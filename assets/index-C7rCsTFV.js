const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/search-worker-entry-DwcQL33J.js","assets/comlink-CUk5F8at.js","assets/chunk-2AUSVPAU-B6cZ_a8c.js","assets/index-Cx7SpYQN.js","assets/big-puzzle-orientation-ZVZQJEF5-BU7G9WHm.js","assets/twisty-dynamic-3d-IKE4BUQG-DBdhnZ6C.js"])))=>i.map(i=>d[i]);
import{_ as y,w as Di,n as bi}from"./comlink-CUk5F8at.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();var Mi={expose:!0},_n=class{is(e){return this instanceof e}as(e){return this instanceof e?this:null}},oe=class extends _n{constructor(){super()}get log(){return console.log.bind(console,this,this.toString())}};function Li(e,t=!0){if(!t)return e;switch(e){case 1:return-1;case-1:return 1}}function Vn(e,t){return t===-1?Array.from(e).reverse():e}function Ii(e){return Array.from(e).reverse()}function*zi(e,t){t===-1?yield*Ei(e):yield*e}function*Ei(e){for(const t of Array.from(e).reverse())yield t}var W=class It extends oe{#e;#t;constructor(t,n){super(),this.#e=Be(t),this.#t=Be(n)}get A(){return this.#e}get B(){return this.#t}isIdentical(t){const n=t.as(It);return!!(n?.A.isIdentical(this.A)&&n?.B.isIdentical(this.B))}invert(){return new It(this.#t,this.#e)}*experimentalExpand(t=1,n){n??=1/0,n===0?yield t===1?this:this.invert():t===1?(yield*this.A.experimentalExpand(1,n-1),yield*this.B.experimentalExpand(1,n-1),yield*this.A.experimentalExpand(-1,n-1),yield*this.B.experimentalExpand(-1,n-1)):(yield*this.B.experimentalExpand(1,n-1),yield*this.A.experimentalExpand(1,n-1),yield*this.B.experimentalExpand(-1,n-1),yield*this.A.experimentalExpand(-1,n-1))}toString(t){return`[${this.#e.toString(t)}, ${this.#t.toString(t)}]`}},F=class zt extends oe{#e;#t;constructor(t,n){super(),this.#e=Be(t),this.#t=Be(n)}get A(){return this.#e}get B(){return this.#t}isIdentical(t){const n=t.as(zt);return!!(n?.A.isIdentical(this.A)&&n?.B.isIdentical(this.B))}invert(){return new zt(this.#e,this.#t.invert())}*experimentalExpand(t,n){n??=1/0,n===0?yield t===1?this:this.invert():(yield*this.A.experimentalExpand(1,n-1),yield*this.B.experimentalExpand(t,n-1),yield*this.A.experimentalExpand(-1,n-1))}toString(t){return`[${this.A.toString(t)}: ${this.B.toString(t)}]`}},Et=2147483647,Tt="2^31 - 1",Ti=-2147483648,lt=class{#e=[];push(e){this.#e.push(e)}experimentalPushAlg(e){for(const t of e.childAlgNodes())this.push(t)}experimentalNumAlgNodes(){return this.#e.length}toAlg(){return new p(this.#e)}reset(){this.#e=[]}},ze=class jn extends oe{#e;constructor(t){if(super(),t.includes(`
`)||t.includes("\r"))throw new Error("LineComment cannot contain newline");this.#e=t}get text(){return this.#e}isIdentical(t){const n=t;return t.is(jn)&&this.#e===n.#e}invert(){return this}*experimentalExpand(t=1,n=1/0){yield this}toString(t){return`//${this.#e}`}},se=class Wn extends oe{toString(t){return`
`}isIdentical(t){return t.is(Wn)}invert(){return this}*experimentalExpand(t=1,n=1/0){yield this}},O=class Gn extends oe{experimentalNISSGrouping;toString(t){return"."}isIdentical(t){return t.is(Gn)}invert(){return this}*experimentalExpand(t=1,n=1/0){yield this}};function Je(e,t){return e?parseInt(e,10):t}var tn=/^(\d+)?('?)/,Ai=/^[_\dA-Za-z]/,ki=/^((([1-9]\d*)-)?([1-9]\d*))?([_A-Za-z]+)/,Ci=/^[^\n]*/,Ri=/^(-?\d+), ?/,Ni=/^(-?\d+)\)/;function qn(e){return new Vt().parseAlg(e)}function Pi(e){return new Vt().parseMove(e)}function Fi(e){return new Vt().parseQuantumMove(e)}var G=Symbol("startCharIndex"),X=Symbol("endCharIndex");function C(e,t,n){const r=e;return r[G]=t,r[X]=n,r}function Bi(e,t){return G in e&&(t[G]=e[G]),X in e&&(t[X]=e[X]),t}var Vt=class{#e="";#t=0;#n=[];parseAlg(e){this.#e=e,this.#t=0;const t=this.parseAlgWithStopping([]);this.mustBeAtEndOfInput();const n=Array.from(t.childAlgNodes());if(this.#n.length>0)for(const a of this.#n.reverse())n.push(a);const r=new p(n),{[G]:i,[X]:s}=t;return C(r,i,s),r}parseMove(e){this.#e=e,this.#t=0;const t=this.parseMoveImpl();return this.mustBeAtEndOfInput(),t}parseQuantumMove(e){this.#e=e,this.#t=0;const t=this.parseQuantumMoveImpl();return this.mustBeAtEndOfInput(),t}mustBeAtEndOfInput(){if(this.#t!==this.#e.length)throw new Error("parsing unexpectedly ended early")}parseAlgWithStopping(e){let t=this.#t,n=this.#t;const r=new lt;let i=!1;const s=a=>{if(i)throw new Error(`Unexpected character at index ${a}. Are you missing a space?`)};for(;this.#t<this.#e.length;){const a=this.#t;if(e.includes(this.#e[this.#t]))return C(r.toAlg(),t,n);if(this.tryConsumeNext(" "))i=!1,r.experimentalNumAlgNodes()===0&&(t=this.#t);else if(Ai.test(this.#e[this.#t])){s(a);const l=this.parseMoveImpl();r.push(l),i=!0,n=this.#t}else if(this.tryConsumeNext("(")){s(a);const l=this.tryRegex(Ri);if(l){const u=l[1],c=this.#t,d=this.parseRegex(Ni),m=C(new o(new te("U_SQ_"),parseInt(u,10)),a+1,a+1+u.length),h=C(new o(new te("D_SQ_"),parseInt(d[1],10)),c,this.#t-1),v=C(new p([m,h]),a+1,this.#t-1);r.push(C(new B(v),a,this.#t)),i=!0,n=this.#t}else{const u=this.parseAlgWithStopping([")"]);this.mustConsumeNext(")");const c=this.parseAmount();r.push(C(new B(u,c),a,this.#t)),i=!0,n=this.#t}}else if(this.tryConsumeNext("^")){this.mustConsumeNext("(");const l=this.parseAlgWithStopping([")"]);this.popNext();const u=new B(l,-1),c=new O;u.experimentalNISSPlaceholder=c,c.experimentalNISSGrouping=u,this.#n.push(u),r.push(c)}else if(this.tryConsumeNext("[")){s(a);const l=this.parseAlgWithStopping([",",":"]),u=this.popNext(),c=this.parseAlgWithStopping(["]"]);this.mustConsumeNext("]");let d;switch(u){case":":{d=C(new F(l,c),a,this.#t),i=!0,n=this.#t;break}case",":{d=C(new W(l,c),a,this.#t),i=!0,n=this.#t;break}default:throw new Error("unexpected parsing error")}const m=this.#t,h=this.parseAmount();if(h===1)r.push(d);else{const v=C(new p([d]),a,m),f=C(new B(v,h),a,this.#t);r.push(f)}i=!0,n=this.#t}else if(this.tryConsumeNext(`
`))r.push(C(new se,a,this.#t)),i=!1,n=this.#t;else if(this.tryConsumeNext("/"))if(this.tryConsumeNext("/")){s(a);const[l]=this.parseRegex(Ci);r.push(C(new ze(l),a,this.#t)),i=!1,n=this.#t}else r.push(C(new o("_SLASH_"),a,this.#t)),i=!0,n=this.#t;else if(this.tryConsumeNext("."))s(a),r.push(C(new O,a,this.#t)),i=!0,n=this.#t;else throw new Error(`Unexpected character: ${this.popNext()}`)}if(this.#t!==this.#e.length)throw new Error("did not finish parsing?");if(e.length>0)throw new Error("expected stopping");return C(r.toAlg(),t,n)}parseQuantumMoveImpl(){const[,,,e,t,n]=this.parseRegex(ki);return new te(n,Je(t,void 0),Je(e,void 0))}parseMoveImpl(){const e=this.#t;if(this.tryConsumeNext("/"))return C(new o("_SLASH_"),e,this.#t);let t=this.parseQuantumMoveImpl(),[n,r]=this.parseAmountAndTrackEmptyAbsAmount();const i=this.parseMoveSuffix();if(i){if(n<0)throw new Error("uh-oh");if((i==="++"||i==="--")&&n!==1)throw new Error("Pochmann ++ or -- moves cannot have an amount other than 1.");if((i==="++"||i==="--")&&!r)throw new Error("Pochmann ++ or -- moves cannot have an amount written as a number.");if((i==="+"||i==="-")&&r)throw new Error("Clock dial moves must have an amount written as a natural number followed by + or -.");i.startsWith("+")&&(t=t.modified({family:`${t.family}_${i==="+"?"PLUS":"PLUSPLUS"}_`})),i.startsWith("-")&&(t=t.modified({family:`${t.family}_${i==="-"?"PLUS":"PLUSPLUS"}_`}),n*=-1)}return C(new o(t,n),e,this.#t)}parseMoveSuffix(){return this.tryConsumeNext("+")?this.tryConsumeNext("+")?"++":"+":this.tryConsumeNext("-")?this.tryConsumeNext("-")?"--":"-":null}parseAmountAndTrackEmptyAbsAmount(){const e=this.#t,[,t,n]=this.parseRegex(tn);if(t?.startsWith("0")&&t!=="0")throw new Error(`Error at char index ${e}: An amount can only start with 0 if it's exactly the digit 0.`);return[Je(t,1)*(n==="'"?-1:1),!t]}parseAmount(){const e=this.#t,[,t,n]=this.parseRegex(tn);if(t?.startsWith("0")&&t!=="0")throw new Error(`Error at char index ${e}: An amount number can only start with 0 if it's exactly the digit 0.`);return Je(t,1)*(n==="'"?-1:1)}parseRegex(e){const t=e.exec(this.remaining());if(t===null)throw new Error("internal parsing error");return this.#t+=t[0].length,t}tryRegex(e){const t=e.exec(this.remaining());return t===null?null:(this.#t+=t[0].length,t)}remaining(){return this.#e.slice(this.#t)}popNext(){const e=this.#e[this.#t];return this.#t++,e}tryConsumeNext(e){return this.#e[this.#t]===e?(this.#t++,!0):!1}mustConsumeNext(e){const t=this.popNext();if(t!==e)throw new Error(`expected \`${e}\` while parsing, encountered ${t}`);return t}},nn=new Set;function $n(e){nn.has(e)||(console.warn(e),nn.add(e))}var At=class{quantum;amount;constructor(e,t=1){if(this.quantum=e,this.amount=t,!Number.isInteger(this.amount)||this.amount<Ti||this.amount>Et)throw new Error(`AlgNode amount absolute value must be a non-negative integer below ${Tt}.`)}suffix(){let e="";const t=Math.abs(this.amount);return t!==1&&(e+=t),this.amount<0&&(e+="'"),e}isIdentical(e){return this.quantum.isIdentical(e.quantum)&&this.amount===e.amount}*experimentalExpand(e,t){const n=Math.abs(this.amount),r=Li(e,this.amount<0);for(let i=0;i<n;i++)yield*this.quantum.experimentalExpand(r,t)}},te=class kt extends _n{#e;#t;#n;constructor(t,n,r){if(super(),this.#e=t,this.#t=n??null,this.#n=r??null,Object.freeze(this),this.#t!==null&&(!Number.isInteger(this.#t)||this.#t<1||this.#t>Et))throw new Error(`QuantumMove inner layer must be a positive integer below ${Tt}.`);if(this.#n!==null&&(!Number.isInteger(this.#n)||this.#n<1||this.#n>Et))throw new Error(`QuantumMove outer layer must be a positive integer below ${Tt}.`);if(this.#n!==null&&this.#t!==null&&this.#t<=this.#n)throw new Error("QuantumMove outer layer must be smaller than inner layer.");if(this.#n!==null&&this.#t===null)throw new Error("QuantumMove with an outer layer must have an inner layer")}static fromString(t){return Fi(t)}modified(t){return new kt(t.family??this.#e,t.innerLayer??this.#t,t.outerLayer??this.#n)}isIdentical(t){const n=t;return t.is(kt)&&this.#e===n.#e&&this.#t===n.#t&&this.#n===n.#n}get family(){return this.#e}get outerLayer(){return this.#n}get innerLayer(){return this.#t}experimentalExpand(){throw new Error("experimentalExpand() cannot be called on a `QuantumMove` directly.")}toString(t){let n=this.#e;return this.#t!==null&&(n=String(this.#t)+n,this.#n!==null&&(n=`${String(this.#n)}-${n}`)),n}},o=class xe extends oe{#e;constructor(...t){if(super(),typeof t[0]=="string")if(t[1]??null){this.#e=new At(te.fromString(t[0]),t[1]);return}else return xe.fromString(t[0]);this.#e=new At(t[0],t[1])}isIdentical(t){const n=t.as(xe);return!!n&&this.#e.isIdentical(n.#e)}invert(){return Bi(this,new xe(this.#e.quantum,this.#n()?this.amount:-this.amount))}*experimentalExpand(t=1){t===1?yield this:yield this.modified({amount:-this.amount})}get quantum(){return this.#e.quantum}modified(t){return new xe(this.#e.quantum.modified(t),t.amount??this.amount)}static fromString(t){return Pi(t)}get amount(){return this.#e.amount}get type(){return $n("deprecated: type"),"blockMove"}get family(){return this.#e.quantum.family??void 0}get outerLayer(){return this.#e.quantum.outerLayer??void 0}get innerLayer(){return this.#e.quantum.innerLayer??void 0}#t;#n(){return this.isIdentical(this.#t??=new xe("_SLASH_"))}toString(t){if(t?.notation!=="LGN"){if(this.#n())return"/";if(this.family.endsWith("_PLUS_"))return this.#e.quantum.toString().slice(0,-6)+Math.abs(this.amount)+(this.amount<0?"-":"+");if(this.family.endsWith("_PLUSPLUS_")){const n=Math.abs(this.amount);return this.#e.quantum.toString().slice(0,-10)+(n===1?"":n)+(this.amount<0?"--":"++")}}return this.#e.quantum.toString(t)+this.#e.suffix()}},Oi=class{quantumU_SQ_=null;quantumD_SQ_=null;format(e,t){if(t?.notation==="LGN"||e.amount!==1)return null;const n=this.tuple(e);return n?`(${n.map(r=>r.amount).join(", ")})`:null}tuple(e){if(e.amount!==1)return null;this.quantumU_SQ_||=new te("U_SQ_"),this.quantumD_SQ_||=new te("D_SQ_");const t=e.alg;if(t.experimentalNumChildAlgNodes()===2){const[n,r]=t.childAlgNodes();if(n.as(o)?.quantum.isIdentical(this.quantumU_SQ_)&&r.as(o)?.quantum.isIdentical(this.quantumD_SQ_))return[n,r]}return null}},wt=new Oi,B=class Re extends oe{#e;experimentalNISSPlaceholder;constructor(t,n){super();const r=Be(t);this.#e=new At(r,n)}isIdentical(t){const n=t;return t.is(Re)&&this.#e.isIdentical(n.#e)}get alg(){return this.#e.quantum}get amount(){return this.#e.amount}modified(t){return new Re(t.alg??this.alg,t.amount??this.amount)}get experimentalRepetitionSuffix(){return this.#e.suffix()}invert(){const t=wt.tuple(this);if(t){const[n,r]=t;return new Re(new p([n.invert(),r.invert()]))}return new Re(this.#e.quantum,-this.#e.amount)}*experimentalExpand(t=1,n){n??=1/0,n===0?yield t===1?this:this.invert():yield*this.#e.experimentalExpand(t,n-1)}static fromString(){throw new Error("unimplemented")}#t(t){const n=this.#e.quantum.toString(t),r=this.alg.childAlgNodes(),{value:i}=r.next();return r.next().done&&(i?.is(W)||i?.is(F))?n:`(${n})`}toString(t){return wt.format(this,t)??`${this.#t(t)}${this.#e.suffix()}`}experimentalAsSquare1Tuple(){return wt.tuple(this)}};function ee(e,t){return e instanceof t}function Ui(e){return ee(e,B)||ee(e,ze)||ee(e,W)||ee(e,F)||ee(e,o)||ee(e,se)||ee(e,O)}var _i="any-direction",Qn=class{constructor(e={}){this.config=e}cancelQuantum(){const{cancel:e}=this.config;return e===!0?_i:e===!1?"none":e?.directional??"none"}cancelAny(){return this.config.cancel&&this.cancelQuantum()!=="none"}cancelPuzzleSpecificModWrap(){const{cancel:e}=this.config;return e===!0||e===!1?"canonical-centered":e?.puzzleSpecificModWrap?e?.puzzleSpecificModWrap:e?.directional==="same-direction"?"preserve-sign":"canonical-centered"}puzzleSpecificSimplifyOptions(){return this.config.puzzleLoader?.puzzleSpecificSimplifyOptions??this.config.puzzleSpecificSimplifyOptions}};function Vi(e,t){return e*Math.sign(t.amount)>=0}function Hn(e,t,n=0){return((e-n)%t+t)%t+n}function Kn(e,t,n){const r=new Qn(n),i=Array.from(e.childAlgNodes());let s=[t];function a(){return new p([...i,...s])}function l(u){if(r.cancelPuzzleSpecificModWrap()==="none")return u;const c=r.puzzleSpecificSimplifyOptions()?.quantumMoveOrder;if(!c)return u;const d=c(t.quantum);let m;switch(r.cancelPuzzleSpecificModWrap()){case"gravity":{m=-Math.floor((d-(u.amount<0?0:1))/2);break}case"canonical-centered":{m=-Math.floor((d-1)/2);break}case"canonical-positive":{m=0;break}case"preserve-sign":{m=u.amount<0?1-d:0;break}default:throw new Error("Unknown mod wrap")}const h=Hn(u.amount,d,m);return u.modified({amount:h})}if(r.cancelAny()){let u;const c=r.puzzleSpecificSimplifyOptions()?.axis;if(c)u=f=>c.areQuantumMovesSameAxis(t.quantum,f.quantum);else{const f=t.quantum.toString();u=b=>b.quantum.toString()===f}const d=r.cancelQuantum()==="same-direction",m=new Map;m.set(t.quantum.toString(),Math.sign(t.amount));let h;for(h=i.length-1;h>=0;h--){const f=i[h].as(o);if(!f||!u(f))break;const b=f.quantum.toString();if(d){const z=m.get(b);if(z&&!Vi(z,f))break;m.set(b,Math.sign(f.amount))}}const v=[...i.splice(h+1),t];if(c)s=c.simplifySameAxisMoves(v,r.cancelPuzzleSpecificModWrap()!=="none");else{const f=v.reduce((b,z)=>b+z.amount,0);if(m.size!==1)throw new Error("Internal error: multiple quantums when one was expected");s=[new o(t.quantum,f)]}}return s=s.map(u=>l(u)).filter(u=>u.amount!==0),a()}function ji(e,t,n){const r=t.as(o);return r?Kn(e,r,n):new p([...e.childAlgNodes(),t])}function Yn(e,t,n){if(t.is(B))return e.traverseGrouping(t,n);if(t.is(o))return e.traverseMove(t,n);if(t.is(W))return e.traverseCommutator(t,n);if(t.is(F))return e.traverseConjugate(t,n);if(t.is(O))return e.traversePause(t,n);if(t.is(se))return e.traverseNewline(t,n);if(t.is(ze))return e.traverseLineComment(t,n);throw new Error("unknown AlgNode")}function Xn(e){if(e.is(B)||e.is(o)||e.is(W)||e.is(F)||e.is(O)||e.is(se)||e.is(ze))return e;throw new Error("internal error: expected AlgNode")}var ge=class{traverseAlgNode(e,t){return Yn(this,e,t)}traverseIntoAlgNode(e,t){return Xn(this.traverseAlgNode(e,t))}},ve=class extends ge{traverseAlgNode(e){return Yn(this,e,void 0)}traverseIntoAlgNode(e){return Xn(this.traverseAlgNode(e))}};function V(e,t){const n=new e(...t??[]);return n.traverseAlg.bind(n)}var Wi=class extends ge{#e;#t(){return this.#e??=new Map}#n(e){return{...e,depth:e.depth?e.depth-1:null}}*traverseAlg(e,t){if(t.depth===0){yield*e.childAlgNodes();return}let n=[];const r=this.#n(t);for(const i of e.childAlgNodes())for(const s of this.traverseAlgNode(i,r))n=Array.from(ji(new p(n),s,r).childAlgNodes());for(const i of n)yield i}*traverseGrouping(e,t){if(t.depth===0){yield e;return}if(e.amount===0)return;const n=new B(this.traverseAlg(e.alg,this.#n(t)),e.amount);if(n.alg.experimentalIsEmpty())return;const r=this.#t().get(e);r&&(n.experimentalNISSPlaceholder=r,r.experimentalNISSGrouping=n),yield n}*traverseMove(e,t){yield e}#r(e,t,n){if(e.experimentalNumChildAlgNodes()===1&&t.experimentalNumChildAlgNodes()===1){const r=Array.from(e.childAlgNodes())[0]?.as(o),i=Array.from(t.childAlgNodes())[0]?.as(o);if(!(r&&i))return!1;if(i.quantum.isIdentical(r.quantum)||new Qn(n).puzzleSpecificSimplifyOptions()?.axis?.areQuantumMovesSameAxis(r.quantum,i.quantum))return!0}return!1}*traverseCommutator(e,t){if(t.depth===0){yield e;return}const n=this.#n(t),r=new W(this.traverseAlg(e.A,n),this.traverseAlg(e.B,n));r.A.experimentalIsEmpty()||r.B.experimentalIsEmpty()||r.A.isIdentical(r.B)||r.A.isIdentical(r.B.invert())||this.#r(r.A,r.B,t)||(yield r)}*traverseConjugate(e,t){if(t.depth===0){yield e;return}const n=this.#n(t),r=new F(this.traverseAlg(e.A,n),this.traverseAlg(e.B,n));if(!r.B.experimentalIsEmpty()){if(r.A.experimentalIsEmpty()||r.A.isIdentical(r.B)||r.A.isIdentical(r.B.invert())||this.#r(r.A,r.B,t)){yield*e.B.childAlgNodes();return}yield r}}*traversePause(e,t){if(e.experimentalNISSGrouping){const n=new O;this.#t().set(e.experimentalNISSGrouping,n),yield n}else yield e}*traverseNewline(e,t){yield e}*traverseLineComment(e,t){yield e}},Gi=V(Wi);function rn(e){if(!e)return[];if(ee(e,p))return e.childAlgNodes();if(typeof e=="string")return qn(e).childAlgNodes();const t=e;if(typeof t[Symbol.iterator]=="function")return t;throw new Error("Invalid AlgNode")}function Be(e){return ee(e,p)?e:new p(e)}var p=class Se extends oe{#e;constructor(t){super(),this.#e=Array.from(rn(t));for(const n of this.#e)if(!Ui(n))throw new Error("An alg can only contain alg nodes.")}isIdentical(t){const n=t;if(!t.is(Se))return!1;const r=Array.from(this.#e),i=Array.from(n.#e);if(r.length!==i.length)return!1;for(let s=0;s<r.length;s++)if(!r[s].isIdentical(i[s]))return!1;return!0}invert(){return new Se(Ii(Array.from(this.#e).map(t=>t.invert())))}*experimentalExpand(t=1,n){n??=1/0;for(const r of Vn(this.#e,t))yield*r.experimentalExpand(t,n)}expand(t){return new Se(this.experimentalExpand(1,t?.depth??1/0))}*experimentalLeafMoves(){for(const t of this.experimentalExpand())t.is(o)&&(yield t)}concat(t){return new Se(Array.from(this.#e).concat(Array.from(rn(t))))}experimentalIsEmpty(){for(const t of this.#e)return!1;return!0}static fromString(t){return qn(t)}units(){return this.childAlgNodes()}*childAlgNodes(){for(const t of this.#e)yield t}experimentalNumUnits(){return this.experimentalNumChildAlgNodes()}experimentalNumChildAlgNodes(){return Array.from(this.#e).length}get type(){return $n("deprecated: type"),"sequence"}toString(t){let n="",r=null;for(const i of this.#e){r&&(n+=qi(r,i));const s=i.as(O)?.experimentalNISSGrouping;if(s){if(s.amount!==-1)throw new Error("Invalid NISS Grouping amount!");n+=`^(${s.alg.toString(t)})`}else i.as(B)?.experimentalNISSPlaceholder||(n+=i.toString(t));r=i}return n}experimentalSimplify(t){return new Se(Gi(this,t??{}))}simplify(t){return this.experimentalSimplify(t)}};function qi(e,t){return e.is(se)||t.is(se)||t.as(B)?.experimentalNISSPlaceholder?"":e.is(ze)&&!t.is(se)?`
`:" "}new p([new o("R",1),new o("U",1),new o("R",-1),new o("U",1),new o("R",1),new o("U",-2),new o("R",-1)]),new p([new o("R",1),new o("U",2),new o("R",-1),new o("U",-1),new o("R",1),new o("U",-1),new o("R",-1)]),new p([new W(new p([new o("R",1),new o("U",1),new o("R",-2)]),new p([new F(new p([new o("R",1)]),new p([new o("U",1)]))]))]),new p([new o("R",1),new o("U",-1),new o("L",-1),new o("U",1),new o("R",-1),new o("U",-1),new o("L",1),new o("U",1)]),new p([new o("x",-1),new W(new p([new F(new p([new o("R",1)]),new p([new o("U",-1)]))]),new p([new o("D",1)])),new W(new p([new F(new p([new o("R",1)]),new p([new o("U",1)]))]),new p([new o("D",1)])),new o("x",1)]),new p([new F(new p([new o("F",1)]),new p([new W(new p([new o("U",1)]),new p([new o("R",1)]))]))]),new p([new F(new p([new o("R",2)]),new p([new W(new p([new o("F",2)]),new p([new o("R",-1),new o("B",-1),new o("R",1)]))]))]),new p([new o("F",1),new o("U",1),new o("R",1),new o("U",-1),new o("R",-1),new o("F",-1)]),new p([new o("R",1),new o("U",1),new o("R",-1),new o("U",-1),new o("R",-1),new o("F",1),new o("R",2),new o("U",-1),new o("R",-1),new o("U",-1),new o("R",1),new o("U",1),new o("R",-1),new o("F",-1)]),new p([new F(new p([new o("F",1)]),new p([new B(new p([new W(new p([new o("R",1)]),new p([new o("U",1)]))]),3)]))]),new p([new O,new O,new O]);var $i=typeof globalThis.Worker>"u"&&typeof globalThis.WorkerNavigator>"u";async function Qi(e,t){const{Worker:n}=globalThis.process.getBuiltinModule("node:worker_threads"),r=new n(e,t);return bi(r)}async function Hi(e,t){let n;return $i?Qi(e):(n=new globalThis.Worker(e,{type:t?t.type:void 0}),n)}function Ki(){return import.meta.resolve("./search-worker-entry.js")}function Yi(){return new URL("data:text/javascript;base64,aW1wb3J0IHsKICBub2RlRW5kcG9pbnRQb3J0Cn0gZnJvbSAiLi9jaHVuay0yQVVTVlBBVS5qcyI7CmltcG9ydCB7CiAgZXhwb3NlQVBJCn0gZnJvbSAiLi9jaHVuay03R1VMM09CUS5qcyI7CmltcG9ydCAiLi9jaHVuay1YTzNKQUEzVi5qcyI7CgovLyBzcmMvY3ViaW5nL3NlYXJjaC93b3JrZXItd29ya2Fyb3VuZHMvc2VhcmNoLXdvcmtlci1lbnRyeS5qcwppZiAoZXhwb3NlQVBJLmV4cG9zZSkgewogIGF3YWl0IGltcG9ydCgiLi9pbnNpZGUtVEpBUUJERFkuanMiKTsKICBjb25zdCBtZXNzYWdlUG9ydCA9IGdsb2JhbFRoaXMucG9zdE1lc3NhZ2UgPyBnbG9iYWxUaGlzIDogYXdhaXQgbm9kZUVuZHBvaW50UG9ydCgpOwogIG1lc3NhZ2VQb3J0LnBvc3RNZXNzYWdlKCJjb21saW5rLWV4cG9zZWQiKTsKfQp2YXIgV09SS0VSX0VOVFJZX0ZJTEVfVVJMID0gaW1wb3J0Lm1ldGEudXJsOwpleHBvcnQgewogIFdPUktFUl9FTlRSWV9GSUxFX1VSTAp9OwovLyMgc291cmNlTWFwcGluZ1VSTD1zZWFyY2gtd29ya2VyLWVudHJ5LmpzLm1hcAo=",import.meta.url)}async function Xi(){return Mi.expose=!1,(await y(async()=>{const{WORKER_ENTRY_FILE_URL:e}=await import("./search-worker-entry-DwcQL33J.js");return{WORKER_ENTRY_FILE_URL:e}},__vite__mapDeps([0,1,2]))).WORKER_ENTRY_FILE_URL}function Zi(){return new Worker(new URL("/Pro-timer/assets/search-worker-entry-C0mCfMUP.js",import.meta.url),{type:"module"})}function Ji(e){try{const t=globalThis.location?.origin,n=e.origin;return!!t&&!!n&&t!==n}catch{return!1}}async function yt(e){const t=new URL(e,import.meta.url),n=Ji(t);try{return sn(t,n)}catch{return sn(t,!n)}}async function sn(e,t){return new Promise(async(n,r)=>{try{e||r(new Error("Could not get worker entry file URL."));let i=e;if(t){const u=`import ${JSON.stringify(e.toString())};`,c=new Blob([u],{type:"text/javascript"});i=new URL(URL.createObjectURL(c))}const s=await Hi(i,{type:"module"});s.unref?.();const a=u=>{r(u)},l=u=>{u==="comlink-exposed"?n(Zn(s)):r(new Error(`wrong module instantiation message ${u}`))};s.nodeWorker?s.nodeWorker.once("message",l):(s.addEventListener("error",a,{once:!0}),s.addEventListener("message",u=>l(u.data),{once:!0}))}catch(i){r(i)}})}async function es(){return new Promise(async(e,t)=>{try{const n=Zi(),r=s=>{t(s)},i=s=>{s==="comlink-exposed"?e(Zn(n)):t(new Error(`wrong module instantiation message ${s}`))};n.addEventListener("error",r,{once:!0}),n.addEventListener("message",s=>i(s.data),{once:!0})}catch(n){t(n)}})}function Zn(e){const t=Di(e),n=e.terminate.bind(e),r=e.nodeWorker,i=r?.ref?.bind(r)??(()=>{}),s=r?.unref?.bind(r)??(()=>{});return{insideAPI:t,outsideAPI:{terminate:n,ref:i,unref:s}}}async function ts(){const e=ns(),{insideAPI:t}=await e;return t.setDebugMeasurePerf(Ct.logPerf),t.setScramblePrefetchLevel(Ct.scramblePrefetchLevel),e}async function ns(){globalThis.location?.protocol==="file:"&&console.warn("This current web page is loaded from the local filesystem (a URL that starts with `file://`). In this situation, `cubing.js` may be unable to generate scrambles or perform searches in some browsers. See: https://js.cubing.net/cubing/scramble/#file-server-required");function e(a){return"Module worker instantiation failed"}const s=[[async()=>yt(Ki()),"using `import.meta.resolve(…)",null],[async()=>yt(await Xi()),"using the `esbuild` workaround",null],[async()=>yt(Yi()),"using `new URL(…, import.meta.url)`","will"],[es,"using inline `new URL(…, import.meta.url)`","may"]];for(const[a,l,u]of s)try{const c=await a();return u&&Ct.showWorkerInstantiationWarnings&&console.warn(`Module worker instantiation required ${l}. \`cubing.js\` ${u} not support this fallback in the future.`),c}catch{}throw new Error(`${e()}. There are no more fallbacks available.`)}var rs;function is(){return rs??=ts()}var xt=new WeakMap;async function ss(e,t){xt.has(e)||xt.set(e,new Set);const n=t(e),r=xt.get(e);r.add(n),e.outsideAPI?.ref?.();try{return await n}finally{r.delete(n),r.size===0&&e.outsideAPI?.unref()}}async function as(e){const t=await is(),n=await ss(t,r=>r.insideAPI.randomScrambleStringForEvent(e));return p.fromString(n)}var Ct={logPerf:!0,scramblePrefetchLevel:"auto",forceNewWorkerForEveryScramble:!1,showWorkerInstantiationWarnings:!0,prioritizeEsbuildWorkaroundForWorkerInstantiation:!1,allowDerivedScrambles:!1};function Rt(e,t,n){const r={};for(const i of e.orbits){const s=t[i.orbitName],a=n[i.orbitName];if(ct(i.numOrientations,a))r[i.orbitName]=s;else if(ct(i.numOrientations,s))r[i.orbitName]=a;else{const l=new Array(i.numPieces);if(i.numOrientations===1){for(let u=0;u<i.numPieces;u++)l[u]=s.permutation[a.permutation[u]];r[i.orbitName]={permutation:l,orientationDelta:s.orientationDelta}}else{const u=new Array(i.numPieces);for(let c=0;c<i.numPieces;c++)u[c]=(s.orientationDelta[a.permutation[c]]+a.orientationDelta[c])%i.numOrientations,l[c]=s.permutation[a.permutation[c]];r[i.orbitName]={permutation:l,orientationDelta:u}}}}return r}function an(e,t,n){const r={};for(const i of e.orbits){const s=t[i.orbitName],a=n[i.orbitName];if(ct(i.numOrientations,a))r[i.orbitName]=s;else{const l=new Array(i.numPieces);if(i.numOrientations===1){for(let c=0;c<i.numPieces;c++)l[c]=s.pieces[a.permutation[c]];const u={pieces:l,orientation:s.orientation};r[i.orbitName]=u}else{const u=new Array(i.numPieces),c=s.orientationMod?new Array(i.numPieces):void 0;for(let m=0;m<i.numPieces;m++){const h=a.permutation[m];let v=i.numOrientations;if(s.orientationMod){const f=s.orientationMod[h];c[m]=f,v=f||i.numOrientations}u[m]=(s.orientation[h]+a.orientationDelta[m])%v,l[m]=s.pieces[h]}const d={pieces:l,orientation:u};c&&(d.orientationMod=c),r[i.orbitName]=d}}}return r}var on=new Map;function os(e){const t=on.get(e);if(t)return t;const n=new Array(e),r=new Array(e);for(let s=0;s<e;s++)n[s]=s,r[s]=0;const i={permutation:n,orientationDelta:r};return on.set(e,i),i}function ls(e){const t={};for(const n of e.orbits)t[n.orbitName]=os(n.numPieces);return t}function cs(e,t){function n(i,s){const a=i.toString(),l=e.definition.moves[a];if(l)return Ie(e,l,s);const u=e.definition.derivedMoves?.[a];if(u)return Ie(e,e.algToTransformation(u).transformationData,s)}const r=n(t.quantum,t.amount)??n(t,1)??n(t.invert,-1);if(r)return r;throw new Error(`Invalid move for KPuzzle (${e.name()}): ${t}`)}var Me=class de{constructor(t,n){this.kpuzzle=t,this.transformationData=n}toJSON(){return{experimentalPuzzleName:this.kpuzzle.name(),transformationData:this.transformationData}}invert(){return new de(this.kpuzzle,Jn(this.kpuzzle,this.transformationData))}#e;isIdentityTransformation(){return this.#e??=this.isIdentical(this.kpuzzle.identityTransformation())}static experimentalConstructIdentity(t){const n=new de(t,ls(t.definition));return n.#e=!0,n}isIdentical(t){return ds(this.kpuzzle,this.transformationData,t.transformationData)}apply(t){return this.applyTransformation(this.kpuzzle.toTransformation(t))}applyTransformation(t){if(this.kpuzzle!==t.kpuzzle)throw new Error(`Tried to apply a transformation for a KPuzzle (${t.kpuzzle.name()}) to a different KPuzzle (${this.kpuzzle.name()}).`);return this.#e?new de(this.kpuzzle,t.transformationData):t.#e?new de(this.kpuzzle,this.transformationData):new de(this.kpuzzle,Rt(this.kpuzzle.definition,this.transformationData,t.transformationData))}applyMove(t){return this.applyTransformation(this.kpuzzle.moveToTransformation(t))}applyAlg(t){return this.applyTransformation(this.kpuzzle.algToTransformation(t))}toKPattern(){return Oe.fromTransformation(this)}repetitionOrder(){return gs(this.kpuzzle.definition,this)}selfMultiply(t){return new de(this.kpuzzle,Ie(this.kpuzzle,this.transformationData,t))}};function ct(e,t){t.permutation||console.log(t);const{permutation:n}=t,r=n.length;for(let i=0;i<r;i++)if(n[i]!==i)return!1;if(e>1){const{orientationDelta:i}=t;for(let s=0;s<r;s++)if(i[s]!==0)return!1}return!0}function us(e,t,n,r={}){for(let i=0;i<e.numPieces;i++)if(!r?.ignorePieceOrientations&&t.orientationDelta[i]!==n.orientationDelta[i]||!r?.ignorePiecePermutation&&t.permutation[i]!==n.permutation[i])return!1;return!0}function ds(e,t,n){for(const r of e.definition.orbits)if(!us(r,t[r.orbitName],n[r.orbitName]))return!1;return!0}function ms(e,t,n,r={}){for(let i=0;i<e.numPieces;i++)if(!r?.ignorePieceOrientations&&(t.orientation[i]!==n.orientation[i]||(t.orientationMod?.[i]??0)!==(n.orientationMod?.[i]??0))||!r?.ignorePieceIndices&&t.pieces[i]!==n.pieces[i])return!1;return!0}function hs(e,t,n){for(const r of e.definition.orbits)if(!ms(r,t[r.orbitName],n[r.orbitName]))return!1;return!0}function Jn(e,t){const n={};for(const r of e.definition.orbits){const i=t[r.orbitName];if(ct(r.numOrientations,i))n[r.orbitName]=i;else if(r.numOrientations===1){const s=new Array(r.numPieces);for(let a=0;a<r.numPieces;a++)s[i.permutation[a]]=a;n[r.orbitName]={permutation:s,orientationDelta:i.orientationDelta}}else{const s=new Array(r.numPieces),a=new Array(r.numPieces);for(let l=0;l<r.numPieces;l++){const u=i.permutation[l];s[u]=l,a[u]=(r.numOrientations-i.orientationDelta[l]+r.numOrientations)%r.numOrientations}n[r.orbitName]={permutation:s,orientationDelta:a}}}return n}function Ie(e,t,n){if(n===1)return t;if(n<0)return Ie(e,Jn(e,t),-n);if(n===0){const{transformationData:s}=e.identityTransformation();return s}let r=t;n!==2&&(r=Ie(e,t,Math.floor(n/2)));const i=Rt(e.definition,r,r);return n%2===0?i:Rt(e.definition,t,i)}var ps=class extends ge{traverseAlg(e,t){let n=null;for(const r of e.childAlgNodes())n?n=n.applyTransformation(this.traverseAlgNode(r,t)):n=this.traverseAlgNode(r,t);return n??t.identityTransformation()}traverseGrouping(e,t){const n=this.traverseAlg(e.alg,t);return new Me(t,Ie(t,n.transformationData,e.amount))}traverseMove(e,t){return t.moveToTransformation(e)}traverseCommutator(e,t){const n=this.traverseAlg(e.A,t),r=this.traverseAlg(e.B,t);return n.applyTransformation(r).applyTransformation(n.invert()).applyTransformation(r.invert())}traverseConjugate(e,t){const n=this.traverseAlg(e.A,t),r=this.traverseAlg(e.B,t);return n.applyTransformation(r).applyTransformation(n.invert())}traversePause(e,t){return t.identityTransformation()}traverseNewline(e,t){return t.identityTransformation()}traverseLineComment(e,t){return t.identityTransformation()}},fs=V(ps);function Nt(e,t){return t?Nt(t,e%t):e}function gs(e,t){let n=1;for(const r of e.orbits){const i=t.transformationData[r.orbitName],s=new Array(r.numPieces);for(let a=0;a<r.numPieces;a++)if(!s[a]){let l=a,u=0,c=0;for(;s[l]=!0,u=u+i.orientationDelta[l],c=c+1,l=i.permutation[l],l!==a;);u!==0&&(c=c*r.numOrientations/Nt(r.numOrientations,Math.abs(u))),n=n*c/Nt(n,c)}}return n}var Oe=class st{constructor(t,n){this.kpuzzle=t,this.patternData=n}toJSON(){return{experimentalPuzzleName:this.kpuzzle.name(),patternData:this.patternData}}static fromTransformation(t){const n=an(t.kpuzzle.definition,t.kpuzzle.definition.defaultPattern,t.transformationData);return new st(t.kpuzzle,n)}apply(t){return this.applyTransformation(this.kpuzzle.toTransformation(t))}applyTransformation(t){if(t.isIdentityTransformation())return new st(this.kpuzzle,this.patternData);const n=an(this.kpuzzle.definition,this.patternData,t.transformationData);return new st(this.kpuzzle,n)}applyMove(t){return this.applyTransformation(this.kpuzzle.moveToTransformation(t))}applyAlg(t){return this.applyTransformation(this.kpuzzle.algToTransformation(t))}isIdentical(t){return hs(this.kpuzzle,this.patternData,t.patternData)}experimentalToTransformation(){if(!this.kpuzzle.canConvertDefaultPatternToUniqueTransformation())return null;const t={};for(const[n,r]of Object.entries(this.patternData)){const i={permutation:r.pieces,orientationDelta:r.orientation};t[n]=i}return new Me(this.kpuzzle,t)}experimentalIsSolved(t){if(!this.kpuzzle.definition.experimentalIsPatternSolved)throw new Error("`KPattern.experimentalIsPatternSolved()` is not supported for this puzzle at the moment.");return this.kpuzzle.definition.experimentalIsPatternSolved(this,t)}},re=class{constructor(e,t){this.definition=e,this.experimentalPGNotation=t?.experimentalPGNotation}experimentalPGNotation;#e;lookupOrbitDefinition(e){return this.#e||=(()=>{const t={};for(const n of this.definition.orbits)t[n.orbitName]=n;return t})(),this.#e[e]}name(){return this.definition.name}identityTransformation(){return Me.experimentalConstructIdentity(this)}#t=new Map;moveToTransformation(e){typeof e=="string"&&(e=new o(e));const t=e.toString(),n=this.#t.get(t);if(n)return new Me(this,n);if(this.experimentalPGNotation){const i=this.experimentalPGNotation.lookupMove(e);if(!i)throw new Error(`could not map to internal move: ${e}`);return this.#t.set(t,i),new Me(this,i)}const r=cs(this,e);return this.#t.set(t,r),new Me(this,r)}algToTransformation(e){return typeof e=="string"&&(e=new p(e)),fs(e,this)}toTransformation(e){return typeof e=="string"?this.algToTransformation(e):e?.is?.(p)?this.algToTransformation(e):e?.is?.(o)?this.moveToTransformation(e):e}defaultPattern(){return new Oe(this,this.definition.defaultPattern)}#n;canConvertDefaultPatternToUniqueTransformation(){return this.#n??=(()=>{for(const e of this.definition.orbits){const t=new Array(e.numPieces).fill(!1);for(const n of this.definition.defaultPattern[e.orbitName].pieces)t[n]=!0;for(const n of t)if(!n)return!1}return!0})()}},er=class at extends Promise{constructor(t){super(n=>{n()}),this._executor=t}static from(t){return new at(n=>{n(t())})}static resolve(t){return new at(n=>{n(t)})}static reject(t){return new at((n,r)=>{r(t)})}then(t,n){return this._promise=this._promise||new Promise(this._executor),this._promise.then(t,n)}catch(t){return this._promise=this._promise||new Promise(this._executor),this._promise.catch(t)}};function jt(e){return new er(t=>{t(e())})}function Gc(e,t,n,r,i){const a=e.orbits[t].pieces[n];if(a===null)return $;const l=a.facelets?.[r];return l===null?$:typeof l=="string"?l:(console.log(l),l.mask)}var me=class{stickerings=new Map;constructor(e,t){for(const n of e.definition.orbits)this.stickerings.set(n.orbitName,new Array(n.numPieces).fill(t))}},$="regular",T="ignored",ye="oriented",vs="experimentalOriented2",Ae="invisible",ce="dim",ke="mystery",ws={Regular:{facelets:[$,$,$,$,$]},Ignored:{facelets:[T,T,T,T,T]},OrientationStickers:{facelets:[ye,ye,ye,ye,ye]},IgnoreNonPrimary:{facelets:[$,T,T,T,T]},Invisible:{facelets:[Ae,Ae,Ae,Ae,Ae]},PermuteNonPrimary:{facelets:[ce,$,$,$,$]},Dim:{facelets:[ce,ce,ce,ce,ce]},Ignoriented:{facelets:[ce,T,T,T,T]},OrientationWithoutPermutation:{facelets:[ye,T,T,T,T]},ExperimentalOrientationWithoutPermutation2:{facelets:[vs,T,T,T,T]},Mystery:{facelets:[ke,ke,ke,ke,ke]}};function tr(e){return ws[e]}var nr=class extends me{constructor(e){super(e,"Regular")}set(e,t){for(const[n,r]of this.stickerings.entries())for(let i=0;i<r.length;i++)e.stickerings.get(n)[i]&&(r[i]=t);return this}toStickeringMask(){const e={orbits:{}};for(const[t,n]of this.stickerings.entries()){const r=[],i={pieces:r};e.orbits[t]=i;for(const s of n)r.push(tr(s))}return e}},rr=class{constructor(e){this.kpuzzle=e}and(e){const t=new me(this.kpuzzle,!1);for(const n of this.kpuzzle.definition.orbits)e:for(let r=0;r<n.numPieces;r++){t.stickerings.get(n.orbitName)[r]=!0;for(const i of e)if(!i.stickerings.get(n.orbitName)[r]){t.stickerings.get(n.orbitName)[r]=!1;continue e}}return t}or(e){const t=new me(this.kpuzzle,!1);for(const n of this.kpuzzle.definition.orbits)e:for(let r=0;r<n.numPieces;r++){t.stickerings.get(n.orbitName)[r]=!1;for(const i of e)if(i.stickerings.get(n.orbitName)[r]){t.stickerings.get(n.orbitName)[r]=!0;continue e}}return t}not(e){const t=new me(this.kpuzzle,!1);for(const n of this.kpuzzle.definition.orbits)for(let r=0;r<n.numPieces;r++)t.stickerings.get(n.orbitName)[r]=!e.stickerings.get(n.orbitName)[r];return t}all(){return this.and(this.moves([]))}move(e){const t=this.kpuzzle.moveToTransformation(e),n=new me(this.kpuzzle,!1);for(const r of this.kpuzzle.definition.orbits)for(let i=0;i<r.numPieces;i++)(t.transformationData[r.orbitName].permutation[i]!==i||t.transformationData[r.orbitName].orientationDelta[i]!==0)&&(n.stickerings.get(r.orbitName)[i]=!0);return n}moves(e){return e.map(t=>this.move(t))}orbits(e){const t=new me(this.kpuzzle,!1);for(const n of e)t.stickerings.get(n).fill(!0);return t}orbitPrefix(e){const t=new me(this.kpuzzle,!1);for(const n of this.kpuzzle.definition.orbits)n.orbitName.startsWith(e)&&t.stickerings.get(n.orbitName).fill(!0);return t}},ln="Last Layer",cn="Last Slot",K={"3x3x3":ln,megaminx:ln},ie={"3x3x3":cn,megaminx:cn},ys={full:{groups:{"3x3x3":"Stickering",megaminx:"Stickering"}},OLL:{groups:K},PLL:{groups:K},LL:{groups:K},EOLL:{groups:K},COLL:{groups:K},OCLL:{groups:K},CPLL:{groups:K},CLL:{groups:K},EPLL:{groups:K},ELL:{groups:K},ZBLL:{groups:K},LS:{groups:ie},LSOLL:{groups:ie},LSOCLL:{groups:ie},ELS:{groups:ie},CLS:{groups:ie},ZBLS:{groups:ie},VLS:{groups:ie},WVLS:{groups:ie},F2L:{groups:{"3x3x3":"CFOP (Fridrich)"}},Daisy:{groups:{"3x3x3":"CFOP (Fridrich)"}},Cross:{groups:{"3x3x3":"CFOP (Fridrich)"}},EO:{groups:{"3x3x3":"ZZ"}},EOline:{groups:{"3x3x3":"ZZ"}},EOcross:{groups:{"3x3x3":"ZZ"}},FirstBlock:{groups:{"3x3x3":"Roux"}},SecondBlock:{groups:{"3x3x3":"Roux"}},CMLL:{groups:{"3x3x3":"Roux"}},L10P:{groups:{"3x3x3":"Roux"}},L6E:{groups:{"3x3x3":"Roux"}},L6EO:{groups:{"3x3x3":"Roux"}},"2x2x2":{groups:{"3x3x3":"Petrus"}},"2x2x3":{groups:{"3x3x3":"Petrus"}},EODF:{groups:{"3x3x3":"Nautilus"}},G1:{groups:{"3x3x3":"FMC"}},L2C:{groups:{"4x4x4":"Reduction","5x5x5":"Reduction","6x6x6":"Reduction"}},OBL:{groups:{"2x2x2":"General"}},PBL:{groups:{"2x2x2":"Ortega"}},"Void Cube":{groups:{"3x3x3":"Miscellaneous"}},invisible:{groups:{"3x3x3":"Miscellaneous"}},picture:{groups:{"3x3x3":"Miscellaneous"}},"centers-only":{groups:{"3x3x3":"Miscellaneous"}},"opposite-centers":{groups:{"4x4x4":"Reduction"}},"experimental-centers-U":{},"experimental-centers-U-D":{},"experimental-centers-U-L-D":{},"experimental-centers-U-L-B-D":{},"experimental-centers":{},"experimental-fto-fc":{groups:{fto:"Bencisco"}},"experimental-fto-f2t":{groups:{fto:"Bencisco"}},"experimental-fto-sc":{groups:{fto:"Bencisco"}},"experimental-fto-l2c":{groups:{fto:"Bencisco"}},"experimental-fto-lbt":{groups:{fto:"Bencisco"}},"experimental-fto-l3t":{groups:{fto:"Bencisco"}}};async function Ue(e,t){return(await xs(e,t)).toStickeringMask()}async function xs(e,t){const n=await e.kpuzzle(),r=new nr(n),i=new rr(n),s=()=>i.move("U"),a=()=>i.or(i.moves(["U","D"])),l=()=>i.or(i.moves(["L","R"])),u=()=>i.not(l()),c=()=>i.not(s()),d=()=>i.orbitPrefix("CENTER"),m=vt=>i.and([i.move(vt),d()]),h=()=>i.orbitPrefix("EDGE"),v=vt=>i.and([i.and(i.moves(vt)),h()]),f=()=>i.or([i.orbitPrefix("CORNER"),i.orbitPrefix("C4RNER"),i.orbitPrefix("C5RNER")]),b=()=>i.or([u(),i.and([s(),h()])]),z=()=>i.and([s(),d()]),I=()=>i.and([i.and(i.moves(["F","R"])),h()]),k=()=>i.and([i.and(i.moves(["F","R"])),f(),i.not(s())]),j=()=>i.or([k(),I()]);function E(){r.set(c(),"Dim")}function Si(){r.set(s(),"PermuteNonPrimary"),r.set(z(),"Dim")}function we(){r.set(s(),"IgnoreNonPrimary"),r.set(z(),"Regular")}function en(){r.set(s(),"Ignoriented"),r.set(z(),"Dim")}switch(t){case"full":break;case"PLL":{E(),Si();break}case"CLS":{E(),r.set(k(),"Regular"),r.set(s(),"Ignoriented"),r.set(i.and([s(),d()]),"Dim"),r.set(i.and([s(),f()]),"IgnoreNonPrimary");break}case"OLL":{E(),we();break}case"EOLL":{E(),we(),r.set(i.and([s(),f()]),"Ignored");break}case"COLL":{E(),r.set(i.and([s(),h()]),"Ignoriented"),r.set(i.and([s(),d()]),"Dim"),r.set(i.and([s(),f()]),"Regular");break}case"OCLL":{E(),en(),r.set(i.and([s(),f()]),"IgnoreNonPrimary");break}case"CPLL":{E(),r.set(i.and([f(),s()]),"PermuteNonPrimary"),r.set(i.and([i.not(f()),s()]),"Dim");break}case"CLL":{E(),r.set(i.not(i.and([f(),s()])),"Dim");break}case"EPLL":{E(),r.set(s(),"Dim"),r.set(i.and([s(),h()]),"PermuteNonPrimary");break}case"ELL":{E(),r.set(s(),"Dim"),r.set(i.and([s(),h()]),"Regular");break}case"ELS":{E(),we(),r.set(i.and([s(),f()]),"Ignored"),r.set(I(),"Regular"),r.set(k(),"Ignored");break}case"LL":{E();break}case"F2L":{r.set(s(),"Ignored");break}case"ZBLL":{E(),r.set(s(),"PermuteNonPrimary"),r.set(z(),"Dim"),r.set(i.and([s(),f()]),"Regular");break}case"ZBLS":{E(),r.set(j(),"Regular"),we(),r.set(i.and([s(),f()]),"Ignored");break}case"VLS":{E(),r.set(j(),"Regular"),we();break}case"WVLS":{E(),r.set(j(),"Regular"),r.set(i.and([s(),h()]),"Ignoriented"),r.set(i.and([s(),d()]),"Dim"),r.set(i.and([s(),f()]),"IgnoreNonPrimary");break}case"LS":{E(),r.set(j(),"Regular"),r.set(s(),"Ignored"),r.set(z(),"Dim");break}case"LSOLL":{E(),we(),r.set(j(),"Regular");break}case"LSOCLL":{E(),en(),r.set(i.and([s(),f()]),"IgnoreNonPrimary"),r.set(j(),"Regular");break}case"EO":{r.set(f(),"Ignored"),r.set(h(),"OrientationWithoutPermutation");break}case"EOline":{r.set(f(),"Ignored"),r.set(h(),"OrientationWithoutPermutation"),r.set(i.and(i.moves(["D","M"])),"Regular");break}case"EOcross":{r.set(h(),"OrientationWithoutPermutation"),r.set(i.move("D"),"Regular"),r.set(f(),"Ignored");break}case"CMLL":{r.set(c(),"Dim"),r.set(b(),"Ignored"),r.set(i.and([s(),f()]),"Regular");break}case"L10P":{r.set(i.not(b()),"Dim"),r.set(i.and([f(),s()]),"Regular");break}case"L6E":{r.set(i.not(b()),"Dim");break}case"L6EO":{r.set(i.not(b()),"Dim"),r.set(b(),"ExperimentalOrientationWithoutPermutation2"),r.set(i.and([d(),a()]),"ExperimentalOrientationWithoutPermutation2"),r.set(i.and([i.move("M"),i.move("E")]),"Ignored");break}case"Daisy":{r.set(i.all(),"Ignored"),r.set(d(),"Dim"),r.set(i.and([i.move("D"),d()]),"Regular"),r.set(i.and([i.move("U"),h()]),"IgnoreNonPrimary");break}case"Cross":{r.set(i.all(),"Ignored"),r.set(d(),"Dim"),r.set(i.and([i.move("D"),d()]),"Regular"),r.set(i.and([i.move("D"),h()]),"Regular");break}case"2x2x2":{r.set(i.or(i.moves(["U","F","R"])),"Ignored"),r.set(i.and([i.or(i.moves(["U","F","R"])),d()]),"Dim");break}case"2x2x3":{r.set(i.all(),"Dim"),r.set(i.or(i.moves(["U","F","R"])),"Ignored"),r.set(i.and([i.or(i.moves(["U","F","R"])),d()]),"Dim"),r.set(i.and([i.move("F"),i.not(i.or(i.moves(["U","R"])))]),"Regular");break}case"G1":{r.set(i.all(),"ExperimentalOrientationWithoutPermutation2"),r.set(i.or(i.moves(["E"])),"OrientationWithoutPermutation"),r.set(i.and(i.moves(["E","S"])),"Ignored");break}case"L2C":{r.set(i.or(i.moves(["L","R","B","D"])),"Dim"),r.set(i.not(d()),"Ignored");break}case"PBL":{r.set(i.all(),"Ignored"),r.set(i.or(i.moves(["U","D"])),"PermuteNonPrimary");break}case"FirstBlock":{r.set(i.not(i.and([i.and(i.moves(["L"])),i.not(s())])),"Ignored"),r.set(m("R"),"Dim");break}case"SecondBlock":{r.set(i.not(i.and([i.and(i.moves(["L"])),i.not(s())])),"Ignored"),r.set(i.and([i.and(i.moves(["L"])),i.not(s())]),"Dim"),r.set(i.and([i.and(i.moves(["R"])),i.not(s())]),"Regular");break}case"EODF":{E(),r.set(i.or([k(),i.and([s(),f()])]),"Ignored"),r.set(i.or([i.and([s(),h()]),I()]),"OrientationWithoutPermutation"),r.set(v(["D","F"]),"Regular"),r.set(m("F"),"Regular");break}case"Void Cube":{r.set(d(),"Invisible");break}case"picture":case"invisible":{r.set(i.all(),"Invisible");break}case"centers-only":{r.set(i.not(d()),"Ignored");break}case"opposite-centers":{r.set(i.not(i.and([d(),i.or(i.moves(["U","D"]))])),"Ignored");break}case"OBL":{r.set(i.or(i.moves(["U","D"])),"IgnoreNonPrimary");break}default:console.warn(`Unsupported stickering for ${e.id}: ${t}. Setting all pieces to dim.`),r.set(i.and(i.moves([])),"Dim")}return r}async function ft(e,t){const n=[],r=[];for(const[i,s]of Object.entries(ys))s.groups&&(e in s.groups?n.push(i):t?.use3x3x3Fallbacks&&"3x3x3"in s.groups&&r.push(i));return n.concat(r)}function S(e){let t=null;return()=>t??=e()}async function Wt(e){return(await y(()=>import("./index-Cx7SpYQN.js"),__vite__mapDeps([3,1]))).getPuzzleGeometryByName(e,{allMoves:!0,orientCenters:!0,addRotations:!0})}async function Ss(e){return(await y(()=>import("./index-Cx7SpYQN.js"),__vite__mapDeps([3,1]))).getPuzzleGeometryByName(e)}async function ir(e,t,n){const r=await e,i=r.getKPuzzleDefinition(!0);i.name=t;const s=await y(()=>import("./index-Cx7SpYQN.js"),__vite__mapDeps([3,1])),a=new s.ExperimentalPGNotation(r,r.getOrbitsDef(!0));if(n){const l=new Set(n);for(const[u,c]of Object.entries(i.defaultPattern))l.has(u)&&(c.orientationMod=new Array(c.pieces.length).fill(1))}return new re(a.remapKPuzzleDefinition(i),{experimentalPGNotation:a})}var Z=class{pgId;id;fullName;inventedBy;inventionYear;#e;constructor(e){this.pgId=e.pgID,this.id=e.id,this.fullName=e.fullName,this.inventedBy=e.inventedBy,this.inventionYear=e.inventionYear,this.#e=e.setOrientationModTo1ForPiecesOfOrbits}#t;pg(){return this.#t??=Wt(this.pgId??this.id)}#n;basePG(){return this.#n??=Ss(this.pgId??this.id)}#r;kpuzzle(){return this.#r??=ir(this.pg(),this.id,this.#e)}#s;svg(){return this.#s??=(async()=>(await this.pg()).generatesvg())()}puzzleSpecificSimplifyOptionsPromise=sr(this.kpuzzle.bind(this))},Ne=class extends Z{stickeringMask(e){return Ue(this,e)}stickerings=()=>ft(this.id,{use3x3x3Fallbacks:!0});algTransformData=Gt};function sr(e){return new er(async t=>{const n=await e();t({quantumMoveOrder:r=>n.moveToTransformation(new o(r)).repetitionOrder()})})}var ut={name:"3x3x3",orbits:[{orbitName:"EDGES",numPieces:12,numOrientations:2},{orbitName:"CORNERS",numPieces:8,numOrientations:3},{orbitName:"CENTERS",numPieces:6,numOrientations:4}],defaultPattern:{EDGES:{pieces:[0,1,2,3,4,5,6,7,8,9,10,11],orientation:[0,0,0,0,0,0,0,0,0,0,0,0]},CORNERS:{pieces:[0,1,2,3,4,5,6,7],orientation:[0,0,0,0,0,0,0,0]},CENTERS:{pieces:[0,1,2,3,4,5],orientation:[0,0,0,0,0,0],orientationMod:[1,1,1,1,1,1]}},moves:{U:{EDGES:{permutation:[1,2,3,0,4,5,6,7,8,9,10,11],orientationDelta:[0,0,0,0,0,0,0,0,0,0,0,0]},CORNERS:{permutation:[1,2,3,0,4,5,6,7],orientationDelta:[0,0,0,0,0,0,0,0]},CENTERS:{permutation:[0,1,2,3,4,5],orientationDelta:[1,0,0,0,0,0]}},y:{EDGES:{permutation:[1,2,3,0,5,6,7,4,10,8,11,9],orientationDelta:[0,0,0,0,0,0,0,0,1,1,1,1]},CORNERS:{permutation:[1,2,3,0,7,4,5,6],orientationDelta:[0,0,0,0,0,0,0,0]},CENTERS:{permutation:[0,2,3,4,1,5],orientationDelta:[1,0,0,0,0,3]}},x:{EDGES:{permutation:[4,8,0,9,6,10,2,11,5,7,1,3],orientationDelta:[1,0,1,0,1,0,1,0,0,0,0,0]},CORNERS:{permutation:[4,0,3,5,7,6,2,1],orientationDelta:[2,1,2,1,1,2,1,2]},CENTERS:{permutation:[2,1,5,3,0,4],orientationDelta:[0,3,0,1,2,2]}},L:{EDGES:{permutation:[0,1,2,11,4,5,6,9,8,3,10,7],orientationDelta:[0,0,0,0,0,0,0,0,0,0,0,0]},CORNERS:{permutation:[0,1,6,2,4,3,5,7],orientationDelta:[0,0,2,1,0,2,1,0]},CENTERS:{permutation:[0,1,2,3,4,5],orientationDelta:[0,1,0,0,0,0]}},F:{EDGES:{permutation:[9,1,2,3,8,5,6,7,0,4,10,11],orientationDelta:[1,0,0,0,1,0,0,0,1,1,0,0]},CORNERS:{permutation:[3,1,2,5,0,4,6,7],orientationDelta:[1,0,0,2,2,1,0,0]},CENTERS:{permutation:[0,1,2,3,4,5],orientationDelta:[0,0,1,0,0,0]}},R:{EDGES:{permutation:[0,8,2,3,4,10,6,7,5,9,1,11],orientationDelta:[0,0,0,0,0,0,0,0,0,0,0,0]},CORNERS:{permutation:[4,0,2,3,7,5,6,1],orientationDelta:[2,1,0,0,1,0,0,2]},CENTERS:{permutation:[0,1,2,3,4,5],orientationDelta:[0,0,0,1,0,0]}},B:{EDGES:{permutation:[0,1,10,3,4,5,11,7,8,9,6,2],orientationDelta:[0,0,1,0,0,0,1,0,0,0,1,1]},CORNERS:{permutation:[0,7,1,3,4,5,2,6],orientationDelta:[0,2,1,0,0,0,2,1]},CENTERS:{permutation:[0,1,2,3,4,5],orientationDelta:[0,0,0,0,1,0]}},D:{EDGES:{permutation:[0,1,2,3,7,4,5,6,8,9,10,11],orientationDelta:[0,0,0,0,0,0,0,0,0,0,0,0]},CORNERS:{permutation:[0,1,2,3,5,6,7,4],orientationDelta:[0,0,0,0,0,0,0,0]},CENTERS:{permutation:[0,1,2,3,4,5],orientationDelta:[0,0,0,0,0,1]}},z:{EDGES:{permutation:[9,3,11,7,8,1,10,5,0,4,2,6],orientationDelta:[1,1,1,1,1,1,1,1,1,1,1,1]},CORNERS:{permutation:[3,2,6,5,0,4,7,1],orientationDelta:[1,2,1,2,2,1,2,1]},CENTERS:{permutation:[1,5,2,0,4,3],orientationDelta:[1,1,1,1,3,1]}},M:{EDGES:{permutation:[2,1,6,3,0,5,4,7,8,9,10,11],orientationDelta:[1,0,1,0,1,0,1,0,0,0,0,0]},CORNERS:{permutation:[0,1,2,3,4,5,6,7],orientationDelta:[0,0,0,0,0,0,0,0]},CENTERS:{permutation:[4,1,0,3,5,2],orientationDelta:[2,0,0,0,2,0]}},E:{EDGES:{permutation:[0,1,2,3,4,5,6,7,9,11,8,10],orientationDelta:[0,0,0,0,0,0,0,0,1,1,1,1]},CORNERS:{permutation:[0,1,2,3,4,5,6,7],orientationDelta:[0,0,0,0,0,0,0,0]},CENTERS:{permutation:[0,4,1,2,3,5],orientationDelta:[0,0,0,0,0,0]}},S:{EDGES:{permutation:[0,3,2,7,4,1,6,5,8,9,10,11],orientationDelta:[0,1,0,1,0,1,0,1,0,0,0,0]},CORNERS:{permutation:[0,1,2,3,4,5,6,7],orientationDelta:[0,0,0,0,0,0,0,0]},CENTERS:{permutation:[1,5,2,0,4,3],orientationDelta:[1,1,0,1,0,1]}},u:{EDGES:{permutation:[1,2,3,0,4,5,6,7,10,8,11,9],orientationDelta:[0,0,0,0,0,0,0,0,1,1,1,1]},CORNERS:{permutation:[1,2,3,0,4,5,6,7],orientationDelta:[0,0,0,0,0,0,0,0]},CENTERS:{permutation:[0,2,3,4,1,5],orientationDelta:[1,0,0,0,0,0]}},l:{EDGES:{permutation:[2,1,6,11,0,5,4,9,8,3,10,7],orientationDelta:[1,0,1,0,1,0,1,0,0,0,0,0]},CORNERS:{permutation:[0,1,6,2,4,3,5,7],orientationDelta:[0,0,2,1,0,2,1,0]},CENTERS:{permutation:[4,1,0,3,5,2],orientationDelta:[2,1,0,0,2,0]}},f:{EDGES:{permutation:[9,3,2,7,8,1,6,5,0,4,10,11],orientationDelta:[1,1,0,1,1,1,0,1,1,1,0,0]},CORNERS:{permutation:[3,1,2,5,0,4,6,7],orientationDelta:[1,0,0,2,2,1,0,0]},CENTERS:{permutation:[1,5,2,0,4,3],orientationDelta:[1,1,1,1,0,1]}},r:{EDGES:{permutation:[4,8,0,3,6,10,2,7,5,9,1,11],orientationDelta:[1,0,1,0,1,0,1,0,0,0,0,0]},CORNERS:{permutation:[4,0,2,3,7,5,6,1],orientationDelta:[2,1,0,0,1,0,0,2]},CENTERS:{permutation:[2,1,5,3,0,4],orientationDelta:[0,0,0,1,2,2]}},b:{EDGES:{permutation:[0,5,10,1,4,7,11,3,8,9,6,2],orientationDelta:[0,1,1,1,0,1,1,1,0,0,1,1]},CORNERS:{permutation:[0,7,1,3,4,5,2,6],orientationDelta:[0,2,1,0,0,0,2,1]},CENTERS:{permutation:[3,0,2,5,4,1],orientationDelta:[3,3,0,3,1,3]}},d:{EDGES:{permutation:[0,1,2,3,7,4,5,6,9,11,8,10],orientationDelta:[0,0,0,0,0,0,0,0,1,1,1,1]},CORNERS:{permutation:[0,1,2,3,5,6,7,4],orientationDelta:[0,0,0,0,0,0,0,0]},CENTERS:{permutation:[0,4,1,2,3,5],orientationDelta:[0,0,0,0,0,1]}}},derivedMoves:{Uw:"u",Lw:"l",Fw:"f",Rw:"r",Bw:"b",Dw:"d",Uv:"y",Lv:"x'",Fv:"z",Rv:"x",Bv:"z'",Dv:"y'","2U":"u U'","2L":"l L'","2F":"f F'","2R":"r R'","2B":"b B'","2D":"d D'"}};function ar(e){const t=e.patternData.CENTERS.pieces[0],n=e.patternData.CENTERS.pieces[5],r=e.patternData.CENTERS.pieces[1];let i=r;return t<r&&i--,n<r&&i--,[t,i]}var un=new Array(6).fill(0).map(()=>new Array(6));function Ds(){{const e=["","z","x","z'","x'","x2"].map(n=>p.fromString(n)),t=new p("y");for(const n of e){let r=cr.algToTransformation(n);for(let i=0;i<4;i++){r=r.applyAlg(t);const[s,a]=ar(r.toKPattern());un[s][a]=r.invert()}}}return un}function bs(e){const[t,n]=ar(e),r=Ds()[t][n];return e.applyTransformation(r)}function Ms(e,t){return t.ignorePuzzleOrientation&&(e=bs(e)),t.ignoreCenterOrientation&&(e=new Oe(e.kpuzzle,{EDGES:e.patternData.EDGES,CORNERS:e.patternData.CORNERS,CENTERS:{pieces:e.patternData.CENTERS.pieces,orientation:new Array(6).fill(0)}})),!!e.experimentalToTransformation()?.isIdentityTransformation()}async function Ls(e){const t=await(e.puzzleSpecificSimplifyOptions??e.puzzleSpecificSimplifyOptionsPromise);return t?{puzzleLoader:{puzzleSpecificSimplifyOptions:t}}:{}}var Is=class extends ge{traverseAlg(e,t){const n=[];for(const r of e.childAlgNodes())n.push(this.traverseAlgNode(r,t));return new p(n)}traverseGrouping(e,t){return e.modified({alg:this.traverseAlg(e.alg,t)})}traverseMove(e,t){const n=(()=>{const{invertExceptByFamily:r}=t;return r?!r.has(e.family):!1})();return e.modified({amount:n?-e.amount:e.amount,family:t.replaceMovesByFamily[e.family]??e.family})}traverseCommutator(e,t){return new W(this.traverseAlg(e.A,t),this.traverseAlg(e.B,t))}traverseConjugate(e,t){return new F(this.traverseAlg(e.A,t),this.traverseAlg(e.B,t))}traversePause(e,t){return e}traverseNewline(e,t){return e}traverseLineComment(e,t){return e}};V(Is);async function Pe(e,t){return(await y(()=>import("./index-Cx7SpYQN.js"),__vite__mapDeps([3,1]))).getPuzzleGeometryByDesc(e,{allMoves:t?.allMoves??!0,orientCenters:t?.orientCenters??!0,addRotations:t?.addRotations??!0,...t})}async function or(e,t){const n=Pe(e,t);return ir(n,`description: ${e}`)}var zs=1;function Es(e,t){const n=zs++;let r=null;const i=async()=>r??=or(e);return{id:`custom-${n}`,fullName:t?.fullName??`Custom Puzzle (instance #${n})`,kpuzzle:i,svg:async()=>(await Pe(e)).generatesvg(),pg:async()=>Pe(e),basePG:async()=>Pe(e,{allMoves:!1,orientCenters:!1,addRotations:!1}),puzzleSpecificSimplifyOptionsPromise:sr(i)}}function lr(e){const n=e.experimentalToTransformation().invert().transformationData.CORNERS;return n.permutation[6]*3+n.orientationDelta[6]}var dn=new Array(24);function Ts(e){{const t=["","z","x","z'","x'","x2"].map(r=>p.fromString(r)),n=new p("y");for(const r of t){let i=e.algToTransformation(r);for(let s=0;s<4;s++){i=i.applyAlg(n);const a=lr(i.toKPattern());dn[a]={transformation:i.invert(),alg:r.concat(n)}}}}return dn}function As(e){const t=lr(e),{transformation:n,alg:r}=Ts(e.kpuzzle)[t];return{normalizedPattern:e.applyTransformation(n),normalizationAlg:r.invert()}}function ks(e,t){return t.ignorePuzzleOrientation&&(e=As(e).normalizedPattern),!!e.experimentalToTransformation().isIdentityTransformation()}var cr=new re(ut);ut.experimentalIsPatternSolved=Ms;var ur=S(()=>y(()=>import("./big-puzzle-orientation-ZVZQJEF5-BU7G9WHm.js"),__vite__mapDeps([4,1]))),dr={KeyI:new o("R"),KeyK:new o("R'"),KeyW:new o("B"),KeyO:new o("B'"),KeyS:new o("D"),KeyL:new o("D'"),KeyD:new o("L"),KeyE:new o("L'"),KeyJ:new o("U"),KeyF:new o("U'"),KeyH:new o("F"),KeyG:new o("F'"),KeyC:new o("l"),KeyR:new o("l'"),KeyU:new o("r"),KeyM:new o("r'"),KeyX:new o("d"),Comma:new o("d'"),KeyT:new o("x"),KeyY:new o("x"),KeyV:new o("x'"),KeyN:new o("x'"),Semicolon:new o("y"),KeyA:new o("y'"),KeyP:new o("z"),KeyQ:new o("z'"),KeyZ:new o("M'"),KeyB:new o("M"),Period:new o("M'"),Backquote:new O};function R(e,t,n,r){const i=[];for(const s of e){const a=o.fromString(s),{family:l,amount:u}=a;if(![-1,1].includes(u))throw new Error("Invalid config move");i.push({family:l,direction:u,type:t,from:n,to:r})}return i}var pe={"x axis":{sliceDiameter:3,extendsThroughEntirePuzzle:!0,moveSourceInfos:[...R(["R"],0,0,3),...R(["L'"],1,0,3),...R(["r","Rw"],2,0,2),...R(["l'","Lw'"],3,0,2),...R(["M'"],4,1,2),...R(["x","Uv","Dv'"],5,0,3)]},"y axis":{sliceDiameter:3,extendsThroughEntirePuzzle:!0,moveSourceInfos:[...R(["U"],0,0,3),...R(["D'"],1,0,3),...R(["u","Uw"],2,0,2),...R(["d'","Dw'"],3,0,2),...R(["E'"],4,1,2),...R(["y","Uv","Dv'"],5,0,3)]},"z axis":{sliceDiameter:3,extendsThroughEntirePuzzle:!0,moveSourceInfos:[...R(["F"],0,0,3),...R(["B'"],1,0,3),...R(["f","Fw"],2,0,3),...R(["b'","Bw'"],3,0,3),...R(["S"],4,1,2),...R(["z","Fv","Bv'"],5,0,3)]}},_e={};for(const[e,t]of Object.entries(pe))for(const n of t.moveSourceInfos)_e[n.family]={axis:e,moveSourceInfo:n};var mr={};for(const e of Object.keys(pe)){const t={};mr[e]=t;for(const n of pe[e].moveSourceInfos)(t[n.type]??=[]).push(n)}var hr={};for(const e of Object.keys(pe)){const t=new Map;hr[e]=t;for(const n of pe[e].moveSourceInfos)t.get(n.from)||t.set(n.from,n)}function mn(e,t){const n=mr[e][t]?.[0];if(!n)throw new Error(`Could not find a reference move (axis: ${e}, move source type: ${t})`);return n}var Cs=(e,t)=>_e[e.family].axis===_e[t.family].axis;function Rs(e,t,n,r){if(t+1===n){const h=hr[e].get(t);if(h)return new o(new te(h.family),r*h.direction)}const i=pe[e],{sliceDiameter:s}=i;if(t===0&&n===s){const h=mn(e,5);return new o(new te(h.family),r*h.direction)}const a=t+n>s;a&&([t,n]=[s-n,s-t]);let l=t+1,u=n;const c=l===u;c&&(u=null),l===1&&(l=null),c&&l===1&&(u=null),!c&&u===2&&(u=null);const m=mn(e,c?a?1:0:a?3:2);return new o(new te(m.family,u,l),r*m.direction)}function Ns(e,t=!0){if(e.length===0)return[];const n=_e[e[0].family].axis,r=pe[n],{sliceDiameter:i}=r,s=new Map;let a=null;function l(h,v){let f=(s.get(h)??0)+v;t&&(f=f%4+5%4-1),f===0?s.delete(h):s.set(h,f)}let u=0;for(const h of Array.from(e).reverse()){u++;const{moveSourceInfo:v}=_e[h.family],f=h.amount*v.direction;switch(v.type){case 0:{const b=(h.innerLayer??1)-1;l(b,f),l(b+1,-f);break}case 1:{const b=i-(h.innerLayer??1);l(b,f),l(b+1,-f);break}case 2:{l((h.outerLayer??1)-1,f),l(h.innerLayer??2,-f);break}case 3:{l(i-(h.innerLayer??2),f),l(i-((h.outerLayer??1)-1),-f);break}case 4:{l(v.from,f),l(v.to,-f);break}case 5:{l(0,f),l(i,-f);break}}[0,2].includes(s.size)&&(a={suffixLength:u,sliceDeltas:new Map(s)})}if(s.size===0)return[];if(!a)return e;let[c,d]=a.sliceDeltas.keys();c>d&&([c,d]=[d,c]);const m=a.sliceDeltas.get(c);return[...e.slice(0,-a.suffixLength),...m!==0?[Rs(n,c,d,m)]:[]]}var Ps={quantumMoveOrder:()=>4,axis:{areQuantumMovesSameAxis:Cs,simplifySameAxisMoves:Ns}},Gt={"↔ Mirror (M)":{replaceMovesByFamily:{L:"R",R:"L",l:"r",r:"l",Lw:"Rw",Rw:"Lw",Lv:"Rv",Rv:"Lv"},invertExceptByFamily:new Set(["x","M","m"])},"⤢ Mirror (S)":{replaceMovesByFamily:{F:"B",B:"F",f:"b",b:"f",Fw:"Bw",Bw:"Fw",Fv:"Bv",Bv:"Fv"},invertExceptByFamily:new Set(["z","S","s"])},"↕ Mirror (E)":{replaceMovesByFamily:{U:"D",D:"U",u:"d",d:"u",Uw:"Dw",Dw:"Uw",Uv:"Dv",Dv:"Uv"},invertExceptByFamily:new Set(["y","E","e"])}},qt={id:"3x3x3",fullName:"3×3×3 Cube",inventedBy:["Ernő Rubik"],inventionYear:1974,kpuzzle:S(async()=>cr),svg:S(async()=>(await y(async()=>{const{cube3x3x3SVG:e}=await import("./puzzles-dynamic-3x3x3-FYXD7SIU-BAAKgtmM.js");return{cube3x3x3SVG:e}},[])).cube3x3x3SVG),llSVG:S(async()=>(await y(async()=>{const{cube3x3x3LLSVG:e}=await import("./puzzles-dynamic-3x3x3-FYXD7SIU-BAAKgtmM.js");return{cube3x3x3LLSVG:e}},[])).cube3x3x3LLSVG),llFaceSVG:S(async()=>(await y(async()=>{const{cube3x3x3LLFaceSVG:e}=await import("./puzzles-dynamic-3x3x3-FYXD7SIU-BAAKgtmM.js");return{cube3x3x3LLFaceSVG:e}},[])).cube3x3x3LLFaceSVG),pg:S(async()=>Wt("3x3x3")),stickeringMask:e=>Ue(qt,e),stickerings:()=>ft("3x3x3"),puzzleSpecificSimplifyOptions:Ps,keyMapping:async()=>dr,algTransformData:Gt},Fs={333:{puzzleID:"3x3x3",eventName:"3x3x3 Cube",scramblesImplemented:"random-state"},222:{puzzleID:"2x2x2",eventName:"2x2x2 Cube",scramblesImplemented:"random-state"},444:{puzzleID:"4x4x4",eventName:"4x4x4 Cube",scramblesImplemented:"random-state"},555:{puzzleID:"5x5x5",eventName:"5x5x5 Cube",scramblesImplemented:"random-moves"},666:{puzzleID:"6x6x6",eventName:"6x6x6 Cube",scramblesImplemented:"random-moves"},777:{puzzleID:"7x7x7",eventName:"7x7x7 Cube",scramblesImplemented:"random-moves"},"333bf":{puzzleID:"3x3x3",eventName:"3x3x3 Blindfolded",scramblesImplemented:"random-state"},"333fm":{puzzleID:"3x3x3",eventName:"3x3x3 Fewest Moves",scramblesImplemented:"random-state"},"333oh":{puzzleID:"3x3x3",eventName:"3x3x3 One-Handed",scramblesImplemented:"random-state"},clock:{puzzleID:"clock",eventName:"Clock",scramblesImplemented:"random-state"},minx:{puzzleID:"megaminx",eventName:"Megaminx",scramblesImplemented:"random-moves"},pyram:{puzzleID:"pyraminx",eventName:"Pyraminx",scramblesImplemented:"random-state"},skewb:{puzzleID:"skewb",eventName:"Skewb",scramblesImplemented:"random-state"},sq1:{puzzleID:"square1",eventName:"Square-1",scramblesImplemented:"random-state"},"444bf":{puzzleID:"4x4x4",eventName:"4x4x4 Blindfolded",scramblesImplemented:"random-state"},"555bf":{puzzleID:"5x5x5",eventName:"5x5x5 Blindfolded",scramblesImplemented:"random-moves"},"333mbf":{puzzleID:"3x3x3",eventName:"3x3x3 Multi-Blind",scramblesImplemented:"random-state"}},Bs={...Fs,fto:{puzzleID:"fto",eventName:"Face-Turning Octahedron",scramblesImplemented:"random-state"},master_tetraminx:{puzzleID:"master_tetraminx",eventName:"Master Tetraminx",scramblesImplemented:"random-state"},kilominx:{puzzleID:"kilominx",eventName:"Kilominx",scramblesImplemented:"random-state"},redi_cube:{puzzleID:"redi_cube",eventName:"Redi Cube",scramblesImplemented:"random-state"},baby_fto:{puzzleID:"baby_fto",eventName:"Baby FTO",scramblesImplemented:"random-state"},loopover:{puzzleID:"loopover",eventName:"Loopover",scramblesImplemented:null}};function Os(e){return Bs[e]??null}var pr={id:"2x2x2",fullName:"2×2×2 Cube",kpuzzle:S(async()=>{const e=new re((await y(async()=>{const{cube2x2x2JSON:t}=await import("./puzzles-dynamic-side-events-IMYJ533P-uM0XY_nj.js");return{cube2x2x2JSON:t}},[])).cube2x2x2JSON);return e.definition.experimentalIsPatternSolved=ks,e}),svg:async()=>(await y(async()=>{const{cube2x2x2SVG:e}=await import("./puzzles-dynamic-side-events-IMYJ533P-uM0XY_nj.js");return{cube2x2x2SVG:e}},[])).cube2x2x2SVG,llSVG:S(async()=>(await y(async()=>{const{cube2x2x2LLSVG:e}=await import("./puzzles-dynamic-side-events-IMYJ533P-uM0XY_nj.js");return{cube2x2x2LLSVG:e}},[])).cube2x2x2LLSVG),pg:S(async()=>Wt("2x2x2")),stickeringMask:e=>Ue(pr,e),stickerings:()=>ft("2x2x2",{use3x3x3Fallbacks:!0}),algTransformData:Gt},fr={...dr,KeyZ:new o("m'"),KeyB:new o("m"),Period:new o("m'")},Ve=new Ne({id:"4x4x4",fullName:"4×4×4 Cube",inventedBy:["Peter Sebestény"],inventionYear:1981});Ve.llSVG=S(async()=>(await y(async()=>{const{cube4x4x4LLSVG:e}=await import("./puzzles-dynamic-4x4x4-REUXFQJ4-BNnOy5ao.js");return{cube4x4x4LLSVG:e}},[])).cube4x4x4LLSVG);Ve.keyMapping=async()=>fr;Ve.kpuzzle=S(async()=>{const e=await Z.prototype.kpuzzle.call(Ve);e.definition.defaultPattern.CENTERS.pieces=[0,0,0,0,4,4,4,4,8,8,8,8,12,12,12,12,16,16,16,16,20,20,20,20];const{experimentalIsBigCubeSolved:t}=await ur();return e.definition.experimentalIsPatternSolved=t,e});var dt=new Ne({id:"5x5x5",fullName:"5×5×5 Cube",inventedBy:["Udo Krell"],inventionYear:1981});dt.keyMapping=async()=>fr;dt.kpuzzle=S(async()=>{const e=await Z.prototype.kpuzzle.call(dt),t=[0,0,0,0,4,4,4,4,8,8,8,8,12,12,12,12,16,16,16,16,20,20,20,20];e.definition.defaultPattern.CENTERS.pieces=t,e.definition.defaultPattern.CENTERS2.pieces=t,e.definition.defaultPattern.CENTERS3.orientationMod=new Array(6).fill(1);const{experimentalIsBigCubeSolved:n}=await ur();return e.definition.experimentalIsPatternSolved=n,e});async function gr(e,t){const n=await e.kpuzzle(),r=new nr(n),i=new rr(n),s=()=>i.and([i.move("U"),i.not(i.or(i.moves(["F","BL","BR"])))]),a=()=>i.and([i.move("U"),i.not(i.move("F"))]),l=()=>i.or([a(),i.and([i.move("F"),i.not(i.or(i.moves(["U","BL","BR"])))])]),u=()=>i.not(i.or([i.and([i.move("U"),i.move("F")]),i.and([i.move("F"),i.move("BL")]),i.and([i.move("F"),i.move("BR")]),i.and([i.move("BL"),i.move("BR")])])),c=()=>i.not(i.or([i.and([i.move("F"),i.move("BL")]),i.and([i.move("F"),i.move("BR")]),i.and([i.move("BL"),i.move("BR")])]));switch(t){case"full":break;case"experimental-fto-fc":{r.set(i.not(s()),"Ignored");break}case"experimental-fto-f2t":{r.set(i.not(a()),"Ignored"),r.set(s(),"Dim");break}case"experimental-fto-sc":{r.set(i.not(l()),"Ignored"),r.set(a(),"Dim");break}case"experimental-fto-l2c":{r.set(i.not(u()),"Ignored"),r.set(l(),"Dim");break}case"experimental-fto-lbt":{r.set(i.not(c()),"Ignored"),r.set(u(),"Dim");break}case"experimental-fto-l3t":{r.set(c(),"Dim");break}default:console.warn(`Unsupported stickering for ${e.id}: ${t}. Setting all pieces to dim.`),r.set(i.and(i.moves([])),"Dim")}return r.toStickeringMask()}async function Us(){return["full","experimental-fto-fc","experimental-fto-f2t","experimental-fto-sc","experimental-fto-l2c","experimental-fto-lbt","experimental-fto-l3t"]}var vr={KeyI:new o("R"),KeyK:new o("R'"),KeyW:new o("B"),KeyO:new o("B'"),KeyS:new o("D"),KeyL:new o("D'"),KeyD:new o("L"),KeyE:new o("L'"),KeyJ:new o("U"),KeyF:new o("U'"),KeyH:new o("F"),KeyG:new o("F'"),KeyN:new o("Rv'"),KeyC:new o("l"),KeyR:new o("l'"),KeyU:new o("r"),KeyM:new o("r'"),KeyX:new o("d"),Comma:new o("d'"),KeyT:new o("Lv'"),KeyY:new o("Rv"),KeyV:new o("Lv"),Semicolon:new o("Uv"),KeyA:new o("Uv'"),KeyP:new o("BR'"),KeyQ:new o("BL"),KeyZ:new o("BL'"),KeyB:new o("T"),Period:new o("BR"),Backquote:new O},_s=class extends Z{constructor(){super({pgID:"skewb diamond",id:"baby_fto",fullName:"Baby FTO",inventedBy:["Uwe Mèffert"],setOrientationModTo1ForPiecesOfOrbits:["CENTERS"]})}stickeringMask(e){return gr(this,e)}svg=S(async()=>(await y(async()=>{const{babyFTOSVG:e}=await import("./puzzles-dynamic-unofficial-P3TW433I-cOWAxRTA.js");return{babyFTOSVG:e}},[])).babyFTOSVG);keyMapping=async()=>vr},Vs=new _s,js={id:"clock",fullName:"Clock",inventedBy:["Christopher C. Wiggs","Christopher J. Taylor"],inventionYear:1988,kpuzzle:S(async()=>new re((await y(async()=>{const{clockJSON:e}=await import("./puzzles-dynamic-side-events-IMYJ533P-uM0XY_nj.js");return{clockJSON:e}},[])).clockJSON)),svg:S(async()=>(await y(async()=>{const{clockSVG:e}=await import("./puzzles-dynamic-side-events-IMYJ533P-uM0XY_nj.js");return{clockSVG:e}},[])).clockSVG)},Ws=class extends Z{constructor(){super({pgID:"FTO",id:"fto",fullName:"Face-Turning Octahedron",inventedBy:["Karl Rohrbach","David Pitcher"],inventionYear:1983})}stickeringMask(e){return gr(this,e)}stickerings=Us;svg=S(async()=>(await y(async()=>{const{ftoSVG:e}=await import("./puzzles-dynamic-unofficial-P3TW433I-cOWAxRTA.js");return{ftoSVG:e}},[])).ftoSVG);keyMapping=async()=>vr;algTransformData={"↔ Mirror (x)":{replaceMovesByFamily:{L:"R",R:"L",l:"r",r:"l",Lw:"Rw",Rw:"Lw",Lv:"Rv",Rv:"Lv",BL:"BR",BR:"BL",bl:"br",br:"bl",BLw:"BRw",BRw:"BLw",BLv:"BRv",BRv:"BLv"},invertExceptByFamily:new Set(["x"])}}},Gs=new Ws,hn="d f 0.56",qs={id:"kilominx",fullName:"Kilominx",kpuzzle:S(()=>or(hn,{includeCenterOrbits:!1,includeEdgeOrbits:!1})),pg:()=>Pe(hn,{includeCenterOrbits:!1,includeEdgeOrbits:!1}),svg:S(async()=>(await y(async()=>{const{kilominxSVG:e}=await import("./puzzles-dynamic-unofficial-P3TW433I-cOWAxRTA.js");return{kilominxSVG:e}},[])).kilominxSVG)},$s={id:"loopover",fullName:"Loopover",inventedBy:["Cary Huang"],inventionYear:2018,kpuzzle:S(async()=>new re((await y(async()=>{const{loopoverJSON:e}=await import("./puzzles-dynamic-unofficial-P3TW433I-cOWAxRTA.js");return{loopoverJSON:e}},[])).loopoverJSON)),svg:async()=>(await y(async()=>{const{loopoverSVG:e}=await import("./puzzles-dynamic-unofficial-P3TW433I-cOWAxRTA.js");return{loopoverSVG:e}},[])).loopoverSVG};async function Qs(e,t){return(await wr()).includes(t)?Ue(e,t):(console.warn(`Unsupported stickering for ${e.id}: ${t}. Setting all pieces to dim.`),Ue(e,"full"))}var Hs=jt(()=>ft("megaminx"));function wr(){return Hs}var Ks={KeyI:new o("R"),KeyK:new o("R'"),KeyW:new o("B"),KeyO:new o("B'"),KeyS:new o("FR"),KeyL:new o("FR'"),KeyD:new o("L"),KeyE:new o("L'"),KeyJ:new o("U"),KeyF:new o("U'"),KeyH:new o("F"),KeyG:new o("F'"),KeyC:new o("Lw"),KeyR:new o("Lw'"),KeyU:new o("Rw"),KeyM:new o("Rw'"),KeyX:new o("d"),Comma:new o("d'"),KeyT:new o("Rv"),KeyY:new o("Rv"),KeyV:new o("Rv'"),KeyN:new o("Rv'"),Semicolon:new o("y"),KeyA:new o("y'"),KeyP:new o("z"),KeyQ:new o("z'"),KeyZ:new o("2L'"),KeyB:new o("2R"),Period:new o("2R'"),Backquote:new O},Ys=class extends Z{constructor(){super({id:"megaminx",fullName:"Megaminx",inventionYear:1981})}stickeringMask(e){return Qs(this,e)}stickerings=wr;llSVG=S(async()=>(await y(async()=>{const{megaminxLLSVG:e}=await import("./puzzles-dynamic-megaminx-2LVHIDL4-Cm8jQJ-N.js");return{megaminxLLSVG:e}},[])).megaminxLLSVG);keyMapping=async()=>Ks},Xs=new Ys,Zs={id:"melindas2x2x2x2",fullName:"Melinda's 2×2×2×2",inventedBy:["Melinda Green"],kpuzzle:S(async()=>new re((await y(async()=>{const{melindas2x2x2x2OrbitJSON:e}=await import("./puzzles-dynamic-side-events-IMYJ533P-uM0XY_nj.js");return{melindas2x2x2x2OrbitJSON:e}},[])).melindas2x2x2x2OrbitJSON)),svg:S(async()=>(await y(async()=>{const{melindas2x2x2x2OrbitSVG:e}=await import("./puzzles-dynamic-side-events-IMYJ533P-uM0XY_nj.js");return{melindas2x2x2x2OrbitSVG:e}},[])).melindas2x2x2x2OrbitSVG)},Js=class extends Z{constructor(){super({id:"pyraminx",fullName:"Pyraminx",inventedBy:["Uwe Meffert"]})}svg=S(async()=>(await y(async()=>{const{pyraminxSVG:e}=await import("./puzzles-dynamic-side-events-IMYJ533P-uM0XY_nj.js");return{pyraminxSVG:e}},[])).pyraminxSVG);algTransformData={"↔ Mirror (x)":{replaceMovesByFamily:{L:"R",R:"L",l:"r",r:"l",Lw:"Rw",Rw:"Lw",Lv:"Rv",Rv:"Lv"},invertExceptByFamily:new Set([])}}},ea=new Js,ta={id:"redi_cube",fullName:"Redi Cube",inventedBy:["Oskar van Deventer"],inventionYear:2009,kpuzzle:S(async()=>new re((await y(async()=>{const{rediCubeJSON:e}=await import("./puzzles-dynamic-unofficial-P3TW433I-cOWAxRTA.js");return{rediCubeJSON:e}},[])).rediCubeJSON)),svg:async()=>(await y(async()=>{const{rediCubeSVG:e}=await import("./puzzles-dynamic-unofficial-P3TW433I-cOWAxRTA.js");return{rediCubeSVG:e}},[])).rediCubeSVG},na={id:"square1",fullName:"Square-1",inventedBy:["Karel Hršel","Vojtech Kopský"],inventionYear:1990,kpuzzle:S(async()=>new re((await y(async()=>{const{sq1HyperOrbitJSON:e}=await import("./puzzles-dynamic-side-events-IMYJ533P-uM0XY_nj.js");return{sq1HyperOrbitJSON:e}},[])).sq1HyperOrbitJSON)),svg:S(async()=>(await y(async()=>{const{sq1HyperOrbitSVG:e}=await import("./puzzles-dynamic-side-events-IMYJ533P-uM0XY_nj.js");return{sq1HyperOrbitSVG:e}},[])).sq1HyperOrbitSVG)},ra={id:"tri_quad",fullName:"TriQuad",inventedBy:["Bram Cohen","Carl Hoff"],inventionYear:2018,kpuzzle:S(async()=>new re((await y(async()=>{const{triQuadJSON:e}=await import("./puzzles-dynamic-side-events-IMYJ533P-uM0XY_nj.js");return{triQuadJSON:e}},[])).triQuadJSON)),svg:S(async()=>(await y(async()=>{const{triQuadSVG:e}=await import("./puzzles-dynamic-side-events-IMYJ533P-uM0XY_nj.js");return{triQuadSVG:e}},[])).triQuadSVG)},$t={"3x3x3":qt,"2x2x2":pr,"4x4x4":Ve,"5x5x5":dt,"6x6x6":new Ne({id:"6x6x6",fullName:"6×6×6 Cube"}),"7x7x7":new Ne({id:"7x7x7",fullName:"7×7×7 Cube"}),"40x40x40":new Ne({id:"40x40x40",fullName:"40×40×40 Cube"}),clock:js,megaminx:Xs,pyraminx:ea,skewb:new Z({id:"skewb",fullName:"Skewb",inventedBy:["Tony Durham"]}),square1:na,fto:Gs,gigaminx:new Z({id:"gigaminx",fullName:"Gigaminx",inventedBy:["Tyler Fox"],inventionYear:2006}),master_tetraminx:new Z({pgID:"master tetraminx",id:"master_tetraminx",fullName:"Master Tetraminx",inventedBy:["Katsuhiko Okamoto"],inventionYear:2002}),kilominx:qs,redi_cube:ta,melindas2x2x2x2:Zs,loopover:$s,tri_quad:ra,baby_fto:Vs},yr=2**53,ia=2097152,sa=11,St=new Uint32Array(2);function aa(){globalThis.crypto.getRandomValues(St);const e=St[0],t=St[1];return Math.floor(e*ia)+(t>>sa)}function oa(e){if(typeof e!="number"||e<0||Math.floor(e)!==e)throw new Error("randomUIntBelow() not called with a positive integer value.");if(e>yr)throw new Error(`Called randomUIntBelow() with max === ${e}, which is larger than JavaScript can handle with integer precision.`)}function la(e){oa(e);for(var t,n,r;;)if(t=aa(),n=Math.floor(t/e),r=n*e,r<=yr-e)return t-r}function xr(e){return e[la(e.length)]}var Sr=!1;function qc(e){Sr=e}function ca(){if(!Sr)throw new Error("Must be called from inside a worker, to avoid impact on page performance. Try importing from the top level of `cubing/solve`?")}function ua(e,t){const n=new lt;n.experimentalPushAlg(e);for(const r of t){const i=xr(r);i!==null&&n.push(o.fromString(i))}return n.toAlg()}var Dr=jt(()=>y(()=>import("./search-dynamic-solve-3x3x3-B2L4IN34-uMfhr9Ka.js"),[])),da="UF UR UB UL DF DR DB DL FR FL BR BL".split(" "),ma="UFR URB UBL ULF DRF DFL DLB DBR".split(" "),ha="U L F R B D".split(" "),pa=[[1,2,0],[0,2,0],[1,1,0],[0,3,0],[2,0,0],[0,1,0],[1,3,0],[0,0,0],[1,0,0],[1,0,2],[0,1,1],[1,1,1],[0,8,1],[2,3,0],[0,10,1],[1,4,1],[0,5,1],[1,7,2],[1,3,2],[0,0,1],[1,0,1],[0,9,0],[2,2,0],[0,8,0],[1,5,1],[0,4,1],[1,4,2],[1,5,0],[0,4,0],[1,4,0],[0,7,0],[2,5,0],[0,5,0],[1,6,0],[0,6,0],[1,7,0],[1,2,2],[0,3,1],[1,3,1],[0,11,1],[2,1,0],[0,9,1],[1,6,1],[0,7,1],[1,5,2],[1,1,2],[0,2,1],[1,2,1],[0,10,0],[2,4,0],[0,11,0],[1,7,1],[0,6,1],[1,6,2]];function pn(e,t){return e.slice(t)+e.slice(0,t)}function fa(e){const t=[[],[]];for(let n=0;n<6;n++)if(e.patternData.CENTERS.pieces[n]!==n)throw new Error("non-oriented puzzles are not supported");for(let n=0;n<12;n++)t[0].push(pn(da[e.patternData.EDGES.pieces[n]],e.patternData.EDGES.orientation[n]));for(let n=0;n<8;n++)t[1].push(pn(ma[e.patternData.CORNERS.pieces[n]],e.patternData.CORNERS.orientation[n]));return t.push(ha),t}function ga(e){const t=fa(e);return pa.map(([n,r,i])=>t[n][r][i]).join("")}function fn(e,t){const n=new Oe(e.kpuzzle,{EDGES:e.patternData.EDGES,CORNERS:e.patternData.CORNERS,CENTERS:{pieces:e.patternData.CENTERS.pieces,orientation:new Array(6).fill(0)}}).experimentalToTransformation(),r=new Oe(t.kpuzzle,{EDGES:t.patternData.EDGES,CORNERS:t.patternData.CORNERS,CENTERS:{pieces:t.patternData.CENTERS.pieces,orientation:new Array(6).fill(0)}}).experimentalToTransformation();return n.isIdentical(r)}function va(e,t){if(fn(e.defaultPattern(),t))return!1;for(const n of"ULFRBD")for(let r=1;r<4;r++){const i=e.moveToTransformation(new o(n,r)).toKPattern();if(fn(i,t))return!1}return!0}var wa=[["R U'","R2 B","D2 B2","D' L B'","R' U'","B","D B2","R' B","L' U","L2 B'","B2","D L B'","L U","B'","U'","R B","D' B2","L B'","U2","U L' B'","","U' L' B'","U","L' B'"],["F2 L2","F' L'","R' F L2","D' L2","F L2","F2 L'","R' F' L'","R2 F L2","R2 F2 L'","L2","F L'","D' L","D2 L2","R2 F' L'","D L","","L2 F L'","L F' L2","L F L'","F' L2","L'","D L2","D F L'","L"],["R B U2 B'","R2 B U' B'","F2 B U B'","F B2 L' B2","B2 L B2","B U' B'","R2 B U2 B'","R' B U' B'","B2 L' B2","F B U B'","B2 U' B2","B' L B","L F' B D' B'","B' U' B2 D B'","B U2 B'","R B U' B'","B2 L2 B2","D' B' L B","B U B'","F' B2 L' B2","","B2 L' B' U' B'"],["U F2 L2 U'","F' U L' U'","F2 U L' U'","U F L2 U'","U2 B2 U2","R' U' B U","D2 U L U'","D U2 B' U2","U L2 U'","F U L' U'","D U L U'","U2 B' U2","","U2 B' U' L' U'","U2 L' U2","U' B U","U L U'","D' U2 B' U2","U L' U'","U2 B U2"],["R' D' F2","F'","F2","D R F'","R D' F2","R2 F'","D' F2","R F'","F2 R' D' F2","F","D2 F2","D' R F'","R2 D' F2","R' F'","D F2","D2 R F'","","F R' D' F2"],["R' D2 F' D F","R F2 R2 F2","R2 F' D2 F","F' R2 D2 F","L D' L'","D F' D2 F","F2 R2 F2","R F' D2 F","F' R2 D' F","F' R' D2 F","F2 R' F2","L D L'","F' R D' F","F2 R F2","F' D2 F","","L D2 R D' L'","F' D2 F' R F2","D2 R2 F2 R2 F2","D F' D' F","F' D F"],["U F2 U'","R U F' U'","D R U F2 U'","U F U'","R2 U F2 U'","R' U F' U'","R U F2 U'","R2 U F' U'","","U L D L' F U'","F2 D' R D F2","D2 U F U'","R' U F2 U'","U F' U'","F2 D2 R D2 F2","D U F U'"],["R2","R' B' D B","D R'","F' R2 F","","R B' D B","R'","B' D B","D' R'","D2 F' R2 F","R","R2 B' D B","D2 R'","B' D' B"],["R2 D' R2","F' R' F R","R D' R2 D R'","D2 R2 D2 R2","R' D' F' R F","U F D F' U'","","R2 D2 B R' B' R'","R' F D' F2 R F","R2 D R2","F2 U F U' F","R' D F' R F","D R2 D2 R2","U F D' F' U'","D R' D2 F' R F","R2 D2 R2","U F D2 F' U'","R' D2 F' R F"],["B R B'","F D F' B R2 B'","D B R2 B'","D2 B R' B'","B R2 B'","D B R' B'","D' B R2 B'","B R' B'","","B R2 B' D B R' B'","D2 B R2 B'","D' B R' B'"],["","R' D R F D2 F'","R' D R","D F D' F'","R F' R' F","F D' F'","R' D' R","F D2 F'","R' D2 R","F D F'"],["","F2 D2 R F' R' D2 F' D2 F'","F2 D2 F' D' F D' F' D2 F'","F2 D F2 D F2 D2 F2","D2 F L D2 L' D2 F'","D F D2 L D2 L' F'","R' D B' D2 B D' R","R' D2 B' D2 B R","F D2 F' D F D F'","F D' L D2 L' D F'","B D' F D B' D' F'","F D2 L D2 L' F'","F D' L D L' D F'","F L D2 L' D2 F'","R' B' D2 B D2 R"],["D'","F L D L' D' F'","D2","L B D B' D' L'","D","B' L' D' L D B","","D F L D L' D' F'"],["F' D2 F D F' D F","F' D' R' D R F","F' R' D' R D F","B D R D' R' B'","","D B' D' L' D L B"],["D F D F' D F D2 F'","F' U2 B' R' B U2 F' L F' L' F'","","D2 L D L2 F L F2 D F"],["L B' L' F L B L' F'","F2 U F' D2 F U' F' D2 F'","D' F' D B D' F D B'","F L2 F R2 F' L2 F R2 F2","D B D' F' D B' D' F","R F L F' R' F L' F'","","D2 B L' U2 L B' D2 B L' U2 L B'","D2 F R' U2 R F' D2 F R' U2 R F'","R F L' F' R' F L F'","D F D' B' D F' D' B","L2 F2 L' B2 L F2 L' B2 L'"],["L B R' B' L' B R B'","R' B R F' R' B' R F","L D2 L U L' D2 L U' L2","","D2 B' D2 F D' L2 F L2 F' D2 B D' F'","D2 F' R' F R2 B' D2 B D2 R' F D2 F'","L B L' F L B' L' F'","F' D2 F' U' F D2 F' U F2","D' B' D F D' B D F'"],["","D2 F' L U2 L' F D2 F' L U2 L' F","D2 B' R U2 R' B D2 B' R U2 R' B"]];async function br(){const e=await $t["3x3x3"].kpuzzle();let t=e.defaultPattern();for(const n of wa)t=t.applyAlg(p.fromString(xr(n)));return va(e,t)?t:br()}async function ya(e){return ca(),p.fromString((await Dr).solvePattern(ga(e)))}async function xa(){return ya(await br())}async function $c(){(await Dr).initialize()}var Sa=[[null,"Rw","Rw2","Rw'","Fw","Fw'"],[null,"Dw","Dw2","Dw'"]];async function Qc(){return ua(await xa(),Sa)}let Qt="";async function Mr(e="333"){let n=(await as(e)).toString();return(e==="minx"||e==="megaminx")&&(n=Da(n)),n}function Da(e){const t=e.split(" ");let n=[],r=[];for(const i of t)r.push(i),(i==="U"||i==="U'")&&(n.push(r.join(" ")),r=[]);return r.length&&n.push(r.join(" ")),n.join(`
`)}async function Qe(e){const t=await Mr(e);t&&(e==="333"||e==="222"||e==="333bf"||e==="333mbf"||e==="333oh"||e==="333fm"||e==="pyram"?(document.getElementById("scrambleVis").style.width="180px",document.getElementById("scrambleVis").style.height="180px",document.getElementById("scrambleVis").style.right="20px",document.getElementById("scrambleVis").style.bottom="10px"):e==="skewb"||e==="444"||e==="444bf"||e==="skewb"?(document.getElementById("scrambleVis").style.width="230px",document.getElementById("scrambleVis").style.height="230px",document.getElementById("scrambleVis").style.right="0px",document.getElementById("scrambleVis").style.bottom="-20px"):e==="sq1"?(document.getElementById("scrambleVis").style.width="230px",document.getElementById("scrambleVis").style.height="230px",document.getElementById("scrambleVis").style.right="-20px",document.getElementById("scrambleVis").style.bottom="20px"):e==="555"||e==="666"||e==="555bf"||e==="777"?(document.getElementById("scrambleVis").style.width="250px",document.getElementById("scrambleVis").style.height="250px",document.getElementById("scrambleVis").style.right="0px",document.getElementById("scrambleVis").style.bottom="-20px"):e==="minx"?(document.getElementById("scrambleVis").style.width="250px",document.getElementById("scrambleVis").style.height="250px",document.getElementById("scrambleVis").style.right="20px",document.getElementById("scrambleVis").style.bottom="-40px"):e==="clock"&&(document.getElementById("scrambleVis").style.width="300px",document.getElementById("scrambleVis").style.height="300px",document.getElementById("scrambleVis").style.right="0px",document.getElementById("scrambleVis").style.bottom="-50px")),Qt=t;const n=document.getElementById("scrambleContainer"),r=document.getElementById("scrambleDisplay");let i=t;(e==="minx"||e==="megaminx")&&(i=ba(t)),r.textContent=i;const s=document.querySelector("#scrambleVis2");s.scramble=t,s.event=`${e}`;let a=40;for(r.style.fontSize=a+"px",r.style.whiteSpace="pre-wrap",r.style.wordBreak="break-word",r.offsetHeight;r.scrollHeight>n.clientHeight;)a-=1,r.style.fontSize=a+"px"}function ba(e){const t=e.split(" ");let n=[],r=[];for(const i of t)r.push(i),(i==="U"||i==="U'")&&(n.push(r.join(" ")),r=[]);return r.length&&n.push(r.join(" ")),n.join(`
`)}var gt=class{#e=0;#t=0;queue(e){return new Promise(async(t,n)=>{try{const r=++this.#e,i=await e;r>this.#t&&(this.#t=r,t(i))}catch(r){n(r)}})}},Lr=0,Ir=class{canReuse(e,t){return e===t||this.canReuseValue(e,t)}canReuseValue(e,t){return!1}debugGetChildren(){return Array.from(this.#e.values())}#e=new Set;addChild(e){this.#e.add(e)}removeChild(e){this.#e.delete(e)}lastSourceGeneration=0;markStale(e){if(e.detail.generation!==Lr)throw new Error("A TwistyProp was marked stale too late!");if(this.lastSourceGeneration!==e.detail.generation){this.lastSourceGeneration=e.detail.generation;for(const t of this.#e)t.markStale(e);this.#n()}}#t=new Set;addRawListener(e,t){this.#t.add(e),t?.initial&&e()}removeRawListener(e){this.#t.delete(e)}#n(){this.#r||(this.#r=!0,setTimeout(()=>this.#s(),0))}#r=!1;#s(){if(!this.#r)throw new Error("Invalid dispatch state!");for(const e of this.#t)e();this.#r=!1}#i=new Map;addFreshListener(e){const t=new gt;let n=null;const r=async()=>{const i=await t.queue(this.get());n!==null&&this.canReuse(n,i)||(n=i,e(i))};this.#i.set(e,r),this.addRawListener(r,{initial:!0})}removeFreshListener(e){this.removeRawListener(this.#i.get(e)),this.#i.delete(e)}},le=class extends Ir{#e;constructor(e){super(),this.#e=jt(()=>this.getDefaultValue()),e&&(this.#e=this.deriveFromPromiseOrValue(e,this.#e))}set(e){this.#e=this.deriveFromPromiseOrValue(e,this.#e);const t={sourceProp:this,value:this.#e,generation:++Lr};this.markStale(new CustomEvent("stale",{detail:t}))}async get(){return this.#e}async deriveFromPromiseOrValue(e,t){return this.derive(await e,t)}},D=class extends le{derive(e){return e}},je=Symbol("no value"),L=class extends Ir{constructor(e,t){super(),this.userVisibleErrorTracker=t,this.#e=e;for(const n of Object.values(e))n.addChild(this)}#e;#t=null;#n=null;async get(){const e=this.lastSourceGeneration;if(this.#n?.generation===e)return this.#n.output;const t={generation:e,output:this.#s(this.#r(),e,this.#t)};return this.#n=t,this.userVisibleErrorTracker?.reset(),t.output}async#r(){const e={};for(const[n,r]of Object.entries(this.#e))e[n]=r.get();const t={};for(const n in this.#e)t[n]=await e[n];return t}async#s(e,t,n=null){const r=await e,i=a=>(this.#t={inputs:r,output:Promise.resolve(a),generation:t},a);if(!n)return i(await this.derive(r));const s=n.inputs;for(const a in this.#e)if(!this.#e[a].canReuse(r[a],s[a]))return i(await this.derive(r));return n.output}},He=class{#e=[];addListener(e,t){let n=!1;const r=i=>{n||t(i)};e.addFreshListener(r),this.#e.push(()=>{e.removeFreshListener(r),n=!0})}addMultiListener3(e,t){this.addMultiListener(e,t)}addMultiListener(e,t){let n=!1,r=e.length-1;const i=async s=>{if(r>0){r--;return}if(n)return;const a=e.map(u=>u.get()),l=await Promise.all(a);t(l)};for(const s of e)s.addFreshListener(i);this.#e.push(()=>{for(const s of e)s.removeFreshListener(i);n=!0})}disconnect(){for(const e of this.#e)e()}},Ma=class{},We;globalThis.HTMLElement?We=globalThis.HTMLElement:We=Ma;var La=class{define(){}},P;globalThis.customElements?P=globalThis.customElements:P=new La;var q,Ia=class{replaceSync(){}};globalThis.CSSStyleSheet?q=globalThis.CSSStyleSheet:q=Ia;var H=class extends We{shadow;contentWrapper;constructor(e){super(),this.shadow=this.attachShadow({mode:e?.mode??"closed"}),this.contentWrapper=document.createElement("div"),this.contentWrapper.classList.add("wrapper"),this.shadow.appendChild(this.contentWrapper)}addCSS(e){this.shadow.adoptedStyleSheets.push(e)}removeCSS(e){const t=this.shadow.adoptedStyleSheets.indexOf(e);typeof t<"u"&&this.shadow.adoptedStyleSheets.splice(t,t+1)}addElement(e){return this.contentWrapper.appendChild(e)}prependElement(e){this.contentWrapper.prepend(e)}removeElement(e){return this.contentWrapper.removeChild(e)}};P.define("twisty-managed-custom-element",H);var Ee=class{constructor(e){this.callback=e}animFrameID=null;animFrame=this.animFrameWrapper.bind(this);requestIsPending(){return!!this.animFrameID}requestAnimFrame(){this.animFrameID||(this.animFrameID=requestAnimationFrame(this.animFrame))}cancelAnimFrame(){this.animFrameID&&(cancelAnimationFrame(this.animFrameID),this.animFrameID=0)}animFrameWrapper(e){this.animFrameID=0,this.callback(e)}},za={floating:!0,none:!0},Ea=class extends D{getDefaultValue(){return"auto"}},Ta=Math.PI*2,Ge=360/Ta,Aa=null;async function J(){return Aa??=y(()=>import("./twisty-dynamic-3d-IKE4BUQG-DBdhnZ6C.js"),__vite__mapDeps([5,1]))}function Pt(){return devicePixelRatio||1}var gn=.1,ka=class extends EventTarget{constructor(e){super(),this.target=e}#e=new Map;start(){this.addTargetListener("pointerdown",this.onPointerDown.bind(this)),this.addTargetListener("contextmenu",e=>{e.preventDefault()}),this.addTargetListener("touchmove",e=>e.preventDefault()),this.addTargetListener("dblclick",e=>e.preventDefault())}stop(){for(const[e,t]of this.#t.entries())this.target.removeEventListener(e,t);this.#t.clear(),this.#n=!1}#t=new Map;addTargetListener(e,t){this.#t.has(e)||(this.target.addEventListener(e,t),this.#t.set(e,t))}#n=!1;#r(){this.#n||(this.addTargetListener("pointermove",this.onPointerMove.bind(this)),this.addTargetListener("pointerup",this.onPointerUp.bind(this)),this.#n=!0)}#s(e){this.#e.delete(e.pointerId)}#i(e){const t=this.#e.get(e.pointerId);if(!t)return{movementInfo:null,hasMoved:!1};let n;return(e.movementX??0)!==0||(e.movementY??0)!==0?n={attachedInfo:t.attachedInfo,movementX:e.movementX,movementY:e.movementY,elapsedMs:e.timeStamp-t.lastTimeStamp}:n={attachedInfo:t.attachedInfo,movementX:e.clientX-t.lastClientX,movementY:e.clientY-t.lastClientY,elapsedMs:e.timeStamp-t.lastTimeStamp},t.lastClientX=e.clientX,t.lastClientY=e.clientY,t.lastTimeStamp=e.timeStamp,Math.abs(n.movementX)<gn&&Math.abs(n.movementY)<gn?{movementInfo:null,hasMoved:t.hasMoved}:(t.hasMoved=!0,{movementInfo:n,hasMoved:t.hasMoved})}onPointerDown(e){this.#r();const t={attachedInfo:{},hasMoved:!1,lastClientX:e.clientX,lastClientY:e.clientY,lastTimeStamp:e.timeStamp};this.#e.set(e.pointerId,t),this.target.setPointerCapture(e.pointerId)}onPointerMove(e){const t=this.#i(e).movementInfo;t&&(e.preventDefault(),this.dispatchEvent(new CustomEvent("move",{detail:t})))}onPointerUp(e){const t=this.#i(e),n=this.#e.get(e.pointerId);this.#s(e),this.target.releasePointerCapture(e.pointerId);let r;if(t.hasMoved)r=new CustomEvent("up",{detail:{attachedInfo:n.attachedInfo}});else{const{altKey:i,ctrlKey:s,metaKey:a,shiftKey:l}=e;r=new CustomEvent("press",{detail:{normalizedX:e.offsetX/this.target.offsetWidth*2-1,normalizedY:1-e.offsetY/this.target.offsetHeight*2,rightClick:!!(e.button&2),keys:{altKey:i,ctrlOrMetaKey:s||a,shiftKey:l}}})}this.dispatchEvent(r)}},Fe=[];async function zr(e,t,n,r){Fe.length===0&&Fe.push(Ht());const i=await Fe[0];return i.setSize(e,t),i.render(n,r),i.domElement}async function Ca(e,t,n,r,i){if(e===0||t===0)return;Fe.length===0&&Fe.push(Ht());const s=await zr(e,t,r,i),a=n.getContext("2d");a.clearRect(0,0,n.width,n.height),a.drawImage(s,0,0)}var Ra="srgb-linear";async function Ht(){const e=(await J()).ThreeWebGLRenderer,t=new e({antialias:!0,alpha:!0});return t.outputColorSpace=Ra,t.setPixelRatio(Pt()),t}var Er=new q;Er.replaceSync(`
:host {
  width: 384px;
  height: 256px;
  display: grid;
}

.wrapper {
  width: 100%;
  height: 100%;
  display: grid;
  overflow: hidden;
  place-content: center;
  contain: strict;
}

.loading {
  width: 4em;
  height: 4em;
  border-radius: 2.5em;
  border: 0.5em solid rgba(0, 0, 0, 0);
  border-top: 0.5em solid rgba(0, 0, 0, 0.7);
  border-right: 0.5em solid rgba(0, 0, 0, 0.7);
  animation: fade-in-delayed 4s, rotate 1s linear infinite;
}

@keyframes fade-in-delayed {
  0% { opacity: 0; }
  25% {opacity: 0; }
  100% { opacity: 1; }
}

@keyframes rotate {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

/* TODO: This is due to stats hack. Replace with \`canvas\`. */
.wrapper > canvas {
  max-width: 100%;
  max-height: 100%;
  animation: fade-in 0.25s ease-in;
}

@keyframes fade-in {
  from { opacity: 0; }
  to { opacity: 1; }
}

.wrapper.invisible {
  opacity: 0;
}

.wrapper.drag-input-enabled > canvas {
  cursor: grab;
}

.wrapper.drag-input-enabled > canvas:active {
  cursor: grabbing;
}
`);var Na=!0,Dt=500,Pa=50,Fa=.75;function vn(e){return(Math.exp(1-e)-(1-e))/(1-Math.E)+1}var Ba=class{constructor(e,t,n,r){this.startTimestamp=e,this.momentumX=t,this.momentumY=n,this.callback=r,this.scheduler.requestAnimFrame(),this.lastTimestamp=e}scheduler=new Ee(this.render.bind(this));lastTimestamp;render(e){const t=(this.lastTimestamp-this.startTimestamp)/Dt,n=Math.min(1,(e-this.startTimestamp)/Dt);if(t===0&&n>Pa/Dt)return;const r=vn(n)-vn(t);this.callback(this.momentumX*r*1e3,this.momentumY*r*1e3),n<1&&this.scheduler.requestAnimFrame(),this.lastTimestamp=e}},Oa=class{constructor(e,t,n,r){this.model=e,this.mirror=t,this.canvas=n,this.dragTracker=r,this.dragTracker.addEventListener("move",this.onMove.bind(this)),this.dragTracker.addEventListener("up",this.onUp.bind(this))}experimentalInertia=Na;onMovementBound=this.onMovement.bind(this);experimentalHasBeenMoved=!1;temperMovement(e){return Math.sign(e)*Math.log(Math.abs(e*10)+1)/6}onMove(e){e.detail.attachedInfo??={};const{temperedX:t,temperedY:n}=this.onMovement(e.detail.movementX,e.detail.movementY),r=e.detail.attachedInfo;r.lastTemperedX=t*10,r.lastTemperedY=n*10,r.timestamp=e.timeStamp}onMovement(e,t){const n=this.mirror?-1:1,r=Math.min(this.canvas.offsetWidth,this.canvas.offsetHeight),i=this.temperMovement(e/r),s=this.temperMovement(t/r*Fa);return this.model.twistySceneModel.orbitCoordinatesRequest.set((async()=>{const a=await this.model.twistySceneModel.orbitCoordinates.get();return{latitude:a.latitude+2*s*Ge*n,longitude:a.longitude-2*i*Ge}})()),{temperedX:i,temperedY:s}}onUp(e){e.preventDefault(),"lastTemperedX"in e.detail.attachedInfo&&"lastTemperedY"in e.detail.attachedInfo&&"timestamp"in e.detail.attachedInfo&&e.timeStamp-e.detail.attachedInfo.timestamp<60&&new Ba(e.timeStamp,e.detail.attachedInfo.lastTemperedX,e.detail.attachedInfo.lastTemperedY,this.onMovementBound)}};async function Tr(e,t,n=!1){const r=new(await J()).ThreeSpherical(t.distance,(90-(n?-1:1)*t.latitude)/Ge,((n?180:0)+t.longitude)/Ge);r.makeSafe(),e.position.setFromSpherical(r),e.lookAt(0,0,0)}var wn=0,Ua=2,Ar=!1;function _a(){return wn<Ua?(wn++,!1):(Ar=!0,!0)}function Hc(){return Ar}var Ft=class extends H{constructor(e,t,n){super(),this.model=e,this.options=n,this.scene=t??null,this.loadingElement=this.addElement(document.createElement("div")),this.loadingElement.classList.add("loading")}scene=null;stats=null;rendererIsShared=_a();loadingElement=null;async connectedCallback(){this.addCSS(Er),this.addElement((await this.canvasInfo()).canvas),this.#s(),new ResizeObserver(this.#s.bind(this)).observe(this.contentWrapper),this.orbitControls(),this.#e(),this.scheduleRender()}async#e(){(await this.#l()).addEventListener("press",(async t=>{await this.model.twistySceneModel.movePressInput.get()==="basic"&&this.dispatchEvent(new CustomEvent("press",{detail:{pressInfo:t.detail,cameraPromise:this.camera()}}))}))}#t=new gt;async clearCanvas(){if(this.rendererIsShared){const e=await this.canvasInfo();e.context.clearRect(0,0,e.canvas.width,e.canvas.height)}else{const t=(await this.renderer()).getContext();t.clear(t.COLOR_BUFFER_BIT)}}#n=0;#r=0;async#s(){const e=await this.#t.queue(this.camera()),t=this.contentWrapper.clientWidth,n=this.contentWrapper.clientHeight;this.#n=t,this.#r=n;const r=0;let i=0,s=0;if(n>t&&(s=n-t,i=-Math.floor(.5*s)),e.aspect=t/n,e.setViewOffset(t,n-s,r,i,t,n),e.updateProjectionMatrix(),this.clearCanvas(),this.rendererIsShared){const a=await this.canvasInfo();a.canvas.width=t*Pt(),a.canvas.height=n*Pt(),a.canvas.style.width=`${t.toString()}px`,a.canvas.style.height=`${n.toString()}px`}else(await this.renderer()).setSize(t,n,!0);this.scheduleRender()}#i=null;async renderer(){if(this.rendererIsShared)throw new Error("renderer expected to be shared.");return this.#i??=Ht()}#a=null;async canvasInfo(){return this.#a??=(async()=>{let e;if(this.rendererIsShared)e=this.addElement(document.createElement("canvas"));else{const n=await this.renderer();e=this.addElement(n.domElement)}this.loadingElement?.remove();const t=e.getContext("2d");return{canvas:e,context:t}})()}#o=null;async#l(){return this.#o??=(async()=>{const e=new ka((await this.canvasInfo()).canvas);return this.model?.twistySceneModel.dragInput.addFreshListener(t=>{let n=!1;switch(t){case"auto":{e.start(),n=!0;break}case"none":{e.stop();break}}this.contentWrapper.classList.toggle("drag-input-enabled",n)}),e})()}#u=null;async camera(){return this.#u??=(async()=>{const e=new(await J()).ThreePerspectiveCamera(20,1,.1,20);return e.position.copy(new(await J()).ThreeVector3(2,4,4).multiplyScalar(this.options?.backView?-1:1)),e.lookAt(0,0,0),e})()}#d=null;async orbitControls(){return this.#d??=(async()=>{const e=new Oa(this.model,!!this.options?.backView,(await this.canvasInfo()).canvas,await this.#l());return this.model&&this.addListener(this.model.twistySceneModel.orbitCoordinates,async t=>{const n=await this.camera();Tr(n,t,this.options?.backView),this.scheduleRender()}),e})()}addListener(e,t){e.addFreshListener(t),this.#c.push(()=>{e.removeFreshListener(t)})}#c=[];disconnect(){for(const e of this.#c)e();this.#c=[]}#m=null;experimentalNextRenderFinishedCallback(e){this.#m=e}async render(){if(!this.scene)throw new Error("Attempted to render without a scene");this.stats?.begin();const[e,t,n]=await Promise.all([this.scene.scene(),this.camera(),this.canvasInfo()]);this.rendererIsShared?await Ca(this.#n,this.#r,n.canvas,e,t):(await this.renderer()).render(e,t),this.stats?.end(),this.#m?.(),this.#m=null}#h=new Ee(this.render.bind(this));scheduleRender(){this.#h.requestAnimFrame()}};P.define("twisty-3d-vantage",Ft);var Va=class extends ve{traverseAlg(e){let t=0;for(const n of e.childAlgNodes())t+=this.traverseAlgNode(n);return t}traverseGrouping(e){return this.traverseAlg(e.alg)*Math.abs(e.amount)}traverseMove(e){return 1}traverseCommutator(e){return 2*(this.traverseAlg(e.A)+this.traverseAlg(e.B))}traverseConjugate(e){return 2*this.traverseAlg(e.A)+this.traverseAlg(e.B)}traversePause(e){return 1}traverseNewline(e){return 0}traverseLineComment(e){return 0}},ja=V(Va);function Wa(e){return e.endsWith("v")||["x","y","z"].includes(e)?"Rotation":e.startsWith("2")||["M","E","S"].includes(e)?"Inner":"Outer"}var Ce;function Ga(){if(Ce)return Ce;Ce={};const e=[...Object.keys(ut.moves),...Object.keys(ut.derivedMoves)];for(const t of e)Ce[t]=Wa(t);return Ce}var kr={OBTM:{Rotation:{constantFactor:0,amountFactor:0,zeroAmount:0},Outer:{constantFactor:1,amountFactor:0,zeroAmount:0},Inner:{constantFactor:2,amountFactor:0,zeroAmount:0}},RBTM:{Rotation:{constantFactor:0,amountFactor:0,zeroAmount:0},Outer:{constantFactor:1,amountFactor:0,zeroAmount:0},Inner:{constantFactor:1,amountFactor:0,zeroAmount:0}},OBQTM:{Rotation:{constantFactor:0,amountFactor:0,zeroAmount:0},Outer:{constantFactor:0,amountFactor:1,zeroAmount:0},Inner:{constantFactor:0,amountFactor:2,zeroAmount:0}},RBQTM:{Rotation:{constantFactor:0,amountFactor:0,zeroAmount:0},Outer:{constantFactor:0,amountFactor:1,zeroAmount:0},Inner:{constantFactor:0,amountFactor:1,zeroAmount:0}},ETM:{Rotation:{constantFactor:1,amountFactor:0,zeroAmount:1},Outer:{constantFactor:1,amountFactor:0,zeroAmount:1},Inner:{constantFactor:1,amountFactor:0,zeroAmount:1}}};function qa(e,t){const n=kr[e];if(!n)throw new Error(`Invalid metric for 3x3x3: ${e}`);const r=Ga(),i=t.quantum.toString();if(!(i in r))throw new Error(`Invalid move for 3x3x3 ${e}: ${i}`);const s=r[i],{constantFactor:a,amountFactor:l,zeroAmount:u}=n[s];return t.amount===0?u:a+l*Math.abs(t.amount)}var Ke=class extends ve{constructor(e){super(),this.metric=e}traverseAlg(e){let t=0;for(const n of e.childAlgNodes())t+=this.traverseAlgNode(n);return t}traverseGrouping(e){const t=e.alg;return this.traverseAlg(t)*Math.abs(e.amount)}traverseMove(e){return this.metric(e)}traverseCommutator(e){return 2*(this.traverseAlg(e.A)+this.traverseAlg(e.B))}traverseConjugate(e){return 2*this.traverseAlg(e.A)+this.traverseAlg(e.B)}traversePause(e){return 0}traverseNewline(e){return 0}traverseLineComment(e){return 0}},$a=class extends ve{traverseAlg(e){let t=0;for(const n of e.childAlgNodes())t+=this.traverseAlgNode(n);return t}traverseGrouping(e){const t=e.alg;return this.traverseAlg(t)*Math.abs(e.amount)}traverseMove(e){return 1}traverseCommutator(e){return 2*(this.traverseAlg(e.A)+this.traverseAlg(e.B))}traverseConjugate(e){return 2*this.traverseAlg(e.A)+this.traverseAlg(e.B)}traversePause(e){return 1}traverseNewline(e){return 1}traverseLineComment(e){return 1}};function Cr(e){return"A"<=e&&e<="Z"}function Qa(e){const t=e.family;return Cr(t[0])&&t[t.length-1]==="v"||t==="x"||t==="y"||t==="z"||t==="T"?0:1}function Ha(e){return 1}function Rr(e){const t=e.family;return Cr(t[0])&&t[t.length-1]==="v"||t==="x"||t==="y"||t==="z"||t==="T"?0:1}function Ka(e){return Math.abs(e.amount)*Rr(e)}var Kc=V(Ke,[Qa]),Ya=V(Ke,[Ha]),Xa=V(Ke,[Ka]),Za=V(Ke,[Rr]),Ja=V($a,[]);function eo(e,t,n){if(e.id==="3x3x3"){if(t in kr)return V(Ke,[r=>qa(t,r)])(n)}else switch(t){case"ETM":return Ya(n);case"RBTM":{if(e.pg)return Za(n);break}case"RBQTM":{if(e.pg)return Xa(n);break}}throw new Error("Unsupported puzzle or metric.")}function he(e){switch(Math.abs(e)){case 0:return 0;case 1:return 1e3;case 2:return 1500;default:return 2e3}}var Nr=class extends ve{constructor(e=he){super(),this.durationForAmount=e}traverseAlg(e){let t=0;for(const n of e.childAlgNodes())t+=this.traverseAlgNode(n);return t}traverseGrouping(e){return e.amount*this.traverseAlg(e.alg)}traverseMove(e){return this.durationForAmount(e.amount)}traverseCommutator(e){return 2*(this.traverseAlg(e.A)+this.traverseAlg(e.B))}traverseConjugate(e){return 2*this.traverseAlg(e.A)+this.traverseAlg(e.B)}traversePause(e){return this.durationForAmount(1)}traverseNewline(e){return this.durationForAmount(1)}traverseLineComment(e){return this.durationForAmount(0)}},to=class{constructor(e,t){this.kpuzzle=e,this.moves=new p(t.experimentalExpand())}moves;durationFn=new Nr(he);getAnimLeaf(e){return Array.from(this.moves.childAlgNodes())[e]}indexToMoveStartTimestamp(e){const t=new p(Array.from(this.moves.childAlgNodes()).slice(0,e));return this.durationFn.traverseAlg(t)}timestampToIndex(e){let t=0,n;for(n=0;n<this.numAnimatedLeaves();n++)if(t+=this.durationFn.traverseMove(this.getAnimLeaf(n)),t>=e)return n;return n}patternAtIndex(e){return this.kpuzzle.defaultPattern().applyTransformation(this.transformationAtIndex(e))}transformationAtIndex(e){let t=this.kpuzzle.identityTransformation();for(const n of Array.from(this.moves.childAlgNodes()).slice(0,e))t=t.applyMove(n);return t}algDuration(){return this.durationFn.traverseAlg(this.moves)}numAnimatedLeaves(){return ja(this.moves)}moveDuration(e){return this.durationFn.traverseMove(this.getAnimLeaf(e))}},ue=class{constructor(e,t,n,r,i=[]){this.moveCount=e,this.duration=t,this.forward=n,this.backward=r,this.children=i}},no=class extends ve{constructor(e){super(),this.kpuzzle=e,this.identity=e.identityTransformation(),this.dummyLeaf=new ue(0,0,this.identity,this.identity,[])}identity;dummyLeaf;durationFn=new Nr(he);cache={};traverseAlg(e){let t=0,n=0,r=this.identity;const i=[];for(const s of e.childAlgNodes()){const a=this.traverseAlgNode(s);t+=a.moveCount,n+=a.duration,r===this.identity?r=a.forward:r=r.applyTransformation(a.forward),i.push(a)}return new ue(t,n,r,r.invert(),i)}traverseGrouping(e){const t=this.traverseAlg(e.alg);return this.mult(t,e.amount,[t])}traverseMove(e){const t=e.toString();let n=this.cache[t];if(n)return n;const r=this.kpuzzle.moveToTransformation(e);return n=new ue(1,this.durationFn.traverseAlgNode(e),r,r.invert()),this.cache[t]=n,n}traverseCommutator(e){const t=this.traverseAlg(e.A),n=this.traverseAlg(e.B),r=t.forward.applyTransformation(n.forward),i=t.backward.applyTransformation(n.backward),s=r.applyTransformation(i),a=new ue(2*(t.moveCount+n.moveCount),2*(t.duration+n.duration),s,s.invert(),[t,n]);return this.mult(a,1,[a,t,n])}traverseConjugate(e){const t=this.traverseAlg(e.A),n=this.traverseAlg(e.B),i=t.forward.applyTransformation(n.forward).applyTransformation(t.backward),s=new ue(2*t.moveCount+n.moveCount,2*t.duration+n.duration,i,i.invert(),[t,n]);return this.mult(s,1,[s,t,n])}traversePause(e){return e.experimentalNISSGrouping?this.dummyLeaf:new ue(1,this.durationFn.traverseAlgNode(e),this.identity,this.identity)}traverseNewline(e){return this.dummyLeaf}traverseLineComment(e){return this.dummyLeaf}mult(e,t,n){const r=Math.abs(t),i=e.forward.selfMultiply(t);return new ue(e.moveCount*r,e.duration*r,i,i.invert(),n)}},N=class{constructor(e,t){this.apd=e,this.back=t}},ro=class extends ge{constructor(e,t,n){super(),this.kpuzzle=e,this.algOrAlgNode=t,this.apd=n,this.i=-1,this.dur=-1,this.goalIndex=-1,this.goalDuration=-1,this.move=void 0,this.back=!1,this.moveDuration=0,this.st=this.kpuzzle.identityTransformation(),this.root=new N(this.apd,!1)}move;moveDuration;back;st;root;i;dur;goalIndex;goalDuration;moveByIndex(e){return this.i>=0&&this.i===e?this.move!==void 0:this.dosearch(e,1/0)}moveByDuration(e){return this.dur>=0&&this.dur<e&&this.dur+this.moveDuration>=e?this.move!==void 0:this.dosearch(1/0,e)}dosearch(e,t){return this.goalIndex=e,this.goalDuration=t,this.i=0,this.dur=0,this.move=void 0,this.moveDuration=0,this.back=!1,this.st=this.kpuzzle.identityTransformation(),this.algOrAlgNode.is(p)?this.traverseAlg(this.algOrAlgNode,this.root):this.traverseAlgNode(this.algOrAlgNode,this.root)}traverseAlg(e,t){if(!this.firstcheck(t))return!1;let n=t.back?e.experimentalNumChildAlgNodes()-1:0;for(const r of zi(e.childAlgNodes(),t.back?-1:1)){if(this.traverseAlgNode(r,new N(t.apd.children[n],t.back)))return!0;n+=t.back?-1:1}return!1}traverseGrouping(e,t){if(!this.firstcheck(t))return!1;const n=this.domult(t,e.amount);return this.traverseAlg(e.alg,new N(t.apd.children[0],n))}traverseMove(e,t){return this.firstcheck(t)?(this.move=e,this.moveDuration=t.apd.duration,this.back=t.back,!0):!1}traverseCommutator(e,t){if(!this.firstcheck(t))return!1;const n=this.domult(t,1);return n?this.traverseAlg(e.B,new N(t.apd.children[2],!n))||this.traverseAlg(e.A,new N(t.apd.children[1],!n))||this.traverseAlg(e.B,new N(t.apd.children[2],n))||this.traverseAlg(e.A,new N(t.apd.children[1],n)):this.traverseAlg(e.A,new N(t.apd.children[1],n))||this.traverseAlg(e.B,new N(t.apd.children[2],n))||this.traverseAlg(e.A,new N(t.apd.children[1],!n))||this.traverseAlg(e.B,new N(t.apd.children[2],!n))}traverseConjugate(e,t){if(!this.firstcheck(t))return!1;const n=this.domult(t,1);return n?this.traverseAlg(e.A,new N(t.apd.children[1],!n))||this.traverseAlg(e.B,new N(t.apd.children[2],n))||this.traverseAlg(e.A,new N(t.apd.children[1],n)):this.traverseAlg(e.A,new N(t.apd.children[1],n))||this.traverseAlg(e.B,new N(t.apd.children[2],n))||this.traverseAlg(e.A,new N(t.apd.children[1],!n))}traversePause(e,t){return this.firstcheck(t)?(this.move=e,this.moveDuration=t.apd.duration,this.back=t.back,!0):!1}traverseNewline(e,t){return!1}traverseLineComment(e,t){return!1}firstcheck(e){return e.apd.moveCount+this.i<=this.goalIndex&&e.apd.duration+this.dur<this.goalDuration?this.keepgoing(e):!0}domult(e,t){let n=e.back;if(t===0)return n;t<0&&(n=!n,t=-t);const r=e.apd.children[0],i=Math.min(Math.floor((this.goalIndex-this.i)/r.moveCount),Math.ceil((this.goalDuration-this.dur)/r.duration-1));return i>0&&this.keepgoing(new N(r,n),i),n}keepgoing(e,t=1){return this.i+=t*e.apd.moveCount,this.dur+=t*e.apd.duration,t!==1?e.back?this.st=this.st.applyTransformation(e.apd.backward.selfMultiply(t)):this.st=this.st.applyTransformation(e.apd.forward.selfMultiply(t)):e.back?this.st=this.st.applyTransformation(e.apd.backward):this.st=this.st.applyTransformation(e.apd.forward),!1}},io=16;function so(e,t){const n=new lt,r=new lt;for(const i of e.childAlgNodes())r.push(i),r.experimentalNumAlgNodes()>=t&&(n.push(new B(r.toAlg())),r.reset());return n.push(new B(r.toAlg())),n.toAlg()}var ao=class extends ve{traverseAlg(e){const t=e.experimentalNumChildAlgNodes();return t<io?e:so(e,Math.ceil(Math.sqrt(t)))}traverseGrouping(e){return new B(this.traverseAlg(e.alg),e.amount)}traverseMove(e){return e}traverseCommutator(e){return new F(this.traverseAlg(e.A),this.traverseAlg(e.B))}traverseConjugate(e){return new F(this.traverseAlg(e.A),this.traverseAlg(e.B))}traversePause(e){return e}traverseNewline(e){return e}traverseLineComment(e){return e}},oo=V(ao),yn=class{constructor(e,t){this.kpuzzle=e;const n=new no(this.kpuzzle),r=oo(t);this.decoration=n.traverseAlg(r),this.walker=new ro(this.kpuzzle,r,this.decoration)}decoration;walker;getAnimLeaf(e){if(this.walker.moveByIndex(e)){if(!this.walker.move)throw new Error("`this.walker.mv` missing");const t=this.walker.move;return this.walker.back?t.invert():t}return null}indexToMoveStartTimestamp(e){if(this.walker.moveByIndex(e)||this.walker.i===e)return this.walker.dur;throw new Error(`Out of algorithm: index ${e}`)}indexToMovesInProgress(e){if(this.walker.moveByIndex(e)||this.walker.i===e)return this.walker.dur;throw new Error(`Out of algorithm: index ${e}`)}patternAtIndex(e,t){return this.walker.moveByIndex(e),(t??this.kpuzzle.defaultPattern()).applyTransformation(this.walker.st)}transformationAtIndex(e){return this.walker.moveByIndex(e),this.walker.st}numAnimatedLeaves(){return this.decoration.moveCount}timestampToIndex(e){return this.walker.moveByDuration(e),this.walker.i}algDuration(){return this.decoration.duration}moveDuration(e){return this.walker.moveByIndex(e),this.walker.moveDuration}},lo=class extends D{getDefaultValue(){return"auto"}},et="http://www.w3.org/2000/svg",xn="data-copy-id",Sn=0;function co(){return Sn+=1,`svg${Sn.toString()}`}var uo={dim:{white:"#dddddd",orange:"#884400",limegreen:"#008800",red:"#660000","rgb(34, 102, 255)":"#000088",yellow:"#888800","rgb(102, 0, 153)":"rgb(50, 0, 76)",purple:"#3f003f"},oriented:"#44ddcc",ignored:"#555555",invisible:"#00000000"},mo=class{constructor(e,t,n,r=!1){if(this.kpuzzle=e,this.showUnknownOrientations=r,!t)throw new Error(`No SVG definition for puzzle type: ${e.name()}`);this.svgID=co(),this.wrapperElement=document.createElement("div"),this.wrapperElement.classList.add("svg-wrapper"),this.wrapperElement.innerHTML=t;const i=this.wrapperElement.querySelector("svg");if(!i)throw new Error("Could not get SVG element");if(this.svgElement=i,et!==i.namespaceURI)throw new Error("Unexpected XML namespace");i.style.maxWidth="100%",i.style.maxHeight="100%",this.gradientDefs=document.createElementNS(et,"defs"),i.insertBefore(this.gradientDefs,i.firstChild);for(const s of e.definition.orbits)for(let a=0;a<s.numPieces;a++)for(let l=0;l<s.numOrientations;l++){const u=this.elementID(s.orbitName,a,l),c=this.elementByID(u);let d=c?.style.fill;n?(()=>{const m=n.orbits;if(!m)return;const h=m[s.orbitName];if(!h)return;const v=h.pieces[a];if(!v)return;const f=v.facelets[l];if(!f)return;const b=typeof f=="string"?f:f?.mask,z=uo[b];typeof z=="string"?d=z:z&&(d=z[d])})():d=c?.style.fill,this.originalColors[u]=d,this.gradients[u]=this.newGradient(u,d),this.gradientDefs.appendChild(this.gradients[u]),c?.setAttribute("style",`fill: url(#grad-${this.svgID}-${u})`)}for(const s of Array.from(i.querySelectorAll(`[${xn}]`))){const a=s.getAttribute(xn);s.setAttribute("style",`fill: url(#grad-${this.svgID}-${a})`)}this.showUnknownOrientations&&this.drawPattern(this.kpuzzle.defaultPattern())}wrapperElement;svgElement;gradientDefs;originalColors={};gradients={};svgID;drawPattern(e,t,n){this.draw(e,t,n)}draw(e,t,n){const r=t?.experimentalToTransformation();if(!e)throw new Error("Distinguishable pieces are not handled for SVG yet!");for(const i of e.kpuzzle.definition.orbits){const s=e.patternData[i.orbitName],a=r?r.transformationData[i.orbitName]:null;for(let l=0;l<i.numPieces;l++)for(let u=0;u<i.numOrientations;u++){const c=this.elementID(i.orbitName,l,u),d=this.elementID(i.orbitName,s.pieces[l],(i.numOrientations-s.orientation[l]+u)%i.numOrientations);let m=!1;if(a){const h=this.elementID(i.orbitName,a.permutation[l],(i.numOrientations-a.orientationDelta[l]+u)%i.numOrientations);d===h&&(m=!0),n=n||0;const v=100*(1-n*n*(2-n*n));this.gradients[c].children[0].setAttribute("stop-color",this.originalColors[d]),this.gradients[c].children[0].setAttribute("offset",`${Math.max(v-5,0)}%`),this.gradients[c].children[1].setAttribute("offset",`${Math.max(v-5,0)}%`),this.gradients[c].children[2].setAttribute("offset",`${v}%`),this.gradients[c].children[3].setAttribute("offset",`${v}%`),this.gradients[c].children[3].setAttribute("stop-color",this.originalColors[h])}else m=!0;m&&(this.showUnknownOrientations&&s.orientationMod?.[l]===1?(this.gradients[c].children[0].setAttribute("stop-color","#000"),this.gradients[c].children[0].setAttribute("offset","5%"),this.gradients[c].children[1].setAttribute("offset","5%"),this.gradients[c].children[2].setAttribute("offset","20%"),this.gradients[c].children[3].setAttribute("offset","20%"),this.gradients[c].children[3].setAttribute("stop-color",this.originalColors[d])):(this.gradients[c].children[0].setAttribute("stop-color",this.originalColors[d]),this.gradients[c].children[0].setAttribute("offset","100%"),this.gradients[c].children[1].setAttribute("offset","100%"),this.gradients[c].children[2].setAttribute("offset","100%"),this.gradients[c].children[3].setAttribute("offset","100%")))}}}newGradient(e,t){const n=document.createElementNS(et,"radialGradient");n.setAttribute("id",`grad-${this.svgID}-${e}`),n.setAttribute("r","70.7107%");const r=[{offset:0,color:t},{offset:0,color:"black"},{offset:0,color:"black"},{offset:0,color:t}];for(const i of r){const s=document.createElementNS(et,"stop");s.setAttribute("offset",`${i.offset}%`),s.setAttribute("stop-color",i.color),s.setAttribute("stop-opacity","1"),n.appendChild(s)}return n}elementID(e,t,n){return`${e}-l${t}-o${n}`}elementByID(e){return this.wrapperElement.querySelector(`#${e}`)}},Ye=class{constructor(e,t,n){this.elem=e,this.prefix=t,this.validSuffixes=n}#e=null;clearValue(){this.#e&&this.elem.contentWrapper.classList.remove(this.#e),this.#e=null}setValue(e){if(!this.validSuffixes.includes(e))throw new Error(`Invalid suffix: ${e}`);const t=`${this.prefix}${e}`,n=this.#e!==t;return n&&(this.clearValue(),this.elem.contentWrapper.classList.add(t),this.#e=t),n}};function Bt(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Dn(e,t,n){if(e===t)return!0;if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!n(e[r],t[r]))return!1;return!0}function Ot(e,t,n){return Hn(e,n-t,t)}var ho=class{constructor(e){this.model=e,e.tempoScale.addFreshListener(t=>{this.tempoScale=t})}catchingUp=!1;pendingFrame=!1;tempoScale=1;scheduler=new Ee(this.animFrame.bind(this));start(){this.catchingUp||(this.lastTimestamp=performance.now()),this.catchingUp=!0,this.pendingFrame=!0,this.scheduler.requestAnimFrame()}stop(){this.catchingUp=!1,this.scheduler.cancelAnimFrame()}catchUpMs=500;lastTimestamp=0;animFrame(e){this.scheduler.requestAnimFrame();const t=this.tempoScale*(e-this.lastTimestamp)/this.catchUpMs;this.lastTimestamp=e,this.model.catchUpMove.set((async()=>{const n=await this.model.catchUpMove.get();if(n.move===null)return n;const r=n.amount+t;return r>=1?(this.pendingFrame=!0,this.stop(),this.model.timestampRequest.set("end"),{move:null,amount:0}):(this.pendingFrame=!1,{move:n.move,amount:r})})())}},po=class{constructor(e,t){this.delegate=t,this.model=e,this.lastTimestampPromise=this.#e(),this.model.playingInfo.addFreshListener(this.onPlayingProp.bind(this)),this.catchUpHelper=new ho(this.model),this.model.catchUpMove.addFreshListener(this.onCatchUpMoveProp.bind(this))}playing=!1;direction=1;catchUpHelper;model;lastDatestamp=0;lastTimestampPromise;scheduler=new Ee(this.animFrame.bind(this));async onPlayingProp(e){e.playing!==this.playing&&(e.playing?this.play(e):this.pause())}async onCatchUpMoveProp(e){const t=e.move!==null;t!==this.catchUpHelper.catchingUp&&(t?this.catchUpHelper.start():this.catchUpHelper.stop()),this.scheduler.requestAnimFrame()}async#e(){return(await this.model.detailedTimelineInfo.get()).timestamp}jumpToStart(e){this.model.timestampRequest.set("start"),this.pause(),e?.flash&&this.delegate.flash()}jumpToEnd(e){this.model.timestampRequest.set("end"),this.pause(),e?.flash&&this.delegate.flash()}playPause(){this.playing?this.pause():this.play()}play(e){(async()=>{const t=e?.direction??1,n=await this.model.coarseTimelineInfo.get();(e?.autoSkipToOtherEndIfStartingAtBoundary??!0)&&(t===1&&n.atEnd&&(this.model.timestampRequest.set("start"),this.delegate.flash()),t===-1&&n.atStart&&(this.model.timestampRequest.set("end"),this.delegate.flash())),this.model.playingInfo.set({playing:!0,direction:t,untilBoundary:e?.untilBoundary??"entire-timeline",loop:e?.loop??!1}),this.playing=!0,this.lastDatestamp=performance.now(),this.lastTimestampPromise=this.#e(),this.scheduler.requestAnimFrame()})()}pause(){this.playing=!1,this.scheduler.cancelAnimFrame(),this.model.playingInfo.set({playing:!1,untilBoundary:"entire-timeline"})}#t=new gt;async animFrame(e){this.playing&&this.scheduler.requestAnimFrame();const t=this.lastDatestamp,n=await this.#t.queue(Promise.all([this.model.playingInfo.get(),this.lastTimestampPromise,this.model.timeRange.get(),this.model.tempoScale.get(),this.model.currentMoveInfo.get()])),[r,i,s,a,l]=n;if(!r.playing){this.playing=!1;return}let u=l.earliestEnd;(l.currentMoves.length===0||r.untilBoundary==="entire-timeline")&&(u=s.end);let c=l.latestStart;(l.currentMoves.length===0||r.untilBoundary==="entire-timeline")&&(c=s.start);let d=(e-t)*this.direction*a;d=Math.max(d,1),d*=r.direction;let m=i+d,h=null;m>=u?r.loop?m=Ot(m,s.start,s.end):(m===s.end?h="end":m=u,this.playing=!1,this.model.playingInfo.set({playing:!1})):m<=c&&(r.loop?m=Ot(m,s.start,s.end):(m===s.start?h="start":m=c,this.playing=!1,this.model.playingInfo.set({playing:!1}))),this.lastDatestamp=e,this.lastTimestampPromise=Promise.resolve(m),this.model.timestampRequest.set(h??m)}},fo=class{constructor(e,t){this.model=e,this.animationController=new po(e,t)}animationController;jumpToStart(e){this.animationController.jumpToStart(e)}jumpToEnd(e){this.animationController.jumpToEnd(e)}togglePlay(e){typeof e>"u"&&this.animationController.playPause(),e?this.animationController.play():this.animationController.pause()}async visitTwizzleLink(){const e=document.createElement("a");e.href=await this.model.twizzleLink(),e.target="_blank",e.click()}},go={"bottom-row":!0,none:!0},vo=class extends D{getDefaultValue(){return"auto"}},Kt=new q;Kt.replaceSync(`
:host {
  width: 384px;
  height: 256px;
  display: grid;
}

.wrapper {
  width: 100%;
  height: 100%;
  display: grid;
  overflow: hidden;
}

.wrapper > * {
  width: 100%;
  height: 100%;
  overflow: hidden;
}

.wrapper.back-view-side-by-side {
  grid-template-columns: 1fr 1fr;
}

.wrapper.back-view-top-right {
  grid-template-columns: 3fr 1fr;
  grid-template-rows: 1fr 3fr;
}

.wrapper.back-view-top-right > :nth-child(1) {
  grid-row: 1 / 3;
  grid-column: 1 / 3;
}

.wrapper.back-view-top-right > :nth-child(2) {
  grid-row: 1 / 2;
  grid-column: 2 / 3;
}
`);var Pr=new q;Pr.replaceSync(`
:host {
  width: 384px;
  height: 256px;
  display: grid;
}

.wrapper {
  width: 100%;
  height: 100%;
  display: grid;
  overflow: hidden;
}

.svg-wrapper,
twisty-2d-svg,
svg {
  width: 100%;
  height: 100%;
  display: grid;
  min-height: 0;
}

svg {
  animation: fade-in 0.25s ease-in;
}

@keyframes fade-in {
  from { opacity: 0; }
  to { opacity: 1; }
}

.hint-facelets-none .hint-facelet {
  display: none;
}
`);var Fr=class extends H{constructor(e,t,n,r,i){super(),this.model=e,this.kpuzzle=t,this.svgSource=n,this.options=r,this.puzzleLoader=i,this.addCSS(Pr),this.resetSVG(),this.#t.addListener(this.model.puzzleID,s=>{i?.id!==s&&this.disconnect()}),this.#t.addListener(this.model.twistySceneModel.hintFacelet,s=>{this.setHintFacelet(s)}),this.#t.addListener(this.model.legacyPosition,this.onPositionChange.bind(this)),this.options?.experimentalStickeringMask&&this.experimentalSetStickeringMask(this.options.experimentalStickeringMask)}svgWrapper;scheduler=new Ee(this.render.bind(this));#e=null;#t=new He;disconnect(){this.#t.disconnect()}onPositionChange(e){try{if(e.movesInProgress.length>0){const t=e.movesInProgress[0].move;let n=t;e.movesInProgress[0].direction===-1&&(n=t.invert());const r=e.pattern.applyMove(n);this.svgWrapper?.draw(e.pattern,r,e.movesInProgress[0].fraction)}else this.svgWrapper?.draw(e.pattern),this.#e=e}catch(t){console.warn("Bad position (this doesn't necessarily mean something is wrong). Pre-emptively disconnecting:",this.puzzleLoader?.id,t),this.disconnect()}}scheduleRender(){this.scheduler.requestAnimFrame()}experimentalSetStickeringMask(e){this.resetSVG(e)}resetSVG(e){this.svgWrapper&&this.removeElement(this.svgWrapper.wrapperElement),this.kpuzzle&&(this.svgWrapper=new mo(this.kpuzzle,this.svgSource,e),this.addElement(this.svgWrapper.wrapperElement),this.#e&&this.onPositionChange(this.#e))}hintFaceletsClassListManager=new Ye(this,"hint-facelets-",Object.keys(za));setHintFacelet(e){this.hintFaceletsClassListManager.setValue(e==="auto"?"floating":e)}render(){}};P.define("twisty-2d-puzzle",Fr);var wo=class{constructor(e,t,n,r){this.model=e,this.schedulable=t,this.puzzleLoader=n,this.effectiveVisualization=r,this.twisty2DPuzzle(),this.#e.addListener(this.model.twistySceneModel.stickeringMask,async i=>{(await this.twisty2DPuzzle()).experimentalSetStickeringMask(i)})}#e=new He;disconnect(){this.#e.disconnect()}scheduleRender(){}#t=null;async twisty2DPuzzle(){return this.#t??=(async()=>{const e=this.effectiveVisualization==="experimental-2D-LL-face"?this.puzzleLoader.llFaceSVG():this.effectiveVisualization==="experimental-2D-LL"?this.puzzleLoader.llSVG():this.puzzleLoader.svg();return new Fr(this.model,await this.puzzleLoader.kpuzzle(),await e,{},this.puzzleLoader)})()}},Br=class extends H{constructor(e,t){super(),this.model=e,this.effectiveVisualization=t}#e=new He;disconnect(){this.#e.disconnect()}async connectedCallback(){this.addCSS(Kt),this.model&&this.#e.addListener(this.model.twistyPlayerModel.puzzleLoader,this.onPuzzleLoader.bind(this))}#t;async scene(){return this.#t??=(async()=>new(await J()).ThreeScene)()}scheduleRender(){this.#n?.scheduleRender()}#n;currentTwisty2DPuzzleWrapper(){return this.#n}async setCurrentTwisty2DPuzzleWrapper(e){const t=this.#n;this.#n=e,t?.disconnect();const n=e.twisty2DPuzzle();this.contentWrapper.textContent="",this.addElement(await n)}async onPuzzleLoader(e){this.#n?.disconnect();const t=new wo(this.model.twistyPlayerModel,this,e,this.effectiveVisualization);this.setCurrentTwisty2DPuzzleWrapper(t)}};P.define("twisty-2d-scene-wrapper",Br);var Or=class{#e;reject;promise;constructor(){this.promise=new Promise((e,t)=>{this.#e=e,this.reject=t})}handleNewValue(e){this.#e(e)}},Ur=class extends EventTarget{constructor(e,t,n,r){super(),this.model=e,this.schedulable=t,this.puzzleLoader=n,this.visualizationStrategy=r,this.twisty3DPuzzle(),this.#e.addListener(this.model.puzzleLoader,i=>{this.puzzleLoader.id!==i.id&&this.disconnect()}),this.#e.addListener(this.model.legacyPosition,async i=>{try{(await this.twisty3DPuzzle()).onPositionChange(i),this.scheduleRender()}catch{this.disconnect()}}),this.#e.addListener(this.model.twistySceneModel.hintFacelet,async i=>{(await this.twisty3DPuzzle()).experimentalUpdateOptions({hintFacelets:i==="auto"?"floating":i}),this.scheduleRender()}),this.#e.addListener(this.model.twistySceneModel.foundationDisplay,async i=>{(await this.twisty3DPuzzle()).experimentalUpdateOptions({showFoundation:i!=="none"}),this.scheduleRender()}),this.#e.addListener(this.model.twistySceneModel.stickeringMask,async i=>{(await this.twisty3DPuzzle()).setStickeringMask(i),this.scheduleRender()}),this.#e.addListener(this.model.twistySceneModel.faceletScale,async i=>{(await this.twisty3DPuzzle()).experimentalUpdateOptions({faceletScale:i}),this.scheduleRender()}),this.#e.addMultiListener3([this.model.twistySceneModel.stickeringMask,this.model.twistySceneModel.foundationStickerSprite,this.model.twistySceneModel.hintStickerSprite],async i=>{"experimentalUpdateTexture"in await this.twisty3DPuzzle()&&((await this.twisty3DPuzzle()).experimentalUpdateTexture(i[0].specialBehaviour==="picture",i[1],i[2]),this.scheduleRender())})}#e=new He;disconnect(){this.#e.disconnect()}scheduleRender(){this.schedulable.scheduleRender(),this.dispatchEvent(new CustomEvent("render-scheduled"))}#t=null;async twisty3DPuzzle(){return this.#t??=(async()=>{const e=J();if(this.puzzleLoader.id==="3x3x3"&&this.visualizationStrategy==="Cube3D"){const[t,n,r,i]=await Promise.all([this.model.twistySceneModel.foundationStickerSprite.get(),this.model.twistySceneModel.hintStickerSprite.get(),this.model.twistySceneModel.stickeringMask.get(),this.model.twistySceneModel.initialHintFaceletsAnimation.get()]);return(await e).cube3DShim(()=>this.schedulable.scheduleRender(),{foundationSprite:t,hintSprite:n,experimentalStickeringMask:r,initialHintFaceletsAnimation:i})}else{const[t,n,r,i]=await Promise.all([this.model.twistySceneModel.hintFacelet.get(),this.model.twistySceneModel.foundationStickerSprite.get(),this.model.twistySceneModel.hintStickerSprite.get(),this.model.twistySceneModel.faceletScale.get()]),s=(await e).pg3dShim(()=>this.schedulable.scheduleRender(),this.puzzleLoader,t==="auto"?"floating":t,i,this.puzzleLoader.id==="kilominx");return s.then(a=>a.experimentalUpdateTexture(!0,n??void 0,r??void 0)),s}})()}async raycastMove(e,t){const n=await this.twisty3DPuzzle();if(!("experimentalGetControlTargets"in n)){console.info("not PG3D! skipping raycast");return}const r=n.experimentalGetControlTargets(),[i,s]=await Promise.all([e,this.model.twistySceneModel.movePressCancelOptions.get()]),a=i.intersectObjects(r);if(a.length>0){const l=n.getClosestMoveToAxis(a[0].point,t);l?this.model.experimentalAddMove(l.move,{cancel:s}):console.info("Skipping move!")}}},Ut=class extends H{constructor(e){super(),this.model=e}#e=new Ye(this,"back-view-",["auto","none","side-by-side","top-right"]);#t=new He;disconnect(){this.#t.disconnect()}async connectedCallback(){this.addCSS(Kt);const e=new Ft(this.model,this);this.addVantage(e),this.model&&(this.#t.addMultiListener([this.model.puzzleLoader,this.model.visualizationStrategy],this.onPuzzle.bind(this)),this.#t.addListener(this.model.backView,this.setBackView.bind(this))),this.scheduleRender()}#n=null;setBackView(e){const t=["side-by-side","top-right"].includes(e),n=this.#n!==null;this.#e.setValue(e),t?n||(this.#n=new Ft(this.model,this,{backView:!0}),this.addVantage(this.#n),this.scheduleRender()):this.#n&&(this.removeVantage(this.#n),this.#n=null)}async onPress(e){const t=this.#i;if(!t){console.info("no wrapper; skipping scene wrapper press!");return}const n=(async()=>{const[r,{ThreeRaycaster:i,ThreeVector2:s}]=await Promise.all([e.detail.cameraPromise,(async()=>{const{ThreeRaycaster:u,ThreeVector2:c}=await J();return{ThreeRaycaster:u,ThreeVector2:c}})()]),a=new i,l=new s(e.detail.pressInfo.normalizedX,e.detail.pressInfo.normalizedY);return a.setFromCamera(l,r),a})();t.raycastMove(n,{invert:!e.detail.pressInfo.rightClick,depth:e.detail.pressInfo.keys.ctrlOrMetaKey?"rotation":e.detail.pressInfo.keys.shiftKey?"secondSlice":"none"})}#r;async scene(){return this.#r??=(async()=>new(await J()).ThreeScene)()}#s=new Set;addVantage(e){e.addEventListener("press",this.onPress.bind(this)),this.#s.add(e),this.contentWrapper.appendChild(e)}removeVantage(e){this.#s.delete(e),e.remove(),e.disconnect(),this.#i?.disconnect()}experimentalVantages(){return this.#s.values()}scheduleRender(){for(const e of this.#s)e.scheduleRender()}#i=null;async setCurrentTwisty3DPuzzleWrapper(e,t){const n=this.#i;try{this.#i=t,n?.disconnect(),e.add(await t.twisty3DPuzzle())}finally{n&&e.remove(await n.twisty3DPuzzle())}this.#a.handleNewValue(t)}#a=new Or;async experimentalTwisty3DPuzzleWrapper(){return this.#i||this.#a.promise}#o=new gt;async onPuzzle(e){if(e[1]==="2D")return;this.#i?.disconnect();const[t,n]=await this.#o.queue(Promise.all([this.scene(),new Ur(this.model,this,e[0],e[1])]));this.setCurrentTwisty3DPuzzleWrapper(t,n)}};P.define("twisty-3d-scene-wrapper",Ut);var ae=typeof document>"u"?null:document,yo=ae?.fullscreenEnabled||!!ae?.webkitFullscreenEnabled;function xo(){return document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen()}function bn(){return document.fullscreenElement?document.fullscreenElement:document.webkitFullscreenElement??null}function So(e){return e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen()}var Do=["skip-to-start","skip-to-end","step-forward","step-backward","pause","play","enter-fullscreen","exit-fullscreen","twizzle-tw"],bo=class extends L{derive(e){return{fullscreen:{enabled:yo,icon:document.fullscreenElement===null?"enter-fullscreen":"exit-fullscreen",title:"Enter fullscreen"},"jump-to-start":{enabled:!e.coarseTimelineInfo.atStart,icon:"skip-to-start",title:"Restart"},"play-step-backwards":{enabled:!e.coarseTimelineInfo.atStart,icon:"step-backward",title:"Step backward"},"play-pause":{enabled:!(e.coarseTimelineInfo.atStart&&e.coarseTimelineInfo.atEnd),icon:e.coarseTimelineInfo.playing?"pause":"play",title:e.coarseTimelineInfo.playing?"Pause":"Play"},"play-step":{enabled:!e.coarseTimelineInfo.atEnd,icon:"step-forward",title:"Step forward"},"jump-to-end":{enabled:!e.coarseTimelineInfo.atEnd,icon:"skip-to-end",title:"Skip to End"},"twizzle-link":{enabled:!0,icon:"twizzle-tw",title:"View at Twizzle",hidden:e.viewerLink==="none"}}}},_r=new q;_r.replaceSync(`
:host {
  width: 384px;
  height: 24px;
  display: grid;
}

.wrapper {
  width: 100%;
  height: 100%;
  display: grid;
  overflow: hidden;
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
}

.wrapper {
  grid-auto-flow: column;
}

.viewer-link-none .twizzle-link-button {
  display: none;
}

.wrapper twisty-button,
.wrapper twisty-control-button {
  width: inherit;
  height: inherit;
}
`);var Vr=new q;Vr.replaceSync(`
:host:not([hidden]) {
  display: grid;
}

:host {
  width: 48px;
  height: 24px;
}

.wrapper {
  width: 100%;
  height: 100%;
}

button {
  width: 100%;
  height: 100%;
  border: none;
  
  background-position: center;
  background-repeat: no-repeat;
  background-size: contain;

  background-color: rgba(196, 196, 196, 0.75);
}

button:enabled {
  background-color: rgba(196, 196, 196, 0.75)
}

.dark-mode button:enabled {
  background-color: #88888888;
}

button:disabled {
  background-color: rgba(0, 0, 0, 0.4);
  opacity: 0.25;
  pointer-events: none;
}

.dark-mode button:disabled {
  background-color: #ffffff44;
}

button:enabled:hover {
  background-color: rgba(255, 255, 255, 0.75);
  box-shadow: 0 0 1em rgba(0, 0, 0, 0.25);
  cursor: pointer;
}

/* TODO: fullscreen icons have too much padding?? */
.svg-skip-to-start button,
button.svg-skip-to-start {
  background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNTg0IiBoZWlnaHQ9IjM1ODQiIHZpZXdCb3g9IjAgMCAzNTg0IDM1ODQiPjxwYXRoIGQ9Ik0yNjQzIDEwMzdxMTktMTkgMzItMTN0MTMgMzJ2MTQ3MnEwIDI2LTEzIDMydC0zMi0xM2wtNzEwLTcxMHEtOS05LTEzLTE5djcxMHEwIDI2LTEzIDMydC0zMi0xM2wtNzEwLTcxMHEtOS05LTEzLTE5djY3OHEwIDI2LTE5IDQ1dC00NSAxOUg5NjBxLTI2IDAtNDUtMTl0LTE5LTQ1VjEwODhxMC0yNiAxOS00NXQ0NS0xOWgxMjhxMjYgMCA0NSAxOXQxOSA0NXY2NzhxNC0xMSAxMy0xOWw3MTAtNzEwcTE5LTE5IDMyLTEzdDEzIDMydjcxMHE0LTExIDEzLTE5eiIvPjwvc3ZnPg==");
}

.svg-skip-to-end button,
button.svg-skip-to-end {
  background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNTg0IiBoZWlnaHQ9IjM1ODQiIHZpZXdCb3g9IjAgMCAzNTg0IDM1ODQiPjxwYXRoIGQ9Ik05NDEgMjU0N3EtMTkgMTktMzIgMTN0LTEzLTMyVjEwNTZxMC0yNiAxMy0zMnQzMiAxM2w3MTAgNzEwcTggOCAxMyAxOXYtNzEwcTAtMjYgMTMtMzJ0MzIgMTNsNzEwIDcxMHE4IDggMTMgMTl2LTY3OHEwLTI2IDE5LTQ1dDQ1LTE5aDEyOHEyNiAwIDQ1IDE5dDE5IDQ1djE0MDhxMCAyNi0xOSA0NXQtNDUgMTloLTEyOHEtMjYgMC00NS0xOXQtMTktNDV2LTY3OHEtNSAxMC0xMyAxOWwtNzEwIDcxMHEtMTkgMTktMzIgMTN0LTEzLTMydi03MTBxLTUgMTAtMTMgMTl6Ii8+PC9zdmc+");
}

.svg-step-forward button,
button.svg-step-forward {
  background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNTg0IiBoZWlnaHQ9IjM1ODQiIHZpZXdCb3g9IjAgMCAzNTg0IDM1ODQiPjxwYXRoIGQ9Ik0yNjg4IDE1NjhxMCAyNi0xOSA0NWwtNTEyIDUxMnEtMTkgMTktNDUgMTl0LTQ1LTE5cS0xOS0xOS0xOS00NXYtMjU2aC0yMjRxLTk4IDAtMTc1LjUgNnQtMTU0IDIxLjVxLTc2LjUgMTUuNS0xMzMgNDIuNXQtMTA1LjUgNjkuNXEtNDkgNDIuNS04MCAxMDF0LTQ4LjUgMTM4LjVxLTE3LjUgODAtMTcuNSAxODEgMCA1NSA1IDEyMyAwIDYgMi41IDIzLjV0Mi41IDI2LjVxMCAxNS04LjUgMjV0LTIzLjUgMTBxLTE2IDAtMjgtMTctNy05LTEzLTIydC0xMy41LTMwcS03LjUtMTctMTAuNS0yNC0xMjctMjg1LTEyNy00NTEgMC0xOTkgNTMtMzMzIDE2Mi00MDMgODc1LTQwM2gyMjR2LTI1NnEwLTI2IDE5LTQ1dDQ1LTE5cTI2IDAgNDUgMTlsNTEyIDUxMnExOSAxOSAxOSA0NXoiLz48L3N2Zz4=");
}

.svg-step-backward button,
button.svg-step-backward {
  background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNTg0IiBoZWlnaHQ9IjM1ODQiIHZpZXdCb3g9IjAgMCAzNTg0IDM1ODQiPjxwYXRoIGQ9Ik0yNjg4IDIwNDhxMCAxNjYtMTI3IDQ1MS0zIDctMTAuNSAyNHQtMTMuNSAzMHEtNiAxMy0xMyAyMi0xMiAxNy0yOCAxNy0xNSAwLTIzLjUtMTB0LTguNS0yNXEwLTkgMi41LTI2LjV0Mi41LTIzLjVxNS02OCA1LTEyMyAwLTEwMS0xNy41LTE4MXQtNDguNS0xMzguNXEtMzEtNTguNS04MC0xMDF0LTEwNS41LTY5LjVxLTU2LjUtMjctMTMzLTQyLjV0LTE1NC0yMS41cS03Ny41LTYtMTc1LjUtNmgtMjI0djI1NnEwIDI2LTE5IDQ1dC00NSAxOXEtMjYgMC00NS0xOWwtNTEyLTUxMnEtMTktMTktMTktNDV0MTktNDVsNTEyLTUxMnExOS0xOSA0NS0xOXQ0NSAxOXExOSAxOSAxOSA0NXYyNTZoMjI0cTcxMyAwIDg3NSA0MDMgNTMgMTM0IDUzIDMzM3oiLz48L3N2Zz4=");
}

.svg-pause button,
button.svg-pause {
  background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNTg0IiBoZWlnaHQ9IjM1ODQiIHZpZXdCb3g9IjAgMCAzNTg0IDM1ODQiPjxwYXRoIGQ9Ik0yNTYwIDEwODh2MTQwOHEwIDI2LTE5IDQ1dC00NSAxOWgtNTEycS0yNiAwLTQ1LTE5dC0xOS00NVYxMDg4cTAtMjYgMTktNDV0NDUtMTloNTEycTI2IDAgNDUgMTl0MTkgNDV6bS04OTYgMHYxNDA4cTAgMjYtMTkgNDV0LTQ1IDE5aC01MTJxLTI2IDAtNDUtMTl0LTE5LTQ1VjEwODhxMC0yNiAxOS00NXQ0NS0xOWg1MTJxMjYgMCA0NSAxOXQxOSA0NXoiLz48L3N2Zz4=");
}

.svg-play button,
button.svg-play {
  background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNTg0IiBoZWlnaHQ9IjM1ODQiIHZpZXdCb3g9IjAgMCAzNTg0IDM1ODQiPjxwYXRoIGQ9Ik0yNDcyLjUgMTgyM2wtMTMyOCA3MzhxLTIzIDEzLTM5LjUgM3QtMTYuNS0zNlYxMDU2cTAtMjYgMTYuNS0zNnQzOS41IDNsMTMyOCA3MzhxMjMgMTMgMjMgMzF0LTIzIDMxeiIvPjwvc3ZnPg==");
}

.svg-enter-fullscreen button,
button.svg-enter-fullscreen {
  background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjgiIHZpZXdCb3g9IjAgMCAyOCAyOCIgd2lkdGg9IjI4Ij48cGF0aCBkPSJNMiAyaDI0djI0SDJ6IiBmaWxsPSJub25lIi8+PHBhdGggZD0iTTkgMTZIN3Y1aDV2LTJIOXYtM3ptLTItNGgyVjloM1Y3SDd2NXptMTIgN2gtM3YyaDV2LTVoLTJ2M3pNMTYgN3YyaDN2M2gyVjdoLTV6Ii8+PC9zdmc+");
}

.svg-exit-fullscreen button,
button.svg-exit-fullscreen {
  background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjgiIHZpZXdCb3g9IjAgMCAyOCAyOCIgd2lkdGg9IjI4Ij48cGF0aCBkPSJNMiAyaDI0djI0SDJ6IiBmaWxsPSJub25lIi8+PHBhdGggZD0iTTcgMThoM3YzaDJ2LTVIN3Yyem0zLThIN3YyaDVWN2gtMnYzem02IDExaDJ2LTNoM3YtMmgtNXY1em0yLTExVjdoLTJ2NWg1di0yaC0zeiIvPjwvc3ZnPg==");
}

.svg-twizzle-tw button,
button.svg-twizzle-tw {
  background-image: url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODY0IiBoZWlnaHQ9IjYwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMzk3LjU4MSAxNTEuMTh2NTcuMDg0aC04OS43MDN2MjQwLjM1MmgtNjYuOTU1VjIwOC4yNjRIMTUxLjIydi01Ny4wODNoMjQ2LjM2MXptNTQuMzEgNzEuNjc3bDcuNTEyIDMzLjY5MmMyLjcxOCAxMi4xNiA1LjU4IDI0LjY4IDguNTg0IDM3LjU1NWEyMTgwLjc3NSAyMTgwLjc3NSAwIDAwOS40NDIgMzguODQzIDEyNjYuMyAxMjY2LjMgMCAwMDEwLjA4NiAzNy41NTVjMy43Mi0xMi41OSA3LjM2OC0yNS40NjYgMTAuOTQ1LTM4LjYyOCAzLjU3Ni0xMy4xNjIgNy4wMS0yNi4xMSAxMC4zLTM4Ljg0M2w1Ljc2OS0yMi40NTZjMS4yNDgtNC44ODcgMi40NzItOS43MDUgMy42NzQtMTQuNDU1IDMuMDA0LTExLjg3NSA1LjY1MS0yMi45NjIgNy45NC0zMy4yNjNoNDYuMzU0bDIuMzg0IDEwLjU2M2EyMDAwLjc3IDIwMDAuNzcgMCAwMDMuOTM1IDE2LjgyOGw2LjcxMSAyNy43MWMxLjIxMyA0Ljk1NiAyLjQ1IDkuOTggMy43MDkgMTUuMDczYTMxMTkuNzc3IDMxMTkuNzc3IDAgMDA5Ljg3MSAzOC44NDMgMTI0OS4yMjcgMTI0OS4yMjcgMCAwMDEwLjczIDM4LjYyOCAxOTA3LjYwNSAxOTA3LjYwNSAwIDAwMTAuMzAxLTM3LjU1NSAxMzk3Ljk0IDEzOTcuOTQgMCAwMDkuNjU3LTM4Ljg0M2w0LjQtMTkuMDQ2Yy43MTUtMy4xMyAxLjQyMS02LjIzNiAyLjExOC05LjMyMWw5LjU3Ny00Mi44OGg2Ni41MjZhMjk4OC43MTggMjk4OC43MTggMCAwMS0xOS41MjkgNjYuMzExbC01LjcyOCAxOC40ODJhMzIzNy40NiAzMjM3LjQ2IDAgMDEtMTQuMDE1IDQzLjc1MmMtNi40MzggMTkuNi0xMi43MzMgMzcuNjk4LTE4Ljg4NSA1NC4yOTRsLTMuMzA2IDguODI1Yy00Ljg4NCAxMi44OTgtOS40MzMgMjQuMjYzLTEzLjY0NyAzNC4wOTVoLTQ5Ljc4N2E4NDE3LjI4OSA4NDE3LjI4OSAwIDAxLTIxLjAzMS02NC44MDkgMTI4OC42ODYgMTI4OC42ODYgMCAwMS0xOC44ODUtNjQuODEgMTk3Mi40NDQgMTk3Mi40NDQgMCAwMS0xOC4yNCA2NC44MSAyNTc5LjQxMiAyNTc5LjQxMiAwIDAxLTIwLjM4OCA2NC44MWgtNDkuNzg3Yy00LjY4Mi0xMC45MjYtOS43Mi0yMy43NDMtMTUuMTEtMzguNDUxbC0xLjYyOS00LjQ3Yy01LjI1OC0xNC41MjEtMTAuNjgtMzAuMTkyLTE2LjI2Ni00Ny4wMTRsLTIuNDA0LTcuMjhjLTYuNDM4LTE5LjYtMTMuMDItNDAuMzQ0LTE5Ljc0My02Mi4yMzRhMjk4OC43MDcgMjk4OC43MDcgMCAwMS0xOS41MjktNjYuMzExaDY3LjM4NXoiIGZpbGw9IiM0Mjg1RjQiIGZpbGwtcnVsZT0ibm9uemVybyIvPjwvc3ZnPg==");
}
`);var Mn={fullscreen:!0,"jump-to-start":!0,"play-step-backwards":!0,"play-pause":!0,"play-step":!0,"jump-to-end":!0,"twizzle-link":!0},jr=class extends H{constructor(e,t,n){super(),this.model=e,this.controller=t,this.defaultFullscreenElement=n}buttons=null;connectedCallback(){this.addCSS(_r);const e={};for(const t in Mn){const n=new Wr;e[t]=n,n.htmlButton.addEventListener("click",()=>this.#e(t)),this.addElement(n)}this.buttons=e,this.model?.buttonAppearance.addFreshListener(this.update.bind(this)),this.model?.twistySceneModel.colorScheme.addFreshListener(this.updateColorScheme.bind(this))}#e(e){switch(e){case"fullscreen":{this.onFullscreenButton();break}case"jump-to-start":{this.controller?.jumpToStart({flash:!0});break}case"play-step-backwards":{this.controller?.animationController.play({direction:-1,untilBoundary:"move"});break}case"play-pause":{this.controller?.togglePlay();break}case"play-step":{this.controller?.animationController.play({direction:1,untilBoundary:"move"});break}case"jump-to-end":{this.controller?.jumpToEnd({flash:!0});break}case"twizzle-link":{this.controller?.visitTwizzleLink();break}default:throw new Error("Missing command")}}async onFullscreenButton(){if(!this.defaultFullscreenElement)throw new Error("Attempted to go fullscreen without an element.");if(bn()===this.defaultFullscreenElement)xo();else{this.buttons?.fullscreen.setIcon("exit-fullscreen"),So(await this.model?.twistySceneModel.fullscreenElement.get()??this.defaultFullscreenElement);const e=()=>{bn()!==this.defaultFullscreenElement&&(this.buttons?.fullscreen.setIcon("enter-fullscreen"),window.removeEventListener("fullscreenchange",e))};window.addEventListener("fullscreenchange",e)}}async update(e){for(const t in Mn){const n=this.buttons[t],r=e[t];n.htmlButton.disabled=!r.enabled,n.htmlButton.title=r.title,n.setIcon(r.icon),n.hidden=!!r.hidden}}updateColorScheme(e){for(const t of Object.values(this.buttons??{}))t.updateColorScheme(e)}};P.define("twisty-buttons",jr);var Wr=class extends H{htmlButton=document.createElement("button");updateColorScheme(e){this.contentWrapper.classList.toggle("dark-mode",e==="dark")}connectedCallback(){this.addCSS(Vr),this.addElement(this.htmlButton)}#e=new Ye(this,"svg-",Do);setIcon(e){this.#e.setValue(e)}};P.define("twisty-button",Wr);var Gr=new q;Gr.replaceSync(`
:host {
  width: 384px;
  height: 16px;
  display: grid;
}

.wrapper {
  width: 100%;
  height: 100%;
  display: grid;
  overflow: hidden;
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
  background: rgba(196, 196, 196, 0.75);
}

input:not(:disabled) {
  cursor: ew-resize;
}

.wrapper.dark-mode {
  background: #666666;
}
`);ae?.addEventListener("mousedown",e=>{e.which},!0);ae?.addEventListener("mouseup",e=>{e.which},!0);ae?.addEventListener("mousedown",()=>{},!1);ae?.addEventListener("mousemove",qr,!1);ae?.addEventListener("mouseenter",qr,!1);function qr(e){e.pageY}var $r=class extends H{constructor(e,t){super(),this.model=e,this.controller=t}async onDetailedTimelineInfo(e){const t=await this.inputElem();t.min=e.timeRange.start.toString(),t.max=e.timeRange.end.toString(),t.disabled=t.min===t.max,t.value=e.timestamp.toString()}async connectedCallback(){this.addCSS(Gr),this.addElement(await this.inputElem()),this.model?.twistySceneModel.colorScheme.addFreshListener(this.updateColorScheme.bind(this))}updateColorScheme(e){this.contentWrapper.classList.toggle("dark-mode",e==="dark")}#e=null;async inputElem(){return this.#e??=(async()=>{const e=document.createElement("input");return e.type="range",e.disabled=!0,this.model?.detailedTimelineInfo.addFreshListener(this.onDetailedTimelineInfo.bind(this)),e.addEventListener("input",this.onInput.bind(this)),e.addEventListener("keydown",this.onKeypress.bind(this)),e})()}async onInput(e){const t=await this.inputElem();await this.slowDown(e,t);const n=parseInt(t.value,10);this.model?.playingInfo.set({playing:!1}),this.model?.timestampRequest.set(n)}onKeypress(e){switch(e.key){case"ArrowLeft":case"ArrowRight":{this.controller?.animationController.play({direction:e.key==="ArrowLeft"?-1:1,untilBoundary:"move"}),e.preventDefault();break}case" ":{this.controller?.togglePlay(),e.preventDefault();break}}}async slowDown(e,t){}};P.define("twisty-scrubber",$r);var Mo=null;async function Ln(e,t){const[{ThreePerspectiveCamera:n,ThreeScene:r},i,s,a,l,u,c]=await Promise.all([(async()=>{const{ThreePerspectiveCamera:j,ThreeScene:E}=await J();return{ThreePerspectiveCamera:j,ThreeScene:E}})(),await e.puzzleLoader.get(),await e.visualizationStrategy.get(),await e.twistySceneModel.stickeringRequest.get(),await e.twistySceneModel.stickeringMaskRequest.get(),await e.legacyPosition.get(),await e.twistySceneModel.orbitCoordinates.get()]),d=t?.width??2048,m=t?.height??2048,h=d/m,v=Mo??=await(async()=>new n(20,h,.1,20))(),f=new r,b=new Ur(e,{scheduleRender:()=>{}},i,s);f.add(await b.twisty3DPuzzle()),await Tr(v,c);const I=(await zr(d,m,f,v)).toDataURL(),k=await Qr(e);return{dataURL:I,download:async j=>{Hr(I,j??k)}}}async function Qr(e){const[t,n]=await Promise.all([e.puzzleID.get(),e.alg.get()]);return`[${t}]${n.alg.experimentalNumChildAlgNodes()===0?"":` ${n.alg.toString()}`}`}function Hr(e,t,n="png"){const r=document.createElement("a");r.href=e,r.download=`${t}.${n}`,r.click()}var Kr=new q;Kr.replaceSync(`
:host {
  width: 384px;
  height: 256px;
  display: grid;

  -webkit-user-select: none;
  user-select: none;
}

.wrapper {
  display: grid;
  overflow: hidden;
  contain: size;
  grid-template-rows: 7fr minmax(1.5em, 0.5fr) minmax(2em, 1fr);
}

.wrapper > * {
  width: inherit;
  height: inherit;
  overflow: hidden;
}

.wrapper.controls-none {
  grid-template-rows: 7fr;
}

.wrapper.controls-none twisty-scrubber,
.wrapper.controls-none twisty-control-button-panel ,
.wrapper.controls-none twisty-scrubber,
.wrapper.controls-none twisty-buttons {
  display: none;
}

twisty-scrubber {
  background: rgba(196, 196, 196, 0.5);
}

.wrapper.checkered,
.wrapper.checkered-transparent {
  background-color: #EAEAEA;
  background-image: linear-gradient(45deg, #DDD 25%, transparent 25%, transparent 75%, #DDD 75%, #DDD),
    linear-gradient(45deg, #DDD 25%, transparent 25%, transparent 75%, #DDD 75%, #DDD);
  background-size: 32px 32px;
  background-position: 0 0, 16px 16px;
}

.wrapper.checkered-transparent {
  background-color: #F4F4F4;
  background-image: linear-gradient(45deg, #DDDDDD88 25%, transparent 25%, transparent 75%, #DDDDDD88 75%, #DDDDDD88),
    linear-gradient(45deg, #DDDDDD88 25%, transparent 25%, transparent 75%, #DDDDDD88 75%, #DDDDDD88);
}

.wrapper.dark-mode {
  background-color: #444;
  background-image: linear-gradient(45deg, #DDDDDD0b 25%, transparent 25%, transparent 75%, #DDDDDD0b 75%, #DDDDDD0b),
    linear-gradient(45deg, #DDDDDD0b 25%, transparent 25%, transparent 75%, #DDDDDD0b 75%, #DDDDDD0b);
}

.visualization-wrapper > * {
  width: 100%;
  height: 100%;
}

.error-elem {
  width: 100%;
  height: 100%;
  display: none;
  place-content: center;
  font-family: sans-serif;
  box-shadow: inset 0 0 2em rgb(255, 0, 0);
  color: red;
  text-shadow: 0 0 0.2em white;
  background: rgba(255, 255, 255, 0.25);
}

.wrapper.error .visualization-wrapper {
  display: none;
}

.wrapper.error .error-elem {
  display: grid;
}
`);var In=class extends D{getDefaultValue(){return null}},_t=class extends le{getDefaultValue(){return null}derive(e){return typeof e=="string"?new URL(e,location.href):e}},qe=class Yr{warnings;errors;constructor(t){this.warnings=Object.freeze(t?.warnings??[]),this.errors=Object.freeze(t?.errors??[]),Object.freeze(this)}add(t){return new Yr({warnings:this.warnings.concat(t?.warnings??[]),errors:this.errors.concat(t?.errors??[])})}log(){this.errors.length>0?console.error(`🚨 ${this.errors[0]}`):this.warnings.length>0?console.warn(`⚠️ ${this.warnings[0]}`):console.info("😎 No issues!")}};function Xr(e){try{const t=p.fromString(e),n=[];return t.toString()!==e&&n.push("Alg is non-canonical!"),{alg:t,issues:new qe({warnings:n})}}catch(t){return{alg:new p,issues:new qe({errors:[`Malformed alg: ${t.toString()}`]})}}}function Lo(e,t){return e.alg.isIdentical(t.alg)&&Bt(e.issues.warnings,t.issues.warnings)&&Bt(e.issues.errors,t.issues.errors)}var zn=class extends le{getDefaultValue(){return{alg:new p,issues:new qe}}canReuseValue(e,t){return Lo(e,t)}async derive(e){return typeof e=="string"?Xr(e):{alg:e,issues:new qe}}},Io=class extends L{derive(e){return e.kpuzzle.algToTransformation(e.setupAlg.alg)}},zo=class extends L{derive(e){if(e.setupTransformation)return e.setupTransformation;switch(e.setupAnchor){case"start":return e.setupAlgTransformation;case"end":{const n=e.indexer.transformationAtIndex(e.indexer.numAnimatedLeaves()).invert();return e.setupAlgTransformation.applyTransformation(n)}default:throw new Error("Unimplemented!")}}},Eo=class extends D{getDefaultValue(){return null}},To=class extends D{getDefaultValue(){return{move:null,amount:0}}canReuseValue(e,t){return e.move===t.move&&e.amount===t.amount}},Ao=class extends L{derive(e){return{patternIndex:e.currentMoveInfo.patternIndex,movesFinishing:e.currentMoveInfo.movesFinishing.map(t=>t.move),movesFinished:e.currentMoveInfo.movesFinished.map(t=>t.move)}}canReuseValue(e,t){return e.patternIndex===t.patternIndex&&Dn(e.movesFinishing,t.movesFinishing,(n,r)=>n.isIdentical(r))&&Dn(e.movesFinished,t.movesFinished,(n,r)=>n.isIdentical(r))}},ko=class extends L{derive(e){function t(n){return e.detailedTimelineInfo.atEnd&&e.catchUpMove.move!==null&&n.currentMoves.push({move:e.catchUpMove.move,direction:-1,fraction:1-e.catchUpMove.amount,startTimestamp:-1,endTimestamp:-1}),n}if(e.indexer.currentMoveInfo)return t(e.indexer.currentMoveInfo(e.detailedTimelineInfo.timestamp));{const n=e.indexer.timestampToIndex(e.detailedTimelineInfo.timestamp),r={patternIndex:n,currentMoves:[],movesFinishing:[],movesFinished:[],movesStarting:[],latestStart:-1/0,earliestEnd:1/0};if(e.indexer.numAnimatedLeaves()>0){const i=e.indexer.getAnimLeaf(n)?.as(o);if(!i)return t(r);const s=e.indexer.indexToMoveStartTimestamp(n),a=e.indexer.moveDuration(n),l=a?(e.detailedTimelineInfo.timestamp-s)/a:0,u=s+a,c={move:i,direction:1,fraction:l,startTimestamp:s,endTimestamp:u};l===0?r.movesStarting.push(c):l===1?r.movesFinishing.push(c):(r.currentMoves.push(c),r.latestStart=Math.max(r.latestStart,s),r.earliestEnd=Math.min(r.earliestEnd,u))}return t(r)}}},Co=class extends L{derive(e){let t=e.indexer.transformationAtIndex(e.currentLeavesSimplified.patternIndex);t=e.anchoredStart.applyTransformation(t);for(const n of e.currentLeavesSimplified.movesFinishing)t=t.applyMove(n);for(const n of e.currentLeavesSimplified.movesFinished)t=t.applyMove(n);return t.toKPattern()}},En={u:"y",l:"x",f:"z",r:"x",b:"z",d:"y",m:"x",e:"y",s:"z",x:"x",y:"y",z:"z"};function Ro(e,t){return En[e.family[0].toLowerCase()]===En[t.family[0].toLowerCase()]}var No=class extends ve{traverseAlg(e){const t=[];for(const n of e.childAlgNodes())t.push(this.traverseAlgNode(n));return Array.prototype.concat(...t)}traverseGroupingOnce(e){if(e.experimentalIsEmpty())return[];const t=[];for(const i of e.childAlgNodes()){if(!(i.is(o)||i.is(ze)||i.is(se)))return this.traverseAlg(e);const s=i.as(o);s&&t.push(s)}let n=he(t[0].amount);for(let i=0;i<t.length-1;i++){for(let s=1;s<t.length;s++)if(!Ro(t[i],t[s]))return this.traverseAlg(e);n=Math.max(n,he(t[i].amount))}const r=t.map(i=>({animLeafAlgNode:i,msUntilNext:0,duration:n}));return r[r.length-1].msUntilNext=n,r}traverseGrouping(e){const t=[],n=e.amount>0?e.alg:e.alg.invert();for(let r=0;r<Math.abs(e.amount);r++)t.push(this.traverseGroupingOnce(n));return Array.prototype.concat(...t)}traverseMove(e){const t=he(e.amount);return[{animLeafAlgNode:e,msUntilNext:t,duration:t}]}traverseCommutator(e){const t=[],n=[e.A,e.B,e.A.invert(),e.B.invert()];for(const r of n)t.push(this.traverseGroupingOnce(r));return Array.prototype.concat(...t)}traverseConjugate(e){const t=[],n=[e.A,e.B,e.A.invert()];for(const r of n)t.push(this.traverseGroupingOnce(r));return Array.prototype.concat(...t)}traversePause(e){if(e.experimentalNISSGrouping)return[];const t=he(1);return[{animLeafAlgNode:e,msUntilNext:t,duration:t}]}traverseNewline(e){return[]}traverseLineComment(e){return[]}},Po=V(No);function Fo(e){let t=0;return Po(e).map(r=>{const i={animLeaf:r.animLeafAlgNode,start:t,end:t+r.duration};return t+=r.msUntilNext,i})}var bt=class{constructor(e,t,n){this.kpuzzle=e,this.animLeaves=n?.animationTimelineLeaves??Fo(t)}animLeaves;getAnimLeaf(e){return this.animLeaves[Math.min(e,this.animLeaves.length-1)]?.animLeaf??null}getAnimationTimelineLeaf(e){return this.animLeaves[Math.min(e,this.animLeaves.length-1)]}indexToMoveStartTimestamp(e){let t=0;return this.animLeaves.length>0&&(t=this.animLeaves[Math.min(e,this.animLeaves.length-1)].start),t}timestampToIndex(e){let t=0;for(t=0;t<this.animLeaves.length;t++)if(this.animLeaves[t].start>=e)return Math.max(0,t-1);return Math.max(0,t-1)}timestampToPosition(e,t){const n=this.currentMoveInfo(e);let r=t??this.kpuzzle.identityTransformation().toKPattern();for(const i of this.animLeaves.slice(0,n.patternIndex)){const s=i.animLeaf.as(o);s!==null&&(r=r.applyMove(s))}return{pattern:r,movesInProgress:n.currentMoves}}currentMoveInfo(e){let t=1/0;for(const c of this.animLeaves)if(c.start<=e&&c.end>=e)t=Math.min(t,c.start);else if(c.start>e)break;const n=[],r=[],i=[],s=[];let a=-1/0,l=1/0,u=0;for(const c of this.animLeaves)if(c.end<=t){if(!isFinite(t)&&c.start>e)break;u++}else{if(c.start>e)break;{const d=c.animLeaf.as(o);if(d!==null){let m=(e-c.start)/(c.end-c.start),h=!1;m>1&&(m=1,h=!0);const v={move:d,direction:1,fraction:m,startTimestamp:c.start,endTimestamp:c.end};switch(m){case 0:{r.push(v);break}case 1:{h?s.push(v):i.push(v);break}default:n.push(v),a=Math.max(a,c.start),l=Math.min(l,c.end)}}}}return{patternIndex:u,currentMoves:n,latestStart:a,earliestEnd:l,movesStarting:r,movesFinishing:i,movesFinished:s}}patternAtIndex(e,t){let n=t??this.kpuzzle.defaultPattern();for(let r=0;r<this.animLeaves.length&&r<e;r++){const s=this.animLeaves[r].animLeaf.as(o);s!==null&&(n=n.applyMove(s))}return n}transformationAtIndex(e){let t=this.kpuzzle.identityTransformation();for(const n of this.animLeaves.slice(0,e)){const r=n.animLeaf.as(o);r!==null&&(t=t.applyMove(r))}return t}algDuration(){let e=0;for(const t of this.animLeaves)e=Math.max(e,t.end);return e}numAnimatedLeaves(){return this.animLeaves.length}moveDuration(e){const t=this.getAnimationTimelineLeaf(e);return t.end-t.start}},Bo=1024,Oo=class extends L{derive(e){switch(e.indexerConstructorRequest){case"auto":return e.animationTimelineLeaves!==null||Ja(e.alg.alg)<=Bo&&e.puzzle==="3x3x3"&&e.visualizationStrategy==="Cube3D"?bt:yn;case"tree":return yn;case"simple":return to;case"simultaneous":return bt;default:throw new Error("Invalid indexer request!")}}},Uo=class extends D{getDefaultValue(){return"auto"}},_o=class extends L{derive(e){return new e.indexerConstructor(e.kpuzzle,e.algWithIssues.alg,{animationTimelineLeaves:e.animationTimelineLeaves})}},Vo=class extends L{derive(e){return{pattern:e.currentPattern,movesInProgress:e.currentMoveInfo.currentMoves}}},jo=!0,Tn=class extends L{async derive(e){try{return jo&&e.kpuzzle.algToTransformation(e.algWithIssues.alg),e.algWithIssues}catch(t){return{alg:new p,issues:new qe({errors:[`Invalid alg for puzzle: ${t.toString()}`]})}}}},Wo=class extends D{getDefaultValue(){return"start"}},Go=class extends D{getDefaultValue(){return null}},qo=class extends L{async derive(e){return e.puzzleLoader.kpuzzle()}},$o=class extends D{getDefaultValue(){return je}},Qo=class extends L{async derive(e){return e.puzzleLoader.id}},Ho=class extends D{getDefaultValue(){return je}},Ko=class extends L{derive(e){if(e.puzzleIDRequest&&e.puzzleIDRequest!==je){const t=$t[e.puzzleIDRequest];return t||this.userVisibleErrorTracker.set({errors:[`Invalid puzzle ID: ${e.puzzleIDRequest}`]}),t}return e.puzzleDescriptionRequest&&e.puzzleDescriptionRequest!==je?Es(e.puzzleDescriptionRequest):qt}},Yo=class extends L{derive(e){return{playing:e.playingInfo.playing,atStart:e.detailedTimelineInfo.atStart,atEnd:e.detailedTimelineInfo.atEnd}}canReuseValue(e,t){return e.playing===t.playing&&e.atStart===t.atStart&&e.atEnd===t.atEnd}},Xo=class extends L{derive(e){let t=this.#e(e),n=!1,r=!1;return t>=e.timeRange.end&&(r=!0,t=Math.min(e.timeRange.end,t)),t<=e.timeRange.start&&(n=!0,t=Math.max(e.timeRange.start,t)),{timestamp:t,timeRange:e.timeRange,atStart:n,atEnd:r}}#e(e){switch(e.timestampRequest){case"auto":return e.setupAnchor==="start"&&e.setupAlg.alg.experimentalIsEmpty()?e.timeRange.end:e.timeRange.start;case"start":return e.timeRange.start;case"end":return e.timeRange.end;case"anchor":return e.setupAnchor==="start"?e.timeRange.start:e.timeRange.end;case"opposite-anchor":return e.setupAnchor==="start"?e.timeRange.end:e.timeRange.start;default:return e.timestampRequest}}canReuseValue(e,t){return e.timestamp===t.timestamp&&e.timeRange.start===t.timeRange.start&&e.timeRange.end===t.timeRange.end&&e.atStart===t.atStart&&e.atEnd===t.atEnd}},Zo=class extends le{async getDefaultValue(){return{direction:1,playing:!1,untilBoundary:"entire-timeline",loop:!1}}async derive(e,t){const n=await t,r=Object.assign({},n);return Object.assign(r,e),r}canReuseValue(e,t){return e.direction===t.direction&&e.playing===t.playing&&e.untilBoundary===t.untilBoundary&&e.loop===t.loop}},Jo=class extends le{getDefaultValue(){return 1}derive(e){return e<0?1:e}},el={auto:!0,start:!0,end:!0,anchor:!0,"opposite-anchor":!0},tl=class extends D{getDefaultValue(){return"auto"}set(e){const t=this.get();super.set((async()=>this.validInput(await e)?e:t)())}validInput(e){return!!(typeof e=="number"||el[e])}},nl=class extends L{derive(e){return{start:0,end:e.indexer.algDuration()}}},rl=class extends D{getDefaultValue(){return"auto"}},il=class extends D{getDefaultValue(){return"auto"}},sl=class extends L{derive(e){switch(e.puzzleID){case"clock":case"square1":case"redi_cube":case"melindas2x2x2x2":case"tri_quad":case"loopover":return"2D";case"3x3x3":switch(e.visualizationRequest){case"auto":case"3D":return"Cube3D";default:return e.visualizationRequest}default:switch(e.visualizationRequest){case"auto":case"3D":return"PG3D";case"experimental-2D-LL":case"experimental-2D-LL-face":return["2x2x2","4x4x4","megaminx"].includes(e.puzzleID)?"experimental-2D-LL":"2D";default:return e.visualizationRequest}}}},al=class extends D{getDefaultValue(){return"auto"}},ol=class extends D{getDefaultValue(){return"auto"}},ll=class extends D{getDefaultValue(){return"auto"}},cl=null;async function ul(){return cl??=new(await J()).ThreeTextureLoader}var An=class extends L{async derive(e){const{spriteURL:t}=e;return t===null?null:new Promise(async(n,r)=>{const i=()=>{console.warn("Could not load sprite:",t.toString()),n(null)};try{(await ul()).load(t.toString(),n,i,i)}catch{i()}})}},dl={facelets:["regular","regular","regular","regular","regular"]};async function ml(e){const{definition:t}=await e.kpuzzle(),n={orbits:{}};for(const r of t.orbits)n.orbits[r.orbitName]={pieces:new Array(r.numPieces).fill(dl)};return n}var hl=class extends L{getDefaultValue(){return{orbits:{}}}async derive(e){return e.stickeringMaskRequest?e.stickeringMaskRequest:e.stickeringRequest==="picture"?{specialBehaviour:"picture",orbits:{}}:e.puzzleLoader.stickeringMask?.(e.stickeringRequest??"full")??ml(e.puzzleLoader)}},pl={"-":"Regular",D:"Dim",I:"Ignored",X:"Invisible",O:"IgnoreNonPrimary",P:"PermuteNonPrimary",o:"Ignoriented","?":"OrientationWithoutPermutation",M:"Mystery","@":"Regular"};function fl(e){const t={orbits:{}},n=e.split(",");for(const r of n){const[i,s,...a]=r.split(":");if(a.length>0)throw new Error(`Invalid serialized orbit stickering mask (too many colons): \`${r}\``);const l=[];t.orbits[i]={pieces:l};for(const u of s){const c=pl[u];l.push(tr(c))}}return t}var gl=class extends le{getDefaultValue(){return null}derive(e){return e===null?null:typeof e=="string"?fl(e):e}},vl=class extends D{getDefaultValue(){return null}},wl=class extends D{getDefaultValue(){return"auto"}},yl=class extends D{getDefaultValue(){return{}}},xl=class extends D{getDefaultValue(){return"auto"}},Sl=class extends D{getDefaultValue(){return"auto"}},Dl=class extends L{derive(e){return e.colorSchemeRequest==="dark"?"dark":"light"}},bl=class extends D{getDefaultValue(){return"auto"}},Ml=class extends D{getDefaultValue(){return null}},Ll=35,Il=class extends D{getDefaultValue(){return Ll}};function Zr(e,t){return e.latitude===t.latitude&&e.longitude===t.longitude&&e.distance===t.distance}var zl=class extends le{getDefaultValue(){return"auto"}canReuseValue(e,t){return e===t||Zr(e,t)}async derive(e,t){if(e==="auto")return"auto";let n=await t;n==="auto"&&(n={});const r=Object.assign({},n);return Object.assign(r,e),typeof r.latitude<"u"&&(r.latitude=Math.min(Math.max(r.latitude,-90),90)),typeof r.longitude<"u"&&(r.longitude=Ot(r.longitude,180,-180)),r}},El=class extends L{canReuseValue(e,t){return Zr(e,t)}async derive(e){if(e.orbitCoordinatesRequest==="auto")return Cn(e.puzzleID,e.strategy);const t=Object.assign(Object.assign({},Cn(e.puzzleID,e.strategy),e.orbitCoordinatesRequest));if(Math.abs(t.latitude)<=e.latitudeLimit)return t;{const{latitude:n,longitude:r,distance:i}=t;return{latitude:e.latitudeLimit*Math.sign(n),longitude:r,distance:i}}}},Tl={latitude:31.717474411461005,longitude:0,distance:5.877852522924731},Al={latitude:35,longitude:30,distance:6},kn={latitude:35,longitude:30,distance:6.25},kl={latitude:Math.atan(1/2)*Ge,longitude:0,distance:6.7},Cl={latitude:26.56505117707799,longitude:0,distance:6};function Cn(e,t){if(e[1]==="x")return t==="Cube3D"?Al:kn;switch(e){case"megaminx":case"gigaminx":return kl;case"pyraminx":case"master_tetraminx":return Cl;case"skewb":return kn;default:return Tl}}var Rl=class{constructor(e){this.twistyPlayerModel=e,this.orbitCoordinates=new El({orbitCoordinatesRequest:this.orbitCoordinatesRequest,latitudeLimit:this.latitudeLimit,puzzleID:e.puzzleID,strategy:e.visualizationStrategy}),this.stickeringMask=new hl({stickeringMaskRequest:this.stickeringMaskRequest,stickeringRequest:this.stickeringRequest,puzzleLoader:e.puzzleLoader})}background=new Sl;colorSchemeRequest=new bl;dragInput=new wl;foundationDisplay=new ol;foundationStickerSpriteURL=new _t;fullscreenElement=new Ml;hintFacelet=new Ea;hintStickerSpriteURL=new _t;initialHintFaceletsAnimation=new ll;latitudeLimit=new Il;movePressInput=new xl;movePressCancelOptions=new yl;orbitCoordinatesRequest=new zl;stickeringMaskRequest=new gl;stickeringRequest=new vl;faceletScale=new al;colorScheme=new Dl({colorSchemeRequest:this.colorSchemeRequest});foundationStickerSprite=new An({spriteURL:this.foundationStickerSpriteURL});hintStickerSprite=new An({spriteURL:this.hintStickerSpriteURL});orbitCoordinates;stickeringMask},Nl={errors:[]},Pl=class extends D{getDefaultValue(){return Nl}reset(){this.set(this.getDefaultValue())}canReuseValue(e,t){return Bt(e.errors,t.errors)}},Fl=class{userVisibleErrorTracker=new Pl;alg=new zn;backView=new lo;controlPanel=new vo;catchUpMove=new To;indexerConstructorRequest=new Uo;playingInfo=new Zo;puzzleDescriptionRequest=new $o;puzzleIDRequest=new Ho;setupAnchor=new Wo;setupAlg=new zn;setupTransformation=new Go;tempoScale=new Jo;timestampRequest=new tl;viewerLink=new rl;visualizationFormat=new il;title=new In;videoURL=new _t;competitionID=new In;animationTimelineLeavesRequest=new Eo;puzzleLoader=new Ko({puzzleIDRequest:this.puzzleIDRequest,puzzleDescriptionRequest:this.puzzleDescriptionRequest},this.userVisibleErrorTracker);kpuzzle=new qo({puzzleLoader:this.puzzleLoader});puzzleID=new Qo({puzzleLoader:this.puzzleLoader});puzzleAlg=new Tn({algWithIssues:this.alg,kpuzzle:this.kpuzzle});puzzleSetupAlg=new Tn({algWithIssues:this.setupAlg,kpuzzle:this.kpuzzle});visualizationStrategy=new sl({visualizationRequest:this.visualizationFormat,puzzleID:this.puzzleID});indexerConstructor=new Oo({alg:this.alg,puzzle:this.puzzleID,visualizationStrategy:this.visualizationStrategy,indexerConstructorRequest:this.indexerConstructorRequest,animationTimelineLeaves:this.animationTimelineLeavesRequest});setupAlgTransformation=new Io({setupAlg:this.puzzleSetupAlg,kpuzzle:this.kpuzzle});indexer=new _o({indexerConstructor:this.indexerConstructor,algWithIssues:this.puzzleAlg,kpuzzle:this.kpuzzle,animationTimelineLeaves:this.animationTimelineLeavesRequest});anchorTransformation=new zo({setupTransformation:this.setupTransformation,setupAnchor:this.setupAnchor,setupAlgTransformation:this.setupAlgTransformation,indexer:this.indexer});timeRange=new nl({indexer:this.indexer});detailedTimelineInfo=new Xo({timestampRequest:this.timestampRequest,timeRange:this.timeRange,setupAnchor:this.setupAnchor,setupAlg:this.setupAlg});coarseTimelineInfo=new Yo({detailedTimelineInfo:this.detailedTimelineInfo,playingInfo:this.playingInfo});currentMoveInfo=new ko({indexer:this.indexer,detailedTimelineInfo:this.detailedTimelineInfo,catchUpMove:this.catchUpMove});buttonAppearance=new bo({coarseTimelineInfo:this.coarseTimelineInfo,viewerLink:this.viewerLink});currentLeavesSimplified=new Ao({currentMoveInfo:this.currentMoveInfo});currentPattern=new Co({anchoredStart:this.anchorTransformation,currentLeavesSimplified:this.currentLeavesSimplified,indexer:this.indexer});legacyPosition=new Vo({currentMoveInfo:this.currentMoveInfo,currentPattern:this.currentPattern});twistySceneModel=new Rl(this);async twizzleLink(){const[e,t,n,r,i,s,a,l]=await Promise.all([this.viewerLink.get(),this.puzzleID.get(),this.puzzleDescriptionRequest.get(),this.alg.get(),this.setupAlg.get(),this.setupAnchor.get(),this.twistySceneModel.stickeringRequest.get(),this.twistySceneModel.twistyPlayerModel.title.get()]),u=e==="experimental-twizzle-explorer",c=new URL(`https://alpha.twizzle.net/${u?"explore":"edit"}/`);return r.alg.experimentalIsEmpty()||c.searchParams.set("alg",r.alg.toString()),i.alg.experimentalIsEmpty()||c.searchParams.set("setup-alg",i.alg.toString()),s!=="start"&&c.searchParams.set("setup-anchor",s),a!=="full"&&a!==null&&c.searchParams.set("experimental-stickering",a),u&&n!==je?c.searchParams.set("puzzle-description",n):t!=="3x3x3"&&c.searchParams.set("puzzle",t),l&&c.searchParams.set("title",l),c.toString()}experimentalAddAlgLeaf(e,t){const n=e.as(o);n?this.experimentalAddMove(n,t):this.alg.set((async()=>{const i=(await this.alg.get()).alg.concat(new p([e]));return this.timestampRequest.set("end"),i})())}experimentalAddMove(e,t){const n=typeof e=="string"?new o(e):e;this.alg.set((async()=>{const[{alg:r},i]=await Promise.all([this.alg.get(),this.puzzleLoader.get()]),s=Kn(r,n,{...t,...await Ls(i)});return this.timestampRequest.set("end"),this.catchUpMove.set({move:n,amount:0}),s})())}experimentalRemoveFinalChild(){this.alg.set((async()=>{const e=(await this.alg.get()).alg,t=Array.from(e.childAlgNodes()),[n]=t.splice(-1);if(!n)return e;this.timestampRequest.set("end");const r=n.as(o);return r&&this.catchUpMove.set({move:r.invert(),amount:0}),new p(t)})())}};function x(e){return new Error(`Cannot get \`.${e}\` directly from a \`TwistyPlayer\`.`)}var Bl=class extends H{experimentalModel=new Fl;set alg(e){this.experimentalModel.alg.set(e)}get alg(){throw x("alg")}set experimentalSetupAlg(e){this.experimentalModel.setupAlg.set(e)}get experimentalSetupAlg(){throw x("setup")}set experimentalSetupAnchor(e){this.experimentalModel.setupAnchor.set(e)}get experimentalSetupAnchor(){throw x("anchor")}set puzzle(e){this.experimentalModel.puzzleIDRequest.set(e)}get puzzle(){throw x("puzzle")}set experimentalPuzzleDescription(e){this.experimentalModel.puzzleDescriptionRequest.set(e)}get experimentalPuzzleDescription(){throw x("experimentalPuzzleDescription")}set timestamp(e){this.experimentalModel.timestampRequest.set(e)}get timestamp(){throw x("timestamp")}set hintFacelets(e){this.experimentalModel.twistySceneModel.hintFacelet.set(e)}get hintFacelets(){throw x("hintFacelets")}set experimentalStickering(e){this.experimentalModel.twistySceneModel.stickeringRequest.set(e)}get experimentalStickering(){throw x("experimentalStickering")}set experimentalStickeringMaskOrbits(e){this.experimentalModel.twistySceneModel.stickeringMaskRequest.set(e)}get experimentalStickeringMaskOrbits(){throw x("experimentalStickeringMaskOrbits")}set experimentalFaceletScale(e){this.experimentalModel.twistySceneModel.faceletScale.set(e)}get experimentalFaceletScale(){throw x("experimentalFaceletScale")}set backView(e){this.experimentalModel.backView.set(e)}get backView(){throw x("backView")}set background(e){this.experimentalModel.twistySceneModel.background.set(e)}get background(){throw x("background")}set colorScheme(e){this.experimentalModel.twistySceneModel.colorSchemeRequest.set(e)}get colorScheme(){throw x("colorScheme")}set controlPanel(e){this.experimentalModel.controlPanel.set(e)}get controlPanel(){throw x("controlPanel")}set visualization(e){this.experimentalModel.visualizationFormat.set(e)}get visualization(){throw x("visualization")}set experimentalTitle(e){this.experimentalModel.title.set(e)}get experimentalTitle(){throw x("experimentalTitle")}set experimentalVideoURL(e){this.experimentalModel.videoURL.set(e)}get experimentalVideoURL(){throw x("experimentalVideoURL")}set experimentalCompetitionID(e){this.experimentalModel.competitionID.set(e)}get experimentalCompetitionID(){throw x("experimentalCompetitionID")}set viewerLink(e){this.experimentalModel.viewerLink.set(e)}get viewerLink(){throw x("viewerLink")}set experimentalMovePressInput(e){this.experimentalModel.twistySceneModel.movePressInput.set(e)}get experimentalMovePressInput(){throw x("experimentalMovePressInput")}set experimentalMovePressCancelOptions(e){this.experimentalModel.twistySceneModel.movePressCancelOptions.set(e)}get experimentalMovePressCancelOptions(){throw x("experimentalMovePressCancelOptions")}set cameraLatitude(e){this.experimentalModel.twistySceneModel.orbitCoordinatesRequest.set({latitude:e})}get cameraLatitude(){throw x("cameraLatitude")}set cameraLongitude(e){this.experimentalModel.twistySceneModel.orbitCoordinatesRequest.set({longitude:e})}get cameraLongitude(){throw x("cameraLongitude")}set cameraDistance(e){this.experimentalModel.twistySceneModel.orbitCoordinatesRequest.set({distance:e})}get cameraDistance(){throw x("cameraDistance")}set cameraLatitudeLimit(e){this.experimentalModel.twistySceneModel.latitudeLimit.set(e)}get cameraLatitudeLimit(){throw x("cameraLatitudeLimit")}set indexer(e){this.experimentalModel.indexerConstructorRequest.set(e)}get indexer(){throw x("indexer")}set tempoScale(e){this.experimentalModel.tempoScale.set(e)}get tempoScale(){throw x("tempoScale")}set experimentalSprite(e){this.experimentalModel.twistySceneModel.foundationStickerSpriteURL.set(e)}get experimentalSprite(){throw x("experimentalSprite")}set experimentalHintSprite(e){this.experimentalModel.twistySceneModel.hintStickerSpriteURL.set(e)}get experimentalHintSprite(){throw x("experimentalHintSprite")}set fullscreenElement(e){this.experimentalModel.twistySceneModel.fullscreenElement.set(e)}get fullscreenElement(){throw x("fullscreenElement")}set experimentalInitialHintFaceletsAnimation(e){this.experimentalModel.twistySceneModel.initialHintFaceletsAnimation.set(e)}get experimentalInitialHintFaceletsAnimation(){throw x("experimentalInitialHintFaceletsAnimation")}set experimentalDragInput(e){this.experimentalModel.twistySceneModel.dragInput.set(e)}get experimentalDragInput(){throw x("experimentalDragInput")}experimentalGet=new Ol(this.experimentalModel)},Ol=class{constructor(e){this.model=e}async alg(){return(await this.model.alg.get()).alg}async setupAlg(){return(await this.model.setupAlg.get()).alg}puzzleID(){return this.model.puzzleID.get()}async timestamp(){return(await this.model.detailedTimelineInfo.get()).timestamp}},Mt="data-",mt={alg:"alg","experimental-setup-alg":"experimentalSetupAlg","experimental-setup-anchor":"experimentalSetupAnchor",puzzle:"puzzle","experimental-puzzle-description":"experimentalPuzzleDescription",visualization:"visualization","hint-facelets":"hintFacelets","experimental-stickering":"experimentalStickering","experimental-stickering-mask-orbits":"experimentalStickeringMaskOrbits",background:"background","color-scheme":"colorScheme","control-panel":"controlPanel","back-view":"backView","experimental-initial-hint-facelets-animation":"experimentalInitialHintFaceletsAnimation","viewer-link":"viewerLink","experimental-move-press-input":"experimentalMovePressInput","experimental-drag-input":"experimentalDragInput","experimental-title":"experimentalTitle","experimental-video-url":"experimentalVideoURL","experimental-competition-id":"experimentalCompetitionID","camera-latitude":"cameraLatitude","camera-longitude":"cameraLongitude","camera-distance":"cameraDistance","camera-latitude-limit":"cameraLatitudeLimit","tempo-scale":"tempoScale","experimental-sprite":"experimentalSprite","experimental-hint-sprite":"experimentalHintSprite"},Ul=Object.fromEntries(Object.values(mt).map(e=>[e,!0])),_l={experimentalMovePressCancelOptions:!0},Rn,Jr=Symbol("intersectedCallback");function Vl(e){Rn??=new IntersectionObserver((t,n)=>{for(const r of t)r.isIntersecting&&r.intersectionRect.height>0&&(r.target[Jr](),n.unobserve(r.target))}),Rn.observe(e)}var Xe=class extends Bl{controller=new fo(this.experimentalModel,this);buttons;experimentalCanvasClickCallback=()=>{};constructor(e={}){super();for(const[t,n]of Object.entries(e)){if(!(Ul[t]||_l[t])){console.warn(`Invalid config passed to TwistyPlayer: ${t}`);break}this[t]=n}}#e=new Ye(this,"controls-",["auto"].concat(Object.keys(go)));#t=document.createElement("div");#n=document.createElement("div");#r=!1;connectedCallback(){this.addCSS(Kr),Vl(this)}async[Jr](){if(this.#r)return;this.#r=!0,this.addElement(this.#t).classList.add("visualization-wrapper"),this.addElement(this.#n).classList.add("error-elem"),this.#n.textContent="Error",this.experimentalModel.userVisibleErrorTracker.addFreshListener(t=>{const n=t.errors[0]??null;this.contentWrapper.classList.toggle("error",!!n),n&&(this.#n.textContent=n)});const e=new $r(this.experimentalModel,this.controller);this.contentWrapper.appendChild(e),this.buttons=new jr(this.experimentalModel,this.controller,this),this.contentWrapper.appendChild(this.buttons),this.experimentalModel.twistySceneModel.background.addFreshListener(t=>{this.contentWrapper.classList.toggle("checkered",["auto","checkered"].includes(t)),this.contentWrapper.classList.toggle("checkered-transparent",t==="checkered-transparent")}),this.experimentalModel.twistySceneModel.colorScheme.addFreshListener(t=>{this.contentWrapper.classList.toggle("dark-mode",["dark"].includes(t))}),this.experimentalModel.controlPanel.addFreshListener(t=>{this.#e.setValue(t)}),this.experimentalModel.visualizationStrategy.addFreshListener(this.#l.bind(this)),this.experimentalModel.puzzleID.addFreshListener(this.flash.bind(this))}#s="auto";experimentalSetFlashLevel(e){this.#s=e}flash(){this.#s==="auto"&&this.#i?.animate([{opacity:.25},{opacity:1}],{duration:250,easing:"ease-out"})}#i=null;#a=new Or;#o=null;#l(e){if(e!==this.#o){this.#i?.remove(),this.#i?.disconnect();let t;switch(e){case"2D":case"experimental-2D-LL":case"experimental-2D-LL-face":{t=new Br(this.experimentalModel.twistySceneModel,e);break}case"Cube3D":case"PG3D":{t=new Ut(this.experimentalModel),this.#a.handleNewValue(t);break}default:throw new Error("Invalid visualization")}this.#t.appendChild(t),this.#i=t,this.#o=e}}async experimentalCurrentVantages(){this.connectedCallback();const e=this.#i;return e instanceof Ut?e.experimentalVantages():[]}async experimentalCurrentCanvases(){const e=await this.experimentalCurrentVantages(),t=[];for(const n of e)t.push((await n.canvasInfo()).canvas);return t}async experimentalCurrentThreeJSPuzzleObject(e){this.connectedCallback();const n=await(await this.#a.promise).experimentalTwisty3DPuzzleWrapper(),r=n.twisty3DPuzzle(),i=(async()=>{await r,await new Promise(s=>setTimeout(s,0))})();if(e){const s=new Ee(async()=>{});n.addEventListener("render-scheduled",async()=>{s.requestIsPending()||(s.requestAnimFrame(),await i,e())})}return r}jumpToStart(e){this.controller.jumpToStart(e)}jumpToEnd(e){this.controller.jumpToEnd(e)}play(){this.controller.togglePlay(!0)}pause(){this.controller.togglePlay(!1)}togglePlay(e){this.controller.togglePlay(e)}experimentalAddMove(e,t){this.experimentalModel.experimentalAddMove(e,t)}experimentalAddAlgLeaf(e,t){this.experimentalModel.experimentalAddAlgLeaf(e,t)}static get observedAttributes(){const e=[];for(const t of Object.keys(mt))e.push(t,Mt+t);return e}experimentalRemoveFinalChild(){this.experimentalModel.experimentalRemoveFinalChild()}attributeChangedCallback(e,t,n){e.startsWith(Mt)&&(e=e.slice(Mt.length));const r=mt[e];r&&(this[r]=n)}async experimentalScreenshot(e){return(await Ln(this.experimentalModel,e)).dataURL}async experimentalDownloadScreenshot(e){if(["2D","experimental-2D-LL","experimental-2D-LL-face"].includes(await this.experimentalModel.visualizationStrategy.get())){const n=await this.#i.currentTwisty2DPuzzleWrapper().twisty2DPuzzle(),r=new XMLSerializer().serializeToString(n.svgWrapper.svgElement),i=URL.createObjectURL(new Blob([r]));Hr(i,e??await Qr(this.experimentalModel),"svg")}else await(await Ln(this.experimentalModel)).download(e)}};P.define("twisty-player",Xe);var jl=class extends ge{traverseAlg(e,t){const n=[];let r=0;for(const i of e.childAlgNodes()){const s=this.traverseAlgNode(i,{numMovesSoFar:t.numMovesSoFar+r});n.push(s.tokens),r+=s.numLeavesInside}return{tokens:Array.prototype.concat(...n),numLeavesInside:r}}traverseGrouping(e,t){const n=this.traverseAlg(e.alg,t);return{tokens:n.tokens,numLeavesInside:n.numLeavesInside*e.amount}}traverseMove(e,t){return{tokens:[{leaf:e,idx:t.numMovesSoFar}],numLeavesInside:1}}traverseCommutator(e,t){const n=this.traverseAlg(e.A,t),r=this.traverseAlg(e.B,{numMovesSoFar:t.numMovesSoFar+n.numLeavesInside});return{tokens:n.tokens.concat(r.tokens),numLeavesInside:n.numLeavesInside*2+r.numLeavesInside}}traverseConjugate(e,t){const n=this.traverseAlg(e.A,t),r=this.traverseAlg(e.B,{numMovesSoFar:t.numMovesSoFar+n.numLeavesInside});return{tokens:n.tokens.concat(r.tokens),numLeavesInside:n.numLeavesInside*2+r.numLeavesInside*2}}traversePause(e,t){return{tokens:[{leaf:e,idx:t.numMovesSoFar}],numLeavesInside:1}}traverseNewline(e,t){return{tokens:[],numLeavesInside:0}}traverseLineComment(e,t){return{tokens:[],numLeavesInside:0}}},Wl=V(jl),Gl=class extends D{getDefaultValue(){return""}},ql=class extends L{derive(e){return Xr(e.value)}},$l=class extends le{getDefaultValue(){return{selectionStart:0,selectionEnd:0,endChangedMostRecently:!1}}async derive(e,t){const{selectionStart:n,selectionEnd:r}=e,i=await t,s=e.selectionStart===i.selectionStart&&e.selectionEnd!==(await t).selectionEnd;return{selectionStart:n,selectionEnd:r,endChangedMostRecently:s}}},Ql=class extends L{derive(e){return e.selectionInfo.endChangedMostRecently?e.selectionInfo.selectionEnd:e.selectionInfo.selectionStart}},Hl=class extends L{derive(e){return Wl(e.algWithIssues.alg,{numMovesSoFar:0}).tokens}},Kl=class extends L{derive(e){function t(r){if(r===null)return null;let i;return e.targetChar<r.leaf[G]?i="before":e.targetChar===r.leaf[G]?i="start":e.targetChar<r.leaf[X]?i="inside":e.targetChar===r.leaf[X]?i="end":i="after",{leafInfo:r,where:i}}let n=null;for(const r of e.leafTokens){if(e.targetChar<r.leaf[G]&&n!==null)return t(n);if(e.targetChar<=r.leaf[X])return t(r);n=r}return t(n)}},Yl=class{valueProp=new Gl;selectionProp=new $l;targetCharProp=new Ql({selectionInfo:this.selectionProp});algEditorAlgWithIssues=new ql({value:this.valueProp});leafTokensProp=new Hl({algWithIssues:this.algEditorAlgWithIssues});leafToHighlight=new Kl({leafTokens:this.leafTokensProp,targetChar:this.targetCharProp})},Xl="//";function Zl(e){try{return p.fromString(e)}catch{return null}}function ei(e,t){const n=e.indexOf(t);return n===-1?[e,""]:[e.slice(0,n),e.slice(n)]}function Nn(e){const t=[];for(const n of e.split(`
`)){let[r,i]=ei(n,Xl);r=r.replaceAll("’","'"),t.push(r+i)}return t.join(`
`)}function Jl(e,t){const{value:n}=e,{selectionStart:r,selectionEnd:i}=e,s=n.slice(0,r),a=n.slice(i);t=t.replaceAll(`\r
`,`
`);const l=s.match(/\/\/[^\n]*$/),u=n[r-1]==="/"&&t[0]==="/",c=l||u,d=t.match(/\/\/[^\n]*$/);let m=t;if(c){const[z,I]=ei(t,`
`);m=z+Nn(I)}else m=Nn(t);const h=!c&&r!==0&&![`
`," "].includes(m[0])&&![`
`," "].includes(n[r-1]),v=!d&&i!==n.length&&![`
`," "].includes(m.at(-1))&&![`
`," "].includes(n[i]);function f(z,I){const k=z+m+I,j=!!Zl(s+k+a);return j&&(m=k),j}h&&v&&f(" "," ")||h&&f(" ","")||v&&f(""," "),ae?.execCommand("insertText",!1,m)||e.setRangeText(m,r,i,"end")}var ti=new q;ti.replaceSync(`
:host {
  width: 384px;
  display: grid;
}

.wrapper {
  /*overflow: hidden;
  resize: horizontal;*/

  background: var(--background, none);
  display: grid;
}

textarea, .carbon-copy {
  grid-area: 1 / 1 / 2 / 2;

  width: 100%;
  font-family: sans-serif;
  line-height: 1.2em;

  font-size: var(--font-size, inherit);
  font-family: var(--font-family, sans-serif);

  box-sizing: border-box;

  padding: var(--padding, 0.5em);
  /* Prevent horizontal growth. */
  overflow-x: hidden;
}

textarea {
  resize: none;
  background: none;
  z-index: 2;
  border: 1px solid var(--border-color, rgba(0, 0, 0, 0.25));
  overflow: hidden;
}

.carbon-copy {
  white-space: pre-wrap;
  word-wrap: break-word;
  color: transparent;
  user-select: none;
  pointer-events: none;

  z-index: 1;
}

.carbon-copy .highlight {
  background: var(--highlight-color, rgba(255, 128, 0, 0.5));
  padding: 0.1em 0.2em;
  margin: -0.1em -0.2em;
  border-radius: 0.2em;
}

.wrapper.issue-warning textarea,
.wrapper.valid-for-puzzle-warning textarea {
  outline: none;
  border: 1px solid rgba(200, 200, 0, 0.5);
  background: rgba(255, 255, 0, 0.1);
}

.wrapper.issue-error textarea,
.wrapper.valid-for-puzzle-error textarea {
  outline: none;
  border: 1px solid red;
  background: rgba(255, 0, 0, 0.1);
}
`);var tt="for-twisty-player",Pn="placeholder",Fn="twisty-player-prop",ec=class extends H{model=new Yl;#e=document.createElement("textarea");#t=document.createElement("div");#n=document.createElement("span");#r=document.createElement("span");#s=document.createElement("span");#i=new Ye(this,"valid-for-puzzle-",["none","warning","error"]);#a=null;#o;get#l(){return this.#a===null?null:this.#a.experimentalModel[this.#o]}debugNeverRequestTimestamp=!1;constructor(e){super(),this.#t.classList.add("carbon-copy"),this.addElement(this.#t),this.#e.rows=1,this.addElement(this.#e),this.#n.classList.add("prefix"),this.#t.appendChild(this.#n),this.#r.classList.add("highlight"),this.#t.appendChild(this.#r),this.#s.classList.add("suffix"),this.#t.appendChild(this.#s),this.#e.placeholder="Alg",this.#e.setAttribute("spellcheck","false"),this.addCSS(ti),this.#e.addEventListener("input",()=>{this.#u=!0,this.onInput()}),this.#e.addEventListener("blur",()=>this.onBlur()),document.addEventListener("selectionchange",()=>this.onSelectionChange()),e?.twistyPlayer&&(this.twistyPlayer=e.twistyPlayer),this.#o=e?.twistyPlayerProp??"alg",e?.twistyPlayerProp==="alg"&&this.model.leafToHighlight.addFreshListener(t=>{t&&this.highlightLeaf(t.leafInfo.leaf)})}connectedCallback(){this.#e.addEventListener("paste",e=>{const t=e.clipboardData?.getData("text");t&&(Jl(this.#e,t),e.preventDefault(),this.onInput())})}set algString(e){this.#e.value=e,this.onInput()}get algString(){return this.#e.value}set placeholder(e){this.#e.placeholder=e}#u=!1;onInput(){this.#r.hidden=!0,this.highlightLeaf(null);const e=this.#e.value.trimEnd();this.model.valueProp.set(e),this.#l?.set(e)}async onSelectionChange(){if(document.activeElement!==this||this.shadow.activeElement!==this.#e||this.#o!=="alg")return;const{selectionStart:e,selectionEnd:t}=this.#e;this.model.selectionProp.set({selectionStart:e,selectionEnd:t})}async onBlur(){}setAlgIssueClassForPuzzle(e){this.#i.setValue(e)}#d(e){return e.endsWith(`
`)?`${e} `:e}#c=null;highlightLeaf(e){if(e===null){this.#n.textContent="",this.#r.textContent="",this.#s.textContent=this.#d(this.#e.value);return}e!==this.#c&&(this.#c=e,this.#n.textContent=this.#e.value.slice(0,e[G]),this.#r.textContent=this.#e.value.slice(e[G],e[X]),this.#s.textContent=this.#d(this.#e.value.slice(e[X])),this.#r.hidden=!1)}get twistyPlayer(){return this.#a}set twistyPlayer(e){if(this.#a){console.warn("twisty-player reassignment/clearing is not supported");return}this.#a=e,e&&((async()=>this.algString=this.#l?(await this.#l.get()).alg.toString():"")(),this.#o==="alg"&&(this.#a?.experimentalModel.puzzleAlg.addFreshListener(t=>{if(t.issues.errors.length===0){this.setAlgIssueClassForPuzzle(t.issues.warnings.length===0?"none":"warning");const n=t.alg,r=p.fromString(this.algString);n.isIdentical(r)||(this.algString=n.toString(),this.onInput())}else this.setAlgIssueClassForPuzzle("error")}),this.model.leafToHighlight.addFreshListener(async t=>{if(t===null)return;const[n,r]=await Promise.all([await e.experimentalModel.indexer.get(),await e.experimentalModel.timestampRequest.get()]);if(r==="auto"&&!this.#u)return;const i=n.indexToMoveStartTimestamp(t.leafInfo.idx),s=n.moveDuration(t.leafInfo.idx);let a;switch(t.where){case"before":{a=i;break}case"start":case"inside":{a=i+s/4;break}case"end":case"after":{a=i+s;break}default:throw console.log("invalid where"),new Error("Invalid where!")}this.debugNeverRequestTimestamp||e.experimentalModel.timestampRequest.set(a)}),e.experimentalModel.currentLeavesSimplified.addFreshListener(async t=>{const r=(await e.experimentalModel.indexer.get()).getAnimLeaf(t.patternIndex);this.highlightLeaf(r)})))}attributeChangedCallback(e,t,n){switch(e){case tt:{const r=document.getElementById(n);if(!r){console.warn(`${tt}= elem does not exist`);return}if(!(r instanceof Xe)){console.warn(`${tt}=is not a twisty-player`);return}this.twistyPlayer=r;return}case Pn:{this.placeholder=n;return}case Fn:{if(this.#a)throw console.log("cannot set prop"),new Error("cannot set prop after twisty player");this.#o=n;return}}}static get observedAttributes(){return[tt,Pn,Fn]}};P.define("twisty-alg-editor",ec);async function tc(e){return new Promise((t,n)=>{try{const r=document.getElementById(e);r&&t(r);const i=new MutationObserver(s=>{for(const a of s)a.attributeName==="id"&&a.target instanceof Element&&a.target.getAttribute("id")===e&&(t(a.target),i.disconnect())});i.observe(document.body,{attributeFilter:["id"],subtree:!0})}catch(r){n(r)}})}var ni=new q;ni.replaceSync(`
:host {
  display: inline;
}

.wrapper {
  display: inline;
}

a:not(:hover) {
  color: inherit;
  text-decoration: none;
}

twisty-alg-leaf-elem.twisty-alg-comment {
  color: rgba(0, 0, 0, 0.4);
}

.wrapper.current-move {
  background: rgba(66, 133, 244, 0.3);
  margin-left: -0.1em;
  margin-right: -0.1em;
  padding-left: 0.1em;
  padding-right: 0.1em;
  border-radius: 0.1em;
}
`);var nc=.25,De=class extends H{constructor(e,t,n,r,i,s){if(super({mode:"open"}),this.algOrAlgNode=r,this.classList.add(e),this.addCSS(ni),s){const a=this.contentWrapper.appendChild(document.createElement("a"));a.href="#",a.textContent=t,a.addEventListener("click",l=>{l.preventDefault(),n.twistyAlgViewer.jumpToIndex(n.earliestMoveIndex,i)})}else this.contentWrapper.appendChild(document.createElement("span")).textContent=t}pathToIndex(e){return[]}setCurrentMove(e){this.contentWrapper.classList.toggle("current-move",e)}};P.define("twisty-alg-leaf-elem",De);var be=class extends We{constructor(e,t){super(),this.algOrAlgNode=t,this.classList.add(e)}queue=[];addString(e){this.queue.push(document.createTextNode(e))}addElem(e){return this.queue.push(e.element),e.moveCount}flushQueue(e=1){for(const t of ri(this.queue,e))this.append(t);this.queue=[]}pathToIndex(e){return[]}};P.define("twisty-alg-wrapper-elem",be);function rc(e){return e===1?-1:1}function ic(e,t){return t<0?rc(e):e}function ri(e,t){if(t===1)return e;const n=Array.from(e);return n.reverse(),n}var sc=class extends ge{traverseAlg(e,t){let n=0;const r=new be("twisty-alg-alg",e);let i=!0;for(const s of Vn(e.childAlgNodes(),t.direction))i||r.addString(" "),i=!1,s.as(O)?.experimentalNISSGrouping&&r.addString("^("),s.as(B)?.experimentalNISSPlaceholder||(n+=r.addElem(this.traverseAlgNode(s,{earliestMoveIndex:t.earliestMoveIndex+n,twistyAlgViewer:t.twistyAlgViewer,direction:t.direction}))),s.as(O)?.experimentalNISSGrouping&&r.addString(")");return r.flushQueue(t.direction),{moveCount:n,element:r}}traverseGrouping(e,t){const n=e.experimentalAsSquare1Tuple(),r=ic(t.direction,e.amount);let i=0;const s=new be("twisty-alg-grouping",e);return s.addString("("),n?(i+=s.addElem({moveCount:1,element:new De("twisty-alg-move",n[0].amount.toString(),t,n[0],!0,!0)}),s.addString(", "),i+=s.addElem({moveCount:1,element:new De("twisty-alg-move",n[1].amount.toString(),t,n[1],!0,!0)})):i+=s.addElem(this.traverseAlg(e.alg,{earliestMoveIndex:t.earliestMoveIndex+i,twistyAlgViewer:t.twistyAlgViewer,direction:r})),s.addString(`)${e.experimentalRepetitionSuffix}`),s.flushQueue(),{moveCount:i*Math.abs(e.amount),element:s}}traverseMove(e,t){const n=new De("twisty-alg-move",e.toString(),t,e,!0,!0);return t.twistyAlgViewer.highlighter.addMove(e[G],n),{moveCount:1,element:n}}traverseCommutator(e,t){let n=0;const r=new be("twisty-alg-commutator",e);r.addString("["),r.flushQueue();const[i,s]=ri([e.A,e.B],t.direction);return n+=r.addElem(this.traverseAlg(i,{earliestMoveIndex:t.earliestMoveIndex+n,twistyAlgViewer:t.twistyAlgViewer,direction:t.direction})),r.addString(", "),n+=r.addElem(this.traverseAlg(s,{earliestMoveIndex:t.earliestMoveIndex+n,twistyAlgViewer:t.twistyAlgViewer,direction:t.direction})),r.flushQueue(t.direction),r.addString("]"),r.flushQueue(),{moveCount:n*2,element:r}}traverseConjugate(e,t){let n=0;const r=new be("twisty-alg-conjugate",e);r.addString("[");const i=r.addElem(this.traverseAlg(e.A,{earliestMoveIndex:t.earliestMoveIndex+n,twistyAlgViewer:t.twistyAlgViewer,direction:t.direction}));return n+=i,r.addString(": "),n+=r.addElem(this.traverseAlg(e.B,{earliestMoveIndex:t.earliestMoveIndex+n,twistyAlgViewer:t.twistyAlgViewer,direction:t.direction})),r.addString("]"),r.flushQueue(),{moveCount:n+i,element:r}}traversePause(e,t){return e.experimentalNISSGrouping?this.traverseAlg(e.experimentalNISSGrouping.alg,t):{moveCount:1,element:new De("twisty-alg-pause",".",t,e,!0,!0)}}traverseNewline(e,t){const n=new be("twisty-alg-newline",e);return n.append(document.createElement("br")),{moveCount:0,element:n}}traverseLineComment(e,t){return{moveCount:0,element:new De("twisty-alg-line-comment",`//${e.text}`,t,e,!1,!1)}}},ac=V(sc),oc=class{moveCharIndexMap=new Map;currentElem=null;addMove(e,t){this.moveCharIndexMap.set(e,t)}set(e){const t=e?this.moveCharIndexMap.get(e[G])??null:null;this.currentElem!==t&&(this.currentElem?.classList.remove("twisty-alg-current-move"),this.currentElem?.setCurrentMove(!1),t?.classList.add("twisty-alg-current-move"),t?.setCurrentMove(!0),this.currentElem=t)}},ii=class extends We{highlighter=new oc;#e;#t=null;lastClickTimestamp=null;constructor(e){super(),e?.twistyPlayer&&(this.twistyPlayer=e?.twistyPlayer)}connectedCallback(){}setAlg(e){this.#e=ac(e,{earliestMoveIndex:0,twistyAlgViewer:this,direction:1}).element,this.textContent="",this.appendChild(this.#e)}get twistyPlayer(){return this.#t}set twistyPlayer(e){this.#n(e)}async#n(e){if(this.#t){console.warn("twisty-player reassignment is not supported");return}if(e===null)throw new Error("clearing twistyPlayer is not supported");this.#t=e,this.#t.experimentalModel.alg.addFreshListener(r=>{this.setAlg(r.alg)});const t=(await this.#t.experimentalModel.alg.get()).alg,n=G in t?t:p.fromString(t.toString());this.setAlg(n),e.experimentalModel.currentMoveInfo.addFreshListener(r=>{let i=r.currentMoves[0];if(i??=r.movesStarting[0],i??=r.movesFinishing[0],!i)this.highlighter.set(null);else{const s=i.move;this.highlighter.set(s)}}),e.experimentalModel.detailedTimelineInfo.addFreshListener(r=>{r.timestamp!==this.lastClickTimestamp&&(this.lastClickTimestamp=null)})}async jumpToIndex(e,t){const n=this.#t;if(n){n.pause();const r=(async()=>{const i=await n.experimentalModel.indexer.get(),s=t?i.moveDuration(e)*nc:0;return i.indexToMoveStartTimestamp(e)+i.moveDuration(e)-s})();n.experimentalModel.timestampRequest.set(await r),this.lastClickTimestamp===await r?(n.play(),this.lastClickTimestamp=null):this.lastClickTimestamp=await r}}async attributeChangedCallback(e,t,n){if(e==="for"){let r=document.getElementById(n);if(r||console.info("for= elem does not exist, waiting for one"),await customElements.whenDefined("twisty-player"),r=await tc(n),!(r instanceof Xe)){console.warn("for= elem is not a twisty-player");return}this.twistyPlayer=r}}static get observedAttributes(){return["for"]}};P.define("twisty-alg-viewer",ii);var ot=new q;ot.replaceSync(`
.wrapper {
  background: rgb(255, 245, 235);
  border: 1px solid rgba(0, 0, 0, 0.25);

  /* Workaround from https://stackoverflow.com/questions/40010597/how-do-i-apply-opacity-to-a-css-color-variable */
  --text-color: 0, 0, 0;
  --heading-background: 255, 230, 210;

  color: rgb(var(--text-color));
}

.setup-alg, twisty-alg-viewer {
  padding: 0.5em 1em;
}

.heading {
  background: rgba(var(--heading-background), 1);
  color: rgba(var(--text-color), 1);
  font-weight: bold;
  padding: 0.25em 0.5em;
  display: grid;
  grid-template-columns: auto 1fr;

  /* For the move count hover elems. */
  position: sticky;
}

.heading.title {
  background: rgb(255, 245, 235);
  font-size: 150%;
  white-space: pre-wrap;
}

.heading .move-count {
  font-weight: initial;
  text-align: right;
  color: rgba(var(--text-color), 0.4);
}

.wrapper.dark-mode .heading .move-count {
  color: rgba(var(--text-color), 0.7);
}

.heading a {
  text-decoration: none;
  color: inherit;
}

twisty-player {
  width: 100%;
  min-height: 128px;
  height: 288px;
  resize: vertical;
  overflow-y: hidden;
}

twisty-player + .heading {
  padding-top: 0.5em;
}

twisty-alg-viewer {
  display: inline-block;
}

.wrapper {
  container-type: inline-size;
}

.scrollable-region {
  border-top: 1px solid rgba(0, 0, 0, 0.25);
}

.scrollable-region {
  max-height: 18em;
  overflow-y: auto;
}

@container (min-width: 512px) {
  .responsive-wrapper {
    display: grid;
    grid-template-columns: 1fr 1fr;
  }
  twisty-player {
    height: 320px
  }
  .scrollable-region {
    border-top: none;
    border-left: 1px solid rgba(0, 0, 0, 0.25);
    contain: strict;
    max-height: 100cqh;
  }
}

.wrapper:fullscreen,
.wrapper:fullscreen .responsive-wrapper {
  width: 100%;
  height: 100%;
}

.wrapper:fullscreen twisty-player,
.wrapper:fullscreen .scrollable-region {
  height: 50%;
}

@container (min-width: 512px) {
  .wrapper:fullscreen twisty-player,
  .wrapper:fullscreen .scrollable-region {
    height: 100%;
  }
}

/* TODO: dedup with Twizzle Editor */
.move-count > span:hover:before {
  background-color: rgba(var(--heading-background), 1);
  color: rgba(var(--text-color), 1);
  backdrop-filter: blur(4px);
  z-index: 100;
  position: absolute;
  padding: 0.5em;
  top: 1.5em;
  right: 0;
  content: attr(data-before);
  white-space: pre-wrap;
  text-align: left;
}

.move-count > span:hover {
  color: rgba(var(--text-color), 1);
  cursor: help;
}
`);var si=new q;si.replaceSync(`
.wrapper {
  background: white;
  --heading-background: 232, 239, 253
}

.wrapper.dark-mode {
  --text-color: 236, 236, 236;
  --heading-background: 29, 29, 29;
}

.scrollable-region {
  overflow-y: auto;
}

.wrapper.dark-mode {
  background: #262626;
  --text-color: 142, 142, 142;
  border-color: #FFFFFF44;
  color-scheme: dark;
}

.wrapper.dark-mode .heading:not(.title) {
  background: #1d1d1d;
}

.heading.title {
  background: none;
}
`);function lc(e="",t=location.href){const n={alg:"alg","setup-alg":"experimental-setup-alg","setup-anchor":"experimental-setup-anchor",puzzle:"puzzle",stickering:"experimental-stickering","puzzle-description":"experimental-puzzle-description",title:"experimental-title","video-url":"experimental-video-url",competition:"experimental-competition-id"},r=new URL(t).searchParams,i={};for(const[s,a]of Object.entries(n)){const l=r.get(e+s);if(l!==null){const u=mt[a];i[u]=l}}return i}var nt="outer block moves (e.g. R, Rw, or 4r)",rt="inner block moves (e.g. M or 2-5r)",Bn={OBTM:`HTM = OBTM ("Outer Block Turn Metric"):
• ${rt} count as 2 turns
• ${nt} count as 1 turn
• rotations (e.g. x) count as 0 turns`,OBQTM:`QTM = OBQTM ("Outer Block Quantum Turn Metric"):
• ${rt} count as 2 turns per quantum (e.g. M2 counts as 4)
• ${nt} count as 1 turn per quantum (e.g. R2 counts as 2)
• rotations (e.g. x) count as 0 turns`,RBTM:`STM = RBTM ("Range Block Turn Metric"):
• ${rt} count as 1 turn
• ${nt} count as 1 turn
• rotations (e.g. x) count as 0 turns`,RBQTM:`SQTM = RBQTM ("Range Block Quantum Turn Metric"):
• ${rt} count as 1 turn per quantum (e.g. M2 counts as 2)
• ${nt} count as 1 turn per quantum (e.g. R2 counts as 2)
• rotations (e.g. x) count as 0 turns`,ETM:`ETM ("Execution Turn Metric"):
• all moves (including rotations) count as 1 turn`},cc={OBTM:"OB",OBQTM:"OBQ",RBTM:"RB",RBQTM:"RBQ",ETM:"E"},uc=class extends H{constructor(e){super({mode:"open"}),this.options=e}twistyPlayer=null;a=null;#e(){if(this.contentWrapper.textContent="",this.a){const t=this.contentWrapper.appendChild(document.createElement("span"));t.textContent="❗️",t.title="Could not show a player for link",this.addElement(this.a)}this.removeCSS(ot);const e=this.shadow.adoptedStyleSheets.indexOf(ot);typeof e<"u"&&this.shadow.adoptedStyleSheets.splice(e,e+1),this.#t?.remove()}#t;#n;#r;#s;async connectedCallback(){if(this.#r=this.addElement(document.createElement("div")),this.#r.classList.add("responsive-wrapper"),this.options?.colorScheme==="dark"&&this.contentWrapper.classList.add("dark-mode"),this.addCSS(ot),this.options?.cdnForumTweaks&&this.addCSS(si),this.a=this.querySelector("a"),!this.a)return;const e=lc("",this.a.href),t=this.a?.href,{hostname:n,pathname:r}=new URL(t);if(n!=="alpha.twizzle.net"){this.#e();return}if(["/edit/","/explore/"].includes(r)){const i=r==="/explore/";if(e.puzzle&&!(e.puzzle in $t)){const l=(await y(async()=>{const{getPuzzleDescriptionString:u}=await import("./index-Cx7SpYQN.js");return{getPuzzleDescriptionString:u}},__vite__mapDeps([3,1]))).getPuzzleDescriptionString(e.puzzle);delete e.puzzle,e.experimentalPuzzleDescription=l}if(this.twistyPlayer=this.#r.appendChild(new Xe({background:this.options?.cdnForumTweaks?"checkered-transparent":"checkered",colorScheme:this.options?.colorScheme==="dark"?"dark":"light",...e,viewerLink:i?"experimental-twizzle-explorer":"auto"})),this.twistyPlayer.fullscreenElement=this.contentWrapper,e.experimentalTitle&&(this.twistyPlayer.experimentalTitle=e.experimentalTitle),this.#n=this.#r.appendChild(document.createElement("div")),this.#n.classList.add("scrollable-region"),e.experimentalTitle&&this.#i(e.experimentalTitle).classList.add("title"),e.experimentalSetupAlg){this.#i("Setup",async()=>(await this.twistyPlayer?.experimentalModel.setupAlg.get())?.alg.toString()??null);const l=this.#n.appendChild(document.createElement("div"));l.classList.add("setup-alg"),l.textContent=new p(e.experimentalSetupAlg).toString()}const s=this.#i("Moves",async()=>(await this.twistyPlayer?.experimentalModel.alg.get())?.alg.toString()??null);this.#s=s.appendChild(dc(this.twistyPlayer.experimentalModel)),this.#s.classList.add("move-count"),this.#n.appendChild(new ii({twistyPlayer:this.twistyPlayer})).part.add("twisty-alg-viewer")}else this.#e()}#i(e,t){const n=this.#n.appendChild(document.createElement("div"));n.classList.add("heading");const r=n.appendChild(document.createElement("span"));if(r.textContent=e,t){r.textContent+=" ";const i=r.appendChild(document.createElement("a"));i.textContent="📋",i.href="#",i.title="Copy to clipboard";async function s(a){i.textContent=a,await new Promise(l=>setTimeout(l,2e3)),i.textContent===a&&(i.textContent="📋")}i.addEventListener("click",async a=>{a.preventDefault(),i.textContent="📋…";const l=await t();if(l)try{await navigator.clipboard.writeText(l),s("📋✅")}catch(u){throw s("📋❌"),u}else s("📋❌")})}return n}};P.define("twizzle-link",uc);function dc(e,t=document.createElement("span")){async function n(){const[r,i]=await Promise.all([e.puzzleAlg.get(),e.puzzleLoader.get()]);if(r.issues.errors.length!==0){t.textContent="";return}let s=!0;function a(l){s?s=!1:t.append(")(");const u=t.appendChild(document.createElement("span")),c=eo(i,l,r.alg);u.append(`${cc[l]}: `);const d=u.appendChild(document.createElement("span"));d.textContent=c.toString(),d.classList.add("move-number"),u.setAttribute("data-before",Bn[l]??""),u.setAttribute("title",Bn[l]??"")}t.textContent="(",i.id==="3x3x3"?(a("OBTM"),a("OBQTM"),a("RBTM")):i.pg&&(a("RBTM"),a("RBQTM")),a("ETM"),t.append(")")}return e.puzzleAlg.addFreshListener(n),e.puzzleID.addFreshListener(n),t}var mc=`
:host {
  width: 384px;
  height: 256px;
  display: grid;
}

.wrapper {
  width: 100%;
  height: 100%;
  display: grid;
  grid-template-columns: 1fr;
  grid-template-rows: 1fr;
  place-content: center;
  overflow: hidden;
}

.wrapper > * {
  width: inherit;
  height: inherit;
  overflow: hidden;
}

twisty-player {
  width: 100%;
  height: 100%;
}
`,hc="333",pc=hc,fc=class extends HTMLElement{#e;#t=document.createElement("div");#n={eventID:null,scramble:new p,visualization:null,checkered:!1};#r=new Xe({controlPanel:"none",hintFacelets:"none",visualization:"2D",background:"none"});get player(){return this.#r}constructor(){super(),this.#e=this.attachShadow({mode:"closed"}),this.#t.classList.add("wrapper"),this.#e.appendChild(this.#t);const e=document.createElement("style");e.textContent=mc,this.#e.appendChild(e)}connectedCallback(){this.#t.appendChild(this.#r)}set event(e){const t=Os(e??pc);this.#r.puzzle=t?.puzzleID??"3x3x3",this.#n.eventID=e}get event(){return this.#n.eventID}set scramble(e){const t=new p(e??"");this.#r.alg=t,this.#n.scramble=t,this.#t.setAttribute("title",t.toString())}get scramble(){return this.#n.scramble}set visualization(e){this.#r.visualization=e??"2D",this.#n.visualization=e}get visualization(){return this.#n.visualization}set checkered(e){const t=!!e;this.#r.background=t?"checkered":"none",this.#n.checkered=t}get checkered(){return this.#n.checkered}attributeChangedCallback(e,t,n){switch(e){case"event":{this.event=n;break}case"scramble":{this.scramble=n;break}case"visualization":{this.visualization=n;break}case"checkered":{this.checkered=n!==null;break}}}static get observedAttributes(){return["event","scramble","visualization","checkered"]}};customElements.define("scramble-display",fc);const w={timerPhase:0,interval:0,wcaInterval:0,wcaDelayCount:!1,inspecting:!1,inspection:0};function ai(){w.timerPhase!==1?w.timerPhase++:w.timerPhase===1&&(fe("color","red"),w.wcaInterval=setInterval(()=>{fe("color","limeGreen"),w.wcaDelayCount++},300))}function oi(){w.wcaDelayCount>=1?(w.timerPhase++,w.wcaDelayCount=0,clearInterval(w.wcaInterval)):(fe("color","#eaeaf0"),w.wcaDelayCount=0,clearInterval(w.wcaInterval))}function li(){w.inspection=0,w.inspecting=!0,fe("time",`${w.inspection}`),w.interval=setInterval(()=>{w.inspection++,w.inspection===8&&new Audio("./8seconds.mp3").play(),w.inspection===12&&new Audio("./12seconds.mp3").play(),w.inspection===17&&clearInterval(w.interval),fe("time",w.inspection)},1e3)}function Lt(e){return(Math.floor(e*100)/100).toFixed(2)}function gc(e){let t=e/1e3,n=Math.floor(t/60),r=Math.floor(n/60);if(n<1)return Lt(t);if(n>=1)return t=t-60*n,`${n}: ${t<10?"0":""}${Lt(t)}`;if(n>=60)return n=n-60*r,`${r}: ${n<10?"0":""}${n}: ${t<10?"0":""}${Lt(t)}`}function ci(){fe("color","#eaeaf0"),clearInterval(w.interval),w.inspecting=!1;const e=performance.now();w.interval=setInterval(()=>{fe("time",gc(performance.now()-e))},10)}function ui(){clearInterval(w.interval),document.getElementById("timer").innerHTML,w.timerPhase=0}const g={mode:"ao5",solveCounter:0,solvesArray:[]};function di(e){if(typeof e=="number")return e;if(e.includes(":")){const[t,n]=e.split(":");return parseInt(t,10)*60+parseFloat(n)}return parseFloat(e)}function vc(e){const t=Number(e);return Number.isFinite(t)?t.toFixed(2):"-"}function On(e){if(e>=60){const t=Math.floor(e/60),n=(e%60).toFixed(2).padStart(5,"0");return`${t}:${n}`}return e.toFixed(2)}function $e(e){return e.penalty==="DNF"?"DNF":e.penalty==="+2"?On(e.time+2)+" (+2)":On(e.time)}function A(e){if(e==="DNF"||(e=Number(e),!Number.isFinite(e)))return"DNF";if(e>=60){const t=Math.floor(e/60),n=(e%60).toFixed(2).padStart(5,"0");return`${t}:${n}`}return vc(e)}function Yt(e,t){const n=e.map(c=>c.penalty==="DNF"?1/0:c.penalty==="+2"?c.time+2:c.time);let r=null,i=null;if(t==="ao5"){if(n.filter(I=>I===1/0).length>=2)return{dnf:!0};const d=[...n].sort((I,k)=>I-k);r=d[0],i=d[d.length-1];const m=d.slice(1,4);let h=null;m.includes(1/0)?h="DNF":h=m.reduce((I,k)=>I+k,0)/m.length;const v=n.filter(I=>I!==1/0),f=v.reduce((I,k)=>I+k,0)/v.length,b=v.reduce((I,k)=>I+Math.pow(k-f,2),0)/v.length,z=Math.sqrt(b);if(d.length===4){const I=(d[0]+d[1]+d[2])/3,k=(d[3]+d[2]+d[1])/3;return{dnf:!1,avg:h,best:r,worst:i,sigma:z,bpAo5:I,wpA05:k}}return{dnf:!1,avg:h,best:r,worst:i,sigma:z}}if(n.filter(c=>c===1/0).length>=1)return{dnf:!0};const a=n.reduce((c,d)=>c+d,0)/n.length,l=n.reduce((c,d)=>c+Math.pow(d-a,2),0)/n.length,u=Math.sqrt(l);return r=Math.min(...n),i=Math.max(...n),{dnf:!1,avg:a,best:r,worst:i,sigma:u}}function mi(e,t,n){let r=null;n===16?r="+2":n===17&&(r="DNF");const i=di(e);g.solvesArray.push({time:i,penalty:r||null,scramble:t,inspection:n,createdAt:Date.now()}),g.solveCounter++;const s=g.mode==="ao5"?5:3;if(g.solveCounter===s){const a=Yt(g.solvesArray,g.mode),l={mode:g.mode,average:a.avg==="DNF"?"DNF":A(a.avg),worst:A(a.worst),best:A(a.best),sigma:A(a.sigma),solves:structuredClone(g.solvesArray)};return g.solvesArray=[],g.solveCounter=0,l}return null}const M={sessions:JSON.parse(localStorage.getItem("sessions"))||{Default:{averages:[]}},currentSession:localStorage.getItem("currentSession")||"Default",selectEl:document.getElementById("sessionSelect")},wc=U();g.mode=wc.mode||"ao5";document.getElementById("modeBtn").textContent="Mode: "+g.mode;function Q(){localStorage.setItem("sessions",JSON.stringify(M.sessions)),localStorage.setItem("currentSession",M.currentSession)}function U(){return M.sessions[M.currentSession]||(M.sessions[M.currentSession]={averages:[]}),M.sessions[M.currentSession]}function Le(){const e=M.selectEl;e.innerHTML="",Object.keys(M.sessions).forEach(n=>{const r=document.createElement("option");r.value=n,r.textContent=n,n===M.currentSession&&(r.selected=!0),e.appendChild(r)});const t=document.createElement("option");t.disabled=!0,t.textContent="────────────",e.appendChild(t),e.appendChild(new Option("➕ New session...","__new__")),e.appendChild(new Option("✏ Rename current...","__rename__")),e.appendChild(new Option("🗑 Delete current...","__delete__"))}function it(e){M.currentSession=e,Q(),Le(),document.dispatchEvent(new CustomEvent("sessionChanged"))}M.selectEl.onchange=()=>{const e=M.selectEl.value;if(e==="__new__"){const t=prompt("New session name:");if(!t||M.sessions[t]){Le();return}M.sessions[t]={averages:[]},it(t);return}if(e==="__rename__"){const t=M.currentSession,n=prompt("Rename session:",t);if(!n||n===t||M.sessions[n]){Le();return}M.sessions[n]=M.sessions[t],delete M.sessions[t],it(n);return}if(e==="__delete__"){if(Object.keys(M.sessions).length===1){alert("You must have at least one session."),Le();return}if(!confirm("Delete current session?")){Le();return}delete M.sessions[M.currentSession];const t=Object.keys(M.sessions)[0];it(t);return}it(e)};Le();function yc(){const e=U();g.mode=g.mode==="ao5"?"mo3":"ao5",e.mode=g.mode,Q(),document.getElementById("modeBtn").textContent="Mode: "+g.mode,g.solvesArray=[],g.scramblesArray=[],g.solveCounter=0}function xc(){confirm("Delete all averages in this session?")&&(Lc(),g.solvesArray=[],g.scramblesArray=[],g.solveCounter=0)}function Sc(){const e=U();g.mode=e.mode||"ao5",document.getElementById("modeBtn").textContent="Mode: "+g.mode,g.solvesArray=[],g.scramblesArray=[],g.solveCounter=0}const ne=document.getElementById("detailsModal"),Dc=document.getElementById("modalBody"),bc=document.getElementById("closeModalBtn");bc.onclick=()=>ne.classList.add("hidden");ne.onclick=e=>{e.target===ne&&ne.classList.add("hidden")};function Xt(){const e=Ze();let t='<h3 class="modal-title">Session averages</h3>';e.forEach((n,r)=>{t+=`
            <div class="modal-average-card">
                <div class="modal-average-header">
                    <b>${n.mode} #${e.length-r}: ${n.average}</b>
                </div>

                <div class="modal-solves">
        `,n.solves.forEach((i,s)=>{t+=`
                <div class="modal-solve-row">
                    <div class="modal-solve-main">
                        <span>#${s+1}: ${$e(i)}</span>

                        <div class="modal-solve-actions">
                            <button onclick="setPenalty(${r}, ${s}, null)">OK</button>
                            <button onclick="setPenalty(${r}, ${s}, '+2')">+2</button>
                            <button onclick="setPenalty(${r}, ${s}, 'DNF')">DNF</button>
                            <button onclick="removeSolve(${r}, ${s})">✖</button>
                        </div>
                    </div>

                    <div class="modal-scramble">
                        ${n.solves[s].scramble}
                    </div>
                </div>
            `}),t+=`
                </div>
            </div>
        `}),Dc.innerHTML=t,ne.classList.remove("hidden")}function Mc(){const e=U();e.averages||(e.averages=[])}function hi(e){Mc(),U().averages.unshift(e),Q()}function Lc(){const e=U();e.averages=[],Q()}function Ze(){return U().averages||[]}function pi(){if(g.solvesArray.length>0)return{type:"current",solveIndex:g.solvesArray.length-1};const e=Ze();if(e.length===0)return null;const t=0,n=e[0];return!n||n.solves.length===0?null:{type:"saved",blockIndex:t,solveIndex:n.solves.length-1}}function Ic(e,t,n){const i=Ze()[e];i.solves[t].penalty=n;const s=Yt(i.solves,i.mode).avg;i.average=s==="DNF"?"DNF":A(s),Q()}function zc(e,t){const n=Ze();if(e===-1){if(t<0||t>=g.solvesArray.length)return;g.solvesArray.splice(t,1),g.solveCounter--,g.solveCounter<0&&(g.solveCounter=0);return}const r=n[e];if(e===0&&g.solvesArray.length===0){const s=r.solves.filter((a,l)=>l!==t);g.solvesArray=structuredClone(s),g.solveCounter=s.length,n.splice(e,1),ne.classList.add("hidden"),Q();return}if(confirm(`This solve belongs to a finished average.

OK = Replace this solve (reopen average)
Cancel = Delete the whole average`)){const s=r.solves.filter((a,l)=>l!==t);g.solvesArray=structuredClone(s),g.solveCounter=s.length,n.splice(e,1),ne.classList.add("hidden"),Q();return}confirm("Delete the entire average? This cannot be undone.")&&(n.splice(e,1),Q())}function Zt(e){const t=pi();t&&(t.type==="current"?g.solvesArray[t.solveIndex].penalty=e:window.setPenalty(t.blockIndex,t.solveIndex,e))}function Ec(){const e=pi();e&&(e.type==="current"?window.removeSolve(-1,e.solveIndex,!0):window.removeSolve(e.blockIndex,e.solveIndex,!0))}const Tc=-180,ht=Tc*60*1e3;function Ac(e=Date.now()){const t=new Date(e+ht);return t.setUTCHours(0,0,0,0),t.getTime()-ht}function kc(e=Date.now()){const t=new Date(e+ht);return t.setUTCHours(23,59,59,999),t.getTime()-ht}function fi(e){const t=[];return e.averages.forEach(n=>{n.solves.forEach(r=>{t.push(r)})}),g.solvesArray.forEach(n=>t.push(n)),t}function gi(e,t){let n=[],r=[],i=0;if(t.averages.forEach(d=>{d.average!=="DNF"&&r.push(di(d.average))}),e.forEach(d=>{console.log(new Date(d.createdAt)),d.penalty===null?(n.push(d.time),i++):(d.penalty==="+2"&&n.push(d.time+2),i++)}),n.length===0)return{bestTime:0,mean:0,sigma:0,bestAvg:0,solveCounter:i};const s=r.length?Math.min(...r):0,a=Math.min(...n),l=n.reduce((d,m)=>d+m,0)/n.length,u=n.reduce((d,m)=>d+Math.pow(m-l,2),0)/n.length,c=Math.sqrt(u);return{bestTime:a,mean:l,sigma:c,bestAvg:s,solveCounter:i}}function Cc(e,t){const n=Date.now();let r,i;return r=Ac(n),i=kc(n),e.filter(s=>s.createdAt>=r&&s.createdAt<=i)}function vi(){const e=U(),t=fi(e);return gi(t,e)}function Rc(e){const t=U(),n=fi(t),r=Cc(n);return gi(r,t)}function Nc(){const e=vi();document.getElementById("stat-solves").textContent=e.solveCounter,document.getElementById("stat-best-time").textContent=A(e.bestTime),document.getElementById("stat-mean").textContent=A(e.mean),document.getElementById("stat-sigma").textContent=A(e.sigma),document.getElementById("stat-best-avg").textContent=A(e.bestAvg);const t=U(),n=document.getElementById("avg-table-head"),r=document.getElementById("avg-history-body");n.innerHTML="",r.innerHTML="";let i=0;t.averages.forEach(a=>{a.solves.length>i&&(i=a.solves.length)});let s="<tr><th>#</th><th>Type</th><th>Avg</th>";for(let a=0;a<i;a++)s+=`<th>${a+1}</th>`;s+=`
    <th>Best</th>
    <th>Worst</th>
    <th>σ</th>
  </tr>`,n.innerHTML=s,t.averages.forEach((a,l)=>{const u=document.createElement("tr");let c=`
      <td>${t.averages.length-l}</td>
      <td>${a.mode.toUpperCase()}</td>
      <td><strong>${a.average}</strong></td>
    `;a.solves.forEach(m=>{c+=`<td>${$e(m)}</td>`});const d=i-a.solves.length;for(let m=0;m<d;m++)c+="<td></td>";c+=`
      <td>${a.best}</td>
      <td>${a.worst}</td>
      <td>${a.sigma}</td>
    `,u.innerHTML=c,r.appendChild(u)})}function Pc(e,t){let n="";return e==="live"&&(n+=`
            <div class="history-average current-average">
                <div class="history-solves">
        `,g.solvesArray.forEach((r,i)=>{n+=`
                <div class="history-solve">
                    ${i+1} - ${$e(r)}
                </div>
            `}),n+=`
                </div>
            </div>
        `),e==="saved"&&t&&(n+=`
            <div class="history-average current-average">
                <div class="history-solves">
        `,t.solves.forEach((r,i)=>{n+=`
                <div class="history-solve">
                    ${i+1} - ${$e(r)}
                </div>
            `}),n+=`
                </div>
            </div>
        `),n}function Fc(e,t){let n="";for(let r=0;r<e.length;r++){const i=e[r];t==="saved"&&r===0||(n+=`
            <div class="history-block history-average">
                <div class="history-solves">
        `,i.solves.forEach((s,a)=>{n+=`
                <div class="history-solve">
                    ${a+1} - ${$e(s)}
                </div>
            `}),n+=`
                </div>
                <div class="history-title">
                    ${i.mode}: ${i.average}
                </div>
            </div>
        `)}return n}function Un(e){return`
        Best single: ${e.bestTime!==1/0?A(e.bestTime):"-"}
        <br>
        Best ao5: ${e.bestAvg!==1/0?A(e.bestAvg):"-"}
        <br>
        Session Mean: ${e.mean?A(e.mean):"-"}
        <br>
        Session &sigma;: ${e.sigma?A(e.sigma):"-"}
        <br>
        Solves: ${e.solveCounter?e.solveCounter:"-"}
    `}function Bc({type:e,solves:t,mode:n,block:r}){if(e==="live"){if(!t||t.length===0)return"";const i=Yt(t,n),s=i.best,a=i.worst,l=i.sigma,u=i.bpAo5,c=i.wpA05;return t.length===4&&n==="ao5"?`                
                Best: ${A(s)}
                <br>
                Worst: ${A(a)}
                <br>
                &sigma;: ${A(l)}
                <hr>
                bpAo5: ${A(u)}
                <br>
                wpAo5: ${A(c)}
            `:`                
            Best: ${A(s)}
            <br>
            Worst: ${A(a)}
            <br>
            &sigma;: ${A(l)}
        `}return e==="saved"&&r?`                
            Best: ${r.best}
            <br>
            Worst: ${r.worst}
            <br>
            &sigma;: ${r.sigma}
            <hr>
            ${r.mode}: ${r.average}
        `:""}function Y(){const e=Ze(),t=vi(),n=Rc(),r=document.getElementById("currentAverageValue"),i=document.getElementById("historyPanel"),s=document.getElementById("current-stats"),a=document.getElementById("stats"),l=document.getElementById("today-stats");let u=null,c=null;g.solvesArray.length>0?u="live":e.length>0&&(u="saved",c=e[0]),r&&(r.innerHTML=Pc(u,c)),s&&(s.innerHTML=Bc({type:u,solves:g.solvesArray,mode:g.mode,block:c})),i&&(i.innerHTML=Fc(e,u)),a&&(a.innerHTML=Un(t),l.innerHTML=Un(n))}const pt=document.getElementById("eventSelect");let _=U().scrambleType||"333";const Oc=U();_=Oc.scrambleType||"333";pt.value=_;Jt(_);Qe(_);pt.addEventListener("change",()=>{const e=U();_=pt.value,e.scrambleType=_,Q(),Jt(_),Qe(_)});document.addEventListener("sessionChanged",()=>{_=U().scrambleType||"333",pt.value=_,Jt(_),Qe(_)});function fe(e,t){e==="color"?document.getElementById("timer").style.color=t:e==="time"&&(document.getElementById("timer").textContent=t)}function wi(){const e=document.getElementById("timer"),t=document.getElementById("touchOverlay");if(!e||!t)return;function n(r){r===e||r===t||(r.contains(e)?[...r.children].forEach(n):r.classList.add("focus-hidden"))}n(document.body)}function yi(){document.querySelectorAll(".focus-hidden").forEach(e=>{e.classList.remove("focus-hidden")})}document.getElementById("touchOverlay").addEventListener("touchstart",e=>{if(e.preventDefault(),!e.repeat&&(ai(),w.timerPhase===1&&!w.inspecting&&li(),w.timerPhase===3)){ui();const t=mi(document.getElementById("timer").innerHTML,Qt,w.inspection);t&&(hi(t),console.log(t)),Y(),Qe(_),yi()}});document.getElementById("touchOverlay").addEventListener("touchend",e=>{e.preventDefault(),!e.repeat&&(w.timerPhase===1&&oi(),w.timerPhase===2&&(ci(),wi()))});document.addEventListener("keydown",e=>{if(e.key===" "){if(e.preventDefault(),e.repeat)return;ai()}if(e.key===" "&&w.timerPhase===1&&!w.inspecting&&li(),e.key===" "&&w.timerPhase===3){ui();const t=mi(document.getElementById("timer").innerHTML,Qt,w.inspection);t&&(hi(t),console.log(t)),Y(),Qe(_),yi()}});document.addEventListener("keyup",e=>{e.preventDefault(),!e.repeat&&(e.key===" "&&w.timerPhase===1&&oi(),e.key===" "&&w.timerPhase===2&&(ci(),wi()))});const xi=document.getElementById("stats-page"),Uc=document.getElementById("open-stats-btn"),_c=document.getElementById("close-stats-btn");Uc.addEventListener("click",()=>{Nc(),xi.classList.add("open")});_c.addEventListener("click",()=>{xi.classList.remove("open")});function Jt(e){const t=U(),r=Vc(e)?"mo3":"ao5";g.mode!==r&&(g.mode=r,t.mode=r,document.getElementById("modeBtn").textContent="Mode: "+r,g.solvesArray=[],g.solveCounter=0,Q())}function Vc(e){return["333bf","444bf","555bf","666","777"].includes(e)}async function jc(){const e=["333","444","555","222","666"];for(const t of e)await Mr(t)}jc();document.getElementById("modeBtn").addEventListener("click",()=>{yc(),Y()});const Te={modeBtn:document.getElementById("modeBtn"),clearBtn:document.getElementById("clearBtn"),openSessionBtn:document.getElementById("modal-button"),penaltyOkBtn:document.getElementById("penaltyOkBtn"),penaltyPlus2Btn:document.getElementById("penaltyPlus2Btn"),penaltyDnfBtn:document.getElementById("penaltyDnfBtn"),removeLastBtn:document.getElementById("removeLastBtn")};document.querySelectorAll("button").forEach(e=>{e.addEventListener("click",()=>{e.blur()})});document.querySelectorAll("select").forEach(e=>{e.addEventListener("change",()=>{e.blur()})});window.setPenalty=function(e,t,n){Ic(e,t,n),Q(),Y(),ne.classList.contains("hidden")||Xt()};window.removeSolve=function(e,t){zc(e,t),Q(),Y(),ne.classList.contains("hidden")||Xt()};document.addEventListener("sessionChanged",()=>{Sc(),Y()});Te.clearBtn.onclick=()=>{xc(),Y()};Te.openSessionBtn.onclick=Xt;Te.penaltyOkBtn.onclick=()=>{Zt(null),Y()};Te.penaltyPlus2Btn.onclick=()=>{Zt("+2"),Y()};Te.penaltyDnfBtn.onclick=()=>{Zt("DNF"),Y()};Te.removeLastBtn.onclick=()=>Ec();Y();export{p as A,B as G,re as K,o as M,te as Q,Ta as T,za as a,J as b,qt as c,Oe as d,Mi as e,jt as f,Gc as g,Hc as h,ya as i,pr as j,xa as k,ua as l,ca as m,lt as n,Kc as o,$t as p,$c as q,Qc as r,qc as s,la as t};
