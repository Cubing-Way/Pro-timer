(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();const mi="modulepreload",hi=function(e){return"/Pro-timer/"+e},Xt={},y=function(t,n,r){let i=Promise.resolve();if(n&&n.length>0){let u=function(c){return Promise.all(c.map(d=>Promise.resolve(d).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=a?.nonce||a?.getAttribute("nonce");i=u(n.map(c=>{if(c=hi(c),c in Xt)return;Xt[c]=!0;const d=c.endsWith(".css"),m=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${m}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":mi,d||(h.as="script"),h.crossOrigin="",h.href=c,l&&h.setAttribute("nonce",l),document.head.appendChild(h),d)return new Promise((v,p)=>{h.addEventListener("load",v),h.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return i.then(a=>{for(const l of a||[])l.status==="rejected"&&s(l.reason);return t().catch(s)})};let Je=null;async function pi(){if(Je)return Je;try{return Je=await y(()=>import("https://cdn.cubing.net/js/cubing/scramble"),[]),await y(()=>import("https://cdn.cubing.net/js/cubing/twisty"),[]),Je}catch(e){return console.error("Cubing failed to load:",e),null}}let Ft="";async function Pn(e="333"){const t=await pi();if(!t)return"Scramble unavailable on this device";let r=(await t.randomScrambleForEvent(e)).toString();return(e==="minx"||e==="megaminx")&&(r=fi(r)),r}function fi(e){const t=e.split(" ");let n=[],r=[];for(const i of t)r.push(i),(i==="U"||i==="U'")&&(n.push(r.join(" ")),r=[]);return r.length&&n.push(r.join(" ")),n.join(`
`)}async function Qe(e,t){const n=await Pn(e);n&&(e==="333"||e==="222"||e==="333bf"||e==="333mbf"||e==="333oh"||e==="333fm"||e==="pyram"?(document.getElementById("scrambleVis").style.width="180px",document.getElementById("scrambleVis").style.height="180px",document.getElementById("scrambleVis").style.right="20px",document.getElementById("scrambleVis").style.bottom="10px"):e==="skewb"||e==="444"||e==="444bf"||e==="skewb"?(document.getElementById("scrambleVis").style.width="230px",document.getElementById("scrambleVis").style.height="230px",document.getElementById("scrambleVis").style.right="0px",document.getElementById("scrambleVis").style.bottom="-20px"):e==="sq1"?(document.getElementById("scrambleVis").style.width="230px",document.getElementById("scrambleVis").style.height="230px",document.getElementById("scrambleVis").style.right="-20px",document.getElementById("scrambleVis").style.bottom="20px"):e==="555"||e==="666"||e==="555bf"||e==="777"?(document.getElementById("scrambleVis").style.width="250px",document.getElementById("scrambleVis").style.height="250px",document.getElementById("scrambleVis").style.right="0px",document.getElementById("scrambleVis").style.bottom="-20px"):e==="minx"?(document.getElementById("scrambleVis").style.width="250px",document.getElementById("scrambleVis").style.height="250px",document.getElementById("scrambleVis").style.right="20px",document.getElementById("scrambleVis").style.bottom="-40px"):e==="clock"&&(document.getElementById("scrambleVis").style.width="300px",document.getElementById("scrambleVis").style.height="300px",document.getElementById("scrambleVis").style.right="0px",document.getElementById("scrambleVis").style.bottom="-50px")),Ft=n;const r=document.getElementById("scrambleContainer"),i=document.getElementById("scrambleDisplay");let s=n;(e==="minx"||e==="megaminx")&&(s=gi(n)),i.textContent=s,t.scramble=n,t.event=`${e}`;let a=40;for(i.style.fontSize=a+"px",i.style.whiteSpace="pre-wrap",i.style.wordBreak="break-word",i.offsetHeight;i.scrollHeight>r.clientHeight;)a-=1,i.style.fontSize=a+"px"}function gi(e){const t=e.split(" ");let n=[],r=[];for(const i of t)r.push(i),(i==="U"||i==="U'")&&(n.push(r.join(" ")),r=[]);return r.length&&n.push(r.join(" ")),n.join(`
`)}var Rn=class{is(e){return this instanceof e}as(e){return this instanceof e?this:null}},oe=class extends Rn{constructor(){super()}get log(){return console.log.bind(console,this,this.toString())}};function vi(e,t=!0){if(!t)return e;switch(e){case 1:return-1;case-1:return 1}}function On(e,t){return t===-1?Array.from(e).reverse():e}function wi(e){return Array.from(e).reverse()}function*yi(e,t){t===-1?yield*xi(e):yield*e}function*xi(e){for(const t of Array.from(e).reverse())yield t}var q=class Mt extends oe{#e;#t;constructor(t,n){super(),this.#e=Fe(t),this.#t=Fe(n)}get A(){return this.#e}get B(){return this.#t}isIdentical(t){const n=t.as(Mt);return!!(n?.A.isIdentical(this.A)&&n?.B.isIdentical(this.B))}invert(){return new Mt(this.#t,this.#e)}*experimentalExpand(t=1,n){n??=1/0,n===0?yield t===1?this:this.invert():t===1?(yield*this.A.experimentalExpand(1,n-1),yield*this.B.experimentalExpand(1,n-1),yield*this.A.experimentalExpand(-1,n-1),yield*this.B.experimentalExpand(-1,n-1)):(yield*this.B.experimentalExpand(1,n-1),yield*this.A.experimentalExpand(1,n-1),yield*this.B.experimentalExpand(-1,n-1),yield*this.A.experimentalExpand(-1,n-1))}toString(t){return`[${this.#e.toString(t)}, ${this.#t.toString(t)}]`}},O=class It extends oe{#e;#t;constructor(t,n){super(),this.#e=Fe(t),this.#t=Fe(n)}get A(){return this.#e}get B(){return this.#t}isIdentical(t){const n=t.as(It);return!!(n?.A.isIdentical(this.A)&&n?.B.isIdentical(this.B))}invert(){return new It(this.#e,this.#t.invert())}*experimentalExpand(t,n){n??=1/0,n===0?yield t===1?this:this.invert():(yield*this.A.experimentalExpand(1,n-1),yield*this.B.experimentalExpand(t,n-1),yield*this.A.experimentalExpand(-1,n-1))}toString(t){return`[${this.A.toString(t)}: ${this.B.toString(t)}]`}},zt=2147483647,Dt="2^31 - 1",Si=-2147483648,Tt=class{#e=[];push(e){this.#e.push(e)}experimentalPushAlg(e){for(const t of e.childAlgNodes())this.push(t)}experimentalNumAlgNodes(){return this.#e.length}toAlg(){return new f(this.#e)}reset(){this.#e=[]}},Ae=class Bn extends oe{#e;constructor(t){if(super(),t.includes(`
`)||t.includes("\r"))throw new Error("LineComment cannot contain newline");this.#e=t}get text(){return this.#e}isIdentical(t){const n=t;return t.is(Bn)&&this.#e===n.#e}invert(){return this}*experimentalExpand(t=1,n=1/0){yield this}toString(t){return`//${this.#e}`}},se=class Fn extends oe{toString(t){return`
`}isIdentical(t){return t.is(Fn)}invert(){return this}*experimentalExpand(t=1,n=1/0){yield this}},F=class _n extends oe{experimentalNISSGrouping;toString(t){return"."}isIdentical(t){return t.is(_n)}invert(){return this}*experimentalExpand(t=1,n=1/0){yield this}};function et(e,t){return e?parseInt(e,10):t}var Zt=/^(\d+)?('?)/,bi=/^[_\dA-Za-z]/,Mi=/^((([1-9]\d*)-)?([1-9]\d*))?([_A-Za-z]+)/,Ii=/^[^\n]*/,zi=/^(-?\d+), ?/,Di=/^(-?\d+)\)/;function Vn(e){return new _t().parseAlg(e)}function Ti(e){return new _t().parseMove(e)}function Ai(e){return new _t().parseQuantumMove(e)}var G=Symbol("startCharIndex"),X=Symbol("endCharIndex");function C(e,t,n){const r=e;return r[G]=t,r[X]=n,r}function Ei(e,t){return G in e&&(t[G]=e[G]),X in e&&(t[X]=e[X]),t}var _t=class{#e="";#t=0;#n=[];parseAlg(e){this.#e=e,this.#t=0;const t=this.parseAlgWithStopping([]);this.mustBeAtEndOfInput();const n=Array.from(t.childAlgNodes());if(this.#n.length>0)for(const a of this.#n.reverse())n.push(a);const r=new f(n),{[G]:i,[X]:s}=t;return C(r,i,s),r}parseMove(e){this.#e=e,this.#t=0;const t=this.parseMoveImpl();return this.mustBeAtEndOfInput(),t}parseQuantumMove(e){this.#e=e,this.#t=0;const t=this.parseQuantumMoveImpl();return this.mustBeAtEndOfInput(),t}mustBeAtEndOfInput(){if(this.#t!==this.#e.length)throw new Error("parsing unexpectedly ended early")}parseAlgWithStopping(e){let t=this.#t,n=this.#t;const r=new Tt;let i=!1;const s=a=>{if(i)throw new Error(`Unexpected character at index ${a}. Are you missing a space?`)};for(;this.#t<this.#e.length;){const a=this.#t;if(e.includes(this.#e[this.#t]))return C(r.toAlg(),t,n);if(this.tryConsumeNext(" "))i=!1,r.experimentalNumAlgNodes()===0&&(t=this.#t);else if(bi.test(this.#e[this.#t])){s(a);const l=this.parseMoveImpl();r.push(l),i=!0,n=this.#t}else if(this.tryConsumeNext("(")){s(a);const l=this.tryRegex(zi);if(l){const u=l[1],c=this.#t,d=this.parseRegex(Di),m=C(new o(new te("U_SQ_"),parseInt(u,10)),a+1,a+1+u.length),h=C(new o(new te("D_SQ_"),parseInt(d[1],10)),c,this.#t-1),v=C(new f([m,h]),a+1,this.#t-1);r.push(C(new B(v),a,this.#t)),i=!0,n=this.#t}else{const u=this.parseAlgWithStopping([")"]);this.mustConsumeNext(")");const c=this.parseAmount();r.push(C(new B(u,c),a,this.#t)),i=!0,n=this.#t}}else if(this.tryConsumeNext("^")){this.mustConsumeNext("(");const l=this.parseAlgWithStopping([")"]);this.popNext();const u=new B(l,-1),c=new F;u.experimentalNISSPlaceholder=c,c.experimentalNISSGrouping=u,this.#n.push(u),r.push(c)}else if(this.tryConsumeNext("[")){s(a);const l=this.parseAlgWithStopping([",",":"]),u=this.popNext(),c=this.parseAlgWithStopping(["]"]);this.mustConsumeNext("]");let d;switch(u){case":":{d=C(new O(l,c),a,this.#t),i=!0,n=this.#t;break}case",":{d=C(new q(l,c),a,this.#t),i=!0,n=this.#t;break}default:throw new Error("unexpected parsing error")}const m=this.#t,h=this.parseAmount();if(h===1)r.push(d);else{const v=C(new f([d]),a,m),p=C(new B(v,h),a,this.#t);r.push(p)}i=!0,n=this.#t}else if(this.tryConsumeNext(`
`))r.push(C(new se,a,this.#t)),i=!1,n=this.#t;else if(this.tryConsumeNext("/"))if(this.tryConsumeNext("/")){s(a);const[l]=this.parseRegex(Ii);r.push(C(new Ae(l),a,this.#t)),i=!1,n=this.#t}else r.push(C(new o("_SLASH_"),a,this.#t)),i=!0,n=this.#t;else if(this.tryConsumeNext("."))s(a),r.push(C(new F,a,this.#t)),i=!0,n=this.#t;else throw new Error(`Unexpected character: ${this.popNext()}`)}if(this.#t!==this.#e.length)throw new Error("did not finish parsing?");if(e.length>0)throw new Error("expected stopping");return C(r.toAlg(),t,n)}parseQuantumMoveImpl(){const[,,,e,t,n]=this.parseRegex(Mi);return new te(n,et(t,void 0),et(e,void 0))}parseMoveImpl(){const e=this.#t;if(this.tryConsumeNext("/"))return C(new o("_SLASH_"),e,this.#t);let t=this.parseQuantumMoveImpl(),[n,r]=this.parseAmountAndTrackEmptyAbsAmount();const i=this.parseMoveSuffix();if(i){if(n<0)throw new Error("uh-oh");if((i==="++"||i==="--")&&n!==1)throw new Error("Pochmann ++ or -- moves cannot have an amount other than 1.");if((i==="++"||i==="--")&&!r)throw new Error("Pochmann ++ or -- moves cannot have an amount written as a number.");if((i==="+"||i==="-")&&r)throw new Error("Clock dial moves must have an amount written as a natural number followed by + or -.");i.startsWith("+")&&(t=t.modified({family:`${t.family}_${i==="+"?"PLUS":"PLUSPLUS"}_`})),i.startsWith("-")&&(t=t.modified({family:`${t.family}_${i==="-"?"PLUS":"PLUSPLUS"}_`}),n*=-1)}return C(new o(t,n),e,this.#t)}parseMoveSuffix(){return this.tryConsumeNext("+")?this.tryConsumeNext("+")?"++":"+":this.tryConsumeNext("-")?this.tryConsumeNext("-")?"--":"-":null}parseAmountAndTrackEmptyAbsAmount(){const e=this.#t,[,t,n]=this.parseRegex(Zt);if(t?.startsWith("0")&&t!=="0")throw new Error(`Error at char index ${e}: An amount can only start with 0 if it's exactly the digit 0.`);return[et(t,1)*(n==="'"?-1:1),!t]}parseAmount(){const e=this.#t,[,t,n]=this.parseRegex(Zt);if(t?.startsWith("0")&&t!=="0")throw new Error(`Error at char index ${e}: An amount number can only start with 0 if it's exactly the digit 0.`);return et(t,1)*(n==="'"?-1:1)}parseRegex(e){const t=e.exec(this.remaining());if(t===null)throw new Error("internal parsing error");return this.#t+=t[0].length,t}tryRegex(e){const t=e.exec(this.remaining());return t===null?null:(this.#t+=t[0].length,t)}remaining(){return this.#e.slice(this.#t)}popNext(){const e=this.#e[this.#t];return this.#t++,e}tryConsumeNext(e){return this.#e[this.#t]===e?(this.#t++,!0):!1}mustConsumeNext(e){const t=this.popNext();if(t!==e)throw new Error(`expected \`${e}\` while parsing, encountered ${t}`);return t}},Jt=new Set;function Un(e){Jt.has(e)||(console.warn(e),Jt.add(e))}var At=class{quantum;amount;constructor(e,t=1){if(this.quantum=e,this.amount=t,!Number.isInteger(this.amount)||this.amount<Si||this.amount>zt)throw new Error(`AlgNode amount absolute value must be a non-negative integer below ${Dt}.`)}suffix(){let e="";const t=Math.abs(this.amount);return t!==1&&(e+=t),this.amount<0&&(e+="'"),e}isIdentical(e){return this.quantum.isIdentical(e.quantum)&&this.amount===e.amount}*experimentalExpand(e,t){const n=Math.abs(this.amount),r=vi(e,this.amount<0);for(let i=0;i<n;i++)yield*this.quantum.experimentalExpand(r,t)}},te=class Et extends Rn{#e;#t;#n;constructor(t,n,r){if(super(),this.#e=t,this.#t=n??null,this.#n=r??null,Object.freeze(this),this.#t!==null&&(!Number.isInteger(this.#t)||this.#t<1||this.#t>zt))throw new Error(`QuantumMove inner layer must be a positive integer below ${Dt}.`);if(this.#n!==null&&(!Number.isInteger(this.#n)||this.#n<1||this.#n>zt))throw new Error(`QuantumMove outer layer must be a positive integer below ${Dt}.`);if(this.#n!==null&&this.#t!==null&&this.#t<=this.#n)throw new Error("QuantumMove outer layer must be smaller than inner layer.");if(this.#n!==null&&this.#t===null)throw new Error("QuantumMove with an outer layer must have an inner layer")}static fromString(t){return Ai(t)}modified(t){return new Et(t.family??this.#e,t.innerLayer??this.#t,t.outerLayer??this.#n)}isIdentical(t){const n=t;return t.is(Et)&&this.#e===n.#e&&this.#t===n.#t&&this.#n===n.#n}get family(){return this.#e}get outerLayer(){return this.#n}get innerLayer(){return this.#t}experimentalExpand(){throw new Error("experimentalExpand() cannot be called on a `QuantumMove` directly.")}toString(t){let n=this.#e;return this.#t!==null&&(n=String(this.#t)+n,this.#n!==null&&(n=`${String(this.#n)}-${n}`)),n}},o=class Se extends oe{#e;constructor(...t){if(super(),typeof t[0]=="string")if(t[1]??null){this.#e=new At(te.fromString(t[0]),t[1]);return}else return Se.fromString(t[0]);this.#e=new At(t[0],t[1])}isIdentical(t){const n=t.as(Se);return!!n&&this.#e.isIdentical(n.#e)}invert(){return Ei(this,new Se(this.#e.quantum,this.#n()?this.amount:-this.amount))}*experimentalExpand(t=1){t===1?yield this:yield this.modified({amount:-this.amount})}get quantum(){return this.#e.quantum}modified(t){return new Se(this.#e.quantum.modified(t),t.amount??this.amount)}static fromString(t){return Ti(t)}get amount(){return this.#e.amount}get type(){return Un("deprecated: type"),"blockMove"}get family(){return this.#e.quantum.family??void 0}get outerLayer(){return this.#e.quantum.outerLayer??void 0}get innerLayer(){return this.#e.quantum.innerLayer??void 0}#t;#n(){return this.isIdentical(this.#t??=new Se("_SLASH_"))}toString(t){if(t?.notation!=="LGN"){if(this.#n())return"/";if(this.family.endsWith("_PLUS_"))return this.#e.quantum.toString().slice(0,-6)+Math.abs(this.amount)+(this.amount<0?"-":"+");if(this.family.endsWith("_PLUSPLUS_")){const n=Math.abs(this.amount);return this.#e.quantum.toString().slice(0,-10)+(n===1?"":n)+(this.amount<0?"--":"++")}}return this.#e.quantum.toString(t)+this.#e.suffix()}},Li=class{quantumU_SQ_=null;quantumD_SQ_=null;format(e,t){if(t?.notation==="LGN"||e.amount!==1)return null;const n=this.tuple(e);return n?`(${n.map(r=>r.amount).join(", ")})`:null}tuple(e){if(e.amount!==1)return null;this.quantumU_SQ_||=new te("U_SQ_"),this.quantumD_SQ_||=new te("D_SQ_");const t=e.alg;if(t.experimentalNumChildAlgNodes()===2){const[n,r]=t.childAlgNodes();if(n.as(o)?.quantum.isIdentical(this.quantumU_SQ_)&&r.as(o)?.quantum.isIdentical(this.quantumD_SQ_))return[n,r]}return null}},wt=new Li,B=class Pe extends oe{#e;experimentalNISSPlaceholder;constructor(t,n){super();const r=Fe(t);this.#e=new At(r,n)}isIdentical(t){const n=t;return t.is(Pe)&&this.#e.isIdentical(n.#e)}get alg(){return this.#e.quantum}get amount(){return this.#e.amount}modified(t){return new Pe(t.alg??this.alg,t.amount??this.amount)}get experimentalRepetitionSuffix(){return this.#e.suffix()}invert(){const t=wt.tuple(this);if(t){const[n,r]=t;return new Pe(new f([n.invert(),r.invert()]))}return new Pe(this.#e.quantum,-this.#e.amount)}*experimentalExpand(t=1,n){n??=1/0,n===0?yield t===1?this:this.invert():yield*this.#e.experimentalExpand(t,n-1)}static fromString(){throw new Error("unimplemented")}#t(t){const n=this.#e.quantum.toString(t),r=this.alg.childAlgNodes(),{value:i}=r.next();return r.next().done&&(i?.is(q)||i?.is(O))?n:`(${n})`}toString(t){return wt.format(this,t)??`${this.#t(t)}${this.#e.suffix()}`}experimentalAsSquare1Tuple(){return wt.tuple(this)}};function ee(e,t){return e instanceof t}function ki(e){return ee(e,B)||ee(e,Ae)||ee(e,q)||ee(e,O)||ee(e,o)||ee(e,se)||ee(e,F)}var Ci="any-direction",jn=class{constructor(e={}){this.config=e}cancelQuantum(){const{cancel:e}=this.config;return e===!0?Ci:e===!1?"none":e?.directional??"none"}cancelAny(){return this.config.cancel&&this.cancelQuantum()!=="none"}cancelPuzzleSpecificModWrap(){const{cancel:e}=this.config;return e===!0||e===!1?"canonical-centered":e?.puzzleSpecificModWrap?e?.puzzleSpecificModWrap:e?.directional==="same-direction"?"preserve-sign":"canonical-centered"}puzzleSpecificSimplifyOptions(){return this.config.puzzleLoader?.puzzleSpecificSimplifyOptions??this.config.puzzleSpecificSimplifyOptions}};function Ni(e,t){return e*Math.sign(t.amount)>=0}function qn(e,t,n=0){return((e-n)%t+t)%t+n}function Gn(e,t,n){const r=new jn(n),i=Array.from(e.childAlgNodes());let s=[t];function a(){return new f([...i,...s])}function l(u){if(r.cancelPuzzleSpecificModWrap()==="none")return u;const c=r.puzzleSpecificSimplifyOptions()?.quantumMoveOrder;if(!c)return u;const d=c(t.quantum);let m;switch(r.cancelPuzzleSpecificModWrap()){case"gravity":{m=-Math.floor((d-(u.amount<0?0:1))/2);break}case"canonical-centered":{m=-Math.floor((d-1)/2);break}case"canonical-positive":{m=0;break}case"preserve-sign":{m=u.amount<0?1-d:0;break}default:throw new Error("Unknown mod wrap")}const h=qn(u.amount,d,m);return u.modified({amount:h})}if(r.cancelAny()){let u;const c=r.puzzleSpecificSimplifyOptions()?.axis;if(c)u=p=>c.areQuantumMovesSameAxis(t.quantum,p.quantum);else{const p=t.quantum.toString();u=M=>M.quantum.toString()===p}const d=r.cancelQuantum()==="same-direction",m=new Map;m.set(t.quantum.toString(),Math.sign(t.amount));let h;for(h=i.length-1;h>=0;h--){const p=i[h].as(o);if(!p||!u(p))break;const M=p.quantum.toString();if(d){const T=m.get(M);if(T&&!Ni(T,p))break;m.set(M,Math.sign(p.amount))}}const v=[...i.splice(h+1),t];if(c)s=c.simplifySameAxisMoves(v,r.cancelPuzzleSpecificModWrap()!=="none");else{const p=v.reduce((M,T)=>M+T.amount,0);if(m.size!==1)throw new Error("Internal error: multiple quantums when one was expected");s=[new o(t.quantum,p)]}}return s=s.map(u=>l(u)).filter(u=>u.amount!==0),a()}function Pi(e,t,n){const r=t.as(o);return r?Gn(e,r,n):new f([...e.childAlgNodes(),t])}function Wn(e,t,n){if(t.is(B))return e.traverseGrouping(t,n);if(t.is(o))return e.traverseMove(t,n);if(t.is(q))return e.traverseCommutator(t,n);if(t.is(O))return e.traverseConjugate(t,n);if(t.is(F))return e.traversePause(t,n);if(t.is(se))return e.traverseNewline(t,n);if(t.is(Ae))return e.traverseLineComment(t,n);throw new Error("unknown AlgNode")}function $n(e){if(e.is(B)||e.is(o)||e.is(q)||e.is(O)||e.is(F)||e.is(se)||e.is(Ae))return e;throw new Error("internal error: expected AlgNode")}var ve=class{traverseAlgNode(e,t){return Wn(this,e,t)}traverseIntoAlgNode(e,t){return $n(this.traverseAlgNode(e,t))}},we=class extends ve{traverseAlgNode(e){return Wn(this,e,void 0)}traverseIntoAlgNode(e){return $n(this.traverseAlgNode(e))}};function U(e,t){const n=new e(...t??[]);return n.traverseAlg.bind(n)}var Ri=class extends ve{#e;#t(){return this.#e??=new Map}#n(e){return{...e,depth:e.depth?e.depth-1:null}}*traverseAlg(e,t){if(t.depth===0){yield*e.childAlgNodes();return}let n=[];const r=this.#n(t);for(const i of e.childAlgNodes())for(const s of this.traverseAlgNode(i,r))n=Array.from(Pi(new f(n),s,r).childAlgNodes());for(const i of n)yield i}*traverseGrouping(e,t){if(t.depth===0){yield e;return}if(e.amount===0)return;const n=new B(this.traverseAlg(e.alg,this.#n(t)),e.amount);if(n.alg.experimentalIsEmpty())return;const r=this.#t().get(e);r&&(n.experimentalNISSPlaceholder=r,r.experimentalNISSGrouping=n),yield n}*traverseMove(e,t){yield e}#r(e,t,n){if(e.experimentalNumChildAlgNodes()===1&&t.experimentalNumChildAlgNodes()===1){const r=Array.from(e.childAlgNodes())[0]?.as(o),i=Array.from(t.childAlgNodes())[0]?.as(o);if(!(r&&i))return!1;if(i.quantum.isIdentical(r.quantum)||new jn(n).puzzleSpecificSimplifyOptions()?.axis?.areQuantumMovesSameAxis(r.quantum,i.quantum))return!0}return!1}*traverseCommutator(e,t){if(t.depth===0){yield e;return}const n=this.#n(t),r=new q(this.traverseAlg(e.A,n),this.traverseAlg(e.B,n));r.A.experimentalIsEmpty()||r.B.experimentalIsEmpty()||r.A.isIdentical(r.B)||r.A.isIdentical(r.B.invert())||this.#r(r.A,r.B,t)||(yield r)}*traverseConjugate(e,t){if(t.depth===0){yield e;return}const n=this.#n(t),r=new O(this.traverseAlg(e.A,n),this.traverseAlg(e.B,n));if(!r.B.experimentalIsEmpty()){if(r.A.experimentalIsEmpty()||r.A.isIdentical(r.B)||r.A.isIdentical(r.B.invert())||this.#r(r.A,r.B,t)){yield*e.B.childAlgNodes();return}yield r}}*traversePause(e,t){if(e.experimentalNISSGrouping){const n=new F;this.#t().set(e.experimentalNISSGrouping,n),yield n}else yield e}*traverseNewline(e,t){yield e}*traverseLineComment(e,t){yield e}},Oi=U(Ri);function en(e){if(!e)return[];if(ee(e,f))return e.childAlgNodes();if(typeof e=="string")return Vn(e).childAlgNodes();const t=e;if(typeof t[Symbol.iterator]=="function")return t;throw new Error("Invalid AlgNode")}function Fe(e){return ee(e,f)?e:new f(e)}var f=class be extends oe{#e;constructor(t){super(),this.#e=Array.from(en(t));for(const n of this.#e)if(!ki(n))throw new Error("An alg can only contain alg nodes.")}isIdentical(t){const n=t;if(!t.is(be))return!1;const r=Array.from(this.#e),i=Array.from(n.#e);if(r.length!==i.length)return!1;for(let s=0;s<r.length;s++)if(!r[s].isIdentical(i[s]))return!1;return!0}invert(){return new be(wi(Array.from(this.#e).map(t=>t.invert())))}*experimentalExpand(t=1,n){n??=1/0;for(const r of On(this.#e,t))yield*r.experimentalExpand(t,n)}expand(t){return new be(this.experimentalExpand(1,t?.depth??1/0))}*experimentalLeafMoves(){for(const t of this.experimentalExpand())t.is(o)&&(yield t)}concat(t){return new be(Array.from(this.#e).concat(Array.from(en(t))))}experimentalIsEmpty(){for(const t of this.#e)return!1;return!0}static fromString(t){return Vn(t)}units(){return this.childAlgNodes()}*childAlgNodes(){for(const t of this.#e)yield t}experimentalNumUnits(){return this.experimentalNumChildAlgNodes()}experimentalNumChildAlgNodes(){return Array.from(this.#e).length}get type(){return Un("deprecated: type"),"sequence"}toString(t){let n="",r=null;for(const i of this.#e){r&&(n+=Bi(r,i));const s=i.as(F)?.experimentalNISSGrouping;if(s){if(s.amount!==-1)throw new Error("Invalid NISS Grouping amount!");n+=`^(${s.alg.toString(t)})`}else i.as(B)?.experimentalNISSPlaceholder||(n+=i.toString(t));r=i}return n}experimentalSimplify(t){return new be(Oi(this,t??{}))}simplify(t){return this.experimentalSimplify(t)}};function Bi(e,t){return e.is(se)||t.is(se)||t.as(B)?.experimentalNISSPlaceholder?"":e.is(Ae)&&!t.is(se)?`
`:" "}new f([new o("R",1),new o("U",1),new o("R",-1),new o("U",1),new o("R",1),new o("U",-2),new o("R",-1)]),new f([new o("R",1),new o("U",2),new o("R",-1),new o("U",-1),new o("R",1),new o("U",-1),new o("R",-1)]),new f([new q(new f([new o("R",1),new o("U",1),new o("R",-2)]),new f([new O(new f([new o("R",1)]),new f([new o("U",1)]))]))]),new f([new o("R",1),new o("U",-1),new o("L",-1),new o("U",1),new o("R",-1),new o("U",-1),new o("L",1),new o("U",1)]),new f([new o("x",-1),new q(new f([new O(new f([new o("R",1)]),new f([new o("U",-1)]))]),new f([new o("D",1)])),new q(new f([new O(new f([new o("R",1)]),new f([new o("U",1)]))]),new f([new o("D",1)])),new o("x",1)]),new f([new O(new f([new o("F",1)]),new f([new q(new f([new o("U",1)]),new f([new o("R",1)]))]))]),new f([new O(new f([new o("R",2)]),new f([new q(new f([new o("F",2)]),new f([new o("R",-1),new o("B",-1),new o("R",1)]))]))]),new f([new o("F",1),new o("U",1),new o("R",1),new o("U",-1),new o("R",-1),new o("F",-1)]),new f([new o("R",1),new o("U",1),new o("R",-1),new o("U",-1),new o("R",-1),new o("F",1),new o("R",2),new o("U",-1),new o("R",-1),new o("U",-1),new o("R",1),new o("U",1),new o("R",-1),new o("F",-1)]),new f([new O(new f([new o("F",1)]),new f([new B(new f([new q(new f([new o("R",1)]),new f([new o("U",1)]))]),3)]))]),new f([new F,new F,new F]);function Lt(e,t,n){const r={};for(const i of e.orbits){const s=t[i.orbitName],a=n[i.orbitName];if(ct(i.numOrientations,a))r[i.orbitName]=s;else if(ct(i.numOrientations,s))r[i.orbitName]=a;else{const l=new Array(i.numPieces);if(i.numOrientations===1){for(let u=0;u<i.numPieces;u++)l[u]=s.permutation[a.permutation[u]];r[i.orbitName]={permutation:l,orientationDelta:s.orientationDelta}}else{const u=new Array(i.numPieces);for(let c=0;c<i.numPieces;c++)u[c]=(s.orientationDelta[a.permutation[c]]+a.orientationDelta[c])%i.numOrientations,l[c]=s.permutation[a.permutation[c]];r[i.orbitName]={permutation:l,orientationDelta:u}}}}return r}function tn(e,t,n){const r={};for(const i of e.orbits){const s=t[i.orbitName],a=n[i.orbitName];if(ct(i.numOrientations,a))r[i.orbitName]=s;else{const l=new Array(i.numPieces);if(i.numOrientations===1){for(let c=0;c<i.numPieces;c++)l[c]=s.pieces[a.permutation[c]];const u={pieces:l,orientation:s.orientation};r[i.orbitName]=u}else{const u=new Array(i.numPieces),c=s.orientationMod?new Array(i.numPieces):void 0;for(let m=0;m<i.numPieces;m++){const h=a.permutation[m];let v=i.numOrientations;if(s.orientationMod){const p=s.orientationMod[h];c[m]=p,v=p||i.numOrientations}u[m]=(s.orientation[h]+a.orientationDelta[m])%v,l[m]=s.pieces[h]}const d={pieces:l,orientation:u};c&&(d.orientationMod=c),r[i.orbitName]=d}}}return r}var nn=new Map;function Fi(e){const t=nn.get(e);if(t)return t;const n=new Array(e),r=new Array(e);for(let s=0;s<e;s++)n[s]=s,r[s]=0;const i={permutation:n,orientationDelta:r};return nn.set(e,i),i}function _i(e){const t={};for(const n of e.orbits)t[n.orbitName]=Fi(n.numPieces);return t}function Vi(e,t){function n(i,s){const a=i.toString(),l=e.definition.moves[a];if(l)return Te(e,l,s);const u=e.definition.derivedMoves?.[a];if(u)return Te(e,e.algToTransformation(u).transformationData,s)}const r=n(t.quantum,t.amount)??n(t,1)??n(t.invert,-1);if(r)return r;throw new Error(`Invalid move for KPuzzle (${e.name()}): ${t}`)}var ze=class de{constructor(t,n){this.kpuzzle=t,this.transformationData=n}toJSON(){return{experimentalPuzzleName:this.kpuzzle.name(),transformationData:this.transformationData}}invert(){return new de(this.kpuzzle,Qn(this.kpuzzle,this.transformationData))}#e;isIdentityTransformation(){return this.#e??=this.isIdentical(this.kpuzzle.identityTransformation())}static experimentalConstructIdentity(t){const n=new de(t,_i(t.definition));return n.#e=!0,n}isIdentical(t){return ji(this.kpuzzle,this.transformationData,t.transformationData)}apply(t){return this.applyTransformation(this.kpuzzle.toTransformation(t))}applyTransformation(t){if(this.kpuzzle!==t.kpuzzle)throw new Error(`Tried to apply a transformation for a KPuzzle (${t.kpuzzle.name()}) to a different KPuzzle (${this.kpuzzle.name()}).`);return this.#e?new de(this.kpuzzle,t.transformationData):t.#e?new de(this.kpuzzle,this.transformationData):new de(this.kpuzzle,Lt(this.kpuzzle.definition,this.transformationData,t.transformationData))}applyMove(t){return this.applyTransformation(this.kpuzzle.moveToTransformation(t))}applyAlg(t){return this.applyTransformation(this.kpuzzle.algToTransformation(t))}toKPattern(){return Vt.fromTransformation(this)}repetitionOrder(){return Qi(this.kpuzzle.definition,this)}selfMultiply(t){return new de(this.kpuzzle,Te(this.kpuzzle,this.transformationData,t))}};function ct(e,t){t.permutation||console.log(t);const{permutation:n}=t,r=n.length;for(let i=0;i<r;i++)if(n[i]!==i)return!1;if(e>1){const{orientationDelta:i}=t;for(let s=0;s<r;s++)if(i[s]!==0)return!1}return!0}function Ui(e,t,n,r={}){for(let i=0;i<e.numPieces;i++)if(!r?.ignorePieceOrientations&&t.orientationDelta[i]!==n.orientationDelta[i]||!r?.ignorePiecePermutation&&t.permutation[i]!==n.permutation[i])return!1;return!0}function ji(e,t,n){for(const r of e.definition.orbits)if(!Ui(r,t[r.orbitName],n[r.orbitName]))return!1;return!0}function qi(e,t,n,r={}){for(let i=0;i<e.numPieces;i++)if(!r?.ignorePieceOrientations&&(t.orientation[i]!==n.orientation[i]||(t.orientationMod?.[i]??0)!==(n.orientationMod?.[i]??0))||!r?.ignorePieceIndices&&t.pieces[i]!==n.pieces[i])return!1;return!0}function Gi(e,t,n){for(const r of e.definition.orbits)if(!qi(r,t[r.orbitName],n[r.orbitName]))return!1;return!0}function Qn(e,t){const n={};for(const r of e.definition.orbits){const i=t[r.orbitName];if(ct(r.numOrientations,i))n[r.orbitName]=i;else if(r.numOrientations===1){const s=new Array(r.numPieces);for(let a=0;a<r.numPieces;a++)s[i.permutation[a]]=a;n[r.orbitName]={permutation:s,orientationDelta:i.orientationDelta}}else{const s=new Array(r.numPieces),a=new Array(r.numPieces);for(let l=0;l<r.numPieces;l++){const u=i.permutation[l];s[u]=l,a[u]=(r.numOrientations-i.orientationDelta[l]+r.numOrientations)%r.numOrientations}n[r.orbitName]={permutation:s,orientationDelta:a}}}return n}function Te(e,t,n){if(n===1)return t;if(n<0)return Te(e,Qn(e,t),-n);if(n===0){const{transformationData:s}=e.identityTransformation();return s}let r=t;n!==2&&(r=Te(e,t,Math.floor(n/2)));const i=Lt(e.definition,r,r);return n%2===0?i:Lt(e.definition,t,i)}var Wi=class extends ve{traverseAlg(e,t){let n=null;for(const r of e.childAlgNodes())n?n=n.applyTransformation(this.traverseAlgNode(r,t)):n=this.traverseAlgNode(r,t);return n??t.identityTransformation()}traverseGrouping(e,t){const n=this.traverseAlg(e.alg,t);return new ze(t,Te(t,n.transformationData,e.amount))}traverseMove(e,t){return t.moveToTransformation(e)}traverseCommutator(e,t){const n=this.traverseAlg(e.A,t),r=this.traverseAlg(e.B,t);return n.applyTransformation(r).applyTransformation(n.invert()).applyTransformation(r.invert())}traverseConjugate(e,t){const n=this.traverseAlg(e.A,t),r=this.traverseAlg(e.B,t);return n.applyTransformation(r).applyTransformation(n.invert())}traversePause(e,t){return t.identityTransformation()}traverseNewline(e,t){return t.identityTransformation()}traverseLineComment(e,t){return t.identityTransformation()}},$i=U(Wi);function kt(e,t){return t?kt(t,e%t):e}function Qi(e,t){let n=1;for(const r of e.orbits){const i=t.transformationData[r.orbitName],s=new Array(r.numPieces);for(let a=0;a<r.numPieces;a++)if(!s[a]){let l=a,u=0,c=0;for(;s[l]=!0,u=u+i.orientationDelta[l],c=c+1,l=i.permutation[l],l!==a;);u!==0&&(c=c*r.numOrientations/kt(r.numOrientations,Math.abs(u))),n=n*c/kt(n,c)}}return n}var Vt=class at{constructor(t,n){this.kpuzzle=t,this.patternData=n}toJSON(){return{experimentalPuzzleName:this.kpuzzle.name(),patternData:this.patternData}}static fromTransformation(t){const n=tn(t.kpuzzle.definition,t.kpuzzle.definition.defaultPattern,t.transformationData);return new at(t.kpuzzle,n)}apply(t){return this.applyTransformation(this.kpuzzle.toTransformation(t))}applyTransformation(t){if(t.isIdentityTransformation())return new at(this.kpuzzle,this.patternData);const n=tn(this.kpuzzle.definition,this.patternData,t.transformationData);return new at(this.kpuzzle,n)}applyMove(t){return this.applyTransformation(this.kpuzzle.moveToTransformation(t))}applyAlg(t){return this.applyTransformation(this.kpuzzle.algToTransformation(t))}isIdentical(t){return Gi(this.kpuzzle,this.patternData,t.patternData)}experimentalToTransformation(){if(!this.kpuzzle.canConvertDefaultPatternToUniqueTransformation())return null;const t={};for(const[n,r]of Object.entries(this.patternData)){const i={permutation:r.pieces,orientationDelta:r.orientation};t[n]=i}return new ze(this.kpuzzle,t)}experimentalIsSolved(t){if(!this.kpuzzle.definition.experimentalIsPatternSolved)throw new Error("`KPattern.experimentalIsPatternSolved()` is not supported for this puzzle at the moment.");return this.kpuzzle.definition.experimentalIsPatternSolved(this,t)}},re=class{constructor(e,t){this.definition=e,this.experimentalPGNotation=t?.experimentalPGNotation}experimentalPGNotation;#e;lookupOrbitDefinition(e){return this.#e||=(()=>{const t={};for(const n of this.definition.orbits)t[n.orbitName]=n;return t})(),this.#e[e]}name(){return this.definition.name}identityTransformation(){return ze.experimentalConstructIdentity(this)}#t=new Map;moveToTransformation(e){typeof e=="string"&&(e=new o(e));const t=e.toString(),n=this.#t.get(t);if(n)return new ze(this,n);if(this.experimentalPGNotation){const i=this.experimentalPGNotation.lookupMove(e);if(!i)throw new Error(`could not map to internal move: ${e}`);return this.#t.set(t,i),new ze(this,i)}const r=Vi(this,e);return this.#t.set(t,r),new ze(this,r)}algToTransformation(e){return typeof e=="string"&&(e=new f(e)),$i(e,this)}toTransformation(e){return typeof e=="string"?this.algToTransformation(e):e?.is?.(f)?this.algToTransformation(e):e?.is?.(o)?this.moveToTransformation(e):e}defaultPattern(){return new Vt(this,this.definition.defaultPattern)}#n;canConvertDefaultPatternToUniqueTransformation(){return this.#n??=(()=>{for(const e of this.definition.orbits){const t=new Array(e.numPieces).fill(!1);for(const n of this.definition.defaultPattern[e.orbitName].pieces)t[n]=!0;for(const n of t)if(!n)return!1}return!0})()}},Hn=class ot extends Promise{constructor(t){super(n=>{n()}),this._executor=t}static from(t){return new ot(n=>{n(t())})}static resolve(t){return new ot(n=>{n(t)})}static reject(t){return new ot((n,r)=>{r(t)})}then(t,n){return this._promise=this._promise||new Promise(this._executor),this._promise.then(t,n)}catch(t){return this._promise=this._promise||new Promise(this._executor),this._promise.catch(t)}};function Kn(e){return new Hn(t=>{t(e())})}function ec(e,t,n,r,i){const a=e.orbits[t].pieces[n];if(a===null)return $;const l=a.facelets?.[r];return l===null?$:typeof l=="string"?l:(console.log(l),l.mask)}var me=class{stickerings=new Map;constructor(e,t){for(const n of e.definition.orbits)this.stickerings.set(n.orbitName,new Array(n.numPieces).fill(t))}},$="regular",E="ignored",xe="oriented",Hi="experimentalOriented2",ke="invisible",ce="dim",Ce="mystery",Ki={Regular:{facelets:[$,$,$,$,$]},Ignored:{facelets:[E,E,E,E,E]},OrientationStickers:{facelets:[xe,xe,xe,xe,xe]},IgnoreNonPrimary:{facelets:[$,E,E,E,E]},Invisible:{facelets:[ke,ke,ke,ke,ke]},PermuteNonPrimary:{facelets:[ce,$,$,$,$]},Dim:{facelets:[ce,ce,ce,ce,ce]},Ignoriented:{facelets:[ce,E,E,E,E]},OrientationWithoutPermutation:{facelets:[xe,E,E,E,E]},ExperimentalOrientationWithoutPermutation2:{facelets:[Hi,E,E,E,E]},Mystery:{facelets:[Ce,Ce,Ce,Ce,Ce]}};function Yn(e){return Ki[e]}var Xn=class extends me{constructor(e){super(e,"Regular")}set(e,t){for(const[n,r]of this.stickerings.entries())for(let i=0;i<r.length;i++)e.stickerings.get(n)[i]&&(r[i]=t);return this}toStickeringMask(){const e={orbits:{}};for(const[t,n]of this.stickerings.entries()){const r=[],i={pieces:r};e.orbits[t]=i;for(const s of n)r.push(Yn(s))}return e}},Zn=class{constructor(e){this.kpuzzle=e}and(e){const t=new me(this.kpuzzle,!1);for(const n of this.kpuzzle.definition.orbits)e:for(let r=0;r<n.numPieces;r++){t.stickerings.get(n.orbitName)[r]=!0;for(const i of e)if(!i.stickerings.get(n.orbitName)[r]){t.stickerings.get(n.orbitName)[r]=!1;continue e}}return t}or(e){const t=new me(this.kpuzzle,!1);for(const n of this.kpuzzle.definition.orbits)e:for(let r=0;r<n.numPieces;r++){t.stickerings.get(n.orbitName)[r]=!1;for(const i of e)if(i.stickerings.get(n.orbitName)[r]){t.stickerings.get(n.orbitName)[r]=!0;continue e}}return t}not(e){const t=new me(this.kpuzzle,!1);for(const n of this.kpuzzle.definition.orbits)for(let r=0;r<n.numPieces;r++)t.stickerings.get(n.orbitName)[r]=!e.stickerings.get(n.orbitName)[r];return t}all(){return this.and(this.moves([]))}move(e){const t=this.kpuzzle.moveToTransformation(e),n=new me(this.kpuzzle,!1);for(const r of this.kpuzzle.definition.orbits)for(let i=0;i<r.numPieces;i++)(t.transformationData[r.orbitName].permutation[i]!==i||t.transformationData[r.orbitName].orientationDelta[i]!==0)&&(n.stickerings.get(r.orbitName)[i]=!0);return n}moves(e){return e.map(t=>this.move(t))}orbits(e){const t=new me(this.kpuzzle,!1);for(const n of e)t.stickerings.get(n).fill(!0);return t}orbitPrefix(e){const t=new me(this.kpuzzle,!1);for(const n of this.kpuzzle.definition.orbits)n.orbitName.startsWith(e)&&t.stickerings.get(n.orbitName).fill(!0);return t}},rn="Last Layer",sn="Last Slot",K={"3x3x3":rn,megaminx:rn},ie={"3x3x3":sn,megaminx:sn},Yi={full:{groups:{"3x3x3":"Stickering",megaminx:"Stickering"}},OLL:{groups:K},PLL:{groups:K},LL:{groups:K},EOLL:{groups:K},COLL:{groups:K},OCLL:{groups:K},CPLL:{groups:K},CLL:{groups:K},EPLL:{groups:K},ELL:{groups:K},ZBLL:{groups:K},LS:{groups:ie},LSOLL:{groups:ie},LSOCLL:{groups:ie},ELS:{groups:ie},CLS:{groups:ie},ZBLS:{groups:ie},VLS:{groups:ie},WVLS:{groups:ie},F2L:{groups:{"3x3x3":"CFOP (Fridrich)"}},Daisy:{groups:{"3x3x3":"CFOP (Fridrich)"}},Cross:{groups:{"3x3x3":"CFOP (Fridrich)"}},EO:{groups:{"3x3x3":"ZZ"}},EOline:{groups:{"3x3x3":"ZZ"}},EOcross:{groups:{"3x3x3":"ZZ"}},FirstBlock:{groups:{"3x3x3":"Roux"}},SecondBlock:{groups:{"3x3x3":"Roux"}},CMLL:{groups:{"3x3x3":"Roux"}},L10P:{groups:{"3x3x3":"Roux"}},L6E:{groups:{"3x3x3":"Roux"}},L6EO:{groups:{"3x3x3":"Roux"}},"2x2x2":{groups:{"3x3x3":"Petrus"}},"2x2x3":{groups:{"3x3x3":"Petrus"}},EODF:{groups:{"3x3x3":"Nautilus"}},G1:{groups:{"3x3x3":"FMC"}},L2C:{groups:{"4x4x4":"Reduction","5x5x5":"Reduction","6x6x6":"Reduction"}},OBL:{groups:{"2x2x2":"General"}},PBL:{groups:{"2x2x2":"Ortega"}},"Void Cube":{groups:{"3x3x3":"Miscellaneous"}},invisible:{groups:{"3x3x3":"Miscellaneous"}},picture:{groups:{"3x3x3":"Miscellaneous"}},"centers-only":{groups:{"3x3x3":"Miscellaneous"}},"opposite-centers":{groups:{"4x4x4":"Reduction"}},"experimental-centers-U":{},"experimental-centers-U-D":{},"experimental-centers-U-L-D":{},"experimental-centers-U-L-B-D":{},"experimental-centers":{},"experimental-fto-fc":{groups:{fto:"Bencisco"}},"experimental-fto-f2t":{groups:{fto:"Bencisco"}},"experimental-fto-sc":{groups:{fto:"Bencisco"}},"experimental-fto-l2c":{groups:{fto:"Bencisco"}},"experimental-fto-lbt":{groups:{fto:"Bencisco"}},"experimental-fto-l3t":{groups:{fto:"Bencisco"}}};async function _e(e,t){return(await Xi(e,t)).toStickeringMask()}async function Xi(e,t){const n=await e.kpuzzle(),r=new Xn(n),i=new Zn(n),s=()=>i.move("U"),a=()=>i.or(i.moves(["U","D"])),l=()=>i.or(i.moves(["L","R"])),u=()=>i.not(l()),c=()=>i.not(s()),d=()=>i.orbitPrefix("CENTER"),m=vt=>i.and([i.move(vt),d()]),h=()=>i.orbitPrefix("EDGE"),v=vt=>i.and([i.and(i.moves(vt)),h()]),p=()=>i.or([i.orbitPrefix("CORNER"),i.orbitPrefix("C4RNER"),i.orbitPrefix("C5RNER")]),M=()=>i.or([u(),i.and([s(),h()])]),T=()=>i.and([s(),d()]),D=()=>i.and([i.and(i.moves(["F","R"])),h()]),k=()=>i.and([i.and(i.moves(["F","R"])),p(),i.not(s())]),j=()=>i.or([k(),D()]);function A(){r.set(c(),"Dim")}function di(){r.set(s(),"PermuteNonPrimary"),r.set(T(),"Dim")}function ye(){r.set(s(),"IgnoreNonPrimary"),r.set(T(),"Regular")}function Yt(){r.set(s(),"Ignoriented"),r.set(T(),"Dim")}switch(t){case"full":break;case"PLL":{A(),di();break}case"CLS":{A(),r.set(k(),"Regular"),r.set(s(),"Ignoriented"),r.set(i.and([s(),d()]),"Dim"),r.set(i.and([s(),p()]),"IgnoreNonPrimary");break}case"OLL":{A(),ye();break}case"EOLL":{A(),ye(),r.set(i.and([s(),p()]),"Ignored");break}case"COLL":{A(),r.set(i.and([s(),h()]),"Ignoriented"),r.set(i.and([s(),d()]),"Dim"),r.set(i.and([s(),p()]),"Regular");break}case"OCLL":{A(),Yt(),r.set(i.and([s(),p()]),"IgnoreNonPrimary");break}case"CPLL":{A(),r.set(i.and([p(),s()]),"PermuteNonPrimary"),r.set(i.and([i.not(p()),s()]),"Dim");break}case"CLL":{A(),r.set(i.not(i.and([p(),s()])),"Dim");break}case"EPLL":{A(),r.set(s(),"Dim"),r.set(i.and([s(),h()]),"PermuteNonPrimary");break}case"ELL":{A(),r.set(s(),"Dim"),r.set(i.and([s(),h()]),"Regular");break}case"ELS":{A(),ye(),r.set(i.and([s(),p()]),"Ignored"),r.set(D(),"Regular"),r.set(k(),"Ignored");break}case"LL":{A();break}case"F2L":{r.set(s(),"Ignored");break}case"ZBLL":{A(),r.set(s(),"PermuteNonPrimary"),r.set(T(),"Dim"),r.set(i.and([s(),p()]),"Regular");break}case"ZBLS":{A(),r.set(j(),"Regular"),ye(),r.set(i.and([s(),p()]),"Ignored");break}case"VLS":{A(),r.set(j(),"Regular"),ye();break}case"WVLS":{A(),r.set(j(),"Regular"),r.set(i.and([s(),h()]),"Ignoriented"),r.set(i.and([s(),d()]),"Dim"),r.set(i.and([s(),p()]),"IgnoreNonPrimary");break}case"LS":{A(),r.set(j(),"Regular"),r.set(s(),"Ignored"),r.set(T(),"Dim");break}case"LSOLL":{A(),ye(),r.set(j(),"Regular");break}case"LSOCLL":{A(),Yt(),r.set(i.and([s(),p()]),"IgnoreNonPrimary"),r.set(j(),"Regular");break}case"EO":{r.set(p(),"Ignored"),r.set(h(),"OrientationWithoutPermutation");break}case"EOline":{r.set(p(),"Ignored"),r.set(h(),"OrientationWithoutPermutation"),r.set(i.and(i.moves(["D","M"])),"Regular");break}case"EOcross":{r.set(h(),"OrientationWithoutPermutation"),r.set(i.move("D"),"Regular"),r.set(p(),"Ignored");break}case"CMLL":{r.set(c(),"Dim"),r.set(M(),"Ignored"),r.set(i.and([s(),p()]),"Regular");break}case"L10P":{r.set(i.not(M()),"Dim"),r.set(i.and([p(),s()]),"Regular");break}case"L6E":{r.set(i.not(M()),"Dim");break}case"L6EO":{r.set(i.not(M()),"Dim"),r.set(M(),"ExperimentalOrientationWithoutPermutation2"),r.set(i.and([d(),a()]),"ExperimentalOrientationWithoutPermutation2"),r.set(i.and([i.move("M"),i.move("E")]),"Ignored");break}case"Daisy":{r.set(i.all(),"Ignored"),r.set(d(),"Dim"),r.set(i.and([i.move("D"),d()]),"Regular"),r.set(i.and([i.move("U"),h()]),"IgnoreNonPrimary");break}case"Cross":{r.set(i.all(),"Ignored"),r.set(d(),"Dim"),r.set(i.and([i.move("D"),d()]),"Regular"),r.set(i.and([i.move("D"),h()]),"Regular");break}case"2x2x2":{r.set(i.or(i.moves(["U","F","R"])),"Ignored"),r.set(i.and([i.or(i.moves(["U","F","R"])),d()]),"Dim");break}case"2x2x3":{r.set(i.all(),"Dim"),r.set(i.or(i.moves(["U","F","R"])),"Ignored"),r.set(i.and([i.or(i.moves(["U","F","R"])),d()]),"Dim"),r.set(i.and([i.move("F"),i.not(i.or(i.moves(["U","R"])))]),"Regular");break}case"G1":{r.set(i.all(),"ExperimentalOrientationWithoutPermutation2"),r.set(i.or(i.moves(["E"])),"OrientationWithoutPermutation"),r.set(i.and(i.moves(["E","S"])),"Ignored");break}case"L2C":{r.set(i.or(i.moves(["L","R","B","D"])),"Dim"),r.set(i.not(d()),"Ignored");break}case"PBL":{r.set(i.all(),"Ignored"),r.set(i.or(i.moves(["U","D"])),"PermuteNonPrimary");break}case"FirstBlock":{r.set(i.not(i.and([i.and(i.moves(["L"])),i.not(s())])),"Ignored"),r.set(m("R"),"Dim");break}case"SecondBlock":{r.set(i.not(i.and([i.and(i.moves(["L"])),i.not(s())])),"Ignored"),r.set(i.and([i.and(i.moves(["L"])),i.not(s())]),"Dim"),r.set(i.and([i.and(i.moves(["R"])),i.not(s())]),"Regular");break}case"EODF":{A(),r.set(i.or([k(),i.and([s(),p()])]),"Ignored"),r.set(i.or([i.and([s(),h()]),D()]),"OrientationWithoutPermutation"),r.set(v(["D","F"]),"Regular"),r.set(m("F"),"Regular");break}case"Void Cube":{r.set(d(),"Invisible");break}case"picture":case"invisible":{r.set(i.all(),"Invisible");break}case"centers-only":{r.set(i.not(d()),"Ignored");break}case"opposite-centers":{r.set(i.not(i.and([d(),i.or(i.moves(["U","D"]))])),"Ignored");break}case"OBL":{r.set(i.or(i.moves(["U","D"])),"IgnoreNonPrimary");break}default:console.warn(`Unsupported stickering for ${e.id}: ${t}. Setting all pieces to dim.`),r.set(i.and(i.moves([])),"Dim")}return r}async function ft(e,t){const n=[],r=[];for(const[i,s]of Object.entries(Yi))s.groups&&(e in s.groups?n.push(i):t?.use3x3x3Fallbacks&&"3x3x3"in s.groups&&r.push(i));return n.concat(r)}function S(e){let t=null;return()=>t??=e()}async function Ut(e){return(await y(()=>import("./index-MDAPUQL5.js"),[])).getPuzzleGeometryByName(e,{allMoves:!0,orientCenters:!0,addRotations:!0})}async function Zi(e){return(await y(()=>import("./index-MDAPUQL5.js"),[])).getPuzzleGeometryByName(e)}async function Jn(e,t,n){const r=await e,i=r.getKPuzzleDefinition(!0);i.name=t;const s=await y(()=>import("./index-MDAPUQL5.js"),[]),a=new s.ExperimentalPGNotation(r,r.getOrbitsDef(!0));if(n){const l=new Set(n);for(const[u,c]of Object.entries(i.defaultPattern))l.has(u)&&(c.orientationMod=new Array(c.pieces.length).fill(1))}return new re(a.remapKPuzzleDefinition(i),{experimentalPGNotation:a})}var Z=class{pgId;id;fullName;inventedBy;inventionYear;#e;constructor(e){this.pgId=e.pgID,this.id=e.id,this.fullName=e.fullName,this.inventedBy=e.inventedBy,this.inventionYear=e.inventionYear,this.#e=e.setOrientationModTo1ForPiecesOfOrbits}#t;pg(){return this.#t??=Ut(this.pgId??this.id)}#n;basePG(){return this.#n??=Zi(this.pgId??this.id)}#r;kpuzzle(){return this.#r??=Jn(this.pg(),this.id,this.#e)}#s;svg(){return this.#s??=(async()=>(await this.pg()).generatesvg())()}puzzleSpecificSimplifyOptionsPromise=er(this.kpuzzle.bind(this))},Re=class extends Z{stickeringMask(e){return _e(this,e)}stickerings=()=>ft(this.id,{use3x3x3Fallbacks:!0});algTransformData=jt};function er(e){return new Hn(async t=>{const n=await e();t({quantumMoveOrder:r=>n.moveToTransformation(new o(r)).repetitionOrder()})})}var ut={name:"3x3x3",orbits:[{orbitName:"EDGES",numPieces:12,numOrientations:2},{orbitName:"CORNERS",numPieces:8,numOrientations:3},{orbitName:"CENTERS",numPieces:6,numOrientations:4}],defaultPattern:{EDGES:{pieces:[0,1,2,3,4,5,6,7,8,9,10,11],orientation:[0,0,0,0,0,0,0,0,0,0,0,0]},CORNERS:{pieces:[0,1,2,3,4,5,6,7],orientation:[0,0,0,0,0,0,0,0]},CENTERS:{pieces:[0,1,2,3,4,5],orientation:[0,0,0,0,0,0],orientationMod:[1,1,1,1,1,1]}},moves:{U:{EDGES:{permutation:[1,2,3,0,4,5,6,7,8,9,10,11],orientationDelta:[0,0,0,0,0,0,0,0,0,0,0,0]},CORNERS:{permutation:[1,2,3,0,4,5,6,7],orientationDelta:[0,0,0,0,0,0,0,0]},CENTERS:{permutation:[0,1,2,3,4,5],orientationDelta:[1,0,0,0,0,0]}},y:{EDGES:{permutation:[1,2,3,0,5,6,7,4,10,8,11,9],orientationDelta:[0,0,0,0,0,0,0,0,1,1,1,1]},CORNERS:{permutation:[1,2,3,0,7,4,5,6],orientationDelta:[0,0,0,0,0,0,0,0]},CENTERS:{permutation:[0,2,3,4,1,5],orientationDelta:[1,0,0,0,0,3]}},x:{EDGES:{permutation:[4,8,0,9,6,10,2,11,5,7,1,3],orientationDelta:[1,0,1,0,1,0,1,0,0,0,0,0]},CORNERS:{permutation:[4,0,3,5,7,6,2,1],orientationDelta:[2,1,2,1,1,2,1,2]},CENTERS:{permutation:[2,1,5,3,0,4],orientationDelta:[0,3,0,1,2,2]}},L:{EDGES:{permutation:[0,1,2,11,4,5,6,9,8,3,10,7],orientationDelta:[0,0,0,0,0,0,0,0,0,0,0,0]},CORNERS:{permutation:[0,1,6,2,4,3,5,7],orientationDelta:[0,0,2,1,0,2,1,0]},CENTERS:{permutation:[0,1,2,3,4,5],orientationDelta:[0,1,0,0,0,0]}},F:{EDGES:{permutation:[9,1,2,3,8,5,6,7,0,4,10,11],orientationDelta:[1,0,0,0,1,0,0,0,1,1,0,0]},CORNERS:{permutation:[3,1,2,5,0,4,6,7],orientationDelta:[1,0,0,2,2,1,0,0]},CENTERS:{permutation:[0,1,2,3,4,5],orientationDelta:[0,0,1,0,0,0]}},R:{EDGES:{permutation:[0,8,2,3,4,10,6,7,5,9,1,11],orientationDelta:[0,0,0,0,0,0,0,0,0,0,0,0]},CORNERS:{permutation:[4,0,2,3,7,5,6,1],orientationDelta:[2,1,0,0,1,0,0,2]},CENTERS:{permutation:[0,1,2,3,4,5],orientationDelta:[0,0,0,1,0,0]}},B:{EDGES:{permutation:[0,1,10,3,4,5,11,7,8,9,6,2],orientationDelta:[0,0,1,0,0,0,1,0,0,0,1,1]},CORNERS:{permutation:[0,7,1,3,4,5,2,6],orientationDelta:[0,2,1,0,0,0,2,1]},CENTERS:{permutation:[0,1,2,3,4,5],orientationDelta:[0,0,0,0,1,0]}},D:{EDGES:{permutation:[0,1,2,3,7,4,5,6,8,9,10,11],orientationDelta:[0,0,0,0,0,0,0,0,0,0,0,0]},CORNERS:{permutation:[0,1,2,3,5,6,7,4],orientationDelta:[0,0,0,0,0,0,0,0]},CENTERS:{permutation:[0,1,2,3,4,5],orientationDelta:[0,0,0,0,0,1]}},z:{EDGES:{permutation:[9,3,11,7,8,1,10,5,0,4,2,6],orientationDelta:[1,1,1,1,1,1,1,1,1,1,1,1]},CORNERS:{permutation:[3,2,6,5,0,4,7,1],orientationDelta:[1,2,1,2,2,1,2,1]},CENTERS:{permutation:[1,5,2,0,4,3],orientationDelta:[1,1,1,1,3,1]}},M:{EDGES:{permutation:[2,1,6,3,0,5,4,7,8,9,10,11],orientationDelta:[1,0,1,0,1,0,1,0,0,0,0,0]},CORNERS:{permutation:[0,1,2,3,4,5,6,7],orientationDelta:[0,0,0,0,0,0,0,0]},CENTERS:{permutation:[4,1,0,3,5,2],orientationDelta:[2,0,0,0,2,0]}},E:{EDGES:{permutation:[0,1,2,3,4,5,6,7,9,11,8,10],orientationDelta:[0,0,0,0,0,0,0,0,1,1,1,1]},CORNERS:{permutation:[0,1,2,3,4,5,6,7],orientationDelta:[0,0,0,0,0,0,0,0]},CENTERS:{permutation:[0,4,1,2,3,5],orientationDelta:[0,0,0,0,0,0]}},S:{EDGES:{permutation:[0,3,2,7,4,1,6,5,8,9,10,11],orientationDelta:[0,1,0,1,0,1,0,1,0,0,0,0]},CORNERS:{permutation:[0,1,2,3,4,5,6,7],orientationDelta:[0,0,0,0,0,0,0,0]},CENTERS:{permutation:[1,5,2,0,4,3],orientationDelta:[1,1,0,1,0,1]}},u:{EDGES:{permutation:[1,2,3,0,4,5,6,7,10,8,11,9],orientationDelta:[0,0,0,0,0,0,0,0,1,1,1,1]},CORNERS:{permutation:[1,2,3,0,4,5,6,7],orientationDelta:[0,0,0,0,0,0,0,0]},CENTERS:{permutation:[0,2,3,4,1,5],orientationDelta:[1,0,0,0,0,0]}},l:{EDGES:{permutation:[2,1,6,11,0,5,4,9,8,3,10,7],orientationDelta:[1,0,1,0,1,0,1,0,0,0,0,0]},CORNERS:{permutation:[0,1,6,2,4,3,5,7],orientationDelta:[0,0,2,1,0,2,1,0]},CENTERS:{permutation:[4,1,0,3,5,2],orientationDelta:[2,1,0,0,2,0]}},f:{EDGES:{permutation:[9,3,2,7,8,1,6,5,0,4,10,11],orientationDelta:[1,1,0,1,1,1,0,1,1,1,0,0]},CORNERS:{permutation:[3,1,2,5,0,4,6,7],orientationDelta:[1,0,0,2,2,1,0,0]},CENTERS:{permutation:[1,5,2,0,4,3],orientationDelta:[1,1,1,1,0,1]}},r:{EDGES:{permutation:[4,8,0,3,6,10,2,7,5,9,1,11],orientationDelta:[1,0,1,0,1,0,1,0,0,0,0,0]},CORNERS:{permutation:[4,0,2,3,7,5,6,1],orientationDelta:[2,1,0,0,1,0,0,2]},CENTERS:{permutation:[2,1,5,3,0,4],orientationDelta:[0,0,0,1,2,2]}},b:{EDGES:{permutation:[0,5,10,1,4,7,11,3,8,9,6,2],orientationDelta:[0,1,1,1,0,1,1,1,0,0,1,1]},CORNERS:{permutation:[0,7,1,3,4,5,2,6],orientationDelta:[0,2,1,0,0,0,2,1]},CENTERS:{permutation:[3,0,2,5,4,1],orientationDelta:[3,3,0,3,1,3]}},d:{EDGES:{permutation:[0,1,2,3,7,4,5,6,9,11,8,10],orientationDelta:[0,0,0,0,0,0,0,0,1,1,1,1]},CORNERS:{permutation:[0,1,2,3,5,6,7,4],orientationDelta:[0,0,0,0,0,0,0,0]},CENTERS:{permutation:[0,4,1,2,3,5],orientationDelta:[0,0,0,0,0,1]}}},derivedMoves:{Uw:"u",Lw:"l",Fw:"f",Rw:"r",Bw:"b",Dw:"d",Uv:"y",Lv:"x'",Fv:"z",Rv:"x",Bv:"z'",Dv:"y'","2U":"u U'","2L":"l L'","2F":"f F'","2R":"r R'","2B":"b B'","2D":"d D'"}};function tr(e){const t=e.patternData.CENTERS.pieces[0],n=e.patternData.CENTERS.pieces[5],r=e.patternData.CENTERS.pieces[1];let i=r;return t<r&&i--,n<r&&i--,[t,i]}var an=new Array(6).fill(0).map(()=>new Array(6));function Ji(){{const e=["","z","x","z'","x'","x2"].map(n=>f.fromString(n)),t=new f("y");for(const n of e){let r=ir.algToTransformation(n);for(let i=0;i<4;i++){r=r.applyAlg(t);const[s,a]=tr(r.toKPattern());an[s][a]=r.invert()}}}return an}function es(e){const[t,n]=tr(e),r=Ji()[t][n];return e.applyTransformation(r)}function ts(e,t){return t.ignorePuzzleOrientation&&(e=es(e)),t.ignoreCenterOrientation&&(e=new Vt(e.kpuzzle,{EDGES:e.patternData.EDGES,CORNERS:e.patternData.CORNERS,CENTERS:{pieces:e.patternData.CENTERS.pieces,orientation:new Array(6).fill(0)}})),!!e.experimentalToTransformation()?.isIdentityTransformation()}async function ns(e){const t=await(e.puzzleSpecificSimplifyOptions??e.puzzleSpecificSimplifyOptionsPromise);return t?{puzzleLoader:{puzzleSpecificSimplifyOptions:t}}:{}}var rs=class extends ve{traverseAlg(e,t){const n=[];for(const r of e.childAlgNodes())n.push(this.traverseAlgNode(r,t));return new f(n)}traverseGrouping(e,t){return e.modified({alg:this.traverseAlg(e.alg,t)})}traverseMove(e,t){const n=(()=>{const{invertExceptByFamily:r}=t;return r?!r.has(e.family):!1})();return e.modified({amount:n?-e.amount:e.amount,family:t.replaceMovesByFamily[e.family]??e.family})}traverseCommutator(e,t){return new q(this.traverseAlg(e.A,t),this.traverseAlg(e.B,t))}traverseConjugate(e,t){return new O(this.traverseAlg(e.A,t),this.traverseAlg(e.B,t))}traversePause(e,t){return e}traverseNewline(e,t){return e}traverseLineComment(e,t){return e}};U(rs);async function Oe(e,t){return(await y(()=>import("./index-MDAPUQL5.js"),[])).getPuzzleGeometryByDesc(e,{allMoves:t?.allMoves??!0,orientCenters:t?.orientCenters??!0,addRotations:t?.addRotations??!0,...t})}async function nr(e,t){const n=Oe(e,t);return Jn(n,`description: ${e}`)}var is=1;function ss(e,t){const n=is++;let r=null;const i=async()=>r??=nr(e);return{id:`custom-${n}`,fullName:t?.fullName??`Custom Puzzle (instance #${n})`,kpuzzle:i,svg:async()=>(await Oe(e)).generatesvg(),pg:async()=>Oe(e),basePG:async()=>Oe(e,{allMoves:!1,orientCenters:!1,addRotations:!1}),puzzleSpecificSimplifyOptionsPromise:er(i)}}function rr(e){const n=e.experimentalToTransformation().invert().transformationData.CORNERS;return n.permutation[6]*3+n.orientationDelta[6]}var on=new Array(24);function as(e){{const t=["","z","x","z'","x'","x2"].map(r=>f.fromString(r)),n=new f("y");for(const r of t){let i=e.algToTransformation(r);for(let s=0;s<4;s++){i=i.applyAlg(n);const a=rr(i.toKPattern());on[a]={transformation:i.invert(),alg:r.concat(n)}}}}return on}function os(e){const t=rr(e),{transformation:n,alg:r}=as(e.kpuzzle)[t];return{normalizedPattern:e.applyTransformation(n),normalizationAlg:r.invert()}}function ls(e,t){return t.ignorePuzzleOrientation&&(e=os(e).normalizedPattern),!!e.experimentalToTransformation().isIdentityTransformation()}var ir=new re(ut);ut.experimentalIsPatternSolved=ts;var sr=S(()=>y(()=>import("./big-puzzle-orientation-ZVZQJEF5-DQZ2l_8A.js"),[])),ar={KeyI:new o("R"),KeyK:new o("R'"),KeyW:new o("B"),KeyO:new o("B'"),KeyS:new o("D"),KeyL:new o("D'"),KeyD:new o("L"),KeyE:new o("L'"),KeyJ:new o("U"),KeyF:new o("U'"),KeyH:new o("F"),KeyG:new o("F'"),KeyC:new o("l"),KeyR:new o("l'"),KeyU:new o("r"),KeyM:new o("r'"),KeyX:new o("d"),Comma:new o("d'"),KeyT:new o("x"),KeyY:new o("x"),KeyV:new o("x'"),KeyN:new o("x'"),Semicolon:new o("y"),KeyA:new o("y'"),KeyP:new o("z"),KeyQ:new o("z'"),KeyZ:new o("M'"),KeyB:new o("M"),Period:new o("M'"),Backquote:new F};function N(e,t,n,r){const i=[];for(const s of e){const a=o.fromString(s),{family:l,amount:u}=a;if(![-1,1].includes(u))throw new Error("Invalid config move");i.push({family:l,direction:u,type:t,from:n,to:r})}return i}var pe={"x axis":{sliceDiameter:3,extendsThroughEntirePuzzle:!0,moveSourceInfos:[...N(["R"],0,0,3),...N(["L'"],1,0,3),...N(["r","Rw"],2,0,2),...N(["l'","Lw'"],3,0,2),...N(["M'"],4,1,2),...N(["x","Uv","Dv'"],5,0,3)]},"y axis":{sliceDiameter:3,extendsThroughEntirePuzzle:!0,moveSourceInfos:[...N(["U"],0,0,3),...N(["D'"],1,0,3),...N(["u","Uw"],2,0,2),...N(["d'","Dw'"],3,0,2),...N(["E'"],4,1,2),...N(["y","Uv","Dv'"],5,0,3)]},"z axis":{sliceDiameter:3,extendsThroughEntirePuzzle:!0,moveSourceInfos:[...N(["F"],0,0,3),...N(["B'"],1,0,3),...N(["f","Fw"],2,0,3),...N(["b'","Bw'"],3,0,3),...N(["S"],4,1,2),...N(["z","Fv","Bv'"],5,0,3)]}},Ve={};for(const[e,t]of Object.entries(pe))for(const n of t.moveSourceInfos)Ve[n.family]={axis:e,moveSourceInfo:n};var or={};for(const e of Object.keys(pe)){const t={};or[e]=t;for(const n of pe[e].moveSourceInfos)(t[n.type]??=[]).push(n)}var lr={};for(const e of Object.keys(pe)){const t=new Map;lr[e]=t;for(const n of pe[e].moveSourceInfos)t.get(n.from)||t.set(n.from,n)}function ln(e,t){const n=or[e][t]?.[0];if(!n)throw new Error(`Could not find a reference move (axis: ${e}, move source type: ${t})`);return n}var cs=(e,t)=>Ve[e.family].axis===Ve[t.family].axis;function us(e,t,n,r){if(t+1===n){const h=lr[e].get(t);if(h)return new o(new te(h.family),r*h.direction)}const i=pe[e],{sliceDiameter:s}=i;if(t===0&&n===s){const h=ln(e,5);return new o(new te(h.family),r*h.direction)}const a=t+n>s;a&&([t,n]=[s-n,s-t]);let l=t+1,u=n;const c=l===u;c&&(u=null),l===1&&(l=null),c&&l===1&&(u=null),!c&&u===2&&(u=null);const m=ln(e,c?a?1:0:a?3:2);return new o(new te(m.family,u,l),r*m.direction)}function ds(e,t=!0){if(e.length===0)return[];const n=Ve[e[0].family].axis,r=pe[n],{sliceDiameter:i}=r,s=new Map;let a=null;function l(h,v){let p=(s.get(h)??0)+v;t&&(p=p%4+5%4-1),p===0?s.delete(h):s.set(h,p)}let u=0;for(const h of Array.from(e).reverse()){u++;const{moveSourceInfo:v}=Ve[h.family],p=h.amount*v.direction;switch(v.type){case 0:{const M=(h.innerLayer??1)-1;l(M,p),l(M+1,-p);break}case 1:{const M=i-(h.innerLayer??1);l(M,p),l(M+1,-p);break}case 2:{l((h.outerLayer??1)-1,p),l(h.innerLayer??2,-p);break}case 3:{l(i-(h.innerLayer??2),p),l(i-((h.outerLayer??1)-1),-p);break}case 4:{l(v.from,p),l(v.to,-p);break}case 5:{l(0,p),l(i,-p);break}}[0,2].includes(s.size)&&(a={suffixLength:u,sliceDeltas:new Map(s)})}if(s.size===0)return[];if(!a)return e;let[c,d]=a.sliceDeltas.keys();c>d&&([c,d]=[d,c]);const m=a.sliceDeltas.get(c);return[...e.slice(0,-a.suffixLength),...m!==0?[us(n,c,d,m)]:[]]}var ms={quantumMoveOrder:()=>4,axis:{areQuantumMovesSameAxis:cs,simplifySameAxisMoves:ds}},jt={" Mirror (M)":{replaceMovesByFamily:{L:"R",R:"L",l:"r",r:"l",Lw:"Rw",Rw:"Lw",Lv:"Rv",Rv:"Lv"},invertExceptByFamily:new Set(["x","M","m"])}," Mirror (S)":{replaceMovesByFamily:{F:"B",B:"F",f:"b",b:"f",Fw:"Bw",Bw:"Fw",Fv:"Bv",Bv:"Fv"},invertExceptByFamily:new Set(["z","S","s"])}," Mirror (E)":{replaceMovesByFamily:{U:"D",D:"U",u:"d",d:"u",Uw:"Dw",Dw:"Uw",Uv:"Dv",Dv:"Uv"},invertExceptByFamily:new Set(["y","E","e"])}},qt={id:"3x3x3",fullName:"333 Cube",inventedBy:["Ern Rubik"],inventionYear:1974,kpuzzle:S(async()=>ir),svg:S(async()=>(await y(async()=>{const{cube3x3x3SVG:e}=await import("./puzzles-dynamic-3x3x3-FYXD7SIU-BAAKgtmM.js");return{cube3x3x3SVG:e}},[])).cube3x3x3SVG),llSVG:S(async()=>(await y(async()=>{const{cube3x3x3LLSVG:e}=await import("./puzzles-dynamic-3x3x3-FYXD7SIU-BAAKgtmM.js");return{cube3x3x3LLSVG:e}},[])).cube3x3x3LLSVG),llFaceSVG:S(async()=>(await y(async()=>{const{cube3x3x3LLFaceSVG:e}=await import("./puzzles-dynamic-3x3x3-FYXD7SIU-BAAKgtmM.js");return{cube3x3x3LLFaceSVG:e}},[])).cube3x3x3LLFaceSVG),pg:S(async()=>Ut("3x3x3")),stickeringMask:e=>_e(qt,e),stickerings:()=>ft("3x3x3"),puzzleSpecificSimplifyOptions:ms,keyMapping:async()=>ar,algTransformData:jt},hs={333:{puzzleID:"3x3x3",eventName:"3x3x3 Cube",scramblesImplemented:"random-state"},222:{puzzleID:"2x2x2",eventName:"2x2x2 Cube",scramblesImplemented:"random-state"},444:{puzzleID:"4x4x4",eventName:"4x4x4 Cube",scramblesImplemented:"random-state"},555:{puzzleID:"5x5x5",eventName:"5x5x5 Cube",scramblesImplemented:"random-moves"},666:{puzzleID:"6x6x6",eventName:"6x6x6 Cube",scramblesImplemented:"random-moves"},777:{puzzleID:"7x7x7",eventName:"7x7x7 Cube",scramblesImplemented:"random-moves"},"333bf":{puzzleID:"3x3x3",eventName:"3x3x3 Blindfolded",scramblesImplemented:"random-state"},"333fm":{puzzleID:"3x3x3",eventName:"3x3x3 Fewest Moves",scramblesImplemented:"random-state"},"333oh":{puzzleID:"3x3x3",eventName:"3x3x3 One-Handed",scramblesImplemented:"random-state"},clock:{puzzleID:"clock",eventName:"Clock",scramblesImplemented:"random-state"},minx:{puzzleID:"megaminx",eventName:"Megaminx",scramblesImplemented:"random-moves"},pyram:{puzzleID:"pyraminx",eventName:"Pyraminx",scramblesImplemented:"random-state"},skewb:{puzzleID:"skewb",eventName:"Skewb",scramblesImplemented:"random-state"},sq1:{puzzleID:"square1",eventName:"Square-1",scramblesImplemented:"random-state"},"444bf":{puzzleID:"4x4x4",eventName:"4x4x4 Blindfolded",scramblesImplemented:"random-state"},"555bf":{puzzleID:"5x5x5",eventName:"5x5x5 Blindfolded",scramblesImplemented:"random-moves"},"333mbf":{puzzleID:"3x3x3",eventName:"3x3x3 Multi-Blind",scramblesImplemented:"random-state"}},ps={...hs,fto:{puzzleID:"fto",eventName:"Face-Turning Octahedron",scramblesImplemented:"random-state"},master_tetraminx:{puzzleID:"master_tetraminx",eventName:"Master Tetraminx",scramblesImplemented:"random-state"},kilominx:{puzzleID:"kilominx",eventName:"Kilominx",scramblesImplemented:"random-state"},redi_cube:{puzzleID:"redi_cube",eventName:"Redi Cube",scramblesImplemented:"random-state"},baby_fto:{puzzleID:"baby_fto",eventName:"Baby FTO",scramblesImplemented:"random-state"},loopover:{puzzleID:"loopover",eventName:"Loopover",scramblesImplemented:null}};function fs(e){return ps[e]??null}var cr={id:"2x2x2",fullName:"222 Cube",kpuzzle:S(async()=>{const e=new re((await y(async()=>{const{cube2x2x2JSON:t}=await import("./puzzles-dynamic-side-events-IMYJ533P-uM0XY_nj.js");return{cube2x2x2JSON:t}},[])).cube2x2x2JSON);return e.definition.experimentalIsPatternSolved=ls,e}),svg:async()=>(await y(async()=>{const{cube2x2x2SVG:e}=await import("./puzzles-dynamic-side-events-IMYJ533P-uM0XY_nj.js");return{cube2x2x2SVG:e}},[])).cube2x2x2SVG,llSVG:S(async()=>(await y(async()=>{const{cube2x2x2LLSVG:e}=await import("./puzzles-dynamic-side-events-IMYJ533P-uM0XY_nj.js");return{cube2x2x2LLSVG:e}},[])).cube2x2x2LLSVG),pg:S(async()=>Ut("2x2x2")),stickeringMask:e=>_e(cr,e),stickerings:()=>ft("2x2x2",{use3x3x3Fallbacks:!0}),algTransformData:jt},ur={...ar,KeyZ:new o("m'"),KeyB:new o("m"),Period:new o("m'")},Ue=new Re({id:"4x4x4",fullName:"444 Cube",inventedBy:["Peter Sebestny"],inventionYear:1981});Ue.llSVG=S(async()=>(await y(async()=>{const{cube4x4x4LLSVG:e}=await import("./puzzles-dynamic-4x4x4-REUXFQJ4-BNnOy5ao.js");return{cube4x4x4LLSVG:e}},[])).cube4x4x4LLSVG);Ue.keyMapping=async()=>ur;Ue.kpuzzle=S(async()=>{const e=await Z.prototype.kpuzzle.call(Ue);e.definition.defaultPattern.CENTERS.pieces=[0,0,0,0,4,4,4,4,8,8,8,8,12,12,12,12,16,16,16,16,20,20,20,20];const{experimentalIsBigCubeSolved:t}=await sr();return e.definition.experimentalIsPatternSolved=t,e});var dt=new Re({id:"5x5x5",fullName:"555 Cube",inventedBy:["Udo Krell"],inventionYear:1981});dt.keyMapping=async()=>ur;dt.kpuzzle=S(async()=>{const e=await Z.prototype.kpuzzle.call(dt),t=[0,0,0,0,4,4,4,4,8,8,8,8,12,12,12,12,16,16,16,16,20,20,20,20];e.definition.defaultPattern.CENTERS.pieces=t,e.definition.defaultPattern.CENTERS2.pieces=t,e.definition.defaultPattern.CENTERS3.orientationMod=new Array(6).fill(1);const{experimentalIsBigCubeSolved:n}=await sr();return e.definition.experimentalIsPatternSolved=n,e});async function dr(e,t){const n=await e.kpuzzle(),r=new Xn(n),i=new Zn(n),s=()=>i.and([i.move("U"),i.not(i.or(i.moves(["F","BL","BR"])))]),a=()=>i.and([i.move("U"),i.not(i.move("F"))]),l=()=>i.or([a(),i.and([i.move("F"),i.not(i.or(i.moves(["U","BL","BR"])))])]),u=()=>i.not(i.or([i.and([i.move("U"),i.move("F")]),i.and([i.move("F"),i.move("BL")]),i.and([i.move("F"),i.move("BR")]),i.and([i.move("BL"),i.move("BR")])])),c=()=>i.not(i.or([i.and([i.move("F"),i.move("BL")]),i.and([i.move("F"),i.move("BR")]),i.and([i.move("BL"),i.move("BR")])]));switch(t){case"full":break;case"experimental-fto-fc":{r.set(i.not(s()),"Ignored");break}case"experimental-fto-f2t":{r.set(i.not(a()),"Ignored"),r.set(s(),"Dim");break}case"experimental-fto-sc":{r.set(i.not(l()),"Ignored"),r.set(a(),"Dim");break}case"experimental-fto-l2c":{r.set(i.not(u()),"Ignored"),r.set(l(),"Dim");break}case"experimental-fto-lbt":{r.set(i.not(c()),"Ignored"),r.set(u(),"Dim");break}case"experimental-fto-l3t":{r.set(c(),"Dim");break}default:console.warn(`Unsupported stickering for ${e.id}: ${t}. Setting all pieces to dim.`),r.set(i.and(i.moves([])),"Dim")}return r.toStickeringMask()}async function gs(){return["full","experimental-fto-fc","experimental-fto-f2t","experimental-fto-sc","experimental-fto-l2c","experimental-fto-lbt","experimental-fto-l3t"]}var mr={KeyI:new o("R"),KeyK:new o("R'"),KeyW:new o("B"),KeyO:new o("B'"),KeyS:new o("D"),KeyL:new o("D'"),KeyD:new o("L"),KeyE:new o("L'"),KeyJ:new o("U"),KeyF:new o("U'"),KeyH:new o("F"),KeyG:new o("F'"),KeyN:new o("Rv'"),KeyC:new o("l"),KeyR:new o("l'"),KeyU:new o("r"),KeyM:new o("r'"),KeyX:new o("d"),Comma:new o("d'"),KeyT:new o("Lv'"),KeyY:new o("Rv"),KeyV:new o("Lv"),Semicolon:new o("Uv"),KeyA:new o("Uv'"),KeyP:new o("BR'"),KeyQ:new o("BL"),KeyZ:new o("BL'"),KeyB:new o("T"),Period:new o("BR"),Backquote:new F},vs=class extends Z{constructor(){super({pgID:"skewb diamond",id:"baby_fto",fullName:"Baby FTO",inventedBy:["Uwe Mffert"],setOrientationModTo1ForPiecesOfOrbits:["CENTERS"]})}stickeringMask(e){return dr(this,e)}svg=S(async()=>(await y(async()=>{const{babyFTOSVG:e}=await import("./puzzles-dynamic-unofficial-P3TW433I-cOWAxRTA.js");return{babyFTOSVG:e}},[])).babyFTOSVG);keyMapping=async()=>mr},ws=new vs,ys={id:"clock",fullName:"Clock",inventedBy:["Christopher C. Wiggs","Christopher J. Taylor"],inventionYear:1988,kpuzzle:S(async()=>new re((await y(async()=>{const{clockJSON:e}=await import("./puzzles-dynamic-side-events-IMYJ533P-uM0XY_nj.js");return{clockJSON:e}},[])).clockJSON)),svg:S(async()=>(await y(async()=>{const{clockSVG:e}=await import("./puzzles-dynamic-side-events-IMYJ533P-uM0XY_nj.js");return{clockSVG:e}},[])).clockSVG)},xs=class extends Z{constructor(){super({pgID:"FTO",id:"fto",fullName:"Face-Turning Octahedron",inventedBy:["Karl Rohrbach","David Pitcher"],inventionYear:1983})}stickeringMask(e){return dr(this,e)}stickerings=gs;svg=S(async()=>(await y(async()=>{const{ftoSVG:e}=await import("./puzzles-dynamic-unofficial-P3TW433I-cOWAxRTA.js");return{ftoSVG:e}},[])).ftoSVG);keyMapping=async()=>mr;algTransformData={" Mirror (x)":{replaceMovesByFamily:{L:"R",R:"L",l:"r",r:"l",Lw:"Rw",Rw:"Lw",Lv:"Rv",Rv:"Lv",BL:"BR",BR:"BL",bl:"br",br:"bl",BLw:"BRw",BRw:"BLw",BLv:"BRv",BRv:"BLv"},invertExceptByFamily:new Set(["x"])}}},Ss=new xs,cn="d f 0.56",bs={id:"kilominx",fullName:"Kilominx",kpuzzle:S(()=>nr(cn,{includeCenterOrbits:!1,includeEdgeOrbits:!1})),pg:()=>Oe(cn,{includeCenterOrbits:!1,includeEdgeOrbits:!1}),svg:S(async()=>(await y(async()=>{const{kilominxSVG:e}=await import("./puzzles-dynamic-unofficial-P3TW433I-cOWAxRTA.js");return{kilominxSVG:e}},[])).kilominxSVG)},Ms={id:"loopover",fullName:"Loopover",inventedBy:["Cary Huang"],inventionYear:2018,kpuzzle:S(async()=>new re((await y(async()=>{const{loopoverJSON:e}=await import("./puzzles-dynamic-unofficial-P3TW433I-cOWAxRTA.js");return{loopoverJSON:e}},[])).loopoverJSON)),svg:async()=>(await y(async()=>{const{loopoverSVG:e}=await import("./puzzles-dynamic-unofficial-P3TW433I-cOWAxRTA.js");return{loopoverSVG:e}},[])).loopoverSVG};async function Is(e,t){return(await hr()).includes(t)?_e(e,t):(console.warn(`Unsupported stickering for ${e.id}: ${t}. Setting all pieces to dim.`),_e(e,"full"))}var zs=Kn(()=>ft("megaminx"));function hr(){return zs}var Ds={KeyI:new o("R"),KeyK:new o("R'"),KeyW:new o("B"),KeyO:new o("B'"),KeyS:new o("FR"),KeyL:new o("FR'"),KeyD:new o("L"),KeyE:new o("L'"),KeyJ:new o("U"),KeyF:new o("U'"),KeyH:new o("F"),KeyG:new o("F'"),KeyC:new o("Lw"),KeyR:new o("Lw'"),KeyU:new o("Rw"),KeyM:new o("Rw'"),KeyX:new o("d"),Comma:new o("d'"),KeyT:new o("Rv"),KeyY:new o("Rv"),KeyV:new o("Rv'"),KeyN:new o("Rv'"),Semicolon:new o("y"),KeyA:new o("y'"),KeyP:new o("z"),KeyQ:new o("z'"),KeyZ:new o("2L'"),KeyB:new o("2R"),Period:new o("2R'"),Backquote:new F},Ts=class extends Z{constructor(){super({id:"megaminx",fullName:"Megaminx",inventionYear:1981})}stickeringMask(e){return Is(this,e)}stickerings=hr;llSVG=S(async()=>(await y(async()=>{const{megaminxLLSVG:e}=await import("./puzzles-dynamic-megaminx-2LVHIDL4-Cm8jQJ-N.js");return{megaminxLLSVG:e}},[])).megaminxLLSVG);keyMapping=async()=>Ds},As=new Ts,Es={id:"melindas2x2x2x2",fullName:"Melinda's 2222",inventedBy:["Melinda Green"],kpuzzle:S(async()=>new re((await y(async()=>{const{melindas2x2x2x2OrbitJSON:e}=await import("./puzzles-dynamic-side-events-IMYJ533P-uM0XY_nj.js");return{melindas2x2x2x2OrbitJSON:e}},[])).melindas2x2x2x2OrbitJSON)),svg:S(async()=>(await y(async()=>{const{melindas2x2x2x2OrbitSVG:e}=await import("./puzzles-dynamic-side-events-IMYJ533P-uM0XY_nj.js");return{melindas2x2x2x2OrbitSVG:e}},[])).melindas2x2x2x2OrbitSVG)},Ls=class extends Z{constructor(){super({id:"pyraminx",fullName:"Pyraminx",inventedBy:["Uwe Meffert"]})}svg=S(async()=>(await y(async()=>{const{pyraminxSVG:e}=await import("./puzzles-dynamic-side-events-IMYJ533P-uM0XY_nj.js");return{pyraminxSVG:e}},[])).pyraminxSVG);algTransformData={" Mirror (x)":{replaceMovesByFamily:{L:"R",R:"L",l:"r",r:"l",Lw:"Rw",Rw:"Lw",Lv:"Rv",Rv:"Lv"},invertExceptByFamily:new Set([])}}},ks=new Ls,Cs={id:"redi_cube",fullName:"Redi Cube",inventedBy:["Oskar van Deventer"],inventionYear:2009,kpuzzle:S(async()=>new re((await y(async()=>{const{rediCubeJSON:e}=await import("./puzzles-dynamic-unofficial-P3TW433I-cOWAxRTA.js");return{rediCubeJSON:e}},[])).rediCubeJSON)),svg:async()=>(await y(async()=>{const{rediCubeSVG:e}=await import("./puzzles-dynamic-unofficial-P3TW433I-cOWAxRTA.js");return{rediCubeSVG:e}},[])).rediCubeSVG},Ns={id:"square1",fullName:"Square-1",inventedBy:["Karel Hrel","Vojtech Kopsk"],inventionYear:1990,kpuzzle:S(async()=>new re((await y(async()=>{const{sq1HyperOrbitJSON:e}=await import("./puzzles-dynamic-side-events-IMYJ533P-uM0XY_nj.js");return{sq1HyperOrbitJSON:e}},[])).sq1HyperOrbitJSON)),svg:S(async()=>(await y(async()=>{const{sq1HyperOrbitSVG:e}=await import("./puzzles-dynamic-side-events-IMYJ533P-uM0XY_nj.js");return{sq1HyperOrbitSVG:e}},[])).sq1HyperOrbitSVG)},Ps={id:"tri_quad",fullName:"TriQuad",inventedBy:["Bram Cohen","Carl Hoff"],inventionYear:2018,kpuzzle:S(async()=>new re((await y(async()=>{const{triQuadJSON:e}=await import("./puzzles-dynamic-side-events-IMYJ533P-uM0XY_nj.js");return{triQuadJSON:e}},[])).triQuadJSON)),svg:S(async()=>(await y(async()=>{const{triQuadSVG:e}=await import("./puzzles-dynamic-side-events-IMYJ533P-uM0XY_nj.js");return{triQuadSVG:e}},[])).triQuadSVG)},pr={"3x3x3":qt,"2x2x2":cr,"4x4x4":Ue,"5x5x5":dt,"6x6x6":new Re({id:"6x6x6",fullName:"666 Cube"}),"7x7x7":new Re({id:"7x7x7",fullName:"777 Cube"}),"40x40x40":new Re({id:"40x40x40",fullName:"404040 Cube"}),clock:ys,megaminx:As,pyraminx:ks,skewb:new Z({id:"skewb",fullName:"Skewb",inventedBy:["Tony Durham"]}),square1:Ns,fto:Ss,gigaminx:new Z({id:"gigaminx",fullName:"Gigaminx",inventedBy:["Tyler Fox"],inventionYear:2006}),master_tetraminx:new Z({pgID:"master tetraminx",id:"master_tetraminx",fullName:"Master Tetraminx",inventedBy:["Katsuhiko Okamoto"],inventionYear:2002}),kilominx:bs,redi_cube:Cs,melindas2x2x2x2:Es,loopover:Ms,tri_quad:Ps,baby_fto:ws},gt=class{#e=0;#t=0;queue(e){return new Promise(async(t,n)=>{try{const r=++this.#e,i=await e;r>this.#t&&(this.#t=r,t(i))}catch(r){n(r)}})}},fr=0,gr=class{canReuse(e,t){return e===t||this.canReuseValue(e,t)}canReuseValue(e,t){return!1}debugGetChildren(){return Array.from(this.#e.values())}#e=new Set;addChild(e){this.#e.add(e)}removeChild(e){this.#e.delete(e)}lastSourceGeneration=0;markStale(e){if(e.detail.generation!==fr)throw new Error("A TwistyProp was marked stale too late!");if(this.lastSourceGeneration!==e.detail.generation){this.lastSourceGeneration=e.detail.generation;for(const t of this.#e)t.markStale(e);this.#n()}}#t=new Set;addRawListener(e,t){this.#t.add(e),t?.initial&&e()}removeRawListener(e){this.#t.delete(e)}#n(){this.#r||(this.#r=!0,setTimeout(()=>this.#s(),0))}#r=!1;#s(){if(!this.#r)throw new Error("Invalid dispatch state!");for(const e of this.#t)e();this.#r=!1}#i=new Map;addFreshListener(e){const t=new gt;let n=null;const r=async()=>{const i=await t.queue(this.get());n!==null&&this.canReuse(n,i)||(n=i,e(i))};this.#i.set(e,r),this.addRawListener(r,{initial:!0})}removeFreshListener(e){this.removeRawListener(this.#i.get(e)),this.#i.delete(e)}},le=class extends gr{#e;constructor(e){super(),this.#e=Kn(()=>this.getDefaultValue()),e&&(this.#e=this.deriveFromPromiseOrValue(e,this.#e))}set(e){this.#e=this.deriveFromPromiseOrValue(e,this.#e);const t={sourceProp:this,value:this.#e,generation:++fr};this.markStale(new CustomEvent("stale",{detail:t}))}async get(){return this.#e}async deriveFromPromiseOrValue(e,t){return this.derive(await e,t)}},b=class extends le{derive(e){return e}},je=Symbol("no value"),z=class extends gr{constructor(e,t){super(),this.userVisibleErrorTracker=t,this.#e=e;for(const n of Object.values(e))n.addChild(this)}#e;#t=null;#n=null;async get(){const e=this.lastSourceGeneration;if(this.#n?.generation===e)return this.#n.output;const t={generation:e,output:this.#s(this.#r(),e,this.#t)};return this.#n=t,this.userVisibleErrorTracker?.reset(),t.output}async#r(){const e={};for(const[n,r]of Object.entries(this.#e))e[n]=r.get();const t={};for(const n in this.#e)t[n]=await e[n];return t}async#s(e,t,n=null){const r=await e,i=a=>(this.#t={inputs:r,output:Promise.resolve(a),generation:t},a);if(!n)return i(await this.derive(r));const s=n.inputs;for(const a in this.#e)if(!this.#e[a].canReuse(r[a],s[a]))return i(await this.derive(r));return n.output}},He=class{#e=[];addListener(e,t){let n=!1;const r=i=>{n||t(i)};e.addFreshListener(r),this.#e.push(()=>{e.removeFreshListener(r),n=!0})}addMultiListener3(e,t){this.addMultiListener(e,t)}addMultiListener(e,t){let n=!1,r=e.length-1;const i=async s=>{if(r>0){r--;return}if(n)return;const a=e.map(u=>u.get()),l=await Promise.all(a);t(l)};for(const s of e)s.addFreshListener(i);this.#e.push(()=>{for(const s of e)s.removeFreshListener(i);n=!0})}disconnect(){for(const e of this.#e)e()}},Rs=class{},qe;globalThis.HTMLElement?qe=globalThis.HTMLElement:qe=Rs;var Os=class{define(){}},R;globalThis.customElements?R=globalThis.customElements:R=new Os;var W,Bs=class{replaceSync(){}};globalThis.CSSStyleSheet?W=globalThis.CSSStyleSheet:W=Bs;var H=class extends qe{shadow;contentWrapper;constructor(e){super(),this.shadow=this.attachShadow({mode:e?.mode??"closed"}),this.contentWrapper=document.createElement("div"),this.contentWrapper.classList.add("wrapper"),this.shadow.appendChild(this.contentWrapper)}addCSS(e){this.shadow.adoptedStyleSheets.push(e)}removeCSS(e){const t=this.shadow.adoptedStyleSheets.indexOf(e);typeof t<"u"&&this.shadow.adoptedStyleSheets.splice(t,t+1)}addElement(e){return this.contentWrapper.appendChild(e)}prependElement(e){this.contentWrapper.prepend(e)}removeElement(e){return this.contentWrapper.removeChild(e)}};R.define("twisty-managed-custom-element",H);var Ee=class{constructor(e){this.callback=e}animFrameID=null;animFrame=this.animFrameWrapper.bind(this);requestIsPending(){return!!this.animFrameID}requestAnimFrame(){this.animFrameID||(this.animFrameID=requestAnimationFrame(this.animFrame))}cancelAnimFrame(){this.animFrameID&&(cancelAnimationFrame(this.animFrameID),this.animFrameID=0)}animFrameWrapper(e){this.animFrameID=0,this.callback(e)}},Fs={floating:!0,none:!0},_s=class extends b{getDefaultValue(){return"auto"}},Vs=Math.PI*2,Ge=360/Vs,Us=null;async function J(){return Us??=y(()=>import("./twisty-dynamic-3d-IKE4BUQG-BfVzbxDG.js"),[])}function Ct(){return devicePixelRatio||1}var un=.1,js=class extends EventTarget{constructor(e){super(),this.target=e}#e=new Map;start(){this.addTargetListener("pointerdown",this.onPointerDown.bind(this)),this.addTargetListener("contextmenu",e=>{e.preventDefault()}),this.addTargetListener("touchmove",e=>e.preventDefault()),this.addTargetListener("dblclick",e=>e.preventDefault())}stop(){for(const[e,t]of this.#t.entries())this.target.removeEventListener(e,t);this.#t.clear(),this.#n=!1}#t=new Map;addTargetListener(e,t){this.#t.has(e)||(this.target.addEventListener(e,t),this.#t.set(e,t))}#n=!1;#r(){this.#n||(this.addTargetListener("pointermove",this.onPointerMove.bind(this)),this.addTargetListener("pointerup",this.onPointerUp.bind(this)),this.#n=!0)}#s(e){this.#e.delete(e.pointerId)}#i(e){const t=this.#e.get(e.pointerId);if(!t)return{movementInfo:null,hasMoved:!1};let n;return(e.movementX??0)!==0||(e.movementY??0)!==0?n={attachedInfo:t.attachedInfo,movementX:e.movementX,movementY:e.movementY,elapsedMs:e.timeStamp-t.lastTimeStamp}:n={attachedInfo:t.attachedInfo,movementX:e.clientX-t.lastClientX,movementY:e.clientY-t.lastClientY,elapsedMs:e.timeStamp-t.lastTimeStamp},t.lastClientX=e.clientX,t.lastClientY=e.clientY,t.lastTimeStamp=e.timeStamp,Math.abs(n.movementX)<un&&Math.abs(n.movementY)<un?{movementInfo:null,hasMoved:t.hasMoved}:(t.hasMoved=!0,{movementInfo:n,hasMoved:t.hasMoved})}onPointerDown(e){this.#r();const t={attachedInfo:{},hasMoved:!1,lastClientX:e.clientX,lastClientY:e.clientY,lastTimeStamp:e.timeStamp};this.#e.set(e.pointerId,t),this.target.setPointerCapture(e.pointerId)}onPointerMove(e){const t=this.#i(e).movementInfo;t&&(e.preventDefault(),this.dispatchEvent(new CustomEvent("move",{detail:t})))}onPointerUp(e){const t=this.#i(e),n=this.#e.get(e.pointerId);this.#s(e),this.target.releasePointerCapture(e.pointerId);let r;if(t.hasMoved)r=new CustomEvent("up",{detail:{attachedInfo:n.attachedInfo}});else{const{altKey:i,ctrlKey:s,metaKey:a,shiftKey:l}=e;r=new CustomEvent("press",{detail:{normalizedX:e.offsetX/this.target.offsetWidth*2-1,normalizedY:1-e.offsetY/this.target.offsetHeight*2,rightClick:!!(e.button&2),keys:{altKey:i,ctrlOrMetaKey:s||a,shiftKey:l}}})}this.dispatchEvent(r)}},Be=[];async function vr(e,t,n,r){Be.length===0&&Be.push(Gt());const i=await Be[0];return i.setSize(e,t),i.render(n,r),i.domElement}async function qs(e,t,n,r,i){if(e===0||t===0)return;Be.length===0&&Be.push(Gt());const s=await vr(e,t,r,i),a=n.getContext("2d");a.clearRect(0,0,n.width,n.height),a.drawImage(s,0,0)}var Gs="srgb-linear";async function Gt(){const e=(await J()).ThreeWebGLRenderer,t=new e({antialias:!0,alpha:!0});return t.outputColorSpace=Gs,t.setPixelRatio(Ct()),t}var wr=new W;wr.replaceSync(`
:host {
  width: 384px;
  height: 256px;
  display: grid;
}

.wrapper {
  width: 100%;
  height: 100%;
  display: grid;
  overflow: hidden;
  place-content: center;
  contain: strict;
}

.loading {
  width: 4em;
  height: 4em;
  border-radius: 2.5em;
  border: 0.5em solid rgba(0, 0, 0, 0);
  border-top: 0.5em solid rgba(0, 0, 0, 0.7);
  border-right: 0.5em solid rgba(0, 0, 0, 0.7);
  animation: fade-in-delayed 4s, rotate 1s linear infinite;
}

@keyframes fade-in-delayed {
  0% { opacity: 0; }
  25% {opacity: 0; }
  100% { opacity: 1; }
}

@keyframes rotate {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

/* TODO: This is due to stats hack. Replace with \`canvas\`. */
.wrapper > canvas {
  max-width: 100%;
  max-height: 100%;
  animation: fade-in 0.25s ease-in;
}

@keyframes fade-in {
  from { opacity: 0; }
  to { opacity: 1; }
}

.wrapper.invisible {
  opacity: 0;
}

.wrapper.drag-input-enabled > canvas {
  cursor: grab;
}

.wrapper.drag-input-enabled > canvas:active {
  cursor: grabbing;
}
`);var Ws=!0,yt=500,$s=50,Qs=.75;function dn(e){return(Math.exp(1-e)-(1-e))/(1-Math.E)+1}var Hs=class{constructor(e,t,n,r){this.startTimestamp=e,this.momentumX=t,this.momentumY=n,this.callback=r,this.scheduler.requestAnimFrame(),this.lastTimestamp=e}scheduler=new Ee(this.render.bind(this));lastTimestamp;render(e){const t=(this.lastTimestamp-this.startTimestamp)/yt,n=Math.min(1,(e-this.startTimestamp)/yt);if(t===0&&n>$s/yt)return;const r=dn(n)-dn(t);this.callback(this.momentumX*r*1e3,this.momentumY*r*1e3),n<1&&this.scheduler.requestAnimFrame(),this.lastTimestamp=e}},Ks=class{constructor(e,t,n,r){this.model=e,this.mirror=t,this.canvas=n,this.dragTracker=r,this.dragTracker.addEventListener("move",this.onMove.bind(this)),this.dragTracker.addEventListener("up",this.onUp.bind(this))}experimentalInertia=Ws;onMovementBound=this.onMovement.bind(this);experimentalHasBeenMoved=!1;temperMovement(e){return Math.sign(e)*Math.log(Math.abs(e*10)+1)/6}onMove(e){e.detail.attachedInfo??={};const{temperedX:t,temperedY:n}=this.onMovement(e.detail.movementX,e.detail.movementY),r=e.detail.attachedInfo;r.lastTemperedX=t*10,r.lastTemperedY=n*10,r.timestamp=e.timeStamp}onMovement(e,t){const n=this.mirror?-1:1,r=Math.min(this.canvas.offsetWidth,this.canvas.offsetHeight),i=this.temperMovement(e/r),s=this.temperMovement(t/r*Qs);return this.model.twistySceneModel.orbitCoordinatesRequest.set((async()=>{const a=await this.model.twistySceneModel.orbitCoordinates.get();return{latitude:a.latitude+2*s*Ge*n,longitude:a.longitude-2*i*Ge}})()),{temperedX:i,temperedY:s}}onUp(e){e.preventDefault(),"lastTemperedX"in e.detail.attachedInfo&&"lastTemperedY"in e.detail.attachedInfo&&"timestamp"in e.detail.attachedInfo&&e.timeStamp-e.detail.attachedInfo.timestamp<60&&new Hs(e.timeStamp,e.detail.attachedInfo.lastTemperedX,e.detail.attachedInfo.lastTemperedY,this.onMovementBound)}};async function yr(e,t,n=!1){const r=new(await J()).ThreeSpherical(t.distance,(90-(n?-1:1)*t.latitude)/Ge,((n?180:0)+t.longitude)/Ge);r.makeSafe(),e.position.setFromSpherical(r),e.lookAt(0,0,0)}var mn=0,Ys=2,xr=!1;function Xs(){return mn<Ys?(mn++,!1):(xr=!0,!0)}function tc(){return xr}var Nt=class extends H{constructor(e,t,n){super(),this.model=e,this.options=n,this.scene=t??null,this.loadingElement=this.addElement(document.createElement("div")),this.loadingElement.classList.add("loading")}scene=null;stats=null;rendererIsShared=Xs();loadingElement=null;async connectedCallback(){this.addCSS(wr),this.addElement((await this.canvasInfo()).canvas),this.#s(),new ResizeObserver(this.#s.bind(this)).observe(this.contentWrapper),this.orbitControls(),this.#e(),this.scheduleRender()}async#e(){(await this.#l()).addEventListener("press",(async t=>{await this.model.twistySceneModel.movePressInput.get()==="basic"&&this.dispatchEvent(new CustomEvent("press",{detail:{pressInfo:t.detail,cameraPromise:this.camera()}}))}))}#t=new gt;async clearCanvas(){if(this.rendererIsShared){const e=await this.canvasInfo();e.context.clearRect(0,0,e.canvas.width,e.canvas.height)}else{const t=(await this.renderer()).getContext();t.clear(t.COLOR_BUFFER_BIT)}}#n=0;#r=0;async#s(){const e=await this.#t.queue(this.camera()),t=this.contentWrapper.clientWidth,n=this.contentWrapper.clientHeight;this.#n=t,this.#r=n;const r=0;let i=0,s=0;if(n>t&&(s=n-t,i=-Math.floor(.5*s)),e.aspect=t/n,e.setViewOffset(t,n-s,r,i,t,n),e.updateProjectionMatrix(),this.clearCanvas(),this.rendererIsShared){const a=await this.canvasInfo();a.canvas.width=t*Ct(),a.canvas.height=n*Ct(),a.canvas.style.width=`${t.toString()}px`,a.canvas.style.height=`${n.toString()}px`}else(await this.renderer()).setSize(t,n,!0);this.scheduleRender()}#i=null;async renderer(){if(this.rendererIsShared)throw new Error("renderer expected to be shared.");return this.#i??=Gt()}#a=null;async canvasInfo(){return this.#a??=(async()=>{let e;if(this.rendererIsShared)e=this.addElement(document.createElement("canvas"));else{const n=await this.renderer();e=this.addElement(n.domElement)}this.loadingElement?.remove();const t=e.getContext("2d");return{canvas:e,context:t}})()}#o=null;async#l(){return this.#o??=(async()=>{const e=new js((await this.canvasInfo()).canvas);return this.model?.twistySceneModel.dragInput.addFreshListener(t=>{let n=!1;switch(t){case"auto":{e.start(),n=!0;break}case"none":{e.stop();break}}this.contentWrapper.classList.toggle("drag-input-enabled",n)}),e})()}#u=null;async camera(){return this.#u??=(async()=>{const e=new(await J()).ThreePerspectiveCamera(20,1,.1,20);return e.position.copy(new(await J()).ThreeVector3(2,4,4).multiplyScalar(this.options?.backView?-1:1)),e.lookAt(0,0,0),e})()}#d=null;async orbitControls(){return this.#d??=(async()=>{const e=new Ks(this.model,!!this.options?.backView,(await this.canvasInfo()).canvas,await this.#l());return this.model&&this.addListener(this.model.twistySceneModel.orbitCoordinates,async t=>{const n=await this.camera();yr(n,t,this.options?.backView),this.scheduleRender()}),e})()}addListener(e,t){e.addFreshListener(t),this.#c.push(()=>{e.removeFreshListener(t)})}#c=[];disconnect(){for(const e of this.#c)e();this.#c=[]}#m=null;experimentalNextRenderFinishedCallback(e){this.#m=e}async render(){if(!this.scene)throw new Error("Attempted to render without a scene");this.stats?.begin();const[e,t,n]=await Promise.all([this.scene.scene(),this.camera(),this.canvasInfo()]);this.rendererIsShared?await qs(this.#n,this.#r,n.canvas,e,t):(await this.renderer()).render(e,t),this.stats?.end(),this.#m?.(),this.#m=null}#h=new Ee(this.render.bind(this));scheduleRender(){this.#h.requestAnimFrame()}};R.define("twisty-3d-vantage",Nt);var Zs=class extends we{traverseAlg(e){let t=0;for(const n of e.childAlgNodes())t+=this.traverseAlgNode(n);return t}traverseGrouping(e){return this.traverseAlg(e.alg)*Math.abs(e.amount)}traverseMove(e){return 1}traverseCommutator(e){return 2*(this.traverseAlg(e.A)+this.traverseAlg(e.B))}traverseConjugate(e){return 2*this.traverseAlg(e.A)+this.traverseAlg(e.B)}traversePause(e){return 1}traverseNewline(e){return 0}traverseLineComment(e){return 0}},Js=U(Zs);function ea(e){return e.endsWith("v")||["x","y","z"].includes(e)?"Rotation":e.startsWith("2")||["M","E","S"].includes(e)?"Inner":"Outer"}var Ne;function ta(){if(Ne)return Ne;Ne={};const e=[...Object.keys(ut.moves),...Object.keys(ut.derivedMoves)];for(const t of e)Ne[t]=ea(t);return Ne}var Sr={OBTM:{Rotation:{constantFactor:0,amountFactor:0,zeroAmount:0},Outer:{constantFactor:1,amountFactor:0,zeroAmount:0},Inner:{constantFactor:2,amountFactor:0,zeroAmount:0}},RBTM:{Rotation:{constantFactor:0,amountFactor:0,zeroAmount:0},Outer:{constantFactor:1,amountFactor:0,zeroAmount:0},Inner:{constantFactor:1,amountFactor:0,zeroAmount:0}},OBQTM:{Rotation:{constantFactor:0,amountFactor:0,zeroAmount:0},Outer:{constantFactor:0,amountFactor:1,zeroAmount:0},Inner:{constantFactor:0,amountFactor:2,zeroAmount:0}},RBQTM:{Rotation:{constantFactor:0,amountFactor:0,zeroAmount:0},Outer:{constantFactor:0,amountFactor:1,zeroAmount:0},Inner:{constantFactor:0,amountFactor:1,zeroAmount:0}},ETM:{Rotation:{constantFactor:1,amountFactor:0,zeroAmount:1},Outer:{constantFactor:1,amountFactor:0,zeroAmount:1},Inner:{constantFactor:1,amountFactor:0,zeroAmount:1}}};function na(e,t){const n=Sr[e];if(!n)throw new Error(`Invalid metric for 3x3x3: ${e}`);const r=ta(),i=t.quantum.toString();if(!(i in r))throw new Error(`Invalid move for 3x3x3 ${e}: ${i}`);const s=r[i],{constantFactor:a,amountFactor:l,zeroAmount:u}=n[s];return t.amount===0?u:a+l*Math.abs(t.amount)}var Ke=class extends we{constructor(e){super(),this.metric=e}traverseAlg(e){let t=0;for(const n of e.childAlgNodes())t+=this.traverseAlgNode(n);return t}traverseGrouping(e){const t=e.alg;return this.traverseAlg(t)*Math.abs(e.amount)}traverseMove(e){return this.metric(e)}traverseCommutator(e){return 2*(this.traverseAlg(e.A)+this.traverseAlg(e.B))}traverseConjugate(e){return 2*this.traverseAlg(e.A)+this.traverseAlg(e.B)}traversePause(e){return 0}traverseNewline(e){return 0}traverseLineComment(e){return 0}},ra=class extends we{traverseAlg(e){let t=0;for(const n of e.childAlgNodes())t+=this.traverseAlgNode(n);return t}traverseGrouping(e){const t=e.alg;return this.traverseAlg(t)*Math.abs(e.amount)}traverseMove(e){return 1}traverseCommutator(e){return 2*(this.traverseAlg(e.A)+this.traverseAlg(e.B))}traverseConjugate(e){return 2*this.traverseAlg(e.A)+this.traverseAlg(e.B)}traversePause(e){return 1}traverseNewline(e){return 1}traverseLineComment(e){return 1}};function br(e){return"A"<=e&&e<="Z"}function ia(e){const t=e.family;return br(t[0])&&t[t.length-1]==="v"||t==="x"||t==="y"||t==="z"||t==="T"?0:1}function sa(e){return 1}function Mr(e){const t=e.family;return br(t[0])&&t[t.length-1]==="v"||t==="x"||t==="y"||t==="z"||t==="T"?0:1}function aa(e){return Math.abs(e.amount)*Mr(e)}U(Ke,[ia]);var oa=U(Ke,[sa]),la=U(Ke,[aa]),ca=U(Ke,[Mr]),ua=U(ra,[]);function da(e,t,n){if(e.id==="3x3x3"){if(t in Sr)return U(Ke,[r=>na(t,r)])(n)}else switch(t){case"ETM":return oa(n);case"RBTM":{if(e.pg)return ca(n);break}case"RBQTM":{if(e.pg)return la(n);break}}throw new Error("Unsupported puzzle or metric.")}function he(e){switch(Math.abs(e)){case 0:return 0;case 1:return 1e3;case 2:return 1500;default:return 2e3}}var Ir=class extends we{constructor(e=he){super(),this.durationForAmount=e}traverseAlg(e){let t=0;for(const n of e.childAlgNodes())t+=this.traverseAlgNode(n);return t}traverseGrouping(e){return e.amount*this.traverseAlg(e.alg)}traverseMove(e){return this.durationForAmount(e.amount)}traverseCommutator(e){return 2*(this.traverseAlg(e.A)+this.traverseAlg(e.B))}traverseConjugate(e){return 2*this.traverseAlg(e.A)+this.traverseAlg(e.B)}traversePause(e){return this.durationForAmount(1)}traverseNewline(e){return this.durationForAmount(1)}traverseLineComment(e){return this.durationForAmount(0)}},ma=class{constructor(e,t){this.kpuzzle=e,this.moves=new f(t.experimentalExpand())}moves;durationFn=new Ir(he);getAnimLeaf(e){return Array.from(this.moves.childAlgNodes())[e]}indexToMoveStartTimestamp(e){const t=new f(Array.from(this.moves.childAlgNodes()).slice(0,e));return this.durationFn.traverseAlg(t)}timestampToIndex(e){let t=0,n;for(n=0;n<this.numAnimatedLeaves();n++)if(t+=this.durationFn.traverseMove(this.getAnimLeaf(n)),t>=e)return n;return n}patternAtIndex(e){return this.kpuzzle.defaultPattern().applyTransformation(this.transformationAtIndex(e))}transformationAtIndex(e){let t=this.kpuzzle.identityTransformation();for(const n of Array.from(this.moves.childAlgNodes()).slice(0,e))t=t.applyMove(n);return t}algDuration(){return this.durationFn.traverseAlg(this.moves)}numAnimatedLeaves(){return Js(this.moves)}moveDuration(e){return this.durationFn.traverseMove(this.getAnimLeaf(e))}},ue=class{constructor(e,t,n,r,i=[]){this.moveCount=e,this.duration=t,this.forward=n,this.backward=r,this.children=i}},ha=class extends we{constructor(e){super(),this.kpuzzle=e,this.identity=e.identityTransformation(),this.dummyLeaf=new ue(0,0,this.identity,this.identity,[])}identity;dummyLeaf;durationFn=new Ir(he);cache={};traverseAlg(e){let t=0,n=0,r=this.identity;const i=[];for(const s of e.childAlgNodes()){const a=this.traverseAlgNode(s);t+=a.moveCount,n+=a.duration,r===this.identity?r=a.forward:r=r.applyTransformation(a.forward),i.push(a)}return new ue(t,n,r,r.invert(),i)}traverseGrouping(e){const t=this.traverseAlg(e.alg);return this.mult(t,e.amount,[t])}traverseMove(e){const t=e.toString();let n=this.cache[t];if(n)return n;const r=this.kpuzzle.moveToTransformation(e);return n=new ue(1,this.durationFn.traverseAlgNode(e),r,r.invert()),this.cache[t]=n,n}traverseCommutator(e){const t=this.traverseAlg(e.A),n=this.traverseAlg(e.B),r=t.forward.applyTransformation(n.forward),i=t.backward.applyTransformation(n.backward),s=r.applyTransformation(i),a=new ue(2*(t.moveCount+n.moveCount),2*(t.duration+n.duration),s,s.invert(),[t,n]);return this.mult(a,1,[a,t,n])}traverseConjugate(e){const t=this.traverseAlg(e.A),n=this.traverseAlg(e.B),i=t.forward.applyTransformation(n.forward).applyTransformation(t.backward),s=new ue(2*t.moveCount+n.moveCount,2*t.duration+n.duration,i,i.invert(),[t,n]);return this.mult(s,1,[s,t,n])}traversePause(e){return e.experimentalNISSGrouping?this.dummyLeaf:new ue(1,this.durationFn.traverseAlgNode(e),this.identity,this.identity)}traverseNewline(e){return this.dummyLeaf}traverseLineComment(e){return this.dummyLeaf}mult(e,t,n){const r=Math.abs(t),i=e.forward.selfMultiply(t);return new ue(e.moveCount*r,e.duration*r,i,i.invert(),n)}},P=class{constructor(e,t){this.apd=e,this.back=t}},pa=class extends ve{constructor(e,t,n){super(),this.kpuzzle=e,this.algOrAlgNode=t,this.apd=n,this.i=-1,this.dur=-1,this.goalIndex=-1,this.goalDuration=-1,this.move=void 0,this.back=!1,this.moveDuration=0,this.st=this.kpuzzle.identityTransformation(),this.root=new P(this.apd,!1)}move;moveDuration;back;st;root;i;dur;goalIndex;goalDuration;moveByIndex(e){return this.i>=0&&this.i===e?this.move!==void 0:this.dosearch(e,1/0)}moveByDuration(e){return this.dur>=0&&this.dur<e&&this.dur+this.moveDuration>=e?this.move!==void 0:this.dosearch(1/0,e)}dosearch(e,t){return this.goalIndex=e,this.goalDuration=t,this.i=0,this.dur=0,this.move=void 0,this.moveDuration=0,this.back=!1,this.st=this.kpuzzle.identityTransformation(),this.algOrAlgNode.is(f)?this.traverseAlg(this.algOrAlgNode,this.root):this.traverseAlgNode(this.algOrAlgNode,this.root)}traverseAlg(e,t){if(!this.firstcheck(t))return!1;let n=t.back?e.experimentalNumChildAlgNodes()-1:0;for(const r of yi(e.childAlgNodes(),t.back?-1:1)){if(this.traverseAlgNode(r,new P(t.apd.children[n],t.back)))return!0;n+=t.back?-1:1}return!1}traverseGrouping(e,t){if(!this.firstcheck(t))return!1;const n=this.domult(t,e.amount);return this.traverseAlg(e.alg,new P(t.apd.children[0],n))}traverseMove(e,t){return this.firstcheck(t)?(this.move=e,this.moveDuration=t.apd.duration,this.back=t.back,!0):!1}traverseCommutator(e,t){if(!this.firstcheck(t))return!1;const n=this.domult(t,1);return n?this.traverseAlg(e.B,new P(t.apd.children[2],!n))||this.traverseAlg(e.A,new P(t.apd.children[1],!n))||this.traverseAlg(e.B,new P(t.apd.children[2],n))||this.traverseAlg(e.A,new P(t.apd.children[1],n)):this.traverseAlg(e.A,new P(t.apd.children[1],n))||this.traverseAlg(e.B,new P(t.apd.children[2],n))||this.traverseAlg(e.A,new P(t.apd.children[1],!n))||this.traverseAlg(e.B,new P(t.apd.children[2],!n))}traverseConjugate(e,t){if(!this.firstcheck(t))return!1;const n=this.domult(t,1);return n?this.traverseAlg(e.A,new P(t.apd.children[1],!n))||this.traverseAlg(e.B,new P(t.apd.children[2],n))||this.traverseAlg(e.A,new P(t.apd.children[1],n)):this.traverseAlg(e.A,new P(t.apd.children[1],n))||this.traverseAlg(e.B,new P(t.apd.children[2],n))||this.traverseAlg(e.A,new P(t.apd.children[1],!n))}traversePause(e,t){return this.firstcheck(t)?(this.move=e,this.moveDuration=t.apd.duration,this.back=t.back,!0):!1}traverseNewline(e,t){return!1}traverseLineComment(e,t){return!1}firstcheck(e){return e.apd.moveCount+this.i<=this.goalIndex&&e.apd.duration+this.dur<this.goalDuration?this.keepgoing(e):!0}domult(e,t){let n=e.back;if(t===0)return n;t<0&&(n=!n,t=-t);const r=e.apd.children[0],i=Math.min(Math.floor((this.goalIndex-this.i)/r.moveCount),Math.ceil((this.goalDuration-this.dur)/r.duration-1));return i>0&&this.keepgoing(new P(r,n),i),n}keepgoing(e,t=1){return this.i+=t*e.apd.moveCount,this.dur+=t*e.apd.duration,t!==1?e.back?this.st=this.st.applyTransformation(e.apd.backward.selfMultiply(t)):this.st=this.st.applyTransformation(e.apd.forward.selfMultiply(t)):e.back?this.st=this.st.applyTransformation(e.apd.backward):this.st=this.st.applyTransformation(e.apd.forward),!1}},fa=16;function ga(e,t){const n=new Tt,r=new Tt;for(const i of e.childAlgNodes())r.push(i),r.experimentalNumAlgNodes()>=t&&(n.push(new B(r.toAlg())),r.reset());return n.push(new B(r.toAlg())),n.toAlg()}var va=class extends we{traverseAlg(e){const t=e.experimentalNumChildAlgNodes();return t<fa?e:ga(e,Math.ceil(Math.sqrt(t)))}traverseGrouping(e){return new B(this.traverseAlg(e.alg),e.amount)}traverseMove(e){return e}traverseCommutator(e){return new O(this.traverseAlg(e.A),this.traverseAlg(e.B))}traverseConjugate(e){return new O(this.traverseAlg(e.A),this.traverseAlg(e.B))}traversePause(e){return e}traverseNewline(e){return e}traverseLineComment(e){return e}},wa=U(va),hn=class{constructor(e,t){this.kpuzzle=e;const n=new ha(this.kpuzzle),r=wa(t);this.decoration=n.traverseAlg(r),this.walker=new pa(this.kpuzzle,r,this.decoration)}decoration;walker;getAnimLeaf(e){if(this.walker.moveByIndex(e)){if(!this.walker.move)throw new Error("`this.walker.mv` missing");const t=this.walker.move;return this.walker.back?t.invert():t}return null}indexToMoveStartTimestamp(e){if(this.walker.moveByIndex(e)||this.walker.i===e)return this.walker.dur;throw new Error(`Out of algorithm: index ${e}`)}indexToMovesInProgress(e){if(this.walker.moveByIndex(e)||this.walker.i===e)return this.walker.dur;throw new Error(`Out of algorithm: index ${e}`)}patternAtIndex(e,t){return this.walker.moveByIndex(e),(t??this.kpuzzle.defaultPattern()).applyTransformation(this.walker.st)}transformationAtIndex(e){return this.walker.moveByIndex(e),this.walker.st}numAnimatedLeaves(){return this.decoration.moveCount}timestampToIndex(e){return this.walker.moveByDuration(e),this.walker.i}algDuration(){return this.decoration.duration}moveDuration(e){return this.walker.moveByIndex(e),this.walker.moveDuration}},ya=class extends b{getDefaultValue(){return"auto"}},tt="http://www.w3.org/2000/svg",pn="data-copy-id",fn=0;function xa(){return fn+=1,`svg${fn.toString()}`}var Sa={dim:{white:"#dddddd",orange:"#884400",limegreen:"#008800",red:"#660000","rgb(34, 102, 255)":"#000088",yellow:"#888800","rgb(102, 0, 153)":"rgb(50, 0, 76)",purple:"#3f003f"},oriented:"#44ddcc",ignored:"#555555",invisible:"#00000000"},ba=class{constructor(e,t,n,r=!1){if(this.kpuzzle=e,this.showUnknownOrientations=r,!t)throw new Error(`No SVG definition for puzzle type: ${e.name()}`);this.svgID=xa(),this.wrapperElement=document.createElement("div"),this.wrapperElement.classList.add("svg-wrapper"),this.wrapperElement.innerHTML=t;const i=this.wrapperElement.querySelector("svg");if(!i)throw new Error("Could not get SVG element");if(this.svgElement=i,tt!==i.namespaceURI)throw new Error("Unexpected XML namespace");i.style.maxWidth="100%",i.style.maxHeight="100%",this.gradientDefs=document.createElementNS(tt,"defs"),i.insertBefore(this.gradientDefs,i.firstChild);for(const s of e.definition.orbits)for(let a=0;a<s.numPieces;a++)for(let l=0;l<s.numOrientations;l++){const u=this.elementID(s.orbitName,a,l),c=this.elementByID(u);let d=c?.style.fill;n?(()=>{const m=n.orbits;if(!m)return;const h=m[s.orbitName];if(!h)return;const v=h.pieces[a];if(!v)return;const p=v.facelets[l];if(!p)return;const M=typeof p=="string"?p:p?.mask,T=Sa[M];typeof T=="string"?d=T:T&&(d=T[d])})():d=c?.style.fill,this.originalColors[u]=d,this.gradients[u]=this.newGradient(u,d),this.gradientDefs.appendChild(this.gradients[u]),c?.setAttribute("style",`fill: url(#grad-${this.svgID}-${u})`)}for(const s of Array.from(i.querySelectorAll(`[${pn}]`))){const a=s.getAttribute(pn);s.setAttribute("style",`fill: url(#grad-${this.svgID}-${a})`)}this.showUnknownOrientations&&this.drawPattern(this.kpuzzle.defaultPattern())}wrapperElement;svgElement;gradientDefs;originalColors={};gradients={};svgID;drawPattern(e,t,n){this.draw(e,t,n)}draw(e,t,n){const r=t?.experimentalToTransformation();if(!e)throw new Error("Distinguishable pieces are not handled for SVG yet!");for(const i of e.kpuzzle.definition.orbits){const s=e.patternData[i.orbitName],a=r?r.transformationData[i.orbitName]:null;for(let l=0;l<i.numPieces;l++)for(let u=0;u<i.numOrientations;u++){const c=this.elementID(i.orbitName,l,u),d=this.elementID(i.orbitName,s.pieces[l],(i.numOrientations-s.orientation[l]+u)%i.numOrientations);let m=!1;if(a){const h=this.elementID(i.orbitName,a.permutation[l],(i.numOrientations-a.orientationDelta[l]+u)%i.numOrientations);d===h&&(m=!0),n=n||0;const v=100*(1-n*n*(2-n*n));this.gradients[c].children[0].setAttribute("stop-color",this.originalColors[d]),this.gradients[c].children[0].setAttribute("offset",`${Math.max(v-5,0)}%`),this.gradients[c].children[1].setAttribute("offset",`${Math.max(v-5,0)}%`),this.gradients[c].children[2].setAttribute("offset",`${v}%`),this.gradients[c].children[3].setAttribute("offset",`${v}%`),this.gradients[c].children[3].setAttribute("stop-color",this.originalColors[h])}else m=!0;m&&(this.showUnknownOrientations&&s.orientationMod?.[l]===1?(this.gradients[c].children[0].setAttribute("stop-color","#000"),this.gradients[c].children[0].setAttribute("offset","5%"),this.gradients[c].children[1].setAttribute("offset","5%"),this.gradients[c].children[2].setAttribute("offset","20%"),this.gradients[c].children[3].setAttribute("offset","20%"),this.gradients[c].children[3].setAttribute("stop-color",this.originalColors[d])):(this.gradients[c].children[0].setAttribute("stop-color",this.originalColors[d]),this.gradients[c].children[0].setAttribute("offset","100%"),this.gradients[c].children[1].setAttribute("offset","100%"),this.gradients[c].children[2].setAttribute("offset","100%"),this.gradients[c].children[3].setAttribute("offset","100%")))}}}newGradient(e,t){const n=document.createElementNS(tt,"radialGradient");n.setAttribute("id",`grad-${this.svgID}-${e}`),n.setAttribute("r","70.7107%");const r=[{offset:0,color:t},{offset:0,color:"black"},{offset:0,color:"black"},{offset:0,color:t}];for(const i of r){const s=document.createElementNS(tt,"stop");s.setAttribute("offset",`${i.offset}%`),s.setAttribute("stop-color",i.color),s.setAttribute("stop-opacity","1"),n.appendChild(s)}return n}elementID(e,t,n){return`${e}-l${t}-o${n}`}elementByID(e){return this.wrapperElement.querySelector(`#${e}`)}},Ye=class{constructor(e,t,n){this.elem=e,this.prefix=t,this.validSuffixes=n}#e=null;clearValue(){this.#e&&this.elem.contentWrapper.classList.remove(this.#e),this.#e=null}setValue(e){if(!this.validSuffixes.includes(e))throw new Error(`Invalid suffix: ${e}`);const t=`${this.prefix}${e}`,n=this.#e!==t;return n&&(this.clearValue(),this.elem.contentWrapper.classList.add(t),this.#e=t),n}};function Pt(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function gn(e,t,n){if(e===t)return!0;if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!n(e[r],t[r]))return!1;return!0}function Rt(e,t,n){return qn(e,n-t,t)}var Ma=class{constructor(e){this.model=e,e.tempoScale.addFreshListener(t=>{this.tempoScale=t})}catchingUp=!1;pendingFrame=!1;tempoScale=1;scheduler=new Ee(this.animFrame.bind(this));start(){this.catchingUp||(this.lastTimestamp=performance.now()),this.catchingUp=!0,this.pendingFrame=!0,this.scheduler.requestAnimFrame()}stop(){this.catchingUp=!1,this.scheduler.cancelAnimFrame()}catchUpMs=500;lastTimestamp=0;animFrame(e){this.scheduler.requestAnimFrame();const t=this.tempoScale*(e-this.lastTimestamp)/this.catchUpMs;this.lastTimestamp=e,this.model.catchUpMove.set((async()=>{const n=await this.model.catchUpMove.get();if(n.move===null)return n;const r=n.amount+t;return r>=1?(this.pendingFrame=!0,this.stop(),this.model.timestampRequest.set("end"),{move:null,amount:0}):(this.pendingFrame=!1,{move:n.move,amount:r})})())}},Ia=class{constructor(e,t){this.delegate=t,this.model=e,this.lastTimestampPromise=this.#e(),this.model.playingInfo.addFreshListener(this.onPlayingProp.bind(this)),this.catchUpHelper=new Ma(this.model),this.model.catchUpMove.addFreshListener(this.onCatchUpMoveProp.bind(this))}playing=!1;direction=1;catchUpHelper;model;lastDatestamp=0;lastTimestampPromise;scheduler=new Ee(this.animFrame.bind(this));async onPlayingProp(e){e.playing!==this.playing&&(e.playing?this.play(e):this.pause())}async onCatchUpMoveProp(e){const t=e.move!==null;t!==this.catchUpHelper.catchingUp&&(t?this.catchUpHelper.start():this.catchUpHelper.stop()),this.scheduler.requestAnimFrame()}async#e(){return(await this.model.detailedTimelineInfo.get()).timestamp}jumpToStart(e){this.model.timestampRequest.set("start"),this.pause(),e?.flash&&this.delegate.flash()}jumpToEnd(e){this.model.timestampRequest.set("end"),this.pause(),e?.flash&&this.delegate.flash()}playPause(){this.playing?this.pause():this.play()}play(e){(async()=>{const t=e?.direction??1,n=await this.model.coarseTimelineInfo.get();(e?.autoSkipToOtherEndIfStartingAtBoundary??!0)&&(t===1&&n.atEnd&&(this.model.timestampRequest.set("start"),this.delegate.flash()),t===-1&&n.atStart&&(this.model.timestampRequest.set("end"),this.delegate.flash())),this.model.playingInfo.set({playing:!0,direction:t,untilBoundary:e?.untilBoundary??"entire-timeline",loop:e?.loop??!1}),this.playing=!0,this.lastDatestamp=performance.now(),this.lastTimestampPromise=this.#e(),this.scheduler.requestAnimFrame()})()}pause(){this.playing=!1,this.scheduler.cancelAnimFrame(),this.model.playingInfo.set({playing:!1,untilBoundary:"entire-timeline"})}#t=new gt;async animFrame(e){this.playing&&this.scheduler.requestAnimFrame();const t=this.lastDatestamp,n=await this.#t.queue(Promise.all([this.model.playingInfo.get(),this.lastTimestampPromise,this.model.timeRange.get(),this.model.tempoScale.get(),this.model.currentMoveInfo.get()])),[r,i,s,a,l]=n;if(!r.playing){this.playing=!1;return}let u=l.earliestEnd;(l.currentMoves.length===0||r.untilBoundary==="entire-timeline")&&(u=s.end);let c=l.latestStart;(l.currentMoves.length===0||r.untilBoundary==="entire-timeline")&&(c=s.start);let d=(e-t)*this.direction*a;d=Math.max(d,1),d*=r.direction;let m=i+d,h=null;m>=u?r.loop?m=Rt(m,s.start,s.end):(m===s.end?h="end":m=u,this.playing=!1,this.model.playingInfo.set({playing:!1})):m<=c&&(r.loop?m=Rt(m,s.start,s.end):(m===s.start?h="start":m=c,this.playing=!1,this.model.playingInfo.set({playing:!1}))),this.lastDatestamp=e,this.lastTimestampPromise=Promise.resolve(m),this.model.timestampRequest.set(h??m)}},za=class{constructor(e,t){this.model=e,this.animationController=new Ia(e,t)}animationController;jumpToStart(e){this.animationController.jumpToStart(e)}jumpToEnd(e){this.animationController.jumpToEnd(e)}togglePlay(e){typeof e>"u"&&this.animationController.playPause(),e?this.animationController.play():this.animationController.pause()}async visitTwizzleLink(){const e=document.createElement("a");e.href=await this.model.twizzleLink(),e.target="_blank",e.click()}},Da={"bottom-row":!0,none:!0},Ta=class extends b{getDefaultValue(){return"auto"}},Wt=new W;Wt.replaceSync(`
:host {
  width: 384px;
  height: 256px;
  display: grid;
}

.wrapper {
  width: 100%;
  height: 100%;
  display: grid;
  overflow: hidden;
}

.wrapper > * {
  width: 100%;
  height: 100%;
  overflow: hidden;
}

.wrapper.back-view-side-by-side {
  grid-template-columns: 1fr 1fr;
}

.wrapper.back-view-top-right {
  grid-template-columns: 3fr 1fr;
  grid-template-rows: 1fr 3fr;
}

.wrapper.back-view-top-right > :nth-child(1) {
  grid-row: 1 / 3;
  grid-column: 1 / 3;
}

.wrapper.back-view-top-right > :nth-child(2) {
  grid-row: 1 / 2;
  grid-column: 2 / 3;
}
`);var zr=new W;zr.replaceSync(`
:host {
  width: 384px;
  height: 256px;
  display: grid;
}

.wrapper {
  width: 100%;
  height: 100%;
  display: grid;
  overflow: hidden;
}

.svg-wrapper,
twisty-2d-svg,
svg {
  width: 100%;
  height: 100%;
  display: grid;
  min-height: 0;
}

svg {
  animation: fade-in 0.25s ease-in;
}

@keyframes fade-in {
  from { opacity: 0; }
  to { opacity: 1; }
}

.hint-facelets-none .hint-facelet {
  display: none;
}
`);var Dr=class extends H{constructor(e,t,n,r,i){super(),this.model=e,this.kpuzzle=t,this.svgSource=n,this.options=r,this.puzzleLoader=i,this.addCSS(zr),this.resetSVG(),this.#t.addListener(this.model.puzzleID,s=>{i?.id!==s&&this.disconnect()}),this.#t.addListener(this.model.twistySceneModel.hintFacelet,s=>{this.setHintFacelet(s)}),this.#t.addListener(this.model.legacyPosition,this.onPositionChange.bind(this)),this.options?.experimentalStickeringMask&&this.experimentalSetStickeringMask(this.options.experimentalStickeringMask)}svgWrapper;scheduler=new Ee(this.render.bind(this));#e=null;#t=new He;disconnect(){this.#t.disconnect()}onPositionChange(e){try{if(e.movesInProgress.length>0){const t=e.movesInProgress[0].move;let n=t;e.movesInProgress[0].direction===-1&&(n=t.invert());const r=e.pattern.applyMove(n);this.svgWrapper?.draw(e.pattern,r,e.movesInProgress[0].fraction)}else this.svgWrapper?.draw(e.pattern),this.#e=e}catch(t){console.warn("Bad position (this doesn't necessarily mean something is wrong). Pre-emptively disconnecting:",this.puzzleLoader?.id,t),this.disconnect()}}scheduleRender(){this.scheduler.requestAnimFrame()}experimentalSetStickeringMask(e){this.resetSVG(e)}resetSVG(e){this.svgWrapper&&this.removeElement(this.svgWrapper.wrapperElement),this.kpuzzle&&(this.svgWrapper=new ba(this.kpuzzle,this.svgSource,e),this.addElement(this.svgWrapper.wrapperElement),this.#e&&this.onPositionChange(this.#e))}hintFaceletsClassListManager=new Ye(this,"hint-facelets-",Object.keys(Fs));setHintFacelet(e){this.hintFaceletsClassListManager.setValue(e==="auto"?"floating":e)}render(){}};R.define("twisty-2d-puzzle",Dr);var Aa=class{constructor(e,t,n,r){this.model=e,this.schedulable=t,this.puzzleLoader=n,this.effectiveVisualization=r,this.twisty2DPuzzle(),this.#e.addListener(this.model.twistySceneModel.stickeringMask,async i=>{(await this.twisty2DPuzzle()).experimentalSetStickeringMask(i)})}#e=new He;disconnect(){this.#e.disconnect()}scheduleRender(){}#t=null;async twisty2DPuzzle(){return this.#t??=(async()=>{const e=this.effectiveVisualization==="experimental-2D-LL-face"?this.puzzleLoader.llFaceSVG():this.effectiveVisualization==="experimental-2D-LL"?this.puzzleLoader.llSVG():this.puzzleLoader.svg();return new Dr(this.model,await this.puzzleLoader.kpuzzle(),await e,{},this.puzzleLoader)})()}},Tr=class extends H{constructor(e,t){super(),this.model=e,this.effectiveVisualization=t}#e=new He;disconnect(){this.#e.disconnect()}async connectedCallback(){this.addCSS(Wt),this.model&&this.#e.addListener(this.model.twistyPlayerModel.puzzleLoader,this.onPuzzleLoader.bind(this))}#t;async scene(){return this.#t??=(async()=>new(await J()).ThreeScene)()}scheduleRender(){this.#n?.scheduleRender()}#n;currentTwisty2DPuzzleWrapper(){return this.#n}async setCurrentTwisty2DPuzzleWrapper(e){const t=this.#n;this.#n=e,t?.disconnect();const n=e.twisty2DPuzzle();this.contentWrapper.textContent="",this.addElement(await n)}async onPuzzleLoader(e){this.#n?.disconnect();const t=new Aa(this.model.twistyPlayerModel,this,e,this.effectiveVisualization);this.setCurrentTwisty2DPuzzleWrapper(t)}};R.define("twisty-2d-scene-wrapper",Tr);var Ar=class{#e;reject;promise;constructor(){this.promise=new Promise((e,t)=>{this.#e=e,this.reject=t})}handleNewValue(e){this.#e(e)}},Er=class extends EventTarget{constructor(e,t,n,r){super(),this.model=e,this.schedulable=t,this.puzzleLoader=n,this.visualizationStrategy=r,this.twisty3DPuzzle(),this.#e.addListener(this.model.puzzleLoader,i=>{this.puzzleLoader.id!==i.id&&this.disconnect()}),this.#e.addListener(this.model.legacyPosition,async i=>{try{(await this.twisty3DPuzzle()).onPositionChange(i),this.scheduleRender()}catch{this.disconnect()}}),this.#e.addListener(this.model.twistySceneModel.hintFacelet,async i=>{(await this.twisty3DPuzzle()).experimentalUpdateOptions({hintFacelets:i==="auto"?"floating":i}),this.scheduleRender()}),this.#e.addListener(this.model.twistySceneModel.foundationDisplay,async i=>{(await this.twisty3DPuzzle()).experimentalUpdateOptions({showFoundation:i!=="none"}),this.scheduleRender()}),this.#e.addListener(this.model.twistySceneModel.stickeringMask,async i=>{(await this.twisty3DPuzzle()).setStickeringMask(i),this.scheduleRender()}),this.#e.addListener(this.model.twistySceneModel.faceletScale,async i=>{(await this.twisty3DPuzzle()).experimentalUpdateOptions({faceletScale:i}),this.scheduleRender()}),this.#e.addMultiListener3([this.model.twistySceneModel.stickeringMask,this.model.twistySceneModel.foundationStickerSprite,this.model.twistySceneModel.hintStickerSprite],async i=>{"experimentalUpdateTexture"in await this.twisty3DPuzzle()&&((await this.twisty3DPuzzle()).experimentalUpdateTexture(i[0].specialBehaviour==="picture",i[1],i[2]),this.scheduleRender())})}#e=new He;disconnect(){this.#e.disconnect()}scheduleRender(){this.schedulable.scheduleRender(),this.dispatchEvent(new CustomEvent("render-scheduled"))}#t=null;async twisty3DPuzzle(){return this.#t??=(async()=>{const e=J();if(this.puzzleLoader.id==="3x3x3"&&this.visualizationStrategy==="Cube3D"){const[t,n,r,i]=await Promise.all([this.model.twistySceneModel.foundationStickerSprite.get(),this.model.twistySceneModel.hintStickerSprite.get(),this.model.twistySceneModel.stickeringMask.get(),this.model.twistySceneModel.initialHintFaceletsAnimation.get()]);return(await e).cube3DShim(()=>this.schedulable.scheduleRender(),{foundationSprite:t,hintSprite:n,experimentalStickeringMask:r,initialHintFaceletsAnimation:i})}else{const[t,n,r,i]=await Promise.all([this.model.twistySceneModel.hintFacelet.get(),this.model.twistySceneModel.foundationStickerSprite.get(),this.model.twistySceneModel.hintStickerSprite.get(),this.model.twistySceneModel.faceletScale.get()]),s=(await e).pg3dShim(()=>this.schedulable.scheduleRender(),this.puzzleLoader,t==="auto"?"floating":t,i,this.puzzleLoader.id==="kilominx");return s.then(a=>a.experimentalUpdateTexture(!0,n??void 0,r??void 0)),s}})()}async raycastMove(e,t){const n=await this.twisty3DPuzzle();if(!("experimentalGetControlTargets"in n)){console.info("not PG3D! skipping raycast");return}const r=n.experimentalGetControlTargets(),[i,s]=await Promise.all([e,this.model.twistySceneModel.movePressCancelOptions.get()]),a=i.intersectObjects(r);if(a.length>0){const l=n.getClosestMoveToAxis(a[0].point,t);l?this.model.experimentalAddMove(l.move,{cancel:s}):console.info("Skipping move!")}}},Ot=class extends H{constructor(e){super(),this.model=e}#e=new Ye(this,"back-view-",["auto","none","side-by-side","top-right"]);#t=new He;disconnect(){this.#t.disconnect()}async connectedCallback(){this.addCSS(Wt);const e=new Nt(this.model,this);this.addVantage(e),this.model&&(this.#t.addMultiListener([this.model.puzzleLoader,this.model.visualizationStrategy],this.onPuzzle.bind(this)),this.#t.addListener(this.model.backView,this.setBackView.bind(this))),this.scheduleRender()}#n=null;setBackView(e){const t=["side-by-side","top-right"].includes(e),n=this.#n!==null;this.#e.setValue(e),t?n||(this.#n=new Nt(this.model,this,{backView:!0}),this.addVantage(this.#n),this.scheduleRender()):this.#n&&(this.removeVantage(this.#n),this.#n=null)}async onPress(e){const t=this.#i;if(!t){console.info("no wrapper; skipping scene wrapper press!");return}const n=(async()=>{const[r,{ThreeRaycaster:i,ThreeVector2:s}]=await Promise.all([e.detail.cameraPromise,(async()=>{const{ThreeRaycaster:u,ThreeVector2:c}=await J();return{ThreeRaycaster:u,ThreeVector2:c}})()]),a=new i,l=new s(e.detail.pressInfo.normalizedX,e.detail.pressInfo.normalizedY);return a.setFromCamera(l,r),a})();t.raycastMove(n,{invert:!e.detail.pressInfo.rightClick,depth:e.detail.pressInfo.keys.ctrlOrMetaKey?"rotation":e.detail.pressInfo.keys.shiftKey?"secondSlice":"none"})}#r;async scene(){return this.#r??=(async()=>new(await J()).ThreeScene)()}#s=new Set;addVantage(e){e.addEventListener("press",this.onPress.bind(this)),this.#s.add(e),this.contentWrapper.appendChild(e)}removeVantage(e){this.#s.delete(e),e.remove(),e.disconnect(),this.#i?.disconnect()}experimentalVantages(){return this.#s.values()}scheduleRender(){for(const e of this.#s)e.scheduleRender()}#i=null;async setCurrentTwisty3DPuzzleWrapper(e,t){const n=this.#i;try{this.#i=t,n?.disconnect(),e.add(await t.twisty3DPuzzle())}finally{n&&e.remove(await n.twisty3DPuzzle())}this.#a.handleNewValue(t)}#a=new Ar;async experimentalTwisty3DPuzzleWrapper(){return this.#i||this.#a.promise}#o=new gt;async onPuzzle(e){if(e[1]==="2D")return;this.#i?.disconnect();const[t,n]=await this.#o.queue(Promise.all([this.scene(),new Er(this.model,this,e[0],e[1])]));this.setCurrentTwisty3DPuzzleWrapper(t,n)}};R.define("twisty-3d-scene-wrapper",Ot);var ae=typeof document>"u"?null:document,Ea=ae?.fullscreenEnabled||!!ae?.webkitFullscreenEnabled;function La(){return document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen()}function vn(){return document.fullscreenElement?document.fullscreenElement:document.webkitFullscreenElement??null}function ka(e){return e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen()}var Ca=["skip-to-start","skip-to-end","step-forward","step-backward","pause","play","enter-fullscreen","exit-fullscreen","twizzle-tw"],Na=class extends z{derive(e){return{fullscreen:{enabled:Ea,icon:document.fullscreenElement===null?"enter-fullscreen":"exit-fullscreen",title:"Enter fullscreen"},"jump-to-start":{enabled:!e.coarseTimelineInfo.atStart,icon:"skip-to-start",title:"Restart"},"play-step-backwards":{enabled:!e.coarseTimelineInfo.atStart,icon:"step-backward",title:"Step backward"},"play-pause":{enabled:!(e.coarseTimelineInfo.atStart&&e.coarseTimelineInfo.atEnd),icon:e.coarseTimelineInfo.playing?"pause":"play",title:e.coarseTimelineInfo.playing?"Pause":"Play"},"play-step":{enabled:!e.coarseTimelineInfo.atEnd,icon:"step-forward",title:"Step forward"},"jump-to-end":{enabled:!e.coarseTimelineInfo.atEnd,icon:"skip-to-end",title:"Skip to End"},"twizzle-link":{enabled:!0,icon:"twizzle-tw",title:"View at Twizzle",hidden:e.viewerLink==="none"}}}},Lr=new W;Lr.replaceSync(`
:host {
  width: 384px;
  height: 24px;
  display: grid;
}

.wrapper {
  width: 100%;
  height: 100%;
  display: grid;
  overflow: hidden;
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
}

.wrapper {
  grid-auto-flow: column;
}

.viewer-link-none .twizzle-link-button {
  display: none;
}

.wrapper twisty-button,
.wrapper twisty-control-button {
  width: inherit;
  height: inherit;
}
`);var kr=new W;kr.replaceSync(`
:host:not([hidden]) {
  display: grid;
}

:host {
  width: 48px;
  height: 24px;
}

.wrapper {
  width: 100%;
  height: 100%;
}

button {
  width: 100%;
  height: 100%;
  border: none;
  
  background-position: center;
  background-repeat: no-repeat;
  background-size: contain;

  background-color: rgba(196, 196, 196, 0.75);
}

button:enabled {
  background-color: rgba(196, 196, 196, 0.75)
}

.dark-mode button:enabled {
  background-color: #88888888;
}

button:disabled {
  background-color: rgba(0, 0, 0, 0.4);
  opacity: 0.25;
  pointer-events: none;
}

.dark-mode button:disabled {
  background-color: #ffffff44;
}

button:enabled:hover {
  background-color: rgba(255, 255, 255, 0.75);
  box-shadow: 0 0 1em rgba(0, 0, 0, 0.25);
  cursor: pointer;
}

/* TODO: fullscreen icons have too much padding?? */
.svg-skip-to-start button,
button.svg-skip-to-start {
  background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNTg0IiBoZWlnaHQ9IjM1ODQiIHZpZXdCb3g9IjAgMCAzNTg0IDM1ODQiPjxwYXRoIGQ9Ik0yNjQzIDEwMzdxMTktMTkgMzItMTN0MTMgMzJ2MTQ3MnEwIDI2LTEzIDMydC0zMi0xM2wtNzEwLTcxMHEtOS05LTEzLTE5djcxMHEwIDI2LTEzIDMydC0zMi0xM2wtNzEwLTcxMHEtOS05LTEzLTE5djY3OHEwIDI2LTE5IDQ1dC00NSAxOUg5NjBxLTI2IDAtNDUtMTl0LTE5LTQ1VjEwODhxMC0yNiAxOS00NXQ0NS0xOWgxMjhxMjYgMCA0NSAxOXQxOSA0NXY2NzhxNC0xMSAxMy0xOWw3MTAtNzEwcTE5LTE5IDMyLTEzdDEzIDMydjcxMHE0LTExIDEzLTE5eiIvPjwvc3ZnPg==");
}

.svg-skip-to-end button,
button.svg-skip-to-end {
  background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNTg0IiBoZWlnaHQ9IjM1ODQiIHZpZXdCb3g9IjAgMCAzNTg0IDM1ODQiPjxwYXRoIGQ9Ik05NDEgMjU0N3EtMTkgMTktMzIgMTN0LTEzLTMyVjEwNTZxMC0yNiAxMy0zMnQzMiAxM2w3MTAgNzEwcTggOCAxMyAxOXYtNzEwcTAtMjYgMTMtMzJ0MzIgMTNsNzEwIDcxMHE4IDggMTMgMTl2LTY3OHEwLTI2IDE5LTQ1dDQ1LTE5aDEyOHEyNiAwIDQ1IDE5dDE5IDQ1djE0MDhxMCAyNi0xOSA0NXQtNDUgMTloLTEyOHEtMjYgMC00NS0xOXQtMTktNDV2LTY3OHEtNSAxMC0xMyAxOWwtNzEwIDcxMHEtMTkgMTktMzIgMTN0LTEzLTMydi03MTBxLTUgMTAtMTMgMTl6Ii8+PC9zdmc+");
}

.svg-step-forward button,
button.svg-step-forward {
  background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNTg0IiBoZWlnaHQ9IjM1ODQiIHZpZXdCb3g9IjAgMCAzNTg0IDM1ODQiPjxwYXRoIGQ9Ik0yNjg4IDE1NjhxMCAyNi0xOSA0NWwtNTEyIDUxMnEtMTkgMTktNDUgMTl0LTQ1LTE5cS0xOS0xOS0xOS00NXYtMjU2aC0yMjRxLTk4IDAtMTc1LjUgNnQtMTU0IDIxLjVxLTc2LjUgMTUuNS0xMzMgNDIuNXQtMTA1LjUgNjkuNXEtNDkgNDIuNS04MCAxMDF0LTQ4LjUgMTM4LjVxLTE3LjUgODAtMTcuNSAxODEgMCA1NSA1IDEyMyAwIDYgMi41IDIzLjV0Mi41IDI2LjVxMCAxNS04LjUgMjV0LTIzLjUgMTBxLTE2IDAtMjgtMTctNy05LTEzLTIydC0xMy41LTMwcS03LjUtMTctMTAuNS0yNC0xMjctMjg1LTEyNy00NTEgMC0xOTkgNTMtMzMzIDE2Mi00MDMgODc1LTQwM2gyMjR2LTI1NnEwLTI2IDE5LTQ1dDQ1LTE5cTI2IDAgNDUgMTlsNTEyIDUxMnExOSAxOSAxOSA0NXoiLz48L3N2Zz4=");
}

.svg-step-backward button,
button.svg-step-backward {
  background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNTg0IiBoZWlnaHQ9IjM1ODQiIHZpZXdCb3g9IjAgMCAzNTg0IDM1ODQiPjxwYXRoIGQ9Ik0yNjg4IDIwNDhxMCAxNjYtMTI3IDQ1MS0zIDctMTAuNSAyNHQtMTMuNSAzMHEtNiAxMy0xMyAyMi0xMiAxNy0yOCAxNy0xNSAwLTIzLjUtMTB0LTguNS0yNXEwLTkgMi41LTI2LjV0Mi41LTIzLjVxNS02OCA1LTEyMyAwLTEwMS0xNy41LTE4MXQtNDguNS0xMzguNXEtMzEtNTguNS04MC0xMDF0LTEwNS41LTY5LjVxLTU2LjUtMjctMTMzLTQyLjV0LTE1NC0yMS41cS03Ny41LTYtMTc1LjUtNmgtMjI0djI1NnEwIDI2LTE5IDQ1dC00NSAxOXEtMjYgMC00NS0xOWwtNTEyLTUxMnEtMTktMTktMTktNDV0MTktNDVsNTEyLTUxMnExOS0xOSA0NS0xOXQ0NSAxOXExOSAxOSAxOSA0NXYyNTZoMjI0cTcxMyAwIDg3NSA0MDMgNTMgMTM0IDUzIDMzM3oiLz48L3N2Zz4=");
}

.svg-pause button,
button.svg-pause {
  background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNTg0IiBoZWlnaHQ9IjM1ODQiIHZpZXdCb3g9IjAgMCAzNTg0IDM1ODQiPjxwYXRoIGQ9Ik0yNTYwIDEwODh2MTQwOHEwIDI2LTE5IDQ1dC00NSAxOWgtNTEycS0yNiAwLTQ1LTE5dC0xOS00NVYxMDg4cTAtMjYgMTktNDV0NDUtMTloNTEycTI2IDAgNDUgMTl0MTkgNDV6bS04OTYgMHYxNDA4cTAgMjYtMTkgNDV0LTQ1IDE5aC01MTJxLTI2IDAtNDUtMTl0LTE5LTQ1VjEwODhxMC0yNiAxOS00NXQ0NS0xOWg1MTJxMjYgMCA0NSAxOXQxOSA0NXoiLz48L3N2Zz4=");
}

.svg-play button,
button.svg-play {
  background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNTg0IiBoZWlnaHQ9IjM1ODQiIHZpZXdCb3g9IjAgMCAzNTg0IDM1ODQiPjxwYXRoIGQ9Ik0yNDcyLjUgMTgyM2wtMTMyOCA3MzhxLTIzIDEzLTM5LjUgM3QtMTYuNS0zNlYxMDU2cTAtMjYgMTYuNS0zNnQzOS41IDNsMTMyOCA3MzhxMjMgMTMgMjMgMzF0LTIzIDMxeiIvPjwvc3ZnPg==");
}

.svg-enter-fullscreen button,
button.svg-enter-fullscreen {
  background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjgiIHZpZXdCb3g9IjAgMCAyOCAyOCIgd2lkdGg9IjI4Ij48cGF0aCBkPSJNMiAyaDI0djI0SDJ6IiBmaWxsPSJub25lIi8+PHBhdGggZD0iTTkgMTZIN3Y1aDV2LTJIOXYtM3ptLTItNGgyVjloM1Y3SDd2NXptMTIgN2gtM3YyaDV2LTVoLTJ2M3pNMTYgN3YyaDN2M2gyVjdoLTV6Ii8+PC9zdmc+");
}

.svg-exit-fullscreen button,
button.svg-exit-fullscreen {
  background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjgiIHZpZXdCb3g9IjAgMCAyOCAyOCIgd2lkdGg9IjI4Ij48cGF0aCBkPSJNMiAyaDI0djI0SDJ6IiBmaWxsPSJub25lIi8+PHBhdGggZD0iTTcgMThoM3YzaDJ2LTVIN3Yyem0zLThIN3YyaDVWN2gtMnYzem02IDExaDJ2LTNoM3YtMmgtNXY1em0yLTExVjdoLTJ2NWg1di0yaC0zeiIvPjwvc3ZnPg==");
}

.svg-twizzle-tw button,
button.svg-twizzle-tw {
  background-image: url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODY0IiBoZWlnaHQ9IjYwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMzk3LjU4MSAxNTEuMTh2NTcuMDg0aC04OS43MDN2MjQwLjM1MmgtNjYuOTU1VjIwOC4yNjRIMTUxLjIydi01Ny4wODNoMjQ2LjM2MXptNTQuMzEgNzEuNjc3bDcuNTEyIDMzLjY5MmMyLjcxOCAxMi4xNiA1LjU4IDI0LjY4IDguNTg0IDM3LjU1NWEyMTgwLjc3NSAyMTgwLjc3NSAwIDAwOS40NDIgMzguODQzIDEyNjYuMyAxMjY2LjMgMCAwMDEwLjA4NiAzNy41NTVjMy43Mi0xMi41OSA3LjM2OC0yNS40NjYgMTAuOTQ1LTM4LjYyOCAzLjU3Ni0xMy4xNjIgNy4wMS0yNi4xMSAxMC4zLTM4Ljg0M2w1Ljc2OS0yMi40NTZjMS4yNDgtNC44ODcgMi40NzItOS43MDUgMy42NzQtMTQuNDU1IDMuMDA0LTExLjg3NSA1LjY1MS0yMi45NjIgNy45NC0zMy4yNjNoNDYuMzU0bDIuMzg0IDEwLjU2M2EyMDAwLjc3IDIwMDAuNzcgMCAwMDMuOTM1IDE2LjgyOGw2LjcxMSAyNy43MWMxLjIxMyA0Ljk1NiAyLjQ1IDkuOTggMy43MDkgMTUuMDczYTMxMTkuNzc3IDMxMTkuNzc3IDAgMDA5Ljg3MSAzOC44NDMgMTI0OS4yMjcgMTI0OS4yMjcgMCAwMDEwLjczIDM4LjYyOCAxOTA3LjYwNSAxOTA3LjYwNSAwIDAwMTAuMzAxLTM3LjU1NSAxMzk3Ljk0IDEzOTcuOTQgMCAwMDkuNjU3LTM4Ljg0M2w0LjQtMTkuMDQ2Yy43MTUtMy4xMyAxLjQyMS02LjIzNiAyLjExOC05LjMyMWw5LjU3Ny00Mi44OGg2Ni41MjZhMjk4OC43MTggMjk4OC43MTggMCAwMS0xOS41MjkgNjYuMzExbC01LjcyOCAxOC40ODJhMzIzNy40NiAzMjM3LjQ2IDAgMDEtMTQuMDE1IDQzLjc1MmMtNi40MzggMTkuNi0xMi43MzMgMzcuNjk4LTE4Ljg4NSA1NC4yOTRsLTMuMzA2IDguODI1Yy00Ljg4NCAxMi44OTgtOS40MzMgMjQuMjYzLTEzLjY0NyAzNC4wOTVoLTQ5Ljc4N2E4NDE3LjI4OSA4NDE3LjI4OSAwIDAxLTIxLjAzMS02NC44MDkgMTI4OC42ODYgMTI4OC42ODYgMCAwMS0xOC44ODUtNjQuODEgMTk3Mi40NDQgMTk3Mi40NDQgMCAwMS0xOC4yNCA2NC44MSAyNTc5LjQxMiAyNTc5LjQxMiAwIDAxLTIwLjM4OCA2NC44MWgtNDkuNzg3Yy00LjY4Mi0xMC45MjYtOS43Mi0yMy43NDMtMTUuMTEtMzguNDUxbC0xLjYyOS00LjQ3Yy01LjI1OC0xNC41MjEtMTAuNjgtMzAuMTkyLTE2LjI2Ni00Ny4wMTRsLTIuNDA0LTcuMjhjLTYuNDM4LTE5LjYtMTMuMDItNDAuMzQ0LTE5Ljc0My02Mi4yMzRhMjk4OC43MDcgMjk4OC43MDcgMCAwMS0xOS41MjktNjYuMzExaDY3LjM4NXoiIGZpbGw9IiM0Mjg1RjQiIGZpbGwtcnVsZT0ibm9uemVybyIvPjwvc3ZnPg==");
}
`);var wn={fullscreen:!0,"jump-to-start":!0,"play-step-backwards":!0,"play-pause":!0,"play-step":!0,"jump-to-end":!0,"twizzle-link":!0},Cr=class extends H{constructor(e,t,n){super(),this.model=e,this.controller=t,this.defaultFullscreenElement=n}buttons=null;connectedCallback(){this.addCSS(Lr);const e={};for(const t in wn){const n=new Nr;e[t]=n,n.htmlButton.addEventListener("click",()=>this.#e(t)),this.addElement(n)}this.buttons=e,this.model?.buttonAppearance.addFreshListener(this.update.bind(this)),this.model?.twistySceneModel.colorScheme.addFreshListener(this.updateColorScheme.bind(this))}#e(e){switch(e){case"fullscreen":{this.onFullscreenButton();break}case"jump-to-start":{this.controller?.jumpToStart({flash:!0});break}case"play-step-backwards":{this.controller?.animationController.play({direction:-1,untilBoundary:"move"});break}case"play-pause":{this.controller?.togglePlay();break}case"play-step":{this.controller?.animationController.play({direction:1,untilBoundary:"move"});break}case"jump-to-end":{this.controller?.jumpToEnd({flash:!0});break}case"twizzle-link":{this.controller?.visitTwizzleLink();break}default:throw new Error("Missing command")}}async onFullscreenButton(){if(!this.defaultFullscreenElement)throw new Error("Attempted to go fullscreen without an element.");if(vn()===this.defaultFullscreenElement)La();else{this.buttons?.fullscreen.setIcon("exit-fullscreen"),ka(await this.model?.twistySceneModel.fullscreenElement.get()??this.defaultFullscreenElement);const e=()=>{vn()!==this.defaultFullscreenElement&&(this.buttons?.fullscreen.setIcon("enter-fullscreen"),window.removeEventListener("fullscreenchange",e))};window.addEventListener("fullscreenchange",e)}}async update(e){for(const t in wn){const n=this.buttons[t],r=e[t];n.htmlButton.disabled=!r.enabled,n.htmlButton.title=r.title,n.setIcon(r.icon),n.hidden=!!r.hidden}}updateColorScheme(e){for(const t of Object.values(this.buttons??{}))t.updateColorScheme(e)}};R.define("twisty-buttons",Cr);var Nr=class extends H{htmlButton=document.createElement("button");updateColorScheme(e){this.contentWrapper.classList.toggle("dark-mode",e==="dark")}connectedCallback(){this.addCSS(kr),this.addElement(this.htmlButton)}#e=new Ye(this,"svg-",Ca);setIcon(e){this.#e.setValue(e)}};R.define("twisty-button",Nr);var Pr=new W;Pr.replaceSync(`
:host {
  width: 384px;
  height: 16px;
  display: grid;
}

.wrapper {
  width: 100%;
  height: 100%;
  display: grid;
  overflow: hidden;
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
  background: rgba(196, 196, 196, 0.75);
}

input:not(:disabled) {
  cursor: ew-resize;
}

.wrapper.dark-mode {
  background: #666666;
}
`);ae?.addEventListener("mousedown",e=>{e.which},!0);ae?.addEventListener("mouseup",e=>{e.which},!0);ae?.addEventListener("mousedown",()=>{},!1);ae?.addEventListener("mousemove",Rr,!1);ae?.addEventListener("mouseenter",Rr,!1);function Rr(e){e.pageY}var Or=class extends H{constructor(e,t){super(),this.model=e,this.controller=t}async onDetailedTimelineInfo(e){const t=await this.inputElem();t.min=e.timeRange.start.toString(),t.max=e.timeRange.end.toString(),t.disabled=t.min===t.max,t.value=e.timestamp.toString()}async connectedCallback(){this.addCSS(Pr),this.addElement(await this.inputElem()),this.model?.twistySceneModel.colorScheme.addFreshListener(this.updateColorScheme.bind(this))}updateColorScheme(e){this.contentWrapper.classList.toggle("dark-mode",e==="dark")}#e=null;async inputElem(){return this.#e??=(async()=>{const e=document.createElement("input");return e.type="range",e.disabled=!0,this.model?.detailedTimelineInfo.addFreshListener(this.onDetailedTimelineInfo.bind(this)),e.addEventListener("input",this.onInput.bind(this)),e.addEventListener("keydown",this.onKeypress.bind(this)),e})()}async onInput(e){const t=await this.inputElem();await this.slowDown(e,t);const n=parseInt(t.value,10);this.model?.playingInfo.set({playing:!1}),this.model?.timestampRequest.set(n)}onKeypress(e){switch(e.key){case"ArrowLeft":case"ArrowRight":{this.controller?.animationController.play({direction:e.key==="ArrowLeft"?-1:1,untilBoundary:"move"}),e.preventDefault();break}case" ":{this.controller?.togglePlay(),e.preventDefault();break}}}async slowDown(e,t){}};R.define("twisty-scrubber",Or);var Pa=null;async function yn(e,t){const[{ThreePerspectiveCamera:n,ThreeScene:r},i,s,a,l,u,c]=await Promise.all([(async()=>{const{ThreePerspectiveCamera:j,ThreeScene:A}=await J();return{ThreePerspectiveCamera:j,ThreeScene:A}})(),await e.puzzleLoader.get(),await e.visualizationStrategy.get(),await e.twistySceneModel.stickeringRequest.get(),await e.twistySceneModel.stickeringMaskRequest.get(),await e.legacyPosition.get(),await e.twistySceneModel.orbitCoordinates.get()]),d=t?.width??2048,m=t?.height??2048,h=d/m,v=Pa??=await(async()=>new n(20,h,.1,20))(),p=new r,M=new Er(e,{scheduleRender:()=>{}},i,s);p.add(await M.twisty3DPuzzle()),await yr(v,c);const D=(await vr(d,m,p,v)).toDataURL(),k=await Br(e);return{dataURL:D,download:async j=>{Fr(D,j??k)}}}async function Br(e){const[t,n]=await Promise.all([e.puzzleID.get(),e.alg.get()]);return`[${t}]${n.alg.experimentalNumChildAlgNodes()===0?"":` ${n.alg.toString()}`}`}function Fr(e,t,n="png"){const r=document.createElement("a");r.href=e,r.download=`${t}.${n}`,r.click()}var _r=new W;_r.replaceSync(`
:host {
  width: 384px;
  height: 256px;
  display: grid;

  -webkit-user-select: none;
  user-select: none;
}

.wrapper {
  display: grid;
  overflow: hidden;
  contain: size;
  grid-template-rows: 7fr minmax(1.5em, 0.5fr) minmax(2em, 1fr);
}

.wrapper > * {
  width: inherit;
  height: inherit;
  overflow: hidden;
}

.wrapper.controls-none {
  grid-template-rows: 7fr;
}

.wrapper.controls-none twisty-scrubber,
.wrapper.controls-none twisty-control-button-panel ,
.wrapper.controls-none twisty-scrubber,
.wrapper.controls-none twisty-buttons {
  display: none;
}

twisty-scrubber {
  background: rgba(196, 196, 196, 0.5);
}

.wrapper.checkered,
.wrapper.checkered-transparent {
  background-color: #EAEAEA;
  background-image: linear-gradient(45deg, #DDD 25%, transparent 25%, transparent 75%, #DDD 75%, #DDD),
    linear-gradient(45deg, #DDD 25%, transparent 25%, transparent 75%, #DDD 75%, #DDD);
  background-size: 32px 32px;
  background-position: 0 0, 16px 16px;
}

.wrapper.checkered-transparent {
  background-color: #F4F4F4;
  background-image: linear-gradient(45deg, #DDDDDD88 25%, transparent 25%, transparent 75%, #DDDDDD88 75%, #DDDDDD88),
    linear-gradient(45deg, #DDDDDD88 25%, transparent 25%, transparent 75%, #DDDDDD88 75%, #DDDDDD88);
}

.wrapper.dark-mode {
  background-color: #444;
  background-image: linear-gradient(45deg, #DDDDDD0b 25%, transparent 25%, transparent 75%, #DDDDDD0b 75%, #DDDDDD0b),
    linear-gradient(45deg, #DDDDDD0b 25%, transparent 25%, transparent 75%, #DDDDDD0b 75%, #DDDDDD0b);
}

.visualization-wrapper > * {
  width: 100%;
  height: 100%;
}

.error-elem {
  width: 100%;
  height: 100%;
  display: none;
  place-content: center;
  font-family: sans-serif;
  box-shadow: inset 0 0 2em rgb(255, 0, 0);
  color: red;
  text-shadow: 0 0 0.2em white;
  background: rgba(255, 255, 255, 0.25);
}

.wrapper.error .visualization-wrapper {
  display: none;
}

.wrapper.error .error-elem {
  display: grid;
}
`);var xn=class extends b{getDefaultValue(){return null}},Bt=class extends le{getDefaultValue(){return null}derive(e){return typeof e=="string"?new URL(e,location.href):e}},We=class Vr{warnings;errors;constructor(t){this.warnings=Object.freeze(t?.warnings??[]),this.errors=Object.freeze(t?.errors??[]),Object.freeze(this)}add(t){return new Vr({warnings:this.warnings.concat(t?.warnings??[]),errors:this.errors.concat(t?.errors??[])})}log(){this.errors.length>0?console.error(` ${this.errors[0]}`):this.warnings.length>0?console.warn(` ${this.warnings[0]}`):console.info(" No issues!")}};function Ur(e){try{const t=f.fromString(e),n=[];return t.toString()!==e&&n.push("Alg is non-canonical!"),{alg:t,issues:new We({warnings:n})}}catch(t){return{alg:new f,issues:new We({errors:[`Malformed alg: ${t.toString()}`]})}}}function Ra(e,t){return e.alg.isIdentical(t.alg)&&Pt(e.issues.warnings,t.issues.warnings)&&Pt(e.issues.errors,t.issues.errors)}var Sn=class extends le{getDefaultValue(){return{alg:new f,issues:new We}}canReuseValue(e,t){return Ra(e,t)}async derive(e){return typeof e=="string"?Ur(e):{alg:e,issues:new We}}},Oa=class extends z{derive(e){return e.kpuzzle.algToTransformation(e.setupAlg.alg)}},Ba=class extends z{derive(e){if(e.setupTransformation)return e.setupTransformation;switch(e.setupAnchor){case"start":return e.setupAlgTransformation;case"end":{const n=e.indexer.transformationAtIndex(e.indexer.numAnimatedLeaves()).invert();return e.setupAlgTransformation.applyTransformation(n)}default:throw new Error("Unimplemented!")}}},Fa=class extends b{getDefaultValue(){return null}},_a=class extends b{getDefaultValue(){return{move:null,amount:0}}canReuseValue(e,t){return e.move===t.move&&e.amount===t.amount}},Va=class extends z{derive(e){return{patternIndex:e.currentMoveInfo.patternIndex,movesFinishing:e.currentMoveInfo.movesFinishing.map(t=>t.move),movesFinished:e.currentMoveInfo.movesFinished.map(t=>t.move)}}canReuseValue(e,t){return e.patternIndex===t.patternIndex&&gn(e.movesFinishing,t.movesFinishing,(n,r)=>n.isIdentical(r))&&gn(e.movesFinished,t.movesFinished,(n,r)=>n.isIdentical(r))}},Ua=class extends z{derive(e){function t(n){return e.detailedTimelineInfo.atEnd&&e.catchUpMove.move!==null&&n.currentMoves.push({move:e.catchUpMove.move,direction:-1,fraction:1-e.catchUpMove.amount,startTimestamp:-1,endTimestamp:-1}),n}if(e.indexer.currentMoveInfo)return t(e.indexer.currentMoveInfo(e.detailedTimelineInfo.timestamp));{const n=e.indexer.timestampToIndex(e.detailedTimelineInfo.timestamp),r={patternIndex:n,currentMoves:[],movesFinishing:[],movesFinished:[],movesStarting:[],latestStart:-1/0,earliestEnd:1/0};if(e.indexer.numAnimatedLeaves()>0){const i=e.indexer.getAnimLeaf(n)?.as(o);if(!i)return t(r);const s=e.indexer.indexToMoveStartTimestamp(n),a=e.indexer.moveDuration(n),l=a?(e.detailedTimelineInfo.timestamp-s)/a:0,u=s+a,c={move:i,direction:1,fraction:l,startTimestamp:s,endTimestamp:u};l===0?r.movesStarting.push(c):l===1?r.movesFinishing.push(c):(r.currentMoves.push(c),r.latestStart=Math.max(r.latestStart,s),r.earliestEnd=Math.min(r.earliestEnd,u))}return t(r)}}},ja=class extends z{derive(e){let t=e.indexer.transformationAtIndex(e.currentLeavesSimplified.patternIndex);t=e.anchoredStart.applyTransformation(t);for(const n of e.currentLeavesSimplified.movesFinishing)t=t.applyMove(n);for(const n of e.currentLeavesSimplified.movesFinished)t=t.applyMove(n);return t.toKPattern()}},bn={u:"y",l:"x",f:"z",r:"x",b:"z",d:"y",m:"x",e:"y",s:"z",x:"x",y:"y",z:"z"};function qa(e,t){return bn[e.family[0].toLowerCase()]===bn[t.family[0].toLowerCase()]}var Ga=class extends we{traverseAlg(e){const t=[];for(const n of e.childAlgNodes())t.push(this.traverseAlgNode(n));return Array.prototype.concat(...t)}traverseGroupingOnce(e){if(e.experimentalIsEmpty())return[];const t=[];for(const i of e.childAlgNodes()){if(!(i.is(o)||i.is(Ae)||i.is(se)))return this.traverseAlg(e);const s=i.as(o);s&&t.push(s)}let n=he(t[0].amount);for(let i=0;i<t.length-1;i++){for(let s=1;s<t.length;s++)if(!qa(t[i],t[s]))return this.traverseAlg(e);n=Math.max(n,he(t[i].amount))}const r=t.map(i=>({animLeafAlgNode:i,msUntilNext:0,duration:n}));return r[r.length-1].msUntilNext=n,r}traverseGrouping(e){const t=[],n=e.amount>0?e.alg:e.alg.invert();for(let r=0;r<Math.abs(e.amount);r++)t.push(this.traverseGroupingOnce(n));return Array.prototype.concat(...t)}traverseMove(e){const t=he(e.amount);return[{animLeafAlgNode:e,msUntilNext:t,duration:t}]}traverseCommutator(e){const t=[],n=[e.A,e.B,e.A.invert(),e.B.invert()];for(const r of n)t.push(this.traverseGroupingOnce(r));return Array.prototype.concat(...t)}traverseConjugate(e){const t=[],n=[e.A,e.B,e.A.invert()];for(const r of n)t.push(this.traverseGroupingOnce(r));return Array.prototype.concat(...t)}traversePause(e){if(e.experimentalNISSGrouping)return[];const t=he(1);return[{animLeafAlgNode:e,msUntilNext:t,duration:t}]}traverseNewline(e){return[]}traverseLineComment(e){return[]}},Wa=U(Ga);function $a(e){let t=0;return Wa(e).map(r=>{const i={animLeaf:r.animLeafAlgNode,start:t,end:t+r.duration};return t+=r.msUntilNext,i})}var xt=class{constructor(e,t,n){this.kpuzzle=e,this.animLeaves=n?.animationTimelineLeaves??$a(t)}animLeaves;getAnimLeaf(e){return this.animLeaves[Math.min(e,this.animLeaves.length-1)]?.animLeaf??null}getAnimationTimelineLeaf(e){return this.animLeaves[Math.min(e,this.animLeaves.length-1)]}indexToMoveStartTimestamp(e){let t=0;return this.animLeaves.length>0&&(t=this.animLeaves[Math.min(e,this.animLeaves.length-1)].start),t}timestampToIndex(e){let t=0;for(t=0;t<this.animLeaves.length;t++)if(this.animLeaves[t].start>=e)return Math.max(0,t-1);return Math.max(0,t-1)}timestampToPosition(e,t){const n=this.currentMoveInfo(e);let r=t??this.kpuzzle.identityTransformation().toKPattern();for(const i of this.animLeaves.slice(0,n.patternIndex)){const s=i.animLeaf.as(o);s!==null&&(r=r.applyMove(s))}return{pattern:r,movesInProgress:n.currentMoves}}currentMoveInfo(e){let t=1/0;for(const c of this.animLeaves)if(c.start<=e&&c.end>=e)t=Math.min(t,c.start);else if(c.start>e)break;const n=[],r=[],i=[],s=[];let a=-1/0,l=1/0,u=0;for(const c of this.animLeaves)if(c.end<=t){if(!isFinite(t)&&c.start>e)break;u++}else{if(c.start>e)break;{const d=c.animLeaf.as(o);if(d!==null){let m=(e-c.start)/(c.end-c.start),h=!1;m>1&&(m=1,h=!0);const v={move:d,direction:1,fraction:m,startTimestamp:c.start,endTimestamp:c.end};switch(m){case 0:{r.push(v);break}case 1:{h?s.push(v):i.push(v);break}default:n.push(v),a=Math.max(a,c.start),l=Math.min(l,c.end)}}}}return{patternIndex:u,currentMoves:n,latestStart:a,earliestEnd:l,movesStarting:r,movesFinishing:i,movesFinished:s}}patternAtIndex(e,t){let n=t??this.kpuzzle.defaultPattern();for(let r=0;r<this.animLeaves.length&&r<e;r++){const s=this.animLeaves[r].animLeaf.as(o);s!==null&&(n=n.applyMove(s))}return n}transformationAtIndex(e){let t=this.kpuzzle.identityTransformation();for(const n of this.animLeaves.slice(0,e)){const r=n.animLeaf.as(o);r!==null&&(t=t.applyMove(r))}return t}algDuration(){let e=0;for(const t of this.animLeaves)e=Math.max(e,t.end);return e}numAnimatedLeaves(){return this.animLeaves.length}moveDuration(e){const t=this.getAnimationTimelineLeaf(e);return t.end-t.start}},Qa=1024,Ha=class extends z{derive(e){switch(e.indexerConstructorRequest){case"auto":return e.animationTimelineLeaves!==null||ua(e.alg.alg)<=Qa&&e.puzzle==="3x3x3"&&e.visualizationStrategy==="Cube3D"?xt:hn;case"tree":return hn;case"simple":return ma;case"simultaneous":return xt;default:throw new Error("Invalid indexer request!")}}},Ka=class extends b{getDefaultValue(){return"auto"}},Ya=class extends z{derive(e){return new e.indexerConstructor(e.kpuzzle,e.algWithIssues.alg,{animationTimelineLeaves:e.animationTimelineLeaves})}},Xa=class extends z{derive(e){return{pattern:e.currentPattern,movesInProgress:e.currentMoveInfo.currentMoves}}},Za=!0,Mn=class extends z{async derive(e){try{return Za&&e.kpuzzle.algToTransformation(e.algWithIssues.alg),e.algWithIssues}catch(t){return{alg:new f,issues:new We({errors:[`Invalid alg for puzzle: ${t.toString()}`]})}}}},Ja=class extends b{getDefaultValue(){return"start"}},eo=class extends b{getDefaultValue(){return null}},to=class extends z{async derive(e){return e.puzzleLoader.kpuzzle()}},no=class extends b{getDefaultValue(){return je}},ro=class extends z{async derive(e){return e.puzzleLoader.id}},io=class extends b{getDefaultValue(){return je}},so=class extends z{derive(e){if(e.puzzleIDRequest&&e.puzzleIDRequest!==je){const t=pr[e.puzzleIDRequest];return t||this.userVisibleErrorTracker.set({errors:[`Invalid puzzle ID: ${e.puzzleIDRequest}`]}),t}return e.puzzleDescriptionRequest&&e.puzzleDescriptionRequest!==je?ss(e.puzzleDescriptionRequest):qt}},ao=class extends z{derive(e){return{playing:e.playingInfo.playing,atStart:e.detailedTimelineInfo.atStart,atEnd:e.detailedTimelineInfo.atEnd}}canReuseValue(e,t){return e.playing===t.playing&&e.atStart===t.atStart&&e.atEnd===t.atEnd}},oo=class extends z{derive(e){let t=this.#e(e),n=!1,r=!1;return t>=e.timeRange.end&&(r=!0,t=Math.min(e.timeRange.end,t)),t<=e.timeRange.start&&(n=!0,t=Math.max(e.timeRange.start,t)),{timestamp:t,timeRange:e.timeRange,atStart:n,atEnd:r}}#e(e){switch(e.timestampRequest){case"auto":return e.setupAnchor==="start"&&e.setupAlg.alg.experimentalIsEmpty()?e.timeRange.end:e.timeRange.start;case"start":return e.timeRange.start;case"end":return e.timeRange.end;case"anchor":return e.setupAnchor==="start"?e.timeRange.start:e.timeRange.end;case"opposite-anchor":return e.setupAnchor==="start"?e.timeRange.end:e.timeRange.start;default:return e.timestampRequest}}canReuseValue(e,t){return e.timestamp===t.timestamp&&e.timeRange.start===t.timeRange.start&&e.timeRange.end===t.timeRange.end&&e.atStart===t.atStart&&e.atEnd===t.atEnd}},lo=class extends le{async getDefaultValue(){return{direction:1,playing:!1,untilBoundary:"entire-timeline",loop:!1}}async derive(e,t){const n=await t,r=Object.assign({},n);return Object.assign(r,e),r}canReuseValue(e,t){return e.direction===t.direction&&e.playing===t.playing&&e.untilBoundary===t.untilBoundary&&e.loop===t.loop}},co=class extends le{getDefaultValue(){return 1}derive(e){return e<0?1:e}},uo={auto:!0,start:!0,end:!0,anchor:!0,"opposite-anchor":!0},mo=class extends b{getDefaultValue(){return"auto"}set(e){const t=this.get();super.set((async()=>this.validInput(await e)?e:t)())}validInput(e){return!!(typeof e=="number"||uo[e])}},ho=class extends z{derive(e){return{start:0,end:e.indexer.algDuration()}}},po=class extends b{getDefaultValue(){return"auto"}},fo=class extends b{getDefaultValue(){return"auto"}},go=class extends z{derive(e){switch(e.puzzleID){case"clock":case"square1":case"redi_cube":case"melindas2x2x2x2":case"tri_quad":case"loopover":return"2D";case"3x3x3":switch(e.visualizationRequest){case"auto":case"3D":return"Cube3D";default:return e.visualizationRequest}default:switch(e.visualizationRequest){case"auto":case"3D":return"PG3D";case"experimental-2D-LL":case"experimental-2D-LL-face":return["2x2x2","4x4x4","megaminx"].includes(e.puzzleID)?"experimental-2D-LL":"2D";default:return e.visualizationRequest}}}},vo=class extends b{getDefaultValue(){return"auto"}},wo=class extends b{getDefaultValue(){return"auto"}},yo=class extends b{getDefaultValue(){return"auto"}},xo=null;async function So(){return xo??=new(await J()).ThreeTextureLoader}var In=class extends z{async derive(e){const{spriteURL:t}=e;return t===null?null:new Promise(async(n,r)=>{const i=()=>{console.warn("Could not load sprite:",t.toString()),n(null)};try{(await So()).load(t.toString(),n,i,i)}catch{i()}})}},bo={facelets:["regular","regular","regular","regular","regular"]};async function Mo(e){const{definition:t}=await e.kpuzzle(),n={orbits:{}};for(const r of t.orbits)n.orbits[r.orbitName]={pieces:new Array(r.numPieces).fill(bo)};return n}var Io=class extends z{getDefaultValue(){return{orbits:{}}}async derive(e){return e.stickeringMaskRequest?e.stickeringMaskRequest:e.stickeringRequest==="picture"?{specialBehaviour:"picture",orbits:{}}:e.puzzleLoader.stickeringMask?.(e.stickeringRequest??"full")??Mo(e.puzzleLoader)}},zo={"-":"Regular",D:"Dim",I:"Ignored",X:"Invisible",O:"IgnoreNonPrimary",P:"PermuteNonPrimary",o:"Ignoriented","?":"OrientationWithoutPermutation",M:"Mystery","@":"Regular"};function Do(e){const t={orbits:{}},n=e.split(",");for(const r of n){const[i,s,...a]=r.split(":");if(a.length>0)throw new Error(`Invalid serialized orbit stickering mask (too many colons): \`${r}\``);const l=[];t.orbits[i]={pieces:l};for(const u of s){const c=zo[u];l.push(Yn(c))}}return t}var To=class extends le{getDefaultValue(){return null}derive(e){return e===null?null:typeof e=="string"?Do(e):e}},Ao=class extends b{getDefaultValue(){return null}},Eo=class extends b{getDefaultValue(){return"auto"}},Lo=class extends b{getDefaultValue(){return{}}},ko=class extends b{getDefaultValue(){return"auto"}},Co=class extends b{getDefaultValue(){return"auto"}},No=class extends z{derive(e){return e.colorSchemeRequest==="dark"?"dark":"light"}},Po=class extends b{getDefaultValue(){return"auto"}},Ro=class extends b{getDefaultValue(){return null}},Oo=35,Bo=class extends b{getDefaultValue(){return Oo}};function jr(e,t){return e.latitude===t.latitude&&e.longitude===t.longitude&&e.distance===t.distance}var Fo=class extends le{getDefaultValue(){return"auto"}canReuseValue(e,t){return e===t||jr(e,t)}async derive(e,t){if(e==="auto")return"auto";let n=await t;n==="auto"&&(n={});const r=Object.assign({},n);return Object.assign(r,e),typeof r.latitude<"u"&&(r.latitude=Math.min(Math.max(r.latitude,-90),90)),typeof r.longitude<"u"&&(r.longitude=Rt(r.longitude,180,-180)),r}},_o=class extends z{canReuseValue(e,t){return jr(e,t)}async derive(e){if(e.orbitCoordinatesRequest==="auto")return Dn(e.puzzleID,e.strategy);const t=Object.assign(Object.assign({},Dn(e.puzzleID,e.strategy),e.orbitCoordinatesRequest));if(Math.abs(t.latitude)<=e.latitudeLimit)return t;{const{latitude:n,longitude:r,distance:i}=t;return{latitude:e.latitudeLimit*Math.sign(n),longitude:r,distance:i}}}},Vo={latitude:31.717474411461005,longitude:0,distance:5.877852522924731},Uo={latitude:35,longitude:30,distance:6},zn={latitude:35,longitude:30,distance:6.25},jo={latitude:Math.atan(1/2)*Ge,longitude:0,distance:6.7},qo={latitude:26.56505117707799,longitude:0,distance:6};function Dn(e,t){if(e[1]==="x")return t==="Cube3D"?Uo:zn;switch(e){case"megaminx":case"gigaminx":return jo;case"pyraminx":case"master_tetraminx":return qo;case"skewb":return zn;default:return Vo}}var Go=class{constructor(e){this.twistyPlayerModel=e,this.orbitCoordinates=new _o({orbitCoordinatesRequest:this.orbitCoordinatesRequest,latitudeLimit:this.latitudeLimit,puzzleID:e.puzzleID,strategy:e.visualizationStrategy}),this.stickeringMask=new Io({stickeringMaskRequest:this.stickeringMaskRequest,stickeringRequest:this.stickeringRequest,puzzleLoader:e.puzzleLoader})}background=new Co;colorSchemeRequest=new Po;dragInput=new Eo;foundationDisplay=new wo;foundationStickerSpriteURL=new Bt;fullscreenElement=new Ro;hintFacelet=new _s;hintStickerSpriteURL=new Bt;initialHintFaceletsAnimation=new yo;latitudeLimit=new Bo;movePressInput=new ko;movePressCancelOptions=new Lo;orbitCoordinatesRequest=new Fo;stickeringMaskRequest=new To;stickeringRequest=new Ao;faceletScale=new vo;colorScheme=new No({colorSchemeRequest:this.colorSchemeRequest});foundationStickerSprite=new In({spriteURL:this.foundationStickerSpriteURL});hintStickerSprite=new In({spriteURL:this.hintStickerSpriteURL});orbitCoordinates;stickeringMask},Wo={errors:[]},$o=class extends b{getDefaultValue(){return Wo}reset(){this.set(this.getDefaultValue())}canReuseValue(e,t){return Pt(e.errors,t.errors)}},Qo=class{userVisibleErrorTracker=new $o;alg=new Sn;backView=new ya;controlPanel=new Ta;catchUpMove=new _a;indexerConstructorRequest=new Ka;playingInfo=new lo;puzzleDescriptionRequest=new no;puzzleIDRequest=new io;setupAnchor=new Ja;setupAlg=new Sn;setupTransformation=new eo;tempoScale=new co;timestampRequest=new mo;viewerLink=new po;visualizationFormat=new fo;title=new xn;videoURL=new Bt;competitionID=new xn;animationTimelineLeavesRequest=new Fa;puzzleLoader=new so({puzzleIDRequest:this.puzzleIDRequest,puzzleDescriptionRequest:this.puzzleDescriptionRequest},this.userVisibleErrorTracker);kpuzzle=new to({puzzleLoader:this.puzzleLoader});puzzleID=new ro({puzzleLoader:this.puzzleLoader});puzzleAlg=new Mn({algWithIssues:this.alg,kpuzzle:this.kpuzzle});puzzleSetupAlg=new Mn({algWithIssues:this.setupAlg,kpuzzle:this.kpuzzle});visualizationStrategy=new go({visualizationRequest:this.visualizationFormat,puzzleID:this.puzzleID});indexerConstructor=new Ha({alg:this.alg,puzzle:this.puzzleID,visualizationStrategy:this.visualizationStrategy,indexerConstructorRequest:this.indexerConstructorRequest,animationTimelineLeaves:this.animationTimelineLeavesRequest});setupAlgTransformation=new Oa({setupAlg:this.puzzleSetupAlg,kpuzzle:this.kpuzzle});indexer=new Ya({indexerConstructor:this.indexerConstructor,algWithIssues:this.puzzleAlg,kpuzzle:this.kpuzzle,animationTimelineLeaves:this.animationTimelineLeavesRequest});anchorTransformation=new Ba({setupTransformation:this.setupTransformation,setupAnchor:this.setupAnchor,setupAlgTransformation:this.setupAlgTransformation,indexer:this.indexer});timeRange=new ho({indexer:this.indexer});detailedTimelineInfo=new oo({timestampRequest:this.timestampRequest,timeRange:this.timeRange,setupAnchor:this.setupAnchor,setupAlg:this.setupAlg});coarseTimelineInfo=new ao({detailedTimelineInfo:this.detailedTimelineInfo,playingInfo:this.playingInfo});currentMoveInfo=new Ua({indexer:this.indexer,detailedTimelineInfo:this.detailedTimelineInfo,catchUpMove:this.catchUpMove});buttonAppearance=new Na({coarseTimelineInfo:this.coarseTimelineInfo,viewerLink:this.viewerLink});currentLeavesSimplified=new Va({currentMoveInfo:this.currentMoveInfo});currentPattern=new ja({anchoredStart:this.anchorTransformation,currentLeavesSimplified:this.currentLeavesSimplified,indexer:this.indexer});legacyPosition=new Xa({currentMoveInfo:this.currentMoveInfo,currentPattern:this.currentPattern});twistySceneModel=new Go(this);async twizzleLink(){const[e,t,n,r,i,s,a,l]=await Promise.all([this.viewerLink.get(),this.puzzleID.get(),this.puzzleDescriptionRequest.get(),this.alg.get(),this.setupAlg.get(),this.setupAnchor.get(),this.twistySceneModel.stickeringRequest.get(),this.twistySceneModel.twistyPlayerModel.title.get()]),u=e==="experimental-twizzle-explorer",c=new URL(`https://alpha.twizzle.net/${u?"explore":"edit"}/`);return r.alg.experimentalIsEmpty()||c.searchParams.set("alg",r.alg.toString()),i.alg.experimentalIsEmpty()||c.searchParams.set("setup-alg",i.alg.toString()),s!=="start"&&c.searchParams.set("setup-anchor",s),a!=="full"&&a!==null&&c.searchParams.set("experimental-stickering",a),u&&n!==je?c.searchParams.set("puzzle-description",n):t!=="3x3x3"&&c.searchParams.set("puzzle",t),l&&c.searchParams.set("title",l),c.toString()}experimentalAddAlgLeaf(e,t){const n=e.as(o);n?this.experimentalAddMove(n,t):this.alg.set((async()=>{const i=(await this.alg.get()).alg.concat(new f([e]));return this.timestampRequest.set("end"),i})())}experimentalAddMove(e,t){const n=typeof e=="string"?new o(e):e;this.alg.set((async()=>{const[{alg:r},i]=await Promise.all([this.alg.get(),this.puzzleLoader.get()]),s=Gn(r,n,{...t,...await ns(i)});return this.timestampRequest.set("end"),this.catchUpMove.set({move:n,amount:0}),s})())}experimentalRemoveFinalChild(){this.alg.set((async()=>{const e=(await this.alg.get()).alg,t=Array.from(e.childAlgNodes()),[n]=t.splice(-1);if(!n)return e;this.timestampRequest.set("end");const r=n.as(o);return r&&this.catchUpMove.set({move:r.invert(),amount:0}),new f(t)})())}};function x(e){return new Error(`Cannot get \`.${e}\` directly from a \`TwistyPlayer\`.`)}var Ho=class extends H{experimentalModel=new Qo;set alg(e){this.experimentalModel.alg.set(e)}get alg(){throw x("alg")}set experimentalSetupAlg(e){this.experimentalModel.setupAlg.set(e)}get experimentalSetupAlg(){throw x("setup")}set experimentalSetupAnchor(e){this.experimentalModel.setupAnchor.set(e)}get experimentalSetupAnchor(){throw x("anchor")}set puzzle(e){this.experimentalModel.puzzleIDRequest.set(e)}get puzzle(){throw x("puzzle")}set experimentalPuzzleDescription(e){this.experimentalModel.puzzleDescriptionRequest.set(e)}get experimentalPuzzleDescription(){throw x("experimentalPuzzleDescription")}set timestamp(e){this.experimentalModel.timestampRequest.set(e)}get timestamp(){throw x("timestamp")}set hintFacelets(e){this.experimentalModel.twistySceneModel.hintFacelet.set(e)}get hintFacelets(){throw x("hintFacelets")}set experimentalStickering(e){this.experimentalModel.twistySceneModel.stickeringRequest.set(e)}get experimentalStickering(){throw x("experimentalStickering")}set experimentalStickeringMaskOrbits(e){this.experimentalModel.twistySceneModel.stickeringMaskRequest.set(e)}get experimentalStickeringMaskOrbits(){throw x("experimentalStickeringMaskOrbits")}set experimentalFaceletScale(e){this.experimentalModel.twistySceneModel.faceletScale.set(e)}get experimentalFaceletScale(){throw x("experimentalFaceletScale")}set backView(e){this.experimentalModel.backView.set(e)}get backView(){throw x("backView")}set background(e){this.experimentalModel.twistySceneModel.background.set(e)}get background(){throw x("background")}set colorScheme(e){this.experimentalModel.twistySceneModel.colorSchemeRequest.set(e)}get colorScheme(){throw x("colorScheme")}set controlPanel(e){this.experimentalModel.controlPanel.set(e)}get controlPanel(){throw x("controlPanel")}set visualization(e){this.experimentalModel.visualizationFormat.set(e)}get visualization(){throw x("visualization")}set experimentalTitle(e){this.experimentalModel.title.set(e)}get experimentalTitle(){throw x("experimentalTitle")}set experimentalVideoURL(e){this.experimentalModel.videoURL.set(e)}get experimentalVideoURL(){throw x("experimentalVideoURL")}set experimentalCompetitionID(e){this.experimentalModel.competitionID.set(e)}get experimentalCompetitionID(){throw x("experimentalCompetitionID")}set viewerLink(e){this.experimentalModel.viewerLink.set(e)}get viewerLink(){throw x("viewerLink")}set experimentalMovePressInput(e){this.experimentalModel.twistySceneModel.movePressInput.set(e)}get experimentalMovePressInput(){throw x("experimentalMovePressInput")}set experimentalMovePressCancelOptions(e){this.experimentalModel.twistySceneModel.movePressCancelOptions.set(e)}get experimentalMovePressCancelOptions(){throw x("experimentalMovePressCancelOptions")}set cameraLatitude(e){this.experimentalModel.twistySceneModel.orbitCoordinatesRequest.set({latitude:e})}get cameraLatitude(){throw x("cameraLatitude")}set cameraLongitude(e){this.experimentalModel.twistySceneModel.orbitCoordinatesRequest.set({longitude:e})}get cameraLongitude(){throw x("cameraLongitude")}set cameraDistance(e){this.experimentalModel.twistySceneModel.orbitCoordinatesRequest.set({distance:e})}get cameraDistance(){throw x("cameraDistance")}set cameraLatitudeLimit(e){this.experimentalModel.twistySceneModel.latitudeLimit.set(e)}get cameraLatitudeLimit(){throw x("cameraLatitudeLimit")}set indexer(e){this.experimentalModel.indexerConstructorRequest.set(e)}get indexer(){throw x("indexer")}set tempoScale(e){this.experimentalModel.tempoScale.set(e)}get tempoScale(){throw x("tempoScale")}set experimentalSprite(e){this.experimentalModel.twistySceneModel.foundationStickerSpriteURL.set(e)}get experimentalSprite(){throw x("experimentalSprite")}set experimentalHintSprite(e){this.experimentalModel.twistySceneModel.hintStickerSpriteURL.set(e)}get experimentalHintSprite(){throw x("experimentalHintSprite")}set fullscreenElement(e){this.experimentalModel.twistySceneModel.fullscreenElement.set(e)}get fullscreenElement(){throw x("fullscreenElement")}set experimentalInitialHintFaceletsAnimation(e){this.experimentalModel.twistySceneModel.initialHintFaceletsAnimation.set(e)}get experimentalInitialHintFaceletsAnimation(){throw x("experimentalInitialHintFaceletsAnimation")}set experimentalDragInput(e){this.experimentalModel.twistySceneModel.dragInput.set(e)}get experimentalDragInput(){throw x("experimentalDragInput")}experimentalGet=new Ko(this.experimentalModel)},Ko=class{constructor(e){this.model=e}async alg(){return(await this.model.alg.get()).alg}async setupAlg(){return(await this.model.setupAlg.get()).alg}puzzleID(){return this.model.puzzleID.get()}async timestamp(){return(await this.model.detailedTimelineInfo.get()).timestamp}},St="data-",mt={alg:"alg","experimental-setup-alg":"experimentalSetupAlg","experimental-setup-anchor":"experimentalSetupAnchor",puzzle:"puzzle","experimental-puzzle-description":"experimentalPuzzleDescription",visualization:"visualization","hint-facelets":"hintFacelets","experimental-stickering":"experimentalStickering","experimental-stickering-mask-orbits":"experimentalStickeringMaskOrbits",background:"background","color-scheme":"colorScheme","control-panel":"controlPanel","back-view":"backView","experimental-initial-hint-facelets-animation":"experimentalInitialHintFaceletsAnimation","viewer-link":"viewerLink","experimental-move-press-input":"experimentalMovePressInput","experimental-drag-input":"experimentalDragInput","experimental-title":"experimentalTitle","experimental-video-url":"experimentalVideoURL","experimental-competition-id":"experimentalCompetitionID","camera-latitude":"cameraLatitude","camera-longitude":"cameraLongitude","camera-distance":"cameraDistance","camera-latitude-limit":"cameraLatitudeLimit","tempo-scale":"tempoScale","experimental-sprite":"experimentalSprite","experimental-hint-sprite":"experimentalHintSprite"},Yo=Object.fromEntries(Object.values(mt).map(e=>[e,!0])),Xo={experimentalMovePressCancelOptions:!0},Tn,qr=Symbol("intersectedCallback");function Zo(e){Tn??=new IntersectionObserver((t,n)=>{for(const r of t)r.isIntersecting&&r.intersectionRect.height>0&&(r.target[qr](),n.unobserve(r.target))}),Tn.observe(e)}var Xe=class extends Ho{controller=new za(this.experimentalModel,this);buttons;experimentalCanvasClickCallback=()=>{};constructor(e={}){super();for(const[t,n]of Object.entries(e)){if(!(Yo[t]||Xo[t])){console.warn(`Invalid config passed to TwistyPlayer: ${t}`);break}this[t]=n}}#e=new Ye(this,"controls-",["auto"].concat(Object.keys(Da)));#t=document.createElement("div");#n=document.createElement("div");#r=!1;connectedCallback(){this.addCSS(_r),Zo(this)}async[qr](){if(this.#r)return;this.#r=!0,this.addElement(this.#t).classList.add("visualization-wrapper"),this.addElement(this.#n).classList.add("error-elem"),this.#n.textContent="Error",this.experimentalModel.userVisibleErrorTracker.addFreshListener(t=>{const n=t.errors[0]??null;this.contentWrapper.classList.toggle("error",!!n),n&&(this.#n.textContent=n)});const e=new Or(this.experimentalModel,this.controller);this.contentWrapper.appendChild(e),this.buttons=new Cr(this.experimentalModel,this.controller,this),this.contentWrapper.appendChild(this.buttons),this.experimentalModel.twistySceneModel.background.addFreshListener(t=>{this.contentWrapper.classList.toggle("checkered",["auto","checkered"].includes(t)),this.contentWrapper.classList.toggle("checkered-transparent",t==="checkered-transparent")}),this.experimentalModel.twistySceneModel.colorScheme.addFreshListener(t=>{this.contentWrapper.classList.toggle("dark-mode",["dark"].includes(t))}),this.experimentalModel.controlPanel.addFreshListener(t=>{this.#e.setValue(t)}),this.experimentalModel.visualizationStrategy.addFreshListener(this.#l.bind(this)),this.experimentalModel.puzzleID.addFreshListener(this.flash.bind(this))}#s="auto";experimentalSetFlashLevel(e){this.#s=e}flash(){this.#s==="auto"&&this.#i?.animate([{opacity:.25},{opacity:1}],{duration:250,easing:"ease-out"})}#i=null;#a=new Ar;#o=null;#l(e){if(e!==this.#o){this.#i?.remove(),this.#i?.disconnect();let t;switch(e){case"2D":case"experimental-2D-LL":case"experimental-2D-LL-face":{t=new Tr(this.experimentalModel.twistySceneModel,e);break}case"Cube3D":case"PG3D":{t=new Ot(this.experimentalModel),this.#a.handleNewValue(t);break}default:throw new Error("Invalid visualization")}this.#t.appendChild(t),this.#i=t,this.#o=e}}async experimentalCurrentVantages(){this.connectedCallback();const e=this.#i;return e instanceof Ot?e.experimentalVantages():[]}async experimentalCurrentCanvases(){const e=await this.experimentalCurrentVantages(),t=[];for(const n of e)t.push((await n.canvasInfo()).canvas);return t}async experimentalCurrentThreeJSPuzzleObject(e){this.connectedCallback();const n=await(await this.#a.promise).experimentalTwisty3DPuzzleWrapper(),r=n.twisty3DPuzzle(),i=(async()=>{await r,await new Promise(s=>setTimeout(s,0))})();if(e){const s=new Ee(async()=>{});n.addEventListener("render-scheduled",async()=>{s.requestIsPending()||(s.requestAnimFrame(),await i,e())})}return r}jumpToStart(e){this.controller.jumpToStart(e)}jumpToEnd(e){this.controller.jumpToEnd(e)}play(){this.controller.togglePlay(!0)}pause(){this.controller.togglePlay(!1)}togglePlay(e){this.controller.togglePlay(e)}experimentalAddMove(e,t){this.experimentalModel.experimentalAddMove(e,t)}experimentalAddAlgLeaf(e,t){this.experimentalModel.experimentalAddAlgLeaf(e,t)}static get observedAttributes(){const e=[];for(const t of Object.keys(mt))e.push(t,St+t);return e}experimentalRemoveFinalChild(){this.experimentalModel.experimentalRemoveFinalChild()}attributeChangedCallback(e,t,n){e.startsWith(St)&&(e=e.slice(St.length));const r=mt[e];r&&(this[r]=n)}async experimentalScreenshot(e){return(await yn(this.experimentalModel,e)).dataURL}async experimentalDownloadScreenshot(e){if(["2D","experimental-2D-LL","experimental-2D-LL-face"].includes(await this.experimentalModel.visualizationStrategy.get())){const n=await this.#i.currentTwisty2DPuzzleWrapper().twisty2DPuzzle(),r=new XMLSerializer().serializeToString(n.svgWrapper.svgElement),i=URL.createObjectURL(new Blob([r]));Fr(i,e??await Br(this.experimentalModel),"svg")}else await(await yn(this.experimentalModel)).download(e)}};R.define("twisty-player",Xe);var Jo=class extends ve{traverseAlg(e,t){const n=[];let r=0;for(const i of e.childAlgNodes()){const s=this.traverseAlgNode(i,{numMovesSoFar:t.numMovesSoFar+r});n.push(s.tokens),r+=s.numLeavesInside}return{tokens:Array.prototype.concat(...n),numLeavesInside:r}}traverseGrouping(e,t){const n=this.traverseAlg(e.alg,t);return{tokens:n.tokens,numLeavesInside:n.numLeavesInside*e.amount}}traverseMove(e,t){return{tokens:[{leaf:e,idx:t.numMovesSoFar}],numLeavesInside:1}}traverseCommutator(e,t){const n=this.traverseAlg(e.A,t),r=this.traverseAlg(e.B,{numMovesSoFar:t.numMovesSoFar+n.numLeavesInside});return{tokens:n.tokens.concat(r.tokens),numLeavesInside:n.numLeavesInside*2+r.numLeavesInside}}traverseConjugate(e,t){const n=this.traverseAlg(e.A,t),r=this.traverseAlg(e.B,{numMovesSoFar:t.numMovesSoFar+n.numLeavesInside});return{tokens:n.tokens.concat(r.tokens),numLeavesInside:n.numLeavesInside*2+r.numLeavesInside*2}}traversePause(e,t){return{tokens:[{leaf:e,idx:t.numMovesSoFar}],numLeavesInside:1}}traverseNewline(e,t){return{tokens:[],numLeavesInside:0}}traverseLineComment(e,t){return{tokens:[],numLeavesInside:0}}},el=U(Jo),tl=class extends b{getDefaultValue(){return""}},nl=class extends z{derive(e){return Ur(e.value)}},rl=class extends le{getDefaultValue(){return{selectionStart:0,selectionEnd:0,endChangedMostRecently:!1}}async derive(e,t){const{selectionStart:n,selectionEnd:r}=e,i=await t,s=e.selectionStart===i.selectionStart&&e.selectionEnd!==(await t).selectionEnd;return{selectionStart:n,selectionEnd:r,endChangedMostRecently:s}}},il=class extends z{derive(e){return e.selectionInfo.endChangedMostRecently?e.selectionInfo.selectionEnd:e.selectionInfo.selectionStart}},sl=class extends z{derive(e){return el(e.algWithIssues.alg,{numMovesSoFar:0}).tokens}},al=class extends z{derive(e){function t(r){if(r===null)return null;let i;return e.targetChar<r.leaf[G]?i="before":e.targetChar===r.leaf[G]?i="start":e.targetChar<r.leaf[X]?i="inside":e.targetChar===r.leaf[X]?i="end":i="after",{leafInfo:r,where:i}}let n=null;for(const r of e.leafTokens){if(e.targetChar<r.leaf[G]&&n!==null)return t(n);if(e.targetChar<=r.leaf[X])return t(r);n=r}return t(n)}},ol=class{valueProp=new tl;selectionProp=new rl;targetCharProp=new il({selectionInfo:this.selectionProp});algEditorAlgWithIssues=new nl({value:this.valueProp});leafTokensProp=new sl({algWithIssues:this.algEditorAlgWithIssues});leafToHighlight=new al({leafTokens:this.leafTokensProp,targetChar:this.targetCharProp})},ll="//";function cl(e){try{return f.fromString(e)}catch{return null}}function Gr(e,t){const n=e.indexOf(t);return n===-1?[e,""]:[e.slice(0,n),e.slice(n)]}function An(e){const t=[];for(const n of e.split(`
`)){let[r,i]=Gr(n,ll);r=r.replaceAll("","'"),t.push(r+i)}return t.join(`
`)}function ul(e,t){const{value:n}=e,{selectionStart:r,selectionEnd:i}=e,s=n.slice(0,r),a=n.slice(i);t=t.replaceAll(`\r
`,`
`);const l=s.match(/\/\/[^\n]*$/),u=n[r-1]==="/"&&t[0]==="/",c=l||u,d=t.match(/\/\/[^\n]*$/);let m=t;if(c){const[T,D]=Gr(t,`
`);m=T+An(D)}else m=An(t);const h=!c&&r!==0&&![`
`," "].includes(m[0])&&![`
`," "].includes(n[r-1]),v=!d&&i!==n.length&&![`
`," "].includes(m.at(-1))&&![`
`," "].includes(n[i]);function p(T,D){const k=T+m+D,j=!!cl(s+k+a);return j&&(m=k),j}h&&v&&p(" "," ")||h&&p(" ","")||v&&p(""," "),ae?.execCommand("insertText",!1,m)||e.setRangeText(m,r,i,"end")}var Wr=new W;Wr.replaceSync(`
:host {
  width: 384px;
  display: grid;
}

.wrapper {
  /*overflow: hidden;
  resize: horizontal;*/

  background: var(--background, none);
  display: grid;
}

textarea, .carbon-copy {
  grid-area: 1 / 1 / 2 / 2;

  width: 100%;
  font-family: sans-serif;
  line-height: 1.2em;

  font-size: var(--font-size, inherit);
  font-family: var(--font-family, sans-serif);

  box-sizing: border-box;

  padding: var(--padding, 0.5em);
  /* Prevent horizontal growth. */
  overflow-x: hidden;
}

textarea {
  resize: none;
  background: none;
  z-index: 2;
  border: 1px solid var(--border-color, rgba(0, 0, 0, 0.25));
  overflow: hidden;
}

.carbon-copy {
  white-space: pre-wrap;
  word-wrap: break-word;
  color: transparent;
  user-select: none;
  pointer-events: none;

  z-index: 1;
}

.carbon-copy .highlight {
  background: var(--highlight-color, rgba(255, 128, 0, 0.5));
  padding: 0.1em 0.2em;
  margin: -0.1em -0.2em;
  border-radius: 0.2em;
}

.wrapper.issue-warning textarea,
.wrapper.valid-for-puzzle-warning textarea {
  outline: none;
  border: 1px solid rgba(200, 200, 0, 0.5);
  background: rgba(255, 255, 0, 0.1);
}

.wrapper.issue-error textarea,
.wrapper.valid-for-puzzle-error textarea {
  outline: none;
  border: 1px solid red;
  background: rgba(255, 0, 0, 0.1);
}
`);var nt="for-twisty-player",En="placeholder",Ln="twisty-player-prop",dl=class extends H{model=new ol;#e=document.createElement("textarea");#t=document.createElement("div");#n=document.createElement("span");#r=document.createElement("span");#s=document.createElement("span");#i=new Ye(this,"valid-for-puzzle-",["none","warning","error"]);#a=null;#o;get#l(){return this.#a===null?null:this.#a.experimentalModel[this.#o]}debugNeverRequestTimestamp=!1;constructor(e){super(),this.#t.classList.add("carbon-copy"),this.addElement(this.#t),this.#e.rows=1,this.addElement(this.#e),this.#n.classList.add("prefix"),this.#t.appendChild(this.#n),this.#r.classList.add("highlight"),this.#t.appendChild(this.#r),this.#s.classList.add("suffix"),this.#t.appendChild(this.#s),this.#e.placeholder="Alg",this.#e.setAttribute("spellcheck","false"),this.addCSS(Wr),this.#e.addEventListener("input",()=>{this.#u=!0,this.onInput()}),this.#e.addEventListener("blur",()=>this.onBlur()),document.addEventListener("selectionchange",()=>this.onSelectionChange()),e?.twistyPlayer&&(this.twistyPlayer=e.twistyPlayer),this.#o=e?.twistyPlayerProp??"alg",e?.twistyPlayerProp==="alg"&&this.model.leafToHighlight.addFreshListener(t=>{t&&this.highlightLeaf(t.leafInfo.leaf)})}connectedCallback(){this.#e.addEventListener("paste",e=>{const t=e.clipboardData?.getData("text");t&&(ul(this.#e,t),e.preventDefault(),this.onInput())})}set algString(e){this.#e.value=e,this.onInput()}get algString(){return this.#e.value}set placeholder(e){this.#e.placeholder=e}#u=!1;onInput(){this.#r.hidden=!0,this.highlightLeaf(null);const e=this.#e.value.trimEnd();this.model.valueProp.set(e),this.#l?.set(e)}async onSelectionChange(){if(document.activeElement!==this||this.shadow.activeElement!==this.#e||this.#o!=="alg")return;const{selectionStart:e,selectionEnd:t}=this.#e;this.model.selectionProp.set({selectionStart:e,selectionEnd:t})}async onBlur(){}setAlgIssueClassForPuzzle(e){this.#i.setValue(e)}#d(e){return e.endsWith(`
`)?`${e} `:e}#c=null;highlightLeaf(e){if(e===null){this.#n.textContent="",this.#r.textContent="",this.#s.textContent=this.#d(this.#e.value);return}e!==this.#c&&(this.#c=e,this.#n.textContent=this.#e.value.slice(0,e[G]),this.#r.textContent=this.#e.value.slice(e[G],e[X]),this.#s.textContent=this.#d(this.#e.value.slice(e[X])),this.#r.hidden=!1)}get twistyPlayer(){return this.#a}set twistyPlayer(e){if(this.#a){console.warn("twisty-player reassignment/clearing is not supported");return}this.#a=e,e&&((async()=>this.algString=this.#l?(await this.#l.get()).alg.toString():"")(),this.#o==="alg"&&(this.#a?.experimentalModel.puzzleAlg.addFreshListener(t=>{if(t.issues.errors.length===0){this.setAlgIssueClassForPuzzle(t.issues.warnings.length===0?"none":"warning");const n=t.alg,r=f.fromString(this.algString);n.isIdentical(r)||(this.algString=n.toString(),this.onInput())}else this.setAlgIssueClassForPuzzle("error")}),this.model.leafToHighlight.addFreshListener(async t=>{if(t===null)return;const[n,r]=await Promise.all([await e.experimentalModel.indexer.get(),await e.experimentalModel.timestampRequest.get()]);if(r==="auto"&&!this.#u)return;const i=n.indexToMoveStartTimestamp(t.leafInfo.idx),s=n.moveDuration(t.leafInfo.idx);let a;switch(t.where){case"before":{a=i;break}case"start":case"inside":{a=i+s/4;break}case"end":case"after":{a=i+s;break}default:throw console.log("invalid where"),new Error("Invalid where!")}this.debugNeverRequestTimestamp||e.experimentalModel.timestampRequest.set(a)}),e.experimentalModel.currentLeavesSimplified.addFreshListener(async t=>{const r=(await e.experimentalModel.indexer.get()).getAnimLeaf(t.patternIndex);this.highlightLeaf(r)})))}attributeChangedCallback(e,t,n){switch(e){case nt:{const r=document.getElementById(n);if(!r){console.warn(`${nt}= elem does not exist`);return}if(!(r instanceof Xe)){console.warn(`${nt}=is not a twisty-player`);return}this.twistyPlayer=r;return}case En:{this.placeholder=n;return}case Ln:{if(this.#a)throw console.log("cannot set prop"),new Error("cannot set prop after twisty player");this.#o=n;return}}}static get observedAttributes(){return[nt,En,Ln]}};R.define("twisty-alg-editor",dl);async function ml(e){return new Promise((t,n)=>{try{const r=document.getElementById(e);r&&t(r);const i=new MutationObserver(s=>{for(const a of s)a.attributeName==="id"&&a.target instanceof Element&&a.target.getAttribute("id")===e&&(t(a.target),i.disconnect())});i.observe(document.body,{attributeFilter:["id"],subtree:!0})}catch(r){n(r)}})}var $r=new W;$r.replaceSync(`
:host {
  display: inline;
}

.wrapper {
  display: inline;
}

a:not(:hover) {
  color: inherit;
  text-decoration: none;
}

twisty-alg-leaf-elem.twisty-alg-comment {
  color: rgba(0, 0, 0, 0.4);
}

.wrapper.current-move {
  background: rgba(66, 133, 244, 0.3);
  margin-left: -0.1em;
  margin-right: -0.1em;
  padding-left: 0.1em;
  padding-right: 0.1em;
  border-radius: 0.1em;
}
`);var hl=.25,Me=class extends H{constructor(e,t,n,r,i,s){if(super({mode:"open"}),this.algOrAlgNode=r,this.classList.add(e),this.addCSS($r),s){const a=this.contentWrapper.appendChild(document.createElement("a"));a.href="#",a.textContent=t,a.addEventListener("click",l=>{l.preventDefault(),n.twistyAlgViewer.jumpToIndex(n.earliestMoveIndex,i)})}else this.contentWrapper.appendChild(document.createElement("span")).textContent=t}pathToIndex(e){return[]}setCurrentMove(e){this.contentWrapper.classList.toggle("current-move",e)}};R.define("twisty-alg-leaf-elem",Me);var Ie=class extends qe{constructor(e,t){super(),this.algOrAlgNode=t,this.classList.add(e)}queue=[];addString(e){this.queue.push(document.createTextNode(e))}addElem(e){return this.queue.push(e.element),e.moveCount}flushQueue(e=1){for(const t of Qr(this.queue,e))this.append(t);this.queue=[]}pathToIndex(e){return[]}};R.define("twisty-alg-wrapper-elem",Ie);function pl(e){return e===1?-1:1}function fl(e,t){return t<0?pl(e):e}function Qr(e,t){if(t===1)return e;const n=Array.from(e);return n.reverse(),n}var gl=class extends ve{traverseAlg(e,t){let n=0;const r=new Ie("twisty-alg-alg",e);let i=!0;for(const s of On(e.childAlgNodes(),t.direction))i||r.addString(" "),i=!1,s.as(F)?.experimentalNISSGrouping&&r.addString("^("),s.as(B)?.experimentalNISSPlaceholder||(n+=r.addElem(this.traverseAlgNode(s,{earliestMoveIndex:t.earliestMoveIndex+n,twistyAlgViewer:t.twistyAlgViewer,direction:t.direction}))),s.as(F)?.experimentalNISSGrouping&&r.addString(")");return r.flushQueue(t.direction),{moveCount:n,element:r}}traverseGrouping(e,t){const n=e.experimentalAsSquare1Tuple(),r=fl(t.direction,e.amount);let i=0;const s=new Ie("twisty-alg-grouping",e);return s.addString("("),n?(i+=s.addElem({moveCount:1,element:new Me("twisty-alg-move",n[0].amount.toString(),t,n[0],!0,!0)}),s.addString(", "),i+=s.addElem({moveCount:1,element:new Me("twisty-alg-move",n[1].amount.toString(),t,n[1],!0,!0)})):i+=s.addElem(this.traverseAlg(e.alg,{earliestMoveIndex:t.earliestMoveIndex+i,twistyAlgViewer:t.twistyAlgViewer,direction:r})),s.addString(`)${e.experimentalRepetitionSuffix}`),s.flushQueue(),{moveCount:i*Math.abs(e.amount),element:s}}traverseMove(e,t){const n=new Me("twisty-alg-move",e.toString(),t,e,!0,!0);return t.twistyAlgViewer.highlighter.addMove(e[G],n),{moveCount:1,element:n}}traverseCommutator(e,t){let n=0;const r=new Ie("twisty-alg-commutator",e);r.addString("["),r.flushQueue();const[i,s]=Qr([e.A,e.B],t.direction);return n+=r.addElem(this.traverseAlg(i,{earliestMoveIndex:t.earliestMoveIndex+n,twistyAlgViewer:t.twistyAlgViewer,direction:t.direction})),r.addString(", "),n+=r.addElem(this.traverseAlg(s,{earliestMoveIndex:t.earliestMoveIndex+n,twistyAlgViewer:t.twistyAlgViewer,direction:t.direction})),r.flushQueue(t.direction),r.addString("]"),r.flushQueue(),{moveCount:n*2,element:r}}traverseConjugate(e,t){let n=0;const r=new Ie("twisty-alg-conjugate",e);r.addString("[");const i=r.addElem(this.traverseAlg(e.A,{earliestMoveIndex:t.earliestMoveIndex+n,twistyAlgViewer:t.twistyAlgViewer,direction:t.direction}));return n+=i,r.addString(": "),n+=r.addElem(this.traverseAlg(e.B,{earliestMoveIndex:t.earliestMoveIndex+n,twistyAlgViewer:t.twistyAlgViewer,direction:t.direction})),r.addString("]"),r.flushQueue(),{moveCount:n+i,element:r}}traversePause(e,t){return e.experimentalNISSGrouping?this.traverseAlg(e.experimentalNISSGrouping.alg,t):{moveCount:1,element:new Me("twisty-alg-pause",".",t,e,!0,!0)}}traverseNewline(e,t){const n=new Ie("twisty-alg-newline",e);return n.append(document.createElement("br")),{moveCount:0,element:n}}traverseLineComment(e,t){return{moveCount:0,element:new Me("twisty-alg-line-comment",`//${e.text}`,t,e,!1,!1)}}},vl=U(gl),wl=class{moveCharIndexMap=new Map;currentElem=null;addMove(e,t){this.moveCharIndexMap.set(e,t)}set(e){const t=e?this.moveCharIndexMap.get(e[G])??null:null;this.currentElem!==t&&(this.currentElem?.classList.remove("twisty-alg-current-move"),this.currentElem?.setCurrentMove(!1),t?.classList.add("twisty-alg-current-move"),t?.setCurrentMove(!0),this.currentElem=t)}},Hr=class extends qe{highlighter=new wl;#e;#t=null;lastClickTimestamp=null;constructor(e){super(),e?.twistyPlayer&&(this.twistyPlayer=e?.twistyPlayer)}connectedCallback(){}setAlg(e){this.#e=vl(e,{earliestMoveIndex:0,twistyAlgViewer:this,direction:1}).element,this.textContent="",this.appendChild(this.#e)}get twistyPlayer(){return this.#t}set twistyPlayer(e){this.#n(e)}async#n(e){if(this.#t){console.warn("twisty-player reassignment is not supported");return}if(e===null)throw new Error("clearing twistyPlayer is not supported");this.#t=e,this.#t.experimentalModel.alg.addFreshListener(r=>{this.setAlg(r.alg)});const t=(await this.#t.experimentalModel.alg.get()).alg,n=G in t?t:f.fromString(t.toString());this.setAlg(n),e.experimentalModel.currentMoveInfo.addFreshListener(r=>{let i=r.currentMoves[0];if(i??=r.movesStarting[0],i??=r.movesFinishing[0],!i)this.highlighter.set(null);else{const s=i.move;this.highlighter.set(s)}}),e.experimentalModel.detailedTimelineInfo.addFreshListener(r=>{r.timestamp!==this.lastClickTimestamp&&(this.lastClickTimestamp=null)})}async jumpToIndex(e,t){const n=this.#t;if(n){n.pause();const r=(async()=>{const i=await n.experimentalModel.indexer.get(),s=t?i.moveDuration(e)*hl:0;return i.indexToMoveStartTimestamp(e)+i.moveDuration(e)-s})();n.experimentalModel.timestampRequest.set(await r),this.lastClickTimestamp===await r?(n.play(),this.lastClickTimestamp=null):this.lastClickTimestamp=await r}}async attributeChangedCallback(e,t,n){if(e==="for"){let r=document.getElementById(n);if(r||console.info("for= elem does not exist, waiting for one"),await customElements.whenDefined("twisty-player"),r=await ml(n),!(r instanceof Xe)){console.warn("for= elem is not a twisty-player");return}this.twistyPlayer=r}}static get observedAttributes(){return["for"]}};R.define("twisty-alg-viewer",Hr);var lt=new W;lt.replaceSync(`
.wrapper {
  background: rgb(255, 245, 235);
  border: 1px solid rgba(0, 0, 0, 0.25);

  /* Workaround from https://stackoverflow.com/questions/40010597/how-do-i-apply-opacity-to-a-css-color-variable */
  --text-color: 0, 0, 0;
  --heading-background: 255, 230, 210;

  color: rgb(var(--text-color));
}

.setup-alg, twisty-alg-viewer {
  padding: 0.5em 1em;
}

.heading {
  background: rgba(var(--heading-background), 1);
  color: rgba(var(--text-color), 1);
  font-weight: bold;
  padding: 0.25em 0.5em;
  display: grid;
  grid-template-columns: auto 1fr;

  /* For the move count hover elems. */
  position: sticky;
}

.heading.title {
  background: rgb(255, 245, 235);
  font-size: 150%;
  white-space: pre-wrap;
}

.heading .move-count {
  font-weight: initial;
  text-align: right;
  color: rgba(var(--text-color), 0.4);
}

.wrapper.dark-mode .heading .move-count {
  color: rgba(var(--text-color), 0.7);
}

.heading a {
  text-decoration: none;
  color: inherit;
}

twisty-player {
  width: 100%;
  min-height: 128px;
  height: 288px;
  resize: vertical;
  overflow-y: hidden;
}

twisty-player + .heading {
  padding-top: 0.5em;
}

twisty-alg-viewer {
  display: inline-block;
}

.wrapper {
  container-type: inline-size;
}

.scrollable-region {
  border-top: 1px solid rgba(0, 0, 0, 0.25);
}

.scrollable-region {
  max-height: 18em;
  overflow-y: auto;
}

@container (min-width: 512px) {
  .responsive-wrapper {
    display: grid;
    grid-template-columns: 1fr 1fr;
  }
  twisty-player {
    height: 320px
  }
  .scrollable-region {
    border-top: none;
    border-left: 1px solid rgba(0, 0, 0, 0.25);
    contain: strict;
    max-height: 100cqh;
  }
}

.wrapper:fullscreen,
.wrapper:fullscreen .responsive-wrapper {
  width: 100%;
  height: 100%;
}

.wrapper:fullscreen twisty-player,
.wrapper:fullscreen .scrollable-region {
  height: 50%;
}

@container (min-width: 512px) {
  .wrapper:fullscreen twisty-player,
  .wrapper:fullscreen .scrollable-region {
    height: 100%;
  }
}

/* TODO: dedup with Twizzle Editor */
.move-count > span:hover:before {
  background-color: rgba(var(--heading-background), 1);
  color: rgba(var(--text-color), 1);
  backdrop-filter: blur(4px);
  z-index: 100;
  position: absolute;
  padding: 0.5em;
  top: 1.5em;
  right: 0;
  content: attr(data-before);
  white-space: pre-wrap;
  text-align: left;
}

.move-count > span:hover {
  color: rgba(var(--text-color), 1);
  cursor: help;
}
`);var Kr=new W;Kr.replaceSync(`
.wrapper {
  background: white;
  --heading-background: 232, 239, 253
}

.wrapper.dark-mode {
  --text-color: 236, 236, 236;
  --heading-background: 29, 29, 29;
}

.scrollable-region {
  overflow-y: auto;
}

.wrapper.dark-mode {
  background: #262626;
  --text-color: 142, 142, 142;
  border-color: #FFFFFF44;
  color-scheme: dark;
}

.wrapper.dark-mode .heading:not(.title) {
  background: #1d1d1d;
}

.heading.title {
  background: none;
}
`);function yl(e="",t=location.href){const n={alg:"alg","setup-alg":"experimental-setup-alg","setup-anchor":"experimental-setup-anchor",puzzle:"puzzle",stickering:"experimental-stickering","puzzle-description":"experimental-puzzle-description",title:"experimental-title","video-url":"experimental-video-url",competition:"experimental-competition-id"},r=new URL(t).searchParams,i={};for(const[s,a]of Object.entries(n)){const l=r.get(e+s);if(l!==null){const u=mt[a];i[u]=l}}return i}var rt="outer block moves (e.g. R, Rw, or 4r)",it="inner block moves (e.g. M or 2-5r)",kn={OBTM:`HTM = OBTM ("Outer Block Turn Metric"):
 ${it} count as 2 turns
 ${rt} count as 1 turn
 rotations (e.g. x) count as 0 turns`,OBQTM:`QTM = OBQTM ("Outer Block Quantum Turn Metric"):
 ${it} count as 2 turns per quantum (e.g. M2 counts as 4)
 ${rt} count as 1 turn per quantum (e.g. R2 counts as 2)
 rotations (e.g. x) count as 0 turns`,RBTM:`STM = RBTM ("Range Block Turn Metric"):
 ${it} count as 1 turn
 ${rt} count as 1 turn
 rotations (e.g. x) count as 0 turns`,RBQTM:`SQTM = RBQTM ("Range Block Quantum Turn Metric"):
 ${it} count as 1 turn per quantum (e.g. M2 counts as 2)
 ${rt} count as 1 turn per quantum (e.g. R2 counts as 2)
 rotations (e.g. x) count as 0 turns`,ETM:`ETM ("Execution Turn Metric"):
 all moves (including rotations) count as 1 turn`},xl={OBTM:"OB",OBQTM:"OBQ",RBTM:"RB",RBQTM:"RBQ",ETM:"E"},Sl=class extends H{constructor(e){super({mode:"open"}),this.options=e}twistyPlayer=null;a=null;#e(){if(this.contentWrapper.textContent="",this.a){const t=this.contentWrapper.appendChild(document.createElement("span"));t.textContent="",t.title="Could not show a player for link",this.addElement(this.a)}this.removeCSS(lt);const e=this.shadow.adoptedStyleSheets.indexOf(lt);typeof e<"u"&&this.shadow.adoptedStyleSheets.splice(e,e+1),this.#t?.remove()}#t;#n;#r;#s;async connectedCallback(){if(this.#r=this.addElement(document.createElement("div")),this.#r.classList.add("responsive-wrapper"),this.options?.colorScheme==="dark"&&this.contentWrapper.classList.add("dark-mode"),this.addCSS(lt),this.options?.cdnForumTweaks&&this.addCSS(Kr),this.a=this.querySelector("a"),!this.a)return;const e=yl("",this.a.href),t=this.a?.href,{hostname:n,pathname:r}=new URL(t);if(n!=="alpha.twizzle.net"){this.#e();return}if(["/edit/","/explore/"].includes(r)){const i=r==="/explore/";if(e.puzzle&&!(e.puzzle in pr)){const l=(await y(async()=>{const{getPuzzleDescriptionString:u}=await import("./index-MDAPUQL5.js");return{getPuzzleDescriptionString:u}},[])).getPuzzleDescriptionString(e.puzzle);delete e.puzzle,e.experimentalPuzzleDescription=l}if(this.twistyPlayer=this.#r.appendChild(new Xe({background:this.options?.cdnForumTweaks?"checkered-transparent":"checkered",colorScheme:this.options?.colorScheme==="dark"?"dark":"light",...e,viewerLink:i?"experimental-twizzle-explorer":"auto"})),this.twistyPlayer.fullscreenElement=this.contentWrapper,e.experimentalTitle&&(this.twistyPlayer.experimentalTitle=e.experimentalTitle),this.#n=this.#r.appendChild(document.createElement("div")),this.#n.classList.add("scrollable-region"),e.experimentalTitle&&this.#i(e.experimentalTitle).classList.add("title"),e.experimentalSetupAlg){this.#i("Setup",async()=>(await this.twistyPlayer?.experimentalModel.setupAlg.get())?.alg.toString()??null);const l=this.#n.appendChild(document.createElement("div"));l.classList.add("setup-alg"),l.textContent=new f(e.experimentalSetupAlg).toString()}const s=this.#i("Moves",async()=>(await this.twistyPlayer?.experimentalModel.alg.get())?.alg.toString()??null);this.#s=s.appendChild(bl(this.twistyPlayer.experimentalModel)),this.#s.classList.add("move-count"),this.#n.appendChild(new Hr({twistyPlayer:this.twistyPlayer})).part.add("twisty-alg-viewer")}else this.#e()}#i(e,t){const n=this.#n.appendChild(document.createElement("div"));n.classList.add("heading");const r=n.appendChild(document.createElement("span"));if(r.textContent=e,t){r.textContent+=" ";const i=r.appendChild(document.createElement("a"));i.textContent="",i.href="#",i.title="Copy to clipboard";async function s(a){i.textContent=a,await new Promise(l=>setTimeout(l,2e3)),i.textContent===a&&(i.textContent="")}i.addEventListener("click",async a=>{a.preventDefault(),i.textContent="";const l=await t();if(l)try{await navigator.clipboard.writeText(l),s("")}catch(u){throw s(""),u}else s("")})}return n}};R.define("twizzle-link",Sl);function bl(e,t=document.createElement("span")){async function n(){const[r,i]=await Promise.all([e.puzzleAlg.get(),e.puzzleLoader.get()]);if(r.issues.errors.length!==0){t.textContent="";return}let s=!0;function a(l){s?s=!1:t.append(")(");const u=t.appendChild(document.createElement("span")),c=da(i,l,r.alg);u.append(`${xl[l]}: `);const d=u.appendChild(document.createElement("span"));d.textContent=c.toString(),d.classList.add("move-number"),u.setAttribute("data-before",kn[l]??""),u.setAttribute("title",kn[l]??"")}t.textContent="(",i.id==="3x3x3"?(a("OBTM"),a("OBQTM"),a("RBTM")):i.pg&&(a("RBTM"),a("RBQTM")),a("ETM"),t.append(")")}return e.puzzleAlg.addFreshListener(n),e.puzzleID.addFreshListener(n),t}var Ml=`
:host {
  width: 384px;
  height: 256px;
  display: grid;
}

.wrapper {
  width: 100%;
  height: 100%;
  display: grid;
  grid-template-columns: 1fr;
  grid-template-rows: 1fr;
  place-content: center;
  overflow: hidden;
}

.wrapper > * {
  width: inherit;
  height: inherit;
  overflow: hidden;
}

twisty-player {
  width: 100%;
  height: 100%;
}
`,Il="333",zl=Il,Dl=class extends HTMLElement{#e;#t=document.createElement("div");#n={eventID:null,scramble:new f,visualization:null,checkered:!1};#r=new Xe({controlPanel:"none",hintFacelets:"none",visualization:"2D",background:"none"});get player(){return this.#r}constructor(){super(),this.#e=this.attachShadow({mode:"closed"}),this.#t.classList.add("wrapper"),this.#e.appendChild(this.#t);const e=document.createElement("style");e.textContent=Ml,this.#e.appendChild(e)}connectedCallback(){this.#t.appendChild(this.#r)}set event(e){const t=fs(e??zl);this.#r.puzzle=t?.puzzleID??"3x3x3",this.#n.eventID=e}get event(){return this.#n.eventID}set scramble(e){const t=new f(e??"");this.#r.alg=t,this.#n.scramble=t,this.#t.setAttribute("title",t.toString())}get scramble(){return this.#n.scramble}set visualization(e){this.#r.visualization=e??"2D",this.#n.visualization=e}get visualization(){return this.#n.visualization}set checkered(e){const t=!!e;this.#r.background=t?"checkered":"none",this.#n.checkered=t}get checkered(){return this.#n.checkered}attributeChangedCallback(e,t,n){switch(e){case"event":{this.event=n;break}case"scramble":{this.scramble=n;break}case"visualization":{this.visualization=n;break}case"checkered":{this.checkered=n!==null;break}}}static get observedAttributes(){return["event","scramble","visualization","checkered"]}};customElements.define("scramble-display",Dl);const w={timerPhase:0,interval:0,wcaInterval:0,wcaDelayCount:!1,inspecting:!1,inspection:0};function Yr(){w.timerPhase!==1?w.timerPhase++:w.timerPhase===1&&(ge("color","red"),w.wcaInterval=setInterval(()=>{ge("color","limeGreen"),w.wcaDelayCount++},300))}function Xr(){w.wcaDelayCount>=1?(w.timerPhase++,w.wcaDelayCount=0,clearInterval(w.wcaInterval)):(ge("color","#eaeaf0"),w.wcaDelayCount=0,clearInterval(w.wcaInterval))}function Zr(){w.inspection=0,w.inspecting=!0,ge("time",`${w.inspection}`),w.interval=setInterval(()=>{w.inspection++,w.inspection===8&&new Audio("./audio/8seconds.mp3").play(),w.inspection===12&&new Audio("./audio/12seconds.mp3").play(),w.inspection===17&&clearInterval(w.interval),ge("time",w.inspection)},1e3)}function bt(e){return(Math.floor(e*100)/100).toFixed(2)}function Tl(e){let t=e/1e3,n=Math.floor(t/60),r=Math.floor(n/60);if(n<1)return bt(t);if(n>=1)return t=t-60*n,`${n}: ${t<10?"0":""}${bt(t)}`;if(n>=60)return n=n-60*r,`${r}: ${n<10?"0":""}${n}: ${t<10?"0":""}${bt(t)}`}function Jr(){ge("color","#eaeaf0"),clearInterval(w.interval),w.inspecting=!1;const e=performance.now();w.interval=setInterval(()=>{ge("time",Tl(performance.now()-e))},10)}function ei(){clearInterval(w.interval),document.getElementById("timer").innerHTML,w.timerPhase=0}const g={mode:"ao5",solveCounter:0,solvesArray:[]};function ti(e){if(typeof e=="number")return e;if(e.includes(":")){const[t,n]=e.split(":");return parseInt(t,10)*60+parseFloat(n)}return parseFloat(e)}function Al(e){const t=Number(e);return Number.isFinite(t)?t.toFixed(2):"-"}function Cn(e){if(e>=60){const t=Math.floor(e/60),n=(e%60).toFixed(2).padStart(5,"0");return`${t}:${n}`}return e.toFixed(2)}function $e(e){return e.penalty==="DNF"?"DNF":e.penalty==="+2"?Cn(e.time+2)+" (+2)":Cn(e.time)}function L(e){if(e==="DNF"||(e=Number(e),!Number.isFinite(e)))return"DNF";if(e>=60){const t=Math.floor(e/60),n=(e%60).toFixed(2).padStart(5,"0");return`${t}:${n}`}return Al(e)}function $t(e,t){const n=e.map(c=>c.penalty==="DNF"?1/0:c.penalty==="+2"?c.time+2:c.time);let r=null,i=null;if(t==="ao5"){if(n.filter(D=>D===1/0).length>=2)return{dnf:!0};const d=[...n].sort((D,k)=>D-k);r=d[0],i=d[d.length-1];const m=d.slice(1,4);let h=null;m.includes(1/0)?h="DNF":h=m.reduce((D,k)=>D+k,0)/m.length;const v=n.filter(D=>D!==1/0),p=v.reduce((D,k)=>D+k,0)/v.length,M=v.reduce((D,k)=>D+Math.pow(k-p,2),0)/v.length,T=Math.sqrt(M);if(d.length===4){const D=(d[0]+d[1]+d[2])/3,k=(d[3]+d[2]+d[1])/3;return{dnf:!1,avg:h,best:r,worst:i,sigma:T,bpAo5:D,wpA05:k}}return{dnf:!1,avg:h,best:r,worst:i,sigma:T}}if(n.filter(c=>c===1/0).length>=1)return{dnf:!0};const a=n.reduce((c,d)=>c+d,0)/n.length,l=n.reduce((c,d)=>c+Math.pow(d-a,2),0)/n.length,u=Math.sqrt(l);return r=Math.min(...n),i=Math.max(...n),{dnf:!1,avg:a,best:r,worst:i,sigma:u}}function ni(e,t,n){let r=null;n===16?r="+2":n===17&&(r="DNF");const i=ti(e);g.solvesArray.push({time:i,penalty:r||null,scramble:t,inspection:n,createdAt:Date.now()}),g.solveCounter++;const s=g.mode==="ao5"?5:3;if(g.solveCounter===s){const a=$t(g.solvesArray,g.mode),l={mode:g.mode,average:a.avg==="DNF"?"DNF":L(a.avg),worst:L(a.worst),best:L(a.best),sigma:L(a.sigma),solves:structuredClone(g.solvesArray)};return g.solvesArray=[],g.solveCounter=0,l}return null}const I={sessions:JSON.parse(localStorage.getItem("sessions"))||{Default:{averages:[]}},currentSession:localStorage.getItem("currentSession")||"Default",selectEl:document.getElementById("sessionSelect")},El=_();g.mode=El.mode||"ao5";document.getElementById("modeBtn").textContent="Mode: "+g.mode;function Q(){localStorage.setItem("sessions",JSON.stringify(I.sessions)),localStorage.setItem("currentSession",I.currentSession)}function _(){return I.sessions[I.currentSession]||(I.sessions[I.currentSession]={averages:[]}),I.sessions[I.currentSession]}function De(){const e=I.selectEl;e.innerHTML="",Object.keys(I.sessions).forEach(n=>{const r=document.createElement("option");r.value=n,r.textContent=n,n===I.currentSession&&(r.selected=!0),e.appendChild(r)});const t=document.createElement("option");t.disabled=!0,t.textContent="",e.appendChild(t),e.appendChild(new Option(" New session...","__new__")),e.appendChild(new Option(" Rename current...","__rename__")),e.appendChild(new Option(" Delete current...","__delete__"))}function st(e){I.currentSession=e,Q(),De(),document.dispatchEvent(new CustomEvent("sessionChanged"))}I.selectEl.onchange=()=>{const e=I.selectEl.value;if(e==="__new__"){const t=prompt("New session name:");if(!t||I.sessions[t]){De();return}I.sessions[t]={averages:[]},st(t);return}if(e==="__rename__"){const t=I.currentSession,n=prompt("Rename session:",t);if(!n||n===t||I.sessions[n]){De();return}I.sessions[n]=I.sessions[t],delete I.sessions[t],st(n);return}if(e==="__delete__"){if(Object.keys(I.sessions).length===1){alert("You must have at least one session."),De();return}if(!confirm("Delete current session?")){De();return}delete I.sessions[I.currentSession];const t=Object.keys(I.sessions)[0];st(t);return}st(e)};De();function Ll(){const e=_();g.mode=g.mode==="ao5"?"mo3":"ao5",e.mode=g.mode,Q(),document.getElementById("modeBtn").textContent="Mode: "+g.mode,g.solvesArray=[],g.scramblesArray=[],g.solveCounter=0}function kl(){confirm("Delete all averages in this session?")&&(Ol(),g.solvesArray=[],g.scramblesArray=[],g.solveCounter=0)}function Cl(){const e=_();g.mode=e.mode||"ao5",document.getElementById("modeBtn").textContent="Mode: "+g.mode,g.solvesArray=[],g.scramblesArray=[],g.solveCounter=0}const ne=document.getElementById("detailsModal"),Nl=document.getElementById("modalBody"),Pl=document.getElementById("closeModalBtn");Pl.onclick=()=>ne.classList.add("hidden");ne.onclick=e=>{e.target===ne&&ne.classList.add("hidden")};function Qt(){const e=Ze();let t='<h3 class="modal-title">Session averages</h3>';e.forEach((n,r)=>{t+=`
            <div class="modal-average-card">
                <div class="modal-average-header">
                    <b>${n.mode} #${e.length-r}: ${n.average}</b>
                </div>

                <div class="modal-solves">
        `,n.solves.forEach((i,s)=>{t+=`
                <div class="modal-solve-row">
                    <div class="modal-solve-main">
                        <span>#${s+1}: ${$e(i)}</span>

                        <div class="modal-solve-actions">
                            <button onclick="setPenalty(${r}, ${s}, null)">OK</button>
                            <button onclick="setPenalty(${r}, ${s}, '+2')">+2</button>
                            <button onclick="setPenalty(${r}, ${s}, 'DNF')">DNF</button>
                            <button onclick="removeSolve(${r}, ${s})"></button>
                        </div>
                    </div>

                    <div class="modal-scramble">
                        ${n.solves[s].scramble}
                    </div>
                </div>
            `}),t+=`
                </div>
            </div>
        `}),Nl.innerHTML=t,ne.classList.remove("hidden")}function Rl(){const e=_();e.averages||(e.averages=[])}function ri(e){Rl(),_().averages.unshift(e),Q()}function Ol(){const e=_();e.averages=[],Q()}function Ze(){return _().averages||[]}function ii(){if(g.solvesArray.length>0)return{type:"current",solveIndex:g.solvesArray.length-1};const e=Ze();if(e.length===0)return null;const t=0,n=e[0];return!n||n.solves.length===0?null:{type:"saved",blockIndex:t,solveIndex:n.solves.length-1}}function Bl(e,t,n){const i=Ze()[e];i.solves[t].penalty=n;const s=$t(i.solves,i.mode).avg;i.average=s==="DNF"?"DNF":L(s),Q()}function Fl(e,t){const n=Ze();if(e===-1){if(t<0||t>=g.solvesArray.length)return;g.solvesArray.splice(t,1),g.solveCounter--,g.solveCounter<0&&(g.solveCounter=0);return}const r=n[e];if(e===0&&g.solvesArray.length===0){const s=r.solves.filter((a,l)=>l!==t);g.solvesArray=structuredClone(s),g.solveCounter=s.length,n.splice(e,1),ne.classList.add("hidden"),Q();return}if(confirm(`This solve belongs to a finished average.

OK = Replace this solve (reopen average)
Cancel = Delete the whole average`)){const s=r.solves.filter((a,l)=>l!==t);g.solvesArray=structuredClone(s),g.solveCounter=s.length,n.splice(e,1),ne.classList.add("hidden"),Q();return}confirm("Delete the entire average? This cannot be undone.")&&(n.splice(e,1),Q())}function Ht(e){const t=ii();t&&(t.type==="current"?g.solvesArray[t.solveIndex].penalty=e:window.setPenalty(t.blockIndex,t.solveIndex,e))}function _l(){const e=ii();e&&(e.type==="current"?window.removeSolve(-1,e.solveIndex,!0):window.removeSolve(e.blockIndex,e.solveIndex,!0))}const Vl=-180,ht=Vl*60*1e3;function Ul(e=Date.now()){const t=new Date(e+ht);return t.setUTCHours(0,0,0,0),t.getTime()-ht}function jl(e=Date.now()){const t=new Date(e+ht);return t.setUTCHours(23,59,59,999),t.getTime()-ht}function si(e){const t=[];return e.averages.forEach(n=>{n.solves.forEach(r=>{t.push(r)})}),g.solvesArray.forEach(n=>t.push(n)),t}function ai(e,t){let n=[],r=[],i=0;if(t.averages.forEach(d=>{d.average!=="DNF"&&r.push(ti(d.average))}),e.forEach(d=>{console.log(new Date(d.createdAt)),d.penalty===null?(n.push(d.time),i++):(d.penalty==="+2"&&n.push(d.time+2),i++)}),n.length===0)return{bestTime:0,mean:0,sigma:0,bestAvg:0,solveCounter:i};const s=r.length?Math.min(...r):0,a=Math.min(...n),l=n.reduce((d,m)=>d+m,0)/n.length,u=n.reduce((d,m)=>d+Math.pow(m-l,2),0)/n.length,c=Math.sqrt(u);return{bestTime:a,mean:l,sigma:c,bestAvg:s,solveCounter:i}}function ql(e,t){const n=Date.now();let r,i;return r=Ul(n),i=jl(n),e.filter(s=>s.createdAt>=r&&s.createdAt<=i)}function oi(){const e=_(),t=si(e);return ai(t,e)}function Gl(e){const t=_(),n=si(t),r=ql(n);return ai(r,t)}function Wl(){const e=oi();document.getElementById("stat-solves").textContent=e.solveCounter,document.getElementById("stat-best-time").textContent=L(e.bestTime),document.getElementById("stat-mean").textContent=L(e.mean),document.getElementById("stat-sigma").textContent=L(e.sigma),document.getElementById("stat-best-avg").textContent=L(e.bestAvg);const t=_(),n=document.getElementById("avg-table-head"),r=document.getElementById("avg-history-body");n.innerHTML="",r.innerHTML="";let i=0;t.averages.forEach(a=>{a.solves.length>i&&(i=a.solves.length)});let s="<tr><th>#</th><th>Type</th><th>Avg</th>";for(let a=0;a<i;a++)s+=`<th>${a+1}</th>`;s+=`
    <th>Best</th>
    <th>Worst</th>
    <th></th>
  </tr>`,n.innerHTML=s,t.averages.forEach((a,l)=>{const u=document.createElement("tr");let c=`
      <td>${t.averages.length-l}</td>
      <td>${a.mode.toUpperCase()}</td>
      <td><strong>${a.average}</strong></td>
    `;a.solves.forEach(m=>{c+=`<td>${$e(m)}</td>`});const d=i-a.solves.length;for(let m=0;m<d;m++)c+="<td></td>";c+=`
      <td>${a.best}</td>
      <td>${a.worst}</td>
      <td>${a.sigma}</td>
    `,u.innerHTML=c,r.appendChild(u)})}function $l(e,t){let n="";return e==="live"&&(n+=`
            <div class="history-average current-average">
                <div class="history-solves">
        `,g.solvesArray.forEach((r,i)=>{n+=`
                <div class="history-solve">
                    ${i+1} - ${$e(r)}
                </div>
            `}),n+=`
                </div>
            </div>
        `),e==="saved"&&t&&(n+=`
            <div class="history-average current-average">
                <div class="history-solves">
        `,t.solves.forEach((r,i)=>{n+=`
                <div class="history-solve">
                    ${i+1} - ${$e(r)}
                </div>
            `}),n+=`
                </div>
            </div>
        `),n}function Ql(e,t){let n="";for(let r=0;r<e.length;r++){const i=e[r];t==="saved"&&r===0||(n+=`
            <div class="history-block history-average">
                <div class="history-solves">
        `,i.solves.forEach((s,a)=>{n+=`
                <div class="history-solve">
                    ${a+1} - ${$e(s)}
                </div>
            `}),n+=`
                </div>
                <div class="history-title">
                    ${i.mode}: ${i.average}
                </div>
            </div>
        `)}return n}function Nn(e){return`
        Best single: ${e.bestTime!==1/0?L(e.bestTime):"-"}
        <br>
        Best ao5: ${e.bestAvg!==1/0?L(e.bestAvg):"-"}
        <br>
        Session Mean: ${e.mean?L(e.mean):"-"}
        <br>
        Session &sigma;: ${e.sigma?L(e.sigma):"-"}
        <br>
        Solves: ${e.solveCounter?e.solveCounter:"-"}
    `}function Hl({type:e,solves:t,mode:n,block:r}){if(e==="live"){if(!t||t.length===0)return"";const i=$t(t,n),s=i.best,a=i.worst,l=i.sigma,u=i.bpAo5,c=i.wpA05;return t.length===4&&n==="ao5"?`                
                Best: ${L(s)}
                <br>
                Worst: ${L(a)}
                <br>
                &sigma;: ${L(l)}
                <hr>
                bpAo5: ${L(u)}
                <br>
                wpAo5: ${L(c)}
            `:`                
            Best: ${L(s)}
            <br>
            Worst: ${L(a)}
            <br>
            &sigma;: ${L(l)}
        `}return e==="saved"&&r?`                
            Best: ${r.best}
            <br>
            Worst: ${r.worst}
            <br>
            &sigma;: ${r.sigma}
            <hr>
            ${r.mode}: ${r.average}
        `:""}function Y(){const e=Ze(),t=oi(),n=Gl(),r=document.getElementById("currentAverageValue"),i=document.getElementById("historyPanel"),s=document.getElementById("current-stats"),a=document.getElementById("stats"),l=document.getElementById("today-stats");let u=null,c=null;g.solvesArray.length>0?u="live":e.length>0&&(u="saved",c=e[0]),r&&(r.innerHTML=$l(u,c)),s&&(s.innerHTML=Hl({type:u,solves:g.solvesArray,mode:g.mode,block:c})),i&&(i.innerHTML=Ql(e,u)),a&&(a.innerHTML=Nn(t),l.innerHTML=Nn(n))}const pt=document.getElementById("eventSelect");let V=_().scrambleType||"333",fe=null;window.innerWidth>768?fe=document.querySelector("#scrambleVis"):fe=document.querySelector("#scrambleVis2");const Kl=_();V=Kl.scrambleType||"333";pt.value=V;Kt(V);Qe(V,fe);pt.addEventListener("change",()=>{const e=_();V=pt.value,e.scrambleType=V,Q(),Kt(V),Qe(V,fe)});document.addEventListener("sessionChanged",()=>{V=_().scrambleType||"333",pt.value=V,Kt(V),Qe(V,fe)});function ge(e,t){e==="color"?document.getElementById("timer").style.color=t:e==="time"&&(document.getElementById("timer").textContent=t)}function li(){const e=document.getElementById("timer"),t=document.getElementById("touchOverlay");if(!e||!t)return;function n(r){r===e||r===t||(r.contains(e)?[...r.children].forEach(n):r.classList.add("focus-hidden"))}n(document.body)}function ci(){document.querySelectorAll(".focus-hidden").forEach(e=>{e.classList.remove("focus-hidden")})}document.getElementById("touchOverlay").addEventListener("touchstart",e=>{if(e.preventDefault(),!e.repeat&&(Yr(),w.timerPhase===1&&!w.inspecting&&Zr(),w.timerPhase===3)){ei();const t=ni(document.getElementById("timer").innerHTML,Ft,w.inspection);t&&(ri(t),console.log(t)),Y(),Qe(V,fe),ci()}});document.getElementById("touchOverlay").addEventListener("touchend",e=>{e.preventDefault(),!e.repeat&&(w.timerPhase===1&&Xr(),w.timerPhase===2&&(Jr(),li()))});document.addEventListener("keydown",e=>{if(e.key===" "){if(e.preventDefault(),e.repeat)return;Yr()}if(e.key===" "&&w.timerPhase===1&&!w.inspecting&&Zr(),e.key===" "&&w.timerPhase===3){ei();const t=ni(document.getElementById("timer").innerHTML,Ft,w.inspection);t&&(ri(t),console.log(t)),Y(),Qe(V,fe),ci()}});document.addEventListener("keyup",e=>{e.preventDefault(),!e.repeat&&(e.key===" "&&w.timerPhase===1&&Xr(),e.key===" "&&w.timerPhase===2&&(Jr(),li()))});const ui=document.getElementById("stats-page"),Yl=document.getElementById("open-stats-btn"),Xl=document.getElementById("close-stats-btn");Yl.addEventListener("click",()=>{Wl(),ui.classList.add("open")});Xl.addEventListener("click",()=>{ui.classList.remove("open")});function Kt(e){const t=_(),r=Zl(e)?"mo3":"ao5";g.mode!==r&&(g.mode=r,t.mode=r,document.getElementById("modeBtn").textContent="Mode: "+r,g.solvesArray=[],g.solveCounter=0,Q())}function Zl(e){return["333bf","444bf","555bf","666","777"].includes(e)}async function Jl(){const e=["333","444","555","222","666"];for(const t of e)await Pn(t)}Jl();document.getElementById("modeBtn").addEventListener("click",()=>{Ll(),Y()});const Le={modeBtn:document.getElementById("modeBtn"),clearBtn:document.getElementById("clearBtn"),openSessionBtn:document.getElementById("modal-button"),penaltyOkBtn:document.getElementById("penaltyOkBtn"),penaltyPlus2Btn:document.getElementById("penaltyPlus2Btn"),penaltyDnfBtn:document.getElementById("penaltyDnfBtn"),removeLastBtn:document.getElementById("removeLastBtn")};document.querySelectorAll("button").forEach(e=>{e.addEventListener("click",()=>{e.blur()})});document.querySelectorAll("select").forEach(e=>{e.addEventListener("change",()=>{e.blur()})});window.setPenalty=function(e,t,n){Bl(e,t,n),Q(),Y(),ne.classList.contains("hidden")||Qt()};window.removeSolve=function(e,t){Fl(e,t),Q(),Y(),ne.classList.contains("hidden")||Qt()};document.addEventListener("sessionChanged",()=>{Cl(),Y()});Le.clearBtn.onclick=()=>{kl(),Y()};Le.openSessionBtn.onclick=Qt;Le.penaltyOkBtn.onclick=()=>{Ht(null),Y()};Le.penaltyPlus2Btn.onclick=()=>{Ht("+2"),Y()};Le.penaltyDnfBtn.onclick=()=>{Ht("DNF"),Y()};Le.removeLastBtn.onclick=()=>_l();Y();export{f as A,B as G,o as M,te as Q,Vs as T,Fs as a,J as b,qt as c,ec as g,tc as h};
