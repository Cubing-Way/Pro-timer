import { Message } from "@optique/core/message";
import { NonEmptyString } from "@optique/core/nonempty";
import { ValueParser } from "@optique/core/valueparser";

//#region src/valueparser.d.ts

/**
 * Custom error messages for path validation failures.
 * @since 0.5.0
 */
interface PathErrorOptions {
  /**
   * Custom error message when file extension is invalid.
   * Can be a static message or a function that receives input, expected
   * extensions, and actual extension.
   * @since 0.5.0
   */
  invalidExtension?: Message | ((input: string, extensions: readonly string[], actualExtension: string) => Message);
  /**
   * Custom error message when path does not exist.
   * Can be a static message or a function that receives the input path.
   * @since 0.5.0
   */
  pathNotFound?: Message | ((input: string) => Message);
  /**
   * Custom error message when path already exists (used with
   * {@link PathOptions.mustNotExist}).
   * Can be a static message or a function that receives the input path.
   * @since 0.9.0
   */
  pathAlreadyExists?: Message | ((input: string) => Message);
  /**
   * Custom error message when path is expected to be a file but isn't.
   * Can be a static message or a function that receives the input path.
   * @since 0.5.0
   */
  notAFile?: Message | ((input: string) => Message);
  /**
   * Custom error message when path is expected to be a directory but isn't.
   * Can be a static message or a function that receives the input path.
   * @since 0.5.0
   */
  notADirectory?: Message | ((input: string) => Message);
  /**
   * Custom error message when parent directory does not exist for new files.
   * Can be a static message or a function that receives the parent directory
   * path.
   * @since 0.5.0
   */
  parentNotFound?: Message | ((parentDir: string) => Message);
}
/**
 * Base configuration options shared by all {@link PathOptions} variants.
 */
interface PathOptionsBase {
  /**
   * The metavariable name for this parser, e.g., `"FILE"`, `"DIR"`.
   * @default "PATH"
   */
  readonly metavar?: NonEmptyString;
  /**
   * Expected type of path (file, directory, or either).
   * Only checked when {@link PathOptionsMustExist.mustExist} is `true`.
   * @default "either"
   */
  readonly type?: "file" | "directory" | "either";
  /**
   * Whether to allow creating new files/directories.
   * When `true` and {@link PathOptionsMustExist.mustExist} is `false`,
   * validates that parent directory exists.
   * @default false
   */
  readonly allowCreate?: boolean;
  /**
   * File extensions to accept (for files only).  Each extension must
   * start with a dot (e.g. `".json"`, `".yaml"`).
   */
  readonly extensions?: readonly string[];
  /**
   * Custom error messages for path validation failures.
   * @since 0.5.0
   */
  readonly errors?: PathErrorOptions;
}
/**
 * Configuration options for when the path must exist.
 */
interface PathOptionsMustExist extends PathOptionsBase {
  /**
   * When `true`, the path must exist on the filesystem.
   */
  readonly mustExist: true;
  /**
   * Cannot be used together with {@link mustExist}.
   */
  readonly mustNotExist?: never;
}
/**
 * Configuration options for when the path must not exist.
 * @since 0.9.0
 */
interface PathOptionsMustNotExist extends PathOptionsBase {
  /**
   * Cannot be used together with {@link mustNotExist}.
   */
  readonly mustExist?: never;
  /**
   * When `true`, the path must not exist on the filesystem.
   * Useful for output files to prevent accidental overwrites.
   * @since 0.9.0
   */
  readonly mustNotExist: true;
}
/**
 * Configuration options when no existence check is required.
 */
interface PathOptionsNoExistenceCheck extends PathOptionsBase {
  /**
   * Whether the path must exist on the filesystem.
   * @default false
   */
  readonly mustExist?: false;
  /**
   * Whether the path must not exist on the filesystem.
   * @default false
   */
  readonly mustNotExist?: false;
}
/**
 * Configuration options for the {@link path} value parser.
 *
 * Note that {@link PathOptionsMustExist.mustExist} and
 * {@link PathOptionsMustNotExist.mustNotExist} are mutually exclusive;
 * you cannot set both to `true` at the same time.
 */
type PathOptions = PathOptionsMustExist | PathOptionsMustNotExist | PathOptionsNoExistenceCheck;
/**
 * Creates a ValueParser for file system paths with validation options.
 *
 * This parser provides filesystem validation and type checking for command-line
 * path arguments. It can validate existence, file vs directory types, parent
 * directory existence for new files, and file extensions.
 *
 * @param options Configuration options for path validation.
 * @returns A ValueParser that validates and returns string paths.
 *
 * @example
 * ```typescript
 * import { path } from "@optique/run";
 * import { argument, object } from "@optique/core/parser";
 *
 * // Basic path parser (any path, no validation)
 * const configFile = argument(path());
 *
 * // File must exist
 * const inputFile = argument(path({ mustExist: true }));
 *
 * // Directory must exist
 * const outputDir = argument(path({ mustExist: true, type: "directory" }));
 *
 * // File can be created (parent directory must exist)
 * const logFile = argument(path({ type: "file", allowCreate: true }));
 *
 * // Config files with specific extensions
 * const config = argument(path({
 *   mustExist: true,
 *   type: "file",
 *   extensions: [".json", ".yaml", ".yml"]
 * }));
 * ```
 */
declare function path(options?: PathOptions): ValueParser<string>;
//#endregion
export { PathErrorOptions, PathOptions, PathOptionsBase, PathOptionsMustExist, PathOptionsMustNotExist, PathOptionsNoExistenceCheck, path };