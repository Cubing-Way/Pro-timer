{
  "version": 3,
  "sources": ["../../../../src/cubing/vendor/apache/comlink-everywhere/node-adapter.ts"],
  "sourcesContent": ["import type {\n  MessagePort as NodeMessagePort,\n  Worker as NodeWorker,\n} from \"node:worker_threads\";\n\nexport type { NodeWorker };\n\n/**\n * Copyright 2019 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *     http://www.apache.org/licenses/LICENSE-2.0\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\ntype EventHandler = EventListenerObject | ((event: any) => void);\n\nfunction nodeEndpoint(parentPort: NodeMessagePort | NodeWorker): Worker & {\n  nodeWorker?: import(\"node:worker_threads\").Worker;\n} {\n  const listeners = new WeakMap();\n  const parentPortAsNodeWorker = parentPort as NodeWorker;\n  const constructedWorker = {\n    postMessage: parentPort.postMessage.bind(parentPort),\n    addEventListener: (_: string, eh: EventHandler) => {\n      const l = (data: Event) => {\n        if (\"handleEvent\" in eh) {\n          eh.handleEvent({ data } as any);\n        } else {\n          eh({ data });\n        }\n      };\n      parentPort.on(\"message\", l);\n      listeners.set(eh, l);\n    },\n    removeEventListener: (_: string, eh: EventHandler) => {\n      const l = listeners.get(eh);\n      if (!l) {\n        return;\n      }\n      parentPort.off(\"message\", l);\n      listeners.delete(eh);\n    },\n    nodeWorker: parentPortAsNodeWorker,\n    terminate: () => {\n      parentPortAsNodeWorker.terminate();\n    },\n    // start: nep.start && nep.start.bind(nep),\n  } as Worker & {\n    nodeWorker?: import(\"node:worker_threads\").Worker;\n  };\n\n  /**  Unref the parent port to prevent `node` from hanging:\n   *\n   * - https://github.com/cubing/cubing.js/issues/358\n   * - https://github.com/nodejs/node/issues/53036#issuecomment-2118106710\n   */\n  // parentPortAsNodeWorker.unref();\n\n  return constructedWorker;\n}\n\nexport default nodeEndpoint;\n//# sourceMappingURL=node-adapter.mjs.map\n"],
  "mappings": ";AAsBA,SAAS,aAAa,YAEpB;AACA,QAAM,YAAY,oBAAI,QAAQ;AAC9B,QAAM,yBAAyB;AAC/B,QAAM,oBAAoB;AAAA,IACxB,aAAa,WAAW,YAAY,KAAK,UAAU;AAAA,IACnD,kBAAkB,CAAC,GAAW,OAAqB;AACjD,YAAM,IAAI,CAAC,SAAgB;AACzB,YAAI,iBAAiB,IAAI;AACvB,aAAG,YAAY,EAAE,KAAK,CAAQ;AAAA,QAChC,OAAO;AACL,aAAG,EAAE,KAAK,CAAC;AAAA,QACb;AAAA,MACF;AACA,iBAAW,GAAG,WAAW,CAAC;AAC1B,gBAAU,IAAI,IAAI,CAAC;AAAA,IACrB;AAAA,IACA,qBAAqB,CAAC,GAAW,OAAqB;AACpD,YAAM,IAAI,UAAU,IAAI,EAAE;AAC1B,UAAI,CAAC,GAAG;AACN;AAAA,MACF;AACA,iBAAW,IAAI,WAAW,CAAC;AAC3B,gBAAU,OAAO,EAAE;AAAA,IACrB;AAAA,IACA,YAAY;AAAA,IACZ,WAAW,MAAM;AACf,6BAAuB,UAAU;AAAA,IACnC;AAAA;AAAA,EAEF;AAWA,SAAO;AACT;AAEA,IAAO,uBAAQ;",
  "names": []
}
